<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SCI-HIGH: Playing!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <!-- Authentication Check -->
    <script>
      // Check authentication before loading the game
      function checkAuthentication() {
        const isAuthenticated = sessionStorage.getItem('sci_high_authenticated');
        const userType = sessionStorage.getItem('sci_high_user_type');
        const savedUser = localStorage.getItem('sci_high_user');
        
        if (!isAuthenticated || !savedUser) {
          // Redirect to login page
          alert('Please log in to access the game.');
          window.location.href = 'index.html';
          return false;
        }
        
        // Log user access for analytics
        console.log(`Game accessed by ${userType} user`);
        return true;
      }
      
      // Run check immediately
      if (!checkAuthentication()) {
        // Stop page loading if not authenticated
        document.documentElement.innerHTML = '<body style="background: #1a1a2e; color: white; text-align: center; padding: 50px;"><h1>Redirecting to login...</h1></body>';
      }
    </script>
    
    <style>
      /* Reset everything */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      /* Authentication overlay */
      #auth-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10001;
        color: white;
        font-family: 'Orbitron', monospace;
        text-align: center;
        padding: 20px;
      }
      
      #auth-overlay .logo {
        width: 120px;
        height: 120px;
        margin-bottom: 30px;
        animation: pulse 2s ease-in-out infinite;
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.05); }
      }
      
      #auth-overlay h2 {
        font-size: 28px;
        margin-bottom: 15px;
        color: #F4CE14;
      }
      
      #auth-overlay p {
        font-size: 16px;
        opacity: 0.8;
        margin-bottom: 30px;
      }
      
      #auth-overlay button {
        background: linear-gradient(to right, #F4CE14, #FFD700);
        color: #1a1a2e;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-family: 'Orbitron', monospace;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      
      #auth-overlay button:hover {
        transform: scale(1.05);
      }
      
      /* Orientation overlay */
      #orientation-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
      }
      
      #orientation-overlay .rotate-icon {
        font-size: 80px;
        margin-bottom: 20px;
        animation: rotate 2s linear infinite;
      }
      
      @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      #orientation-overlay h2 {
        font-size: 24px;
        margin-bottom: 10px;
      }
      
      #orientation-overlay p {
        font-size: 16px;
        opacity: 0.8;
      }
      
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent scrollbars */
        background-color: #000; /* Match black to avoid visible gaps */
      }
      
      body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #181818 0%, #333 100%);
        position: relative;
        overflow: hidden;
      }
      
      #game {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      /* Target the canvas element directly */
      canvas {
        display: block !important;
        margin: 0 auto !important;
        max-width: 100% !important;
        max-height: 100% !important;
      }
      
      /* Removed the glowing border effect */
      #game::after {
        display: none; /* Hiding the entire ::after element */
      }
      /* Removing the glow animation as it's no longer needed */
      @keyframes glow {
        0% { opacity: 0; }
        100% { opacity: 0; }
      }
      /* Parallax clouds */
      body .cloud, body .cloud2, body .cloud3 {
        position: absolute;
        top: 10%;
        left: -30vw;
        width: 60vw;
        height: 18vw;
        background: radial-gradient(ellipse at 30% 40%, #fffde4 60%, transparent 100%),
                    radial-gradient(ellipse at 70% 60%, #ffe600 40%, transparent 100%);
        opacity: 0.18;
        border-radius: 50%;
        filter: blur(2px);
        z-index: 1;
        pointer-events: none;
        animation: cloudmove 80s linear infinite;
      }
      body .cloud2 {
        top: 30%;
        left: -40vw;
        width: 80vw;
        height: 22vw;
        opacity: 0.13;
        filter: blur(3px);
        animation: cloudmove2 120s linear infinite;
      }
      body .cloud3 {
        top: 60%;
        left: -50vw;
        width: 70vw;
        height: 20vw;
        opacity: 0.10;
        filter: blur(4px);
        animation: cloudmove3 160s linear infinite;
      }
      @keyframes cloudmove {
        0% { left: -30vw; }
        100% { left: 110vw; }
      }
      @keyframes cloudmove2 {
        0% { left: -40vw; }
        100% { left: 120vw; }
      }
      @keyframes cloudmove3 {
        0% { left: -50vw; }
        100% { left: 130vw; }
      }
      
      /* Responsive tweaks */
      @media (max-width: 768px) {
        body {
          overflow: hidden;
        }
        
        #game {
          width: 100vw;
          height: 100vh;
          position: fixed;
          top: 0;
          left: 0;
        }
        
        canvas {
          width: 100vw !important;
          height: 100vh !important;
          max-width: none !important;
          max-height: none !important;
        }
      }
      
      @media (max-width: 500px) {
        #game {
          width: 100vw;
          height: 100vh;
        }
        
        canvas {
          width: 100% !important;
          height: 100% !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Authentication overlay -->
    <div id="auth-overlay">
      <img src="public/assets/img/buko_productions-logo.png" alt="SCI-HIGH Logo" class="logo" />
      <h2>Authentication Required</h2>
      <p>You need to be logged in to access the game</p>
      <button onclick="window.location.href='index.html'">Go to Login</button>
    </div>
    
    <!-- Orientation overlay for mobile portrait mode -->
    <div id="orientation-overlay">
      <div class="rotate-icon">ðŸ“±</div>
      <h2>Please rotate your device</h2>
      <p>This game is best played in landscape mode</p>
    </div>
    
    <div id="game"></div>
    
    <script>
      // Function to check if device is mobile
      function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
               (window.innerWidth <= 768 && window.innerHeight <= 1024);
      }
      
      // Function to handle orientation
      function handleOrientation() {
        const overlay = document.getElementById('orientation-overlay');
        const isMobile = isMobileDevice();
        const isPortrait = window.innerHeight > window.innerWidth;
        
        if (isMobile && isPortrait) {
          overlay.style.display = 'flex';
        } else {
          overlay.style.display = 'none';
        }
      }
      
      // Check orientation on load and resize
      window.addEventListener('load', handleOrientation);
      window.addEventListener('resize', handleOrientation);
      window.addEventListener('orientationchange', () => {
        setTimeout(handleOrientation, 100); // Small delay for orientation change
      });
      
      // Try to lock to landscape on mobile if Screen Orientation API is available
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(err => {
          console.log('Could not lock orientation:', err);
        });
      }
    </script>
    
    <script type="module" src="./src/game.js"></script>
  </body>
</html>