<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="public/assets/img/logo/SCI-HIGH_LOGO.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCI-HIGH: Developer Tools</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F4CE14',
              accent: '#379777',
              dark: '#1a1a2e',
              light: '#16213e',
              purple: '#9c27b0',
              cyan: '#00bcd4',
              textColor: '#ffffff',
              cardBg: 'rgba(22, 33, 62, 0.8)',
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace'],
              body: ['Exo 2', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      .game-bg {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
      }
      
      .neon-border {
        border: 2px solid #F4CE14;
        background: rgba(22, 33, 62, 0.8);
        box-shadow: 0 0 10px rgba(244, 206, 20, 0.3);
      }

      .code-block {
        background: #0f0f0f;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 16px;
        font-family: 'Courier New', monospace;
        color: #00ff00;
        overflow-x: auto;
      }

      .dev-card {
        background: rgba(22, 33, 62, 0.9);
        border: 2px solid #379777;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 0 20px rgba(55, 151, 119, 0.2);
      }

      .danger-card {
        border-color: #dc2626;
        box-shadow: 0 0 20px rgba(220, 38, 38, 0.2);
      }

      .warning-card {
        border-color: #f59e0b;
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
      }
    </style>
  </head>
  <body class="font-body game-bg text-textColor min-h-screen">
    <!-- Navigation -->
    <nav class="relative z-50 bg-gradient-to-r from-dark/90 to-light/90 backdrop-blur-md border-b-2 border-primary/30 py-4">
      <div class="max-w-6xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <img src="../public/assets/img/buko_productions-logo.png" alt="Buko Productions Logo" class="w-10 h-10 sm:w-12 sm:h-12" />
            <span class="font-gaming text-sm sm:text-xl font-bold text-primary">SCI-HIGH Developer Tools</span>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="text-textColor hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex space-x-4">
            <a href="index.html" class="px-3 sm:px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent/80 transition-all duration-300 text-sm sm:text-base">
              ğŸ  Back to Main
            </a>
            <button id="logout-btn" class="px-3 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all duration-300 hidden text-sm sm:text-base" onclick="logoutUser()">
              ğŸšª Logout
            </button>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-light/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <a href="index.html" class="block px-4 py-3 bg-accent text-white text-center rounded-lg hover:bg-accent/80 transition-all duration-300 shadow-lg">
              <span class="flex items-center justify-center">
                <span class="mr-2">ğŸ </span> Back to Main
              </span>
            </a>
            <button id="mobile-logout-btn" class="block w-full text-left px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all duration-300 hidden" onclick="logoutUser()">
              <span class="flex items-center">
                <span class="mr-2">ğŸšª</span> Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
      <!-- Access Control Notice -->
      <div class="dev-card danger-card mb-6 sm:mb-8">
        <h2 class="font-gaming text-xl sm:text-2xl text-red-400 mb-4">âš ï¸ DEVELOPER ACCESS ONLY</h2>
        <p class="text-gray-300 mb-4 text-sm sm:text-base">
          This page contains powerful development tools that can modify the database and user accounts. 
          Access is restricted to authorized developers only.
        </p>
        <div id="access-status" class="text-red-400 text-sm sm:text-base">
          ğŸ”’ Access Denied - Please authenticate as a developer
        </div>
      </div>

      <!-- Authentication Section -->
      <div id="auth-section" class="dev-card">
        <h3 class="font-gaming text-lg sm:text-xl text-primary mb-4">ğŸ” Developer Authentication</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-gray-300 text-sm mb-2">Developer Key</label>
            <input type="password" id="dev-key" placeholder="Enter developer access key" class="w-full px-3 sm:px-4 py-2 sm:py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none text-sm sm:text-base">
          </div>
          <button onclick="authenticateAsDeveloper()" class="w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 bg-accent text-white rounded-lg hover:bg-accent/80 transition-all duration-300 text-sm sm:text-base">
            ğŸ”“ Authenticate
          </button>
        </div>
      </div>

      <!-- Developer Tools (Hidden by default) -->
      <div id="dev-tools" class="hidden">
        
        <!-- User Management -->
        <div class="dev-card">
          <h3 class="font-gaming text-xl text-primary mb-4">ğŸ‘¥ User Management</h3>
          
          <!-- Create Admin User -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Create Admin User</h4>
            <p class="text-gray-400 text-sm mb-3">Creates a system administrator account with full privileges</p>
            <button onclick="createAdminUser()" class="px-4 py-2 bg-purple text-white rounded-lg hover:bg-purple/80 transition-all">
              ğŸ›¡ï¸ Create Admin
            </button>
          </div>

          <!-- Create Professor User -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Create Professor User</h4>
            <p class="text-gray-400 text-sm mb-3">Creates a professor account in Firebase with authentication</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
              <input type="email" id="prof-email" placeholder="Email" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <input type="password" id="prof-password" placeholder="Password" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <input type="text" id="prof-name" placeholder="Full Name" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <input type="text" id="prof-institution" placeholder="Institution (optional)" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
            </div>
            <button onclick="createProfessorFromForm()" class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent/80 transition-all">
              ğŸ‘¨â€ğŸ« Create Professor
            </button>
          </div>

          <!-- Sample Account Creation -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Sample Accounts</h4>
            <p class="text-gray-400 text-sm mb-3">Quick creation of test accounts for development</p>
            <div class="flex flex-wrap gap-2">
              <button onclick="createSampleProfessor()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">Sample Professor</button>
              <button onclick="createSampleStudent()" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700">Sample Student</button>
              <button onclick="createSampleGeneral()" class="px-3 py-1 bg-yellow-600 text-white text-sm rounded hover:bg-yellow-700">Sample General</button>
            </div>
          </div>
        </div>

        <!-- Student Management -->
        <div class="dev-card">
          <h3 class="font-gaming text-xl text-primary mb-4">ğŸ“ Student Management</h3>
          
          <!-- Create Student -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Create New Student</h4>
            <p class="text-gray-400 text-sm mb-3">Create a student account with academic information</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
              <input type="text" id="student-id" placeholder="Student ID (e.g., 2024-CS-001)" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <input type="text" id="student-name" placeholder="Full Name" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <select id="student-level" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
                <option value="">Select Academic Level</option>
                <option value="college">College</option>
                <option value="shs">Senior High School</option>
              </select>
              <input type="text" id="student-course" placeholder="Course (for college)" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <input type="text" id="student-year" placeholder="Year Level" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
              <select id="student-strand" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white">
                <option value="">Select Strand (for SHS)</option>
                <option value="STEM">STEM</option>
                <option value="ABM">ABM</option>
                <option value="HUMSS">HUMSS</option>
                <option value="GAS">GAS</option>
                <option value="TVL">TVL</option>
              </select>
            </div>
            <button onclick="createStudentFromForm()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all">
              â• Create Student
            </button>
          </div>

          <!-- Student Search & Management -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Search & Manage Students</h4>
            <div class="mb-3">
              <input type="text" id="search-student" placeholder="Search by Student ID or Name" class="px-3 py-2 bg-dark/50 border border-gray-600 rounded text-white w-full md:w-1/2">
              <button onclick="searchStudents()" class="ml-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                ğŸ” Search
              </button>
              <button onclick="loadAllStudents()" class="ml-2 px-4 py-2 bg-purple text-white rounded hover:bg-purple/80">
                ğŸ“‹ Load All
              </button>
            </div>
            
            <!-- Student Results Table -->
            <div id="student-results" class="hidden">
              <div class="overflow-x-auto">
                <table class="w-full text-sm border border-gray-600 rounded">
                  <thead class="bg-dark/50">
                    <tr>
                      <th class="px-3 py-2 text-left text-accent">Student ID</th>
                      <th class="px-3 py-2 text-left text-accent">Name</th>
                      <th class="px-3 py-2 text-left text-accent">Level</th>
                      <th class="px-3 py-2 text-left text-accent">Course/Strand</th>
                      <th class="px-3 py-2 text-left text-accent">Progress</th>
                      <th class="px-3 py-2 text-left text-accent">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="student-table-body" class="divide-y divide-gray-600">
                    <!-- Student rows will be populated here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Bulk Operations -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Bulk Operations</h4>
            <p class="text-gray-400 text-sm mb-3">Perform operations on multiple students</p>
            <div class="flex flex-wrap gap-2">
              <button onclick="exportStudentData()" class="px-3 py-1 bg-cyan text-white text-sm rounded hover:bg-cyan/80">
                ğŸ“¥ Export CSV
              </button>
              <button onclick="importStudentData()" class="px-3 py-1 bg-orange-600 text-white text-sm rounded hover:bg-orange-700">
                ğŸ“¤ Import CSV
              </button>
              <button onclick="resetAllProgress()" class="px-3 py-1 bg-yellow-600 text-white text-sm rounded hover:bg-yellow-700">
                ğŸ”„ Reset All Progress
              </button>
            </div>
            <input type="file" id="csv-import" accept=".csv" class="hidden">
          </div>

          <!-- Student Analytics -->
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Student Analytics</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="bg-dark/50 p-4 rounded border border-gray-600 text-center">
                <div class="text-2xl font-bold text-primary" id="total-students">0</div>
                <div class="text-sm text-gray-400">Total Students</div>
              </div>
              <div class="bg-dark/50 p-4 rounded border border-gray-600 text-center">
                <div class="text-2xl font-bold text-green-400" id="active-students">0</div>
                <div class="text-sm text-gray-400">Active Students</div>
              </div>
              <div class="bg-dark/50 p-4 rounded border border-gray-600 text-center">
                <div class="text-2xl font-bold text-cyan" id="avg-progress">0%</div>
                <div class="text-sm text-gray-400">Average Progress</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Database Management -->
        <div class="dev-card">
          <h3 class="font-gaming text-xl text-primary mb-4">ğŸ—„ï¸ Database Management</h3>
          
          <div class="mb-6">
            <h4 class="text-lg text-accent mb-2">Firebase Collections</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="bg-dark/50 p-4 rounded border border-gray-600">
                <h5 class="text-accent font-bold">professors</h5>
                <p class="text-sm text-gray-400">Professor and admin accounts</p>
                <button onclick="viewProfessors()" class="mt-2 px-3 py-1 bg-accent text-white text-sm rounded">View</button>
              </div>
              <div class="bg-dark/50 p-4 rounded border border-gray-600">
                <h5 class="text-accent font-bold">students</h5>
                <p class="text-sm text-gray-400">Student accounts and progress</p>
                <button onclick="viewStudents()" class="mt-2 px-3 py-1 bg-accent text-white text-sm rounded">View</button>
              </div>
              <div class="bg-dark/50 p-4 rounded border border-gray-600">
                <h5 class="text-accent font-bold">general_users</h5>
                <p class="text-sm text-gray-400">General user accounts</p>
                <button onclick="viewGeneralUsers()" class="mt-2 px-3 py-1 bg-accent text-white text-sm rounded">View</button>
              </div>
            </div>
          </div>

          <div class="danger-card mb-6">
            <h4 class="text-lg text-red-400 mb-2">âš ï¸ Danger Zone</h4>
            <p class="text-gray-400 text-sm mb-3">These actions are irreversible and affect the production database</p>
            <div class="flex flex-wrap gap-2">
              <button onclick="clearStudentData()" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">Clear Student Data</button>
              <button onclick="resetDatabase()" class="px-3 py-1 bg-red-800 text-white text-sm rounded hover:bg-red-900">Reset Database</button>
            </div>
          </div>
        </div>

        <!-- System Information -->
        <div class="dev-card">
          <h3 class="font-gaming text-xl text-primary mb-4">ğŸ“Š System Information</h3>
          <div id="system-info">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <h4 class="text-accent mb-2">Current User</h4>
                <div id="current-user-info" class="code-block text-sm">
                  No user logged in
                </div>
              </div>
              <div>
                <h4 class="text-accent mb-2">Firebase Status</h4>
                <div id="firebase-status" class="code-block text-sm">
                  Checking Firebase connection...
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Console Commands -->
        <div class="dev-card">
          <h3 class="font-gaming text-xl text-primary mb-4">âŒ¨ï¸ Console Commands</h3>
          <p class="text-gray-400 mb-4">You can also use these commands directly in the browser console (F12):</p>
          <div class="code-block">
<pre>// User Management
createAdminUser()                                    // Create admin account
createProfessorUser(email, password, name, institution) // Create professor in Firebase
createSampleProfessor()                             // Create sample professor
createSampleStudent()                               // Create sample student
createSampleGeneral()                               // Create sample general user

// Authentication
logoutUser()                                        // Logout current user

// Information
showDevCommands()                                   // Show help in console
authManager.currentUser                             // View current user data
authManager.userType                                // View current user type</pre>
          </div>
        </div>

        <!-- Log Viewer -->
        <div class="dev-card">
          <h3 class="font-gaming text-xl text-primary mb-4">ğŸ“ System Logs</h3>
          <div class="mb-4">
            <button onclick="clearLogs()" class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700">Clear Logs</button>
            <button onclick="downloadLogs()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">Download Logs</button>
          </div>
          <div id="log-viewer" class="code-block h-64 overflow-y-auto">
            System initialized...
          </div>
        </div>

      </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <script>
      // Initialize Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
        authDomain: "sci-high-website.firebaseapp.com",
        databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sci-high-website",
        storageBucket: "sci-high-website.appspot.com",
        messagingSenderId: "451463202515",
        appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
      };
      
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }

      // Developer access key (in production, this should be more secure)
      const DEV_ACCESS_KEY = "sci-high-dev-2025";
      let isDeveloperAuthenticated = false;

      // Authentication Management
      class DevAuthManager {
        constructor() {
          this.currentUser = null;
          this.userType = null;
          this.initializeAuth();
        }

        async initializeAuth() {
          const savedUser = localStorage.getItem('sci_high_user');
          if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            this.userType = this.currentUser.type;
            this.updateUI();
          }
          this.updateSystemInfo();
        }

        updateUI() {
          const logoutBtn = document.getElementById('logout-btn');
          if (this.currentUser && this.userType !== 'guest') {
            logoutBtn.classList.remove('hidden');
          } else {
            logoutBtn.classList.add('hidden');
          }
        }

        async updateSystemInfo() {
          const currentUserInfo = document.getElementById('current-user-info');
          const firebaseStatus = document.getElementById('firebase-status');
          
          if (this.currentUser) {
            currentUserInfo.innerHTML = `
Type: ${this.userType}
UID: ${this.currentUser.uid}
Email: ${this.currentUser.email || 'N/A'}
Name: ${this.currentUser.profile?.fullName || 'N/A'}
            `;
          } else {
            currentUserInfo.textContent = 'No user logged in';
          }

          // Check Firebase status
          try {
            const testDoc = await firebase.firestore().collection('test').limit(1).get();
            firebaseStatus.innerHTML = `
Status: âœ… Connected
Project: ${firebase.app().options.projectId}
Auth: ${firebase.auth().currentUser ? 'âœ… Authenticated' : 'âŒ Not authenticated'}
            `;
          } catch (error) {
            firebaseStatus.innerHTML = `
Status: âŒ Connection failed
Error: ${error.message}
            `;
          }
        }

        logout() {
          const confirmLogout = confirm('Are you sure you want to logout?');
          if (!confirmLogout) return;

          if (this.userType !== 'guest') {
            firebase.auth().signOut();
          }
          
          this.currentUser = null;
          this.userType = null;
          localStorage.removeItem('sci_high_user');
          this.updateUI();
          this.updateSystemInfo();
          
          alert('You have been logged out successfully!');
        }

        // All the user creation methods from the main page
        async createAdminUser() {
          try {
            const adminData = {
              fullName: 'System Administrator',
              email: 'admin@sci-high.edu',
              isAdmin: true,
              type: 'admin',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString(),
              permissions: ['read', 'write', 'delete', 'admin']
            };

            if (typeof firebase !== 'undefined' && firebase.firestore) {
              const adminRef = firebase.firestore().collection('professors').doc('admin_system');
              await adminRef.set(adminData);
              this.log('Admin user saved to Firebase');
            }

            this.currentUser = {
              uid: 'admin_system',
              type: 'admin',
              profile: adminData
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'admin';
            this.updateUI();
            this.updateSystemInfo();
            
            return this.currentUser;
          } catch (error) {
            this.log('Error creating admin user: ' + error.message);
            throw error;
          }
        }

        async createProfessorUser(email, password, fullName, institution = 'SCI-HIGH University') {
          try {
            if (typeof firebase === 'undefined' || !firebase.auth) {
              throw new Error('Firebase not available');
            }

            const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;

            const professorData = {
              fullName: fullName,
              email: email,
              institution: institution,
              isVerified: true,
              type: 'professor',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString(),
              permissions: ['read', 'write'],
              classes: [],
              students: []
            };

            await firebase.firestore().collection('professors').doc(user.uid).set(professorData);

            this.log(`Professor user created: ${email} (${fullName})`);

            return {
              success: true,
              uid: user.uid,
              email: email,
              profile: professorData
            };

          } catch (error) {
            this.log('Error creating professor user: ' + error.message);
            return {
              success: false,
              error: error.message
            };
          }
        }

        log(message) {
          const logViewer = document.getElementById('log-viewer');
          const timestamp = new Date().toLocaleTimeString();
          logViewer.innerHTML += `\n[${timestamp}] ${message}`;
          logViewer.scrollTop = logViewer.scrollHeight;
          console.log(`[DEV] ${message}`);
        }
      }

      // Initialize Developer Auth Manager
      const devAuthManager = new DevAuthManager();

      // Developer Authentication
      function authenticateAsDeveloper() {
        const key = document.getElementById('dev-key').value;
        if (key === DEV_ACCESS_KEY) {
          isDeveloperAuthenticated = true;
          document.getElementById('access-status').innerHTML = 'âœ… Access Granted - Developer tools unlocked';
          document.getElementById('access-status').className = 'text-green-400';
          document.getElementById('auth-section').style.display = 'none';
          document.getElementById('dev-tools').classList.remove('hidden');
          devAuthManager.log('Developer authenticated successfully');
        } else {
          alert('âŒ Invalid developer key');
          devAuthManager.log('Failed authentication attempt');
        }
      }

      // User Management Functions
      async function createAdminUser() {
        if (!isDeveloperAuthenticated) return;
        try {
          const admin = await devAuthManager.createAdminUser();
          alert('ğŸ”§ Admin user created! You are now logged in as admin.');
          devAuthManager.log('Admin user created and logged in');
        } catch (error) {
          alert('âŒ Failed to create admin user: ' + error.message);
        }
      }

      function createProfessorFromForm() {
        if (!isDeveloperAuthenticated) return;
        const email = document.getElementById('prof-email').value;
        const password = document.getElementById('prof-password').value;
        const name = document.getElementById('prof-name').value;
        const institution = document.getElementById('prof-institution').value || 'SCI-HIGH University';

        if (!email || !password || !name) {
          alert('Please fill in all required fields (email, password, name)');
          return;
        }

        createProfessorUser(email, password, name, institution);
      }

      async function createProfessorUser(email, password, fullName, institution) {
        if (!isDeveloperAuthenticated) return;
        const result = await devAuthManager.createProfessorUser(email, password, fullName, institution);
        if (result.success) {
          alert(`âœ… Professor user created!\nEmail: ${email}\nUID: ${result.uid}`);
          // Clear form
          document.getElementById('prof-email').value = '';
          document.getElementById('prof-password').value = '';
          document.getElementById('prof-name').value = '';
          document.getElementById('prof-institution').value = '';
        } else {
          alert(`âŒ Failed to create professor user: ${result.error}`);
        }
        return result;
      }

      function createSampleProfessor() {
        if (!isDeveloperAuthenticated) return;
        // Implementation similar to main page
        devAuthManager.log('Sample professor created');
        alert('ğŸ‘¨â€ğŸ« Sample professor created!');
      }

      function createSampleStudent() {
        if (!isDeveloperAuthenticated) return;
        devAuthManager.log('Sample student created');
        alert('ğŸ“ Sample student created!');
      }

      function createSampleGeneral() {
        if (!isDeveloperAuthenticated) return;
        devAuthManager.log('Sample general user created');
        alert('ğŸŒŸ Sample general user created!');
      }

      // Database Management Functions
      async function viewProfessors() {
        if (!isDeveloperAuthenticated) return;
        try {
          const snapshot = await firebase.firestore().collection('professors').get();
          const professors = [];
          snapshot.forEach(doc => {
            professors.push({ id: doc.id, ...doc.data() });
          });
          console.log('Professors:', professors);
          devAuthManager.log(`Found ${professors.length} professor records`);
          alert(`Found ${professors.length} professor records. Check console for details.`);
        } catch (error) {
          alert('Error fetching professors: ' + error.message);
        }
      }

      async function viewStudents() {
        if (!isDeveloperAuthenticated) return;
        try {
          const snapshot = await firebase.firestore().collection('students').get();
          const students = [];
          snapshot.forEach(doc => {
            students.push({ id: doc.id, ...doc.data() });
          });
          console.log('Students:', students);
          devAuthManager.log(`Found ${students.length} student records`);
          alert(`Found ${students.length} student records. Check console for details.`);
        } catch (error) {
          alert('Error fetching students: ' + error.message);
        }
      }

      async function viewGeneralUsers() {
        if (!isDeveloperAuthenticated) return;
        try {
          const snapshot = await firebase.firestore().collection('general_users').get();
          const users = [];
          snapshot.forEach(doc => {
            users.push({ id: doc.id, ...doc.data() });
          });
          console.log('General Users:', users);
          devAuthManager.log(`Found ${users.length} general user records`);
          alert(`Found ${users.length} general user records. Check console for details.`);
        } catch (error) {
          alert('Error fetching general users: ' + error.message);
        }
      }

      function clearStudentData() {
        if (!isDeveloperAuthenticated) return;
        if (!confirm('âš ï¸ This will permanently delete ALL student data. Are you absolutely sure?')) return;
        if (!confirm('This action cannot be undone. Type YES to confirm.')) return;
        devAuthManager.log('Student data clearing requested (not implemented for safety)');
        alert('âš ï¸ Function disabled for safety. Contact system administrator.');
      }

      function resetDatabase() {
        if (!isDeveloperAuthenticated) return;
        alert('âš ï¸ Function disabled for safety. Contact system administrator.');
      }

      // Utility Functions
      function clearLogs() {
        document.getElementById('log-viewer').innerHTML = 'Logs cleared...';
      }

      function downloadLogs() {
        const logs = document.getElementById('log-viewer').textContent;
        const blob = new Blob([logs], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `sci-high-logs-${new Date().toISOString().split('T')[0]}.txt`;
        a.click();
        URL.revokeObjectURL(url);
      }

      function logoutUser() {
        devAuthManager.logout();
      }

      // Student Management Functions
      async function createStudentFromForm() {
        const studentId = document.getElementById('student-id').value.trim();
        const name = document.getElementById('student-name').value.trim();
        const level = document.getElementById('student-level').value;
        const course = document.getElementById('student-course').value.trim();
        const year = document.getElementById('student-year').value.trim();
        const strand = document.getElementById('student-strand').value;

        if (!studentId || !name || !level) {
          alert('Please fill in Student ID, Name, and Academic Level');
          return;
        }

        try {
          // Enhanced duplicate check before creating student
          devAuthManager.log(`Checking for existing student with ID: ${studentId}`);
          
          const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          
          // Check if student already exists
          const existingStudentRef = ref(devAuthManager.database, 'students/' + studentId);
          const existingSnapshot = await get(existingStudentRef);
          
          if (existingSnapshot.exists()) {
            const existingData = existingSnapshot.val();
            devAuthManager.log(`ERROR: Student with ID ${studentId} already exists: ${existingData.name || existingData.fullName || 'Unknown Name'}`);
            alert(`Error: Student account already exists!\n\nStudent ID: ${studentId}\nName: ${existingData.name || existingData.fullName || 'Unknown Name'}\nCreated: ${existingData.createdAt || 'Unknown Date'}\n\nPlease use a different Student ID or update the existing record.`);
            return;
          }
          
          // Also check if student exists in career stats
          const careerStatsRef = ref(devAuthManager.database, 'student_career_stats/' + studentId);
          const careerSnapshot = await get(careerStatsRef);
          
          if (careerSnapshot.exists()) {
            const careerData = careerSnapshot.val();
            const studentName = careerData.studentInfo?.fullName || careerData.firstName + ' ' + careerData.lastName || 'Unknown';
            devAuthManager.log(`WARNING: Student ${studentId} has existing career stats: ${studentName}`);
            
            if (!confirm(`Warning: Student ${studentId} has existing game progress data (${studentName}).\n\nThis might indicate they already have an account. Creating a new account might cause data conflicts.\n\nDo you want to continue anyway?`)) {
              return;
            }
          }
          
          devAuthManager.log(`No duplicates found, creating new student: ${name} (${studentId})`);

          const studentData = {
            studentId: studentId,
            name: name,
            fullName: name, // Add fullName for consistency
            level: level,
            course: level === 'college' ? course : '',
            strand: level === 'shs' ? strand : '',
            year: year,
            academicInfo: {
              level: level,
              course: level === 'college' ? course : null,
              yearLevel: year,
              strand: level === 'shs' ? strand : null
            },
            accountStatus: {
              isActive: true,
              isFirstLogin: true,
              createdBy: 'developer-tools',
              createdAt: new Date().toISOString(),
              lastLogin: null
            },
            progress: {
              completedQuizzes: [],
              completedStories: [],
              totalScore: 0,
              lastActivity: new Date().toISOString()
            },
            gameData: {
              totalPoints: 0,
              achievements: [],
              currentLevel: 1,
              courseProgress: {
                'Web_Design': { unlocked: true, completed: false, progress: 0 },
                'Python': { unlocked: true, completed: false, progress: 0 },
                'Java': { unlocked: false, completed: false, progress: 0 },
                'C': { unlocked: false, completed: false, progress: 0 },
                'CPlusPlus': { unlocked: false, completed: false, progress: 0 },
                'CSharp': { unlocked: false, completed: false, progress: 0 }
              }
            },
            createdAt: new Date().toISOString(),
            isActive: true
          };

          const studentRef = ref(devAuthManager.database, 'students/' + studentId);
          await devAuthManager.setData(studentRef, studentData);
          
          devAuthManager.log(`âœ… Student created successfully: ${name} (${studentId})`);
          clearStudentForm();
          updateStudentAnalytics();
          alert(`Student created successfully!\n\nName: ${name}\nStudent ID: ${studentId}\nLevel: ${level}\n\nThe student can now log in using their Student ID.`);
        } catch (error) {
          devAuthManager.log('âŒ Error creating student: ' + error.message);
          alert('Error creating student: ' + error.message);
        }
      }

      function clearStudentForm() {
        document.getElementById('student-id').value = '';
        document.getElementById('student-name').value = '';
        document.getElementById('student-level').value = '';
        document.getElementById('student-course').value = '';
        document.getElementById('student-year').value = '';
        document.getElementById('student-strand').value = '';
      }

      async function searchStudents() {
        const searchTerm = document.getElementById('search-student').value.trim().toLowerCase();
        if (!searchTerm) {
          alert('Please enter a search term');
          return;
        }

        try {
          const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentsRef = ref(devAuthManager.database, 'students');
          const snapshot = await get(studentsRef);
          
          if (snapshot.exists()) {
            const students = snapshot.val();
            const filteredStudents = Object.values(students).filter(student => 
              student.studentId.toLowerCase().includes(searchTerm) ||
              student.name.toLowerCase().includes(searchTerm)
            );
            displayStudents(filteredStudents);
          } else {
            displayStudents([]);
          }
        } catch (error) {
          devAuthManager.log('Error searching students: ' + error.message);
          alert('Error searching students: ' + error.message);
        }
      }

      async function loadAllStudents() {
        try {
          const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentsRef = ref(devAuthManager.database, 'students');
          const snapshot = await get(studentsRef);
          
          if (snapshot.exists()) {
            const students = Object.values(snapshot.val());
            displayStudents(students);
          } else {
            displayStudents([]);
          }
        } catch (error) {
          devAuthManager.log('Error loading students: ' + error.message);
          alert('Error loading students: ' + error.message);
        }
      }

      function displayStudents(students) {
        const resultsDiv = document.getElementById('student-results');
        const tableBody = document.getElementById('student-table-body');
        
        tableBody.innerHTML = '';
        
        if (students.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="6" class="px-3 py-2 text-center text-gray-400">No students found</td></tr>';
        } else {
          students.forEach(student => {
            const progressPercent = calculateProgressPercent(student.progress);
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="px-3 py-2 text-white">${student.studentId}</td>
              <td class="px-3 py-2 text-white">${student.name}</td>
              <td class="px-3 py-2 text-white">${student.level.toUpperCase()}</td>
              <td class="px-3 py-2 text-white">${student.course || student.strand || 'N/A'}</td>
              <td class="px-3 py-2">
                <div class="flex items-center">
                  <div class="w-16 bg-gray-600 rounded-full h-2 mr-2">
                    <div class="bg-green-400 h-2 rounded-full" style="width: ${progressPercent}%"></div>
                  </div>
                  <span class="text-sm text-white">${progressPercent}%</span>
                </div>
              </td>
              <td class="px-3 py-2">
                <button onclick="editStudent('${student.studentId}')" class="px-2 py-1 bg-blue-600 text-white text-xs rounded mr-1 hover:bg-blue-700">
                  âœï¸ Edit
                </button>
                <button onclick="deleteStudent('${student.studentId}')" class="px-2 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700">
                  ğŸ—‘ï¸ Delete
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        }
        
        resultsDiv.classList.remove('hidden');
      }

      function calculateProgressPercent(progress) {
        if (!progress) return 0;
        const totalQuizzes = 6; // Assuming 6 programming language quizzes
        const totalStories = 3; // Assuming 3 story characters
        const completedQuizzes = progress.completedQuizzes ? progress.completedQuizzes.length : 0;
        const completedStories = progress.completedStories ? progress.completedStories.length : 0;
        
        return Math.round(((completedQuizzes + completedStories) / (totalQuizzes + totalStories)) * 100);
      }

      async function editStudent(studentId) {
        try {
          const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentRef = ref(devAuthManager.database, 'students/' + studentId);
          const snapshot = await get(studentRef);
          
          if (snapshot.exists()) {
            const student = snapshot.val();
            
            // Fill form with current data
            document.getElementById('student-id').value = student.studentId;
            document.getElementById('student-name').value = student.name;
            document.getElementById('student-level').value = student.level;
            document.getElementById('student-course').value = student.course || '';
            document.getElementById('student-year').value = student.year;
            document.getElementById('student-strand').value = student.strand || '';
            
            // Scroll to form
            document.getElementById('student-id').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('student-name').focus();
          }
        } catch (error) {
          devAuthManager.log('Error loading student for edit: ' + error.message);
          alert('Error loading student data');
        }
      }

      async function deleteStudent(studentId) {
        if (!confirm(`Are you sure you want to delete student ${studentId}? This action cannot be undone.`)) {
          return;
        }

        try {
          const { ref, remove } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentRef = ref(devAuthManager.database, 'students/' + studentId);
          await remove(studentRef);
          
          devAuthManager.log(`Student deleted: ${studentId}`);
          loadAllStudents(); // Refresh the list
          updateStudentAnalytics();
          alert('Student deleted successfully');
        } catch (error) {
          devAuthManager.log('Error deleting student: ' + error.message);
          alert('Error deleting student: ' + error.message);
        }
      }

      async function updateStudentAnalytics() {
        try {
          const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentsRef = ref(devAuthManager.database, 'students');
          const snapshot = await get(studentsRef);
          
          if (snapshot.exists()) {
            const students = Object.values(snapshot.val());
            const totalStudents = students.length;
            const activeStudents = students.filter(s => s.isActive).length;
            const avgProgress = students.reduce((sum, s) => sum + calculateProgressPercent(s.progress), 0) / totalStudents;
            
            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('active-students').textContent = activeStudents;
            document.getElementById('avg-progress').textContent = Math.round(avgProgress) + '%';
          } else {
            document.getElementById('total-students').textContent = '0';
            document.getElementById('active-students').textContent = '0';
            document.getElementById('avg-progress').textContent = '0%';
          }
        } catch (error) {
          devAuthManager.log('Error updating analytics: ' + error.message);
        }
      }

      async function exportStudentData() {
        try {
          const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentsRef = ref(devAuthManager.database, 'students');
          const snapshot = await get(studentsRef);
          
          if (snapshot.exists()) {
            const students = Object.values(snapshot.val());
            const csvContent = generateCSV(students);
            downloadCSV(csvContent, `students-export-${new Date().toISOString().split('T')[0]}.csv`);
          } else {
            alert('No student data to export');
          }
        } catch (error) {
          devAuthManager.log('Error exporting student data: ' + error.message);
          alert('Error exporting data');
        }
      }

      function generateCSV(students) {
        const headers = ['Student ID', 'Name', 'Level', 'Course', 'Strand', 'Year', 'Progress %', 'Total Score', 'Created At', 'Is Active'];
        const rows = students.map(student => [
          student.studentId,
          student.name,
          student.level,
          student.course || '',
          student.strand || '',
          student.year,
          calculateProgressPercent(student.progress),
          student.progress?.totalScore || 0,
          student.createdAt,
          student.isActive
        ]);
        
        return [headers, ...rows].map(row => row.join(',')).join('\n');
      }

      function downloadCSV(content, filename) {
        const blob = new Blob([content], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      }

      function importStudentData() {
        document.getElementById('csv-import').click();
      }

      async function resetAllProgress() {
        if (!confirm('Are you sure you want to reset ALL student progress? This action cannot be undone.')) {
          return;
        }

        try {
          const { ref, get, update } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
          const studentsRef = ref(devAuthManager.database, 'students');
          const snapshot = await get(studentsRef);
          
          if (snapshot.exists()) {
            const updates = {};
            Object.keys(snapshot.val()).forEach(studentId => {
              updates[`students/${studentId}/progress`] = {
                completedQuizzes: [],
                completedStories: [],
                totalScore: 0,
                lastActivity: new Date().toISOString()
              };
            });
            
            await update(ref(devAuthManager.database), updates);
            devAuthManager.log('All student progress reset');
            loadAllStudents();
            updateStudentAnalytics();
            alert('All student progress has been reset');
          }
        } catch (error) {
          devAuthManager.log('Error resetting progress: ' + error.message);
          alert('Error resetting progress');
        }
      }

      // Handle CSV import
      document.getElementById('csv-import').addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = async function(event) {
          try {
            const csv = event.target.result;
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            
            for (let i = 1; i < lines.length; i++) {
              const values = lines[i].split(',');
              if (values.length >= 6) {
                const studentData = {
                  studentId: values[0].trim(),
                  name: values[1].trim(),
                  level: values[2].trim(),
                  course: values[3].trim(),
                  strand: values[4].trim(),
                  year: values[5].trim(),
                  progress: {
                    completedQuizzes: [],
                    completedStories: [],
                    totalScore: parseInt(values[7]) || 0,
                    lastActivity: new Date().toISOString()
                  },
                  createdAt: values[8] || new Date().toISOString(),
                  isActive: values[9] !== 'false'
                };

                const { ref } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                const studentRef = ref(devAuthManager.database, 'students/' + studentData.studentId);
                await devAuthManager.setData(studentRef, studentData);
              }
            }
            
            devAuthManager.log(`Imported ${lines.length - 1} students from CSV`);
            loadAllStudents();
            updateStudentAnalytics();
            alert('Students imported successfully!');
          } catch (error) {
            devAuthManager.log('Error importing CSV: ' + error.message);
            alert('Error importing CSV file');
          }
        };
        reader.readAsText(file);
      });

      // Make functions available globally
      window.createAdminUser = createAdminUser;
      window.createProfessorUser = createProfessorUser;
      window.createStudentFromForm = createStudentFromForm;
      window.searchStudents = searchStudents;
      window.loadAllStudents = loadAllStudents;
      window.editStudent = editStudent;
      window.deleteStudent = deleteStudent;
      window.exportStudentData = exportStudentData;
      window.importStudentData = importStudentData;
      window.resetAllProgress = resetAllProgress;
      window.logoutUser = logoutUser;

      // Auto-update system info and analytics every 30 seconds
      setInterval(() => {
        if (isDeveloperAuthenticated) {
          devAuthManager.updateSystemInfo();
          updateStudentAnalytics();
        }
      }, 30000);

      // Initialize analytics on page load
      setTimeout(() => {
        if (isDeveloperAuthenticated) {
          updateStudentAnalytics();
        }
      }, 2000);

      devAuthManager.log('Developer tools initialized');

      // Mobile menu functionality
      document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
        
        // Sync mobile logout button visibility with desktop
        const syncLogoutButton = () => {
          const logoutBtn = document.getElementById('logout-btn');
          const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
          
          if (logoutBtn && mobileLogoutBtn) {
            if (logoutBtn.classList.contains('hidden')) {
              mobileLogoutBtn.classList.add('hidden');
            } else {
              mobileLogoutBtn.classList.remove('hidden');
            }
          }
        };
        
        // Call sync function periodically
        setInterval(syncLogoutButton, 1000);
        syncLogoutButton(); // Initial sync
      });
    </script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SCI-HIGH: Playing!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <!-- Authentication Check -->
    <script>
      // Check authentication before loading the game
      function checkAuthentication() {
        const isAuthenticated = sessionStorage.getItem('sci_high_authenticated');
        const userType = sessionStorage.getItem('sci_high_user_type');
        const savedUser = localStorage.getItem('sci_high_user');
        
        if (!isAuthenticated || !savedUser) {
          // Redirect to login page
          alert('Please log in to access the game.');
          window.location.href = 'index.html';
          return false;
        }
        
        // Log user access for analytics
        console.log(`Game accessed by ${userType} user`);
        return true;
      }
      
      // Run check immediately
      if (!checkAuthentication()) {
        // Stop page loading if not authenticated
        document.documentElement.innerHTML = '<body style="background: #1a1a2e; color: white; text-align: center; padding: 50px;"><h1>Redirecting to login...</h1></body>';
      }
    </script>
    
    <style>
      /* Reset everything */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      /* Authentication overlay */
      #auth-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10001;
        color: white;
        font-family: 'Orbitron', monospace;
        text-align: center;
        padding: 20px;
      }
      
      #auth-overlay .logo {
        width: 120px;
        height: 120px;
        margin-bottom: 30px;
        animation: pulse 2s ease-in-out infinite;
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.05); }
      }
      
      #auth-overlay h2 {
        font-size: 28px;
        margin-bottom: 15px;
        color: #F4CE14;
      }
      
      #auth-overlay p {
        font-size: 16px;
        opacity: 0.8;
        margin-bottom: 30px;
      }
      
      #auth-overlay button {
        background: linear-gradient(to right, #F4CE14, #FFD700);
        color: #1a1a2e;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-family: 'Orbitron', monospace;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      
      #auth-overlay button:hover {
        transform: scale(1.05);
      }
      
      /* Orientation overlay */
      #orientation-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
      }
      
      #orientation-overlay .rotate-icon {
        font-size: 80px;
        margin-bottom: 20px;
        animation: rotate 2s linear infinite;
      }
      
      @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      #orientation-overlay h2 {
        font-size: 24px;
        margin-bottom: 10px;
      }
      
      #orientation-overlay p {
        font-size: 16px;
        opacity: 0.8;
      }
      
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent scrollbars */
        background-color: #000; /* Match black to avoid visible gaps */
      }
      
      body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #181818 0%, #333 100%);
        position: relative;
        overflow: hidden;
      }
      
      #game {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      /* Target the canvas element directly */
      canvas {
        display: block !important;
        margin: 0 auto !important;
        max-width: 100% !important;
        max-height: 100% !important;
      }
      
      /* Removed the glowing border effect */
      #game::after {
        display: none; /* Hiding the entire ::after element */
      }
      /* Removing the glow animation as it's no longer needed */
      @keyframes glow {
        0% { opacity: 0; }
        100% { opacity: 0; }
      }
      /* Parallax clouds */
      body .cloud, body .cloud2, body .cloud3 {
        position: absolute;
        top: 10%;
        left: -30vw;
        width: 60vw;
        height: 18vw;
        background: radial-gradient(ellipse at 30% 40%, #fffde4 60%, transparent 100%),
                    radial-gradient(ellipse at 70% 60%, #ffe600 40%, transparent 100%);
        opacity: 0.18;
        border-radius: 50%;
        filter: blur(2px);
        z-index: 1;
        pointer-events: none;
        animation: cloudmove 80s linear infinite;
      }
      body .cloud2 {
        top: 30%;
        left: -40vw;
        width: 80vw;
        height: 22vw;
        opacity: 0.13;
        filter: blur(3px);
        animation: cloudmove2 120s linear infinite;
      }
      body .cloud3 {
        top: 60%;
        left: -50vw;
        width: 70vw;
        height: 20vw;
        opacity: 0.10;
        filter: blur(4px);
        animation: cloudmove3 160s linear infinite;
      }
      @keyframes cloudmove {
        0% { left: -30vw; }
        100% { left: 110vw; }
      }
      @keyframes cloudmove2 {
        0% { left: -40vw; }
        100% { left: 120vw; }
      }
      @keyframes cloudmove3 {
        0% { left: -50vw; }
        100% { left: 130vw; }
      }
      
      /* Responsive tweaks */
      @media (max-width: 768px) {
        body {
          overflow: hidden;
        }
        
        #game {
          width: 100vw;
          height: 100vh;
          position: fixed;
          top: 0;
          left: 0;
        }
        
        canvas {
          width: 100vw !important;
          height: 100vh !important;
          max-width: none !important;
          max-height: none !important;
        }
      }
      
      @media (max-width: 500px) {
        #game {
          width: 100vw;
          height: 100vh;
        }
        
        canvas {
          width: 100% !important;
          height: 100% !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Authentication overlay -->
    <div id="auth-overlay">
      <img src="../public/assets/img/buko_productions-logo.png" alt="SCI-HIGH Logo" class="logo" />
      <h2>Authentication Required</h2>
      <p>You need to be logged in to access the game</p>
      <button onclick="window.location.href='index.html'">Go to Login</button>
    </div>
    
    <!-- Orientation overlay for mobile portrait mode -->
    <div id="orientation-overlay">
      <div class="rotate-icon">ğŸ“±</div>
      <h2>Please rotate your device</h2>
      <p>This game is best played in landscape mode</p>
    </div>
    
    <div id="game"></div>
    
    <script>
      // Function to check if device is mobile
      function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
               (window.innerWidth <= 768 && window.innerHeight <= 1024);
      }
      
      // Function to handle orientation
      function handleOrientation() {
        const overlay = document.getElementById('orientation-overlay');
        const isMobile = isMobileDevice();
        const isPortrait = window.innerHeight > window.innerWidth;
        
        if (isMobile && isPortrait) {
          overlay.style.display = 'flex';
        } else {
          overlay.style.display = 'none';
        }
      }
      
      // Check orientation on load and resize
      window.addEventListener('load', handleOrientation);
      window.addEventListener('resize', handleOrientation);
      window.addEventListener('orientationchange', () => {
        setTimeout(handleOrientation, 100); // Small delay for orientation change
      });
      
      // Try to lock to landscape on mobile if Screen Orientation API is available
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(err => {
          console.log('Could not lock orientation:', err);
        });
      }
    </script>
    
    <script type="module" src="../src/game.js"></script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="public/assets/img/logo/SCI-HIGH_LOGO.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>SCI-HIGH: A Byte-Size Learning Adventure!</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Gaming Feel -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Modern Notification System -->
    <script src="../js/notifications.js"></script>
    <script>
      // Fallback functions in case notifications.js hasn't loaded yet
      window.ensureNotifications = function() {
        if (typeof window.modernConfirm === 'undefined') {
          console.warn('Notification system not loaded, using fallback');
          window.modernConfirm = function(message, options = {}) {
            return Promise.resolve(confirm(message));
          };
          window.modernAlert = function(message, options = {}) {
            alert(message);
            return Promise.resolve(true);
          };
          window.showSuccess = function(message, options = {}) {
            alert('âœ… ' + message);
            return Promise.resolve(true);
          };
          window.showError = function(message, options = {}) {
            alert('âŒ ' + message);
            return Promise.resolve(true);
          };
          window.showWarning = function(message, options = {}) {
            alert('âš ï¸ ' + message);
            return Promise.resolve(true);
          };
          window.showInfo = function(message, options = {}) {
            alert('â„¹ï¸ ' + message);
            return Promise.resolve(true);
          };
        }
      };
      
      // Ensure notifications are available immediately
      window.ensureNotifications();
    </script>
    <script>
      tailwind.config = {
        theme: {
          screens: {
            'xs': '475px',
            'sm': '640px',
            'md': '768px',
            'lg': '1024px',
            'xl': '1280px',
            '2xl': '1536px',
          },
          extend: {
            colors: {
              primary: '#F4CE14', // yellow
              accent: '#379777', // green
              dark: '#1a1a2e',   // darker navy
              light: '#16213e',  // dark blue
              purple: '#9c27b0', // gaming purple
              cyan: '#00bcd4',   // gaming cyan
              textColor: '#ffffff',
              cardBg: 'rgba(22, 33, 62, 0.8)',
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace'],
              body: ['Exo 2', 'sans-serif'],
            },
            animation: {
              'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate',
              'float': 'float 6s ease-in-out infinite',
              'slide-in': 'slide-in 0.8s ease-out',
              'bounce-in': 'bounce-in 1s ease-out',
            }
          }
        }
      }
    </script>
    <style>
      @keyframes pulse-glow {
        from { box-shadow: 0 0 20px #F4CE14; }
        to { box-shadow: 0 0 30px #F4CE14, 0 0 40px #F4CE14; }
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      @keyframes slide-in {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes bounce-in {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
      }
      
      .game-bg {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
        position: relative;
        overflow-x: hidden;
      }
      
      .game-bg::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
          radial-gradient(circle at 20% 80%, rgba(244, 206, 20, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(55, 151, 119, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(156, 39, 176, 0.1) 0%, transparent 50%);
        animation: float 8s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
      }
      
      .pixelated {
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }
      
      .neon-border {
        border: 2px solid #F4CE14;
        background: rgba(22, 33, 62, 0.8);
        box-shadow: 0 0 10px rgba(244, 206, 20, 0.3);
      }
      
      /* Custom scrollbar for chat */
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      .scrollbar-thumb-purple {
        scrollbar-color: #9c27b0 #1a1a2e;
      }
      .scrollbar-track-dark {
        scrollbar-color: #9c27b0 #1a1a2e;
      }
      
      /* Enhanced chat button styles */
      .quick-btn, .suggestion-btn {
        white-space: nowrap;
        cursor: pointer;
        user-select: none;
        position: relative;
        z-index: 10;
        min-width: fit-content;
      }
      
      .quick-btn:active, .suggestion-btn:active {
        transform: scale(0.95);
      }
      
      /* Ensure chat panel buttons are always clickable */
      #quick-actions {
        position: relative;
        z-index: 20;
      }
      
      #input-suggestions {
        position: relative;
        z-index: 20;
      }
      
      /* Webkit browsers scrollbar */
      #chat-messages::-webkit-scrollbar {
        width: 6px;
      }
      #chat-messages::-webkit-scrollbar-track {
        background: #1a1a2e;
        border-radius: 3px;
      }
      #chat-messages::-webkit-scrollbar-thumb {
        background: #9c27b0;
        border-radius: 3px;
      }
      #chat-messages::-webkit-scrollbar-thumb:hover {
        background: #ba68c8;
      }
      
      /* Chat message animations */
      .assistant-message, .user-message {
        animation: message-slide-in 0.3s ease-out;
      }
      
      @keyframes message-slide-in {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Assistant button glow effect */
      #assistant-toggle {
        animation: assistant-glow 3s ease-in-out infinite alternate;
      }
      
      @keyframes assistant-glow {
        from {
          box-shadow: 0 0 20px rgba(156, 39, 176, 0.3);
        }
        to {
          box-shadow: 0 0 30px rgba(156, 39, 176, 0.6), 0 0 40px rgba(0, 188, 212, 0.3);
        }
      }
      
      /* Loading dots animation */
      #send-loading {
        animation: loading-dots 1.5s ease-in-out infinite;
      }
      
      @keyframes loading-dots {
        0%, 20% {
          color: rgba(255, 255, 255, 0.3);
        }
        40% {
          color: rgba(255, 255, 255, 1);
        }
        60%, 100% {
          color: rgba(255, 255, 255, 0.3);
        }
      }
      
      /* Suggestion buttons hover effect */
      .suggestion-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(156, 39, 176, 0.3);
      }
      
      /* Mobile-specific improvements */
      @media (max-width: 768px) {
        /* Better touch targets */
        button, a {
          min-height: 44px;
        }
        
        /* Prevent zoom on inputs */
        input, select, textarea {
          font-size: 16px;
        }
        
        /* Smooth scrolling for mobile */
        html {
          scroll-behavior: smooth;
          -webkit-overflow-scrolling: touch;
        }
        
        /* Prevent horizontal scroll */
        body {
          overflow-x: hidden;
        }
        
        /* Better mobile menu animations */
        #mobile-menu {
          animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        /* Mobile-friendly card spacing */
        .gaming-card, .neon-border {
          margin-bottom: 1rem;
        }
        
        /* Optimize text for mobile reading */
        .font-gaming {
          letter-spacing: 0.05em;
        }
      }
      
      /* Very small screens (phones in portrait) */
      @media (max-width: 475px) {
        .container {
          padding-left: 1rem;
          padding-right: 1rem;
        }
        
        /* Smaller text on very small screens */
        h1 {
          font-size: 2rem;
          line-height: 1.2;
        }
      }
    </style>
  </head>
  <body class="font-body game-bg text-textColor m-0 p-0 leading-relaxed">
    <!-- Particle Background Effect -->
    <div id="particles" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- Gaming HUD Navigation -->
    <nav class="relative z-50 bg-gradient-to-r from-dark/95 to-light/95 backdrop-blur-md border-b-2 border-primary/30 py-3 sm:py-4 sticky top-0">
      <div class="max-w-6xl mx-auto px-3 sm:px-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <img src="../public/assets/img/buko_productions-logo.png" alt="Buko Productions Logo" class="w-10 h-10 sm:w-16 sm:h-16 animate-bounce-in" />
            <span class="font-gaming text-base sm:text-xl font-bold text-primary">SCI-HIGH</span>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="p-2 text-textColor hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300 bg-dark/50 rounded-lg border border-primary/30" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex space-x-8">
            <a href="#home" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">Home</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <a href="#about" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">About</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <a href="#contact" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">Contact</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <!-- Login Button - Hidden when user is logged in -->
            <button id="login-btn" class="gaming-nav-link text-textColor hover:text-accent transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative" onclick="showLoginModal()">
              <span class="relative z-10">ğŸ” Login</span>
              <div class="absolute inset-0 bg-accent/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </button>
            <!-- Professor Tab - Hidden by default, shown only for admin/professor users -->
            <a href="professor-dashboard.html" id="professor-nav-link" class="gaming-nav-link text-textColor hover:text-accent transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative hidden">
              <span class="relative z-10">ğŸ‘¨â€ğŸ« Professor</span>
              <div class="absolute inset-0 bg-accent/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <!-- User Greeting - Hidden by default, shown for logged-in users -->
            <span id="user-greeting" class="text-textColor font-gaming text-sm uppercase tracking-wider hidden">
              <span id="greeting-text">Hello, User!</span>
            </span>
            <!-- Logout Button - Hidden by default, shown for logged-in users (except guests) -->
            <button id="logout-btn" class="gaming-nav-link text-textColor hover:text-red-400 transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative hidden" onclick="logoutUser()">
              <span class="relative z-10">ğŸšª Logout</span>
              <div class="absolute inset-0 bg-red-500/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </button>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-light/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <a href="#home" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">ğŸ </span> Home
              </span>
            </a>
            <a href="#about" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">â„¹ï¸</span> About
              </span>
            </a>
            <a href="#contact" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">ğŸ“</span> Contact
              </span>
            </a>
            <button id="mobile-login-btn" class="block w-full text-left px-4 py-3 text-textColor hover:text-accent hover:bg-accent/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-accent/30" onclick="showLoginModal()">
              <span class="flex items-center">
                <span class="mr-2">ğŸ”</span> Login
              </span>
            </button>
            <a href="professor-dashboard.html" id="mobile-professor-nav-link" class="block px-4 py-3 text-textColor hover:text-accent hover:bg-accent/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-accent/30 hidden">
              <span class="flex items-center">
                <span class="mr-2">ğŸ‘¨â€ğŸ«</span> Professor
              </span>
            </a>
            <div id="mobile-user-greeting" class="block px-4 py-3 text-primary font-gaming text-sm uppercase tracking-wider bg-primary/10 rounded-lg border border-primary/30 hidden">
              <span id="mobile-greeting-text">Hello, User!</span>
            </div>
            <button id="mobile-logout-btn" class="block w-full text-left px-4 py-3 text-red-400 hover:text-red-300 hover:bg-red-500/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-red-500/30 hidden" onclick="logoutUser()">
              <span class="flex items-center">
                <span class="mr-2">ğŸšª</span> Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="relative z-10 min-h-screen flex items-center justify-center px-3 sm:px-6 py-12 sm:py-20">
      <div class="max-w-6xl mx-auto text-center">
        <!-- Main Hero Content -->
        <div class="mb-6 sm:mb-12 animate-slide-in">
          <div class="mb-4 sm:mb-8 relative">
            <img src="../public/assets/img/buko_productions-logo.png" alt="Buko Productions - SCI-HIGH" class="mx-auto w-24 h-24 sm:w-32 sm:h-32 md:w-48 md:h-48 animate-float drop-shadow-2xl relative z-10" />
            <div class="absolute inset-0 bg-primary/20 blur-2xl sm:blur-3xl rounded-full animate-pulse-glow"></div>
          </div>
          
          <h1 class="font-gaming text-3xl xs:text-4xl sm:text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-primary via-accent to-cyan mb-3 sm:mb-6 animate-bounce-in px-2">
            SCI-HIGH
          </h1>
          
          <div class="font-gaming text-sm xs:text-base sm:text-xl md:text-2xl text-primary mb-3 sm:mb-4 tracking-wide sm:tracking-widest animate-bounce-in px-2" style="animation-delay: 0.2s;">
            A BYTE-SIZE LEARNING ADVENTURE!
          </div>
          
          <p class="text-sm xs:text-base sm:text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-6 sm:mb-12 px-4 sm:px-6 animate-bounce-in leading-relaxed" style="animation-delay: 0.4s;">
            Embark on an epic educational journey where programming meets adventure. 
            Battle bugs, solve coding puzzles, and level up your skills in this immersive learning experience!
          </p>
        </div>

        <!-- Gaming Action Buttons -->
        <div class="flex flex-col gap-3 sm:gap-4 md:flex-row md:gap-6 justify-center items-center mb-8 sm:mb-16 animate-bounce-in px-3 sm:px-4" style="animation-delay: 0.6s;">
          <button id="start-game-btn" class="group relative w-full sm:max-w-sm md:w-auto px-6 sm:px-8 md:px-12 py-3 sm:py-4 font-gaming text-sm sm:text-base md:text-lg font-bold text-dark bg-gradient-to-r from-primary to-yellow-300 rounded-xl transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-primary/50 uppercase tracking-wider touch-manipulation">
            <span class="relative z-10">âš¡ Start Adventure</span>
            <div class="absolute inset-0 bg-gradient-to-r from-yellow-300 to-primary rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </button>
          
          <a href="leaderboards.html" class="group relative w-full sm:max-w-sm md:w-auto px-6 sm:px-8 md:px-12 py-3 sm:py-4 font-gaming text-sm sm:text-base md:text-lg font-bold text-textColor bg-gradient-to-r from-accent to-cyan rounded-xl transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-accent/50 uppercase tracking-wider border-2 border-accent/50 touch-manipulation">
            <span class="relative z-10">ğŸ† Leaderboards</span>
            <div class="absolute inset-0 bg-gradient-to-r from-cyan to-accent rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </a>
        </div>

        <!-- Game Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6 max-w-4xl mx-auto animate-bounce-in px-4" style="animation-delay: 0.8s;">
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
            <div class="text-3xl mb-2">ğŸ®</div>
            <h3 class="font-gaming text-primary text-lg mb-2">Interactive Learning</h3>
            <p class="text-gray-300 text-sm">Hands-on coding challenges</p>
            <div class="mt-4 text-xs text-gray-400">
              <span class="bg-primary/20 text-primary px-2 py-1 rounded">5+ Languages</span>
            </div>
          </div>
          
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
            <div class="text-3xl mb-2">âš”ï¸</div>
            <h3 class="font-gaming text-accent text-lg mb-2">Fast-paced Gameplay</h3>
            <p class="text-gray-300 text-sm">Fast Roguelike Gameplay</p>
            <div class="mt-4 text-xs text-gray-400">
              <span class="bg-accent/20 text-accent px-2 py-1 rounded">Blitz</span>
            </div>
          </div>
          
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
            <div class="text-3xl mb-2">ğŸ“š</div>
            <h3 class="font-gaming text-cyan text-lg mb-2">Trial-and-Error</h3>
            <p class="text-gray-300 text-sm">Level up your programming knowledge</p>
            <div class="mt-4 text-xs text-gray-400">
              <span class="bg-cyan/20 text-cyan px-2 py-1 rounded">Learning System</span>
            </div>
          </div>
        </div>

        <!-- Additional Feature Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto mt-12 animate-bounce-in" style="animation-delay: 1s;">
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="../public/assets/img/mainhub/CLASSROOM_ICON.png" alt="Classroom" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-purple text-md mb-2">Interactive Lessons</h4>
            <p class="text-gray-400 text-xs">Immersive classroom experiences with hands-on coding</p>
          </div>

          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="../public/assets/img/mainhub/PUZZLE.png" alt="Puzzles" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-primary text-md mb-2">Logic Puzzles</h4>
            <p class="text-gray-400 text-xs">Brain-teasing challenges that teach programming concepts</p>
          </div>

          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="../public/assets/img/mainhub/COMLAB_ICON.png" alt="Computer Lab" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-accent text-md mb-2">Real-time Leaderboards</h4>
            <p class="text-gray-400 text-xs">Compete with other players</p>
          </div>

          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="../public/assets/img/icons/office/achievements.png" alt="Achievements" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-cyan text-md mb-2">Achievements</h4>
            <p class="text-gray-400 text-xs">Unlock badges and celebrate your coding victories</p>
          </div>
        </div>
      </div>
    </section>
    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-[100] hidden backdrop-blur-sm">
      <div class="neon-border bg-cardBg rounded-xl shadow-2xl w-full mx-2 sm:mx-4 md:mx-6 lg:mx-8 xl:max-w-4xl p-3 sm:p-4 md:p-6 lg:p-8 relative animate-bounce-in max-h-[95vh] overflow-y-auto">
        <button id="close-login-modal" class="absolute top-4 right-4 text-3xl text-gray-400 hover:text-primary transition-colors duration-300 font-gaming">&times;</button>
        
        <!-- User Type Selection -->
        <div id="user-type-selection" class="text-center">
          <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-3 sm:mb-4 text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">ğŸš€ Join the Adventure</h2>
          <p class="text-gray-300 text-sm sm:text-base md:text-lg mb-4 sm:mb-6 md:mb-8 leading-relaxed px-2">Choose your path to begin your programming quest!</p>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 md:gap-6 mb-4 sm:mb-6 md:mb-8">
            <!-- Professor Option -->
            <div class="neon-border bg-cardBg rounded-lg p-3 sm:p-4 md:p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 cursor-pointer" id="professor-option">
              <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl mb-2 sm:mb-3 md:mb-4">ğŸ‘¨â€ğŸ«</div>
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-primary mb-1 sm:mb-2 md:mb-3">Professor</h3>
              <p class="text-gray-300 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4 leading-tight">Manage student accounts, track progress, and access advanced analytics</p>
              <div class="text-xs text-gray-400">
                <span class="bg-primary/20 text-primary px-2 py-1 rounded text-xs">Admin Access</span>
              </div>
            </div>

            <!-- Student Option -->
            <div class="neon-border bg-cardBg rounded-lg p-3 sm:p-4 md:p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 cursor-pointer" id="student-option">
              <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl mb-2 sm:mb-3 md:mb-4">ğŸ“</div>
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-accent mb-1 sm:mb-2 md:mb-3">Student</h3>
              <p class="text-gray-300 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4 leading-tight">Access your courses, track progress, and compete in leaderboards</p>
              <div class="text-xs text-gray-400">
                <span class="bg-accent/20 text-accent px-2 py-1 rounded text-xs">School Account</span>
              </div>
            </div>

            <!-- General User Option -->
            <div class="neon-border bg-cardBg rounded-lg p-3 sm:p-4 md:p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 cursor-pointer sm:col-span-2 lg:col-span-1" id="general-option">
              <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl mb-2 sm:mb-3 md:mb-4">ğŸŒŸ</div>
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-cyan mb-1 sm:mb-2 md:mb-3">General User</h3>
              <p class="text-gray-300 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4 leading-tight">Create a personal account and learn at your own pace</p>
              <div class="text-xs text-gray-400">
                <span class="bg-cyan/20 text-cyan px-2 py-1 rounded text-xs">Personal Account</span>
              </div>
            </div>
          </div>

          <!-- Guest Option -->
          <div class="border-t border-gray-600 pt-3 sm:pt-4 md:pt-6">
            <p class="text-gray-400 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4">Just want to try the game?</p>
            <button id="guest-option" class="w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2 sm:py-2 md:py-3 font-gaming text-sm sm:text-base md:text-lg font-bold text-textColor bg-gradient-to-r from-purple to-pink-500 rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple/50 uppercase tracking-wider">
              ğŸ® Play as Guest
            </button>
          </div>
        </div>

        <!-- Professor Login Form -->
        <div id="professor-form" class="hidden">
          <div class="text-center mb-3 sm:mb-4 md:mb-6">
            <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl font-bold mb-2 text-primary">ğŸ‘¨â€ğŸ« Professor Portal</h2>
            <p class="text-gray-300 text-sm sm:text-base">Access your teaching dashboard</p>
          </div>
          
          <!-- Only Login Form -->
          <div class="max-w-md mx-auto px-2 sm:px-0">
            <form id="professor-login-form" class="space-y-6">
              <div>
                <label class="block text-gray-300 text-sm mb-2">Email</label>
                <input type="email" name="email" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-primary focus:outline-none">
              </div>
              <div>
                <label class="block text-gray-300 text-sm mb-2">Password</label>
                <input type="password" name="password" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-primary focus:outline-none">
              </div>
              <button type="submit" class="w-full px-6 py-3 font-gaming text-dark bg-gradient-to-r from-primary to-yellow-300 rounded-lg transform transition-all duration-300 hover:scale-105">
                Access Dashboard
              </button>
            </form>
            
            <div class="text-center mt-6 pt-6 border-t border-gray-600">
              <p class="text-gray-400 text-sm">
                Don't have an account? Contact your system administrator for professor access.
              </p>
              <div class="mt-4 p-3 bg-dark/30 rounded-lg">
                <p class="text-xs text-gray-500 mb-2">ğŸ”§ Dev Mode Test Account:</p>
                <p class="text-xs text-primary">Email: professor@sci-high.edu</p>
                <p class="text-xs text-primary">Password: Prof123!</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Student Login Form -->
        <div id="student-form" class="hidden">
          <div class="text-center mb-4 sm:mb-6 md:mb-8">
            <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl font-bold mb-2 text-accent">ğŸ“ Student Portal</h2>
            <p class="text-gray-300 text-sm sm:text-base">Enter your Student ID to begin your adventure</p>
            <p class="text-xs sm:text-sm text-gray-400 mt-2">âœ¨ New student? An account will be created automatically for you!</p>
          </div>
          
          <div class="max-w-2xl mx-auto px-2 sm:px-0">
            <!-- Step 1: Student ID Input -->
            <div id="student-id-step" class="space-y-6">
              <div class="max-w-md mx-auto">
                <label class="block text-gray-300 text-sm mb-2">Student ID</label>
                <input type="text" id="student-id-input" required placeholder="e.g., 24-2024-001" 
                       class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none text-center font-gaming">
                <p class="text-xs text-gray-400 mt-1">Format: XX-XXXX-XXX (numbers and dashes only)</p>
              </div>
              <div class="text-center">
                <button type="button" id="verify-student-id" class="px-8 py-3 font-gaming text-white bg-gradient-to-r from-accent to-cyan rounded-lg transform transition-all duration-300 hover:scale-105">
                  ğŸ” Verify Student ID
                </button>
              </div>
            </div>

            <!-- Step 2: Profile Completion (shown only if needed) -->
            <div id="student-profile-step" class="hidden space-y-6">
              <div class="text-center mb-6">
                <h3 class="font-gaming text-lg text-cyan mb-2">ğŸ“ Complete Your Profile</h3>
                <p class="text-gray-300 text-sm">We need a bit more information to set up your account</p>
              </div>
              
              <form id="student-complete-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-4">
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">First Name *</label>
                    <input type="text" name="firstName" required placeholder="Enter your first name" 
                           class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none">
                  </div>
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Last Name *</label>
                    <input type="text" name="lastName" required placeholder="Enter your last name" 
                           class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none">
                  </div>
                </div>
                
                <div class="space-y-4">
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Department *</label>
                    <select name="department" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white focus:border-accent focus:outline-none">
                      <option value="">Select your department</option>
                      <option value="Senior High School Department">Senior High School Department</option>
                      <option value="College Department">College Department</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Strand/Course *</label>
                    <select name="strand" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white focus:border-accent focus:outline-none">
                      <option value="">Select your strand/course</option>
                      <option value="ICT">ICT</option>
                      <option value="BSCS">BSCS</option>
                      <option value="BSIT">BSIT</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Year *</label>
                    <select name="year" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white focus:border-accent focus:outline-none">
                      <option value="">Select your year</option>
                      <option value="1st">1st</option>
                      <option value="2nd">2nd</option>
                      <option value="3rd">3rd</option>
                      <option value="4th">4th</option>
                      <option value="5th">5th</option>
                    </select>
                  </div>
                </div>
                
                <div class="md:col-span-2 text-center pt-4">
                  <button type="submit" class="px-8 py-3 font-gaming text-white bg-gradient-to-r from-accent to-cyan rounded-lg transform transition-all duration-300 hover:scale-105">
                    ğŸš€ Complete Setup & Enter Adventure
                  </button>
                </div>
              </form>
            </div>

            <!-- Step 3: Profile Found (for existing users) -->
            <div id="student-found-step" class="hidden space-y-6">
              <div class="text-center">
                <div class="bg-dark/30 rounded-lg p-6">
                  <h3 class="font-gaming text-lg text-green-400 mb-4">âœ… Profile Found!</h3>
                  <div id="student-profile-preview" class="text-left space-y-2 text-gray-300 max-w-md mx-auto">
                    <!-- Profile details will be inserted here -->
                  </div>
                  <button type="button" id="login-existing-student" class="mt-4 px-8 py-3 font-gaming text-white bg-gradient-to-r from-green-500 to-green-600 rounded-lg transform transition-all duration-300 hover:scale-105">
                    ğŸš€ Continue Adventure
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Help Section -->
            <div class="text-center mt-6 pt-6 border-t border-gray-600">
              <p class="text-gray-400 text-sm">ğŸ“‹ Only your Student ID is needed - no password required!</p>
              <div class="mt-4 p-3 bg-dark/30 rounded-lg">
                <hr class="my-2 border-gray-600">
                <p class="text-cyan text-xs">ğŸ’¡ Or try any Student ID (XX-XXXX-XXX format) to create a new account!</p>
              </div>
            </div>
          </div>
        </div>

        <!-- General User Form -->
        <div id="general-form" class="hidden">
          <div class="text-center mb-3 sm:mb-4 md:mb-6">
            <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl font-bold mb-2 text-cyan">ğŸŒŸ Personal Account</h2>
            <p class="text-gray-300 text-sm sm:text-base">Create your learning account</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 md:gap-8 px-2 sm:px-0">
            <!-- Login Form -->
            <div class="space-y-4">
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-cyan mb-3 sm:mb-4">Login</h3>
              <form id="general-login-form" class="space-y-4">
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Email</label>
                  <input type="email" name="email" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Password</label>
                  <input type="password" name="password" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <button type="submit" class="w-full px-6 py-3 font-gaming text-white bg-gradient-to-r from-cyan to-blue-500 rounded-lg transform transition-all duration-300 hover:scale-105">
                  Login
                </button>
              </form>
            </div>

            <!-- Register Form -->
            <div class="space-y-4">
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-cyan mb-3 sm:mb-4">Register</h3>
              <form id="general-register-form" class="space-y-4">
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Full Name</label>
                  <input type="text" name="fullName" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Email</label>
                  <input type="email" name="email" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Display Name</label>
                  <input type="text" name="displayName" required placeholder="For leaderboards" class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Password</label>
                  <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <button type="submit" class="w-full px-6 py-3 font-gaming text-white bg-gradient-to-r from-cyan to-blue-500 rounded-lg transform transition-all duration-300 hover:scale-105">
                  Create Account
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Back Button -->
        <div class="text-center mt-8">
          <button id="back-to-selection" class="hidden px-6 py-2 text-gray-400 hover:text-white transition-colors duration-300 font-gaming">
            â† Back to Options
          </button>
        </div>
      </div>
    </div>

    <!-- Game Screenshots Modal -->
    <div id="screenshots-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-[100] hidden backdrop-blur-sm">
      <div class="neon-border bg-cardBg rounded-xl shadow-2xl max-w-2xl w-full mx-4 p-8 relative animate-bounce-in">
        <button id="close-screenshots-modal" class="absolute top-4 right-4 text-3xl text-gray-400 hover:text-primary transition-colors duration-300 font-gaming">&times;</button>
        
        <div class="text-center mb-6">
          <h2 class="font-gaming text-3xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Game Preview</h2>
          <p class="text-gray-300 text-lg max-w-lg mx-auto leading-relaxed">
            Experience the ultimate educational adventure! Battle through coding challenges, explore mystical dungeons, and master programming languages in an epic quest for knowledge.
          </p>
        </div>
        
        <div class="relative mb-6">
          <div class="relative w-full flex items-center justify-center">
            <button id="carousel-prev" class="absolute left-2 top-1/2 -translate-y-1/2 bg-gradient-to-r from-primary to-yellow-300 border-none rounded-full w-12 h-12 flex items-center justify-center text-xl text-dark shadow-lg hover:shadow-primary/50 transition-all duration-300 transform hover:scale-110 z-10">â€¹</button>
            <div class="w-full flex items-center justify-center px-16">
              <img id="carousel-image" src="../public/assets/classroom_day-7QRgWPJs.png" alt="Game Screenshot" class="rounded-lg object-cover h-64 w-full max-w-md transition-all duration-500 shadow-2xl border-2 border-primary/30" />
            </div>
            <button id="carousel-next" class="absolute right-2 top-1/2 -translate-y-1/2 bg-gradient-to-r from-primary to-yellow-300 border-none rounded-full w-12 h-12 flex items-center justify-center text-xl text-dark shadow-lg hover:shadow-primary/50 transition-all duration-300 transform hover:scale-110 z-10">â€º</button>
          </div>
        </div>
        
        <div class="flex justify-center gap-3 mb-6" id="carousel-dots">
          <span class="dot w-4 h-4 rounded-full bg-primary scale-110 inline-block cursor-pointer transition-all duration-300"></span>
          <span class="dot w-4 h-4 rounded-full bg-gray-500 inline-block cursor-pointer transition-all duration-300 hover:bg-gray-400"></span>
          <span class="dot w-4 h-4 rounded-full bg-gray-500 inline-block cursor-pointer transition-all duration-300 hover:bg-gray-400"></span>
        </div>
        
        <div class="text-center">
          <a href="game.html" id="play-game-btn" class="inline-block px-10 py-4 font-gaming text-lg font-bold text-dark bg-gradient-to-r from-primary to-yellow-300 rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-primary/50 uppercase tracking-wider">
            ğŸš€ Launch Game
          </a>
        </div>
      </div>
    </div>

    <!-- About Section -->
    <section id="about" class="relative z-10 py-20 px-6">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="font-gaming text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-accent to-cyan mb-6">About Our Quest</h2>
          <div class="w-32 h-1 bg-gradient-to-r from-accent to-cyan mx-auto rounded-full"></div>
        </div>

        <!-- Hero Banner with Gaming Style -->
        <div class="neon-border rounded-xl overflow-hidden shadow-2xl mb-12 transform transition-all duration-300 hover:scale-105">
          <div class="relative">
            <img src="../public/assets/ABOUT_US-Drs9y4b1.jpg" alt="About Us - SCI-HIGH Team" class="w-full h-80 object-cover object-top" />
            <div class="absolute inset-0 bg-gradient-to-t from-dark/80 via-transparent to-transparent"></div>
            <div class="absolute bottom-6 left-6 right-6">
              <h3 class="font-gaming text-2xl font-bold text-primary mb-2">The Development Team</h3>
              <p class="text-gray-200 text-lg">Crafting the future of educational gaming</p>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <!-- Mission Description -->
          <div class="space-y-6">
            <div class="neon-border bg-cardBg rounded-lg p-8 backdrop-blur-sm">
              <h3 class="font-gaming text-2xl text-primary mb-4 flex items-center">
                <span class="mr-3">ğŸ¯</span> Our Mission
              </h3>
              <p class="text-gray-300 text-lg leading-relaxed">
                SCI-HIGH is a thesis project that transforms learning programming fundamentals into a roguelike-style game. 
                The game combines the trial-and-error process of the roguelike genre with programming education, creating an engaging way for students to learn.
              </p>
            </div>
            
            <div class="neon-border bg-cardBg rounded-lg p-8 backdrop-blur-sm">
              <h3 class="font-gaming text-2xl text-accent mb-4 flex items-center">
                <span class="mr-3">ğŸ®</span> Game Features
              </h3>
              <ul class="text-gray-300 space-y-2">
                <li class="flex items-center"><span class="text-primary mr-2">â–¶</span> Narrative in Learning Programming Fundamentals</li>
                <li class="flex items-center"><span class="text-primary mr-2">â–¶</span> Multiple programming languages and concepts</li>
                <li class="flex items-center"><span class="text-primary mr-2">â–¶</span> Fast-paced, roguelike-style game.</li>
                <li class="flex items-center"><span class="text-primary mr-2">â–¶</span> Increasing difficulty. </li>
                <li class="flex items-center"><span class="text-primary mr-2">â–¶</span> Real-time progress tracking</li>
                <li class="flex items-center"><span class="text-primary mr-2">â–¶</span> Achievement system with rewards</li>
              </ul>
            </div>

            <!-- Game Statistics -->
            <div class="neon-border bg-cardBg rounded-lg p-8 backdrop-blur-sm">
              <h3 class="font-gaming text-2xl text-purple mb-4 flex items-center">
                <span class="mr-3">ğŸ“Š</span> Game Stats
              </h3>
              <div class="grid grid-cols-2 gap-4 text-center">
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-primary">500+</div>
                  <div class="text-xs text-gray-400">Challenges</div>
                </div>
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-accent">50+</div>
                  <div class="text-xs text-gray-400">Levels</div>
                </div>
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-cyan">15+</div>
                  <div class="text-xs text-gray-400">Characters</div>
                </div>
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-purple">100+</div>
                  <div class="text-xs text-gray-400">Achievements</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Team Members -->
          <div class="space-y-6">
            <h3 class="font-gaming text-3xl text-cyan mb-8 text-center">âš”ï¸ The Guild</h3>
            <div class="space-y-4">
              <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-primary to-yellow-300 rounded-full flex items-center justify-center text-2xl font-gaming font-bold text-dark">JS</div>
                  <div>
                    <h4 class="font-gaming text-xl text-primary font-bold">Baronia, James Scott</h4>
                    <p class="text-gray-400">Project Lead & Developer</p>
                    <p class="text-sm text-gray-500">Quest Designer & System Architect</p>
                  </div>
                </div>
              </div>
              
              <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-accent to-cyan rounded-full flex items-center justify-center text-2xl font-gaming font-bold text-white">RJ</div>
                  <div>
                    <h4 class="font-gaming text-xl text-accent font-bold">Dela Cruz, Richard Joseph</h4>
                    <p class="text-gray-400">Documentation & QA Tester</p>
                    <p class="text-sm text-gray-500">Lore Master & Quality Guardian</p>
                  </div>
                </div>
              </div>
              
              <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-purple to-pink-500 rounded-full flex items-center justify-center text-2xl font-gaming font-bold text-white">JE</div>
                  <div>
                    <h4 class="font-gaming text-xl text-purple font-bold">Verceles, James Edward</h4>
                    <p class="text-gray-400">Lead Developer</p>
                    <p class="text-sm text-gray-500">Code Wizard & Technical Lead</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Programming Languages Section -->
        <div class="mt-16">
          <div class="flex items-center justify-center gap-4 mb-8">
            <img src="../public/assets/img/mainhub/PLAY_BUTTON.png" alt="Play" class="w-8 h-8 object-contain" />
            <h3 class="font-gaming text-3xl text-center text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Master These Languages</h3>
            <img src="../public/assets/img/mainhub/PLAY_BUTTON.png" alt="Play" class="w-8 h-8 object-contain" />
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 max-w-6xl mx-auto">
            <!-- HTML/CSS/JavaScript -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="../public/assets/img/comlab/icons/web-design_logo.png" alt="Web Design" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-primary text-sm">HTML/CSS/JS</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-primary h-2 rounded-full" style="width: 90%"></div>
              </div>
            </div>

            <!-- Python -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="../public/assets/img/comlab/icons/python_logo.png" alt="Python" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-accent text-sm">Python</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-accent h-2 rounded-full" style="width: 85%"></div>
              </div>
            </div>

            <!-- Java -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="../public/assets/img/comlab/icons/java_logo.png" alt="Java" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-cyan text-sm">Java</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-cyan h-2 rounded-full" style="width: 75%"></div>
              </div>
            </div>

            <!-- C Programming -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="../public/assets/img/comlab/icons/c_logo.png" alt="C Programming" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-purple text-sm">C Programming</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-purple h-2 rounded-full" style="width: 80%"></div>
              </div>
            </div>

            <!-- C++ -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="../public/assets/img/comlab/icons/cplus_logo.png" alt="C++" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-primary text-sm">C++</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-primary h-2 rounded-full" style="width: 70%"></div>
              </div>
            </div>

            <!-- C# -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="../public/assets/img/comlab/icons/csharp_logo.png" alt="C#" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-accent text-sm">C#</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-accent h-2 rounded-full" style="width: 65%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="relative z-10 py-20 px-6">
      <div class="max-w-4xl mx-auto text-center">
        <div class="neon-border bg-cardBg rounded-xl p-12 backdrop-blur-sm">
          <h2 class="font-gaming text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent mb-8">ğŸ“¡ Contact Command Center</h2>
          <p class="text-gray-300 text-xl mb-8 leading-relaxed">
            Ready to join the adventure or have questions about our quest? Send us a transmission!
          </p>
          <div class="inline-block neon-border bg-dark/50 rounded-lg p-6">
            <p class="text-lg text-gray-300 mb-4">ğŸ“§ Mission Control:</p>
            <a href="mailto:info@sci-high-thesis.com" class="font-gaming text-xl text-primary hover:text-accent transition-colors duration-300 underline decoration-primary/50">
              info@sci-high-thesis.com
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- DEV MODE Panel - Hidden by default -->
    <div id="dev-panel" class="fixed bottom-4 right-4 z-[200] hidden">
      <div class="neon-border bg-cardBg rounded-lg p-4 max-w-xs">
        <h3 class="font-gaming text-primary text-sm mb-3">ğŸ”§ Dev Mode</h3>
        <div class="space-y-2">
          <button onclick="createAdminUser()" class="w-full px-3 py-1 bg-purple text-white text-xs rounded hover:bg-purple/80">
            Admin Account
          </button>
          <button onclick="createSampleProfessor()" class="w-full px-3 py-1 bg-primary text-dark text-xs rounded hover:bg-yellow-300">
            Professor Account
          </button>
          <button onclick="createSampleStudent()" class="w-full px-3 py-1 bg-accent text-white text-xs rounded hover:bg-green-600">
            Student Account
          </button>
          <button onclick="createSampleGeneral()" class="w-full px-3 py-1 bg-cyan text-white text-xs rounded hover:bg-blue-500">
            General Account
          </button>
          <button onclick="createSampleCareerStats()" class="w-full px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700">
            ğŸ“Š Career Stats Data
          </button>
          <button onclick="logoutUser()" class="w-full px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700">
            Logout
          </button>
          <button onclick="document.getElementById('dev-panel').classList.add('hidden')" class="w-full px-3 py-1 bg-gray-600 text-white text-xs rounded hover:bg-gray-700">
            Close Panel
          </button>
        </div>
      </div>
    </div>

    <!-- Gaming Footer -->
    <footer class="relative z-10 bg-gradient-to-r from-dark to-light border-t-2 border-primary/30 py-12">
      <div class="max-w-6xl mx-auto px-6 text-center">
        <div class="flex items-center justify-center space-x-4 mb-6">
          <img src="../public/assets/img/buko_productions-logo.png" alt="Buko Productions" class="w-16 h-16" />
          <div>
            <h3 class="font-gaming text-2xl font-bold text-primary">SCI-HIGH</h3>
            <p class="text-gray-400 text-sm">Level up your knowledge!</p>
          </div>
        </div>
        <div class="w-32 h-1 bg-gradient-to-r from-primary to-accent mx-auto rounded-full mb-6"></div>
        <p class="text-gray-400 font-gaming">&copy; 2025 SCI-HIGH Thesis Project. All rights reserved. Game on! ğŸ®</p>
      </div>
    </footer>
    
    <script>
      // Global variables for modal management
      let globalLoginModal = null;
      let globalScreenshotsModal = null;

      // Global Modal Functions (defined early for immediate onclick access)
      function showLoginModal() {
        console.log('showLoginModal called');
        // Use global variable or find element
        const loginModal = globalLoginModal || document.getElementById('login-modal');
        console.log('Login modal element:', loginModal);
        if (loginModal) {
          loginModal.classList.remove('hidden');
          showUserTypeSelection();
        } else {
          console.error('Login modal not found');
          // Retry after a short delay in case DOM isn't ready
          setTimeout(() => {
            const retryModal = document.getElementById('login-modal');
            if (retryModal) {
              retryModal.classList.remove('hidden');
              showUserTypeSelection();
            }
          }, 100);
        }
      }

      function showUserTypeSelection() {
        const userTypeSelection = document.getElementById('user-type-selection');
        const professorForm = document.getElementById('professor-form');
        const studentForm = document.getElementById('student-form');
        const generalForm = document.getElementById('general-form');
        
        if (userTypeSelection) userTypeSelection.classList.remove('hidden');
        if (professorForm) professorForm.classList.add('hidden');
        if (studentForm) studentForm.classList.add('hidden');
        if (generalForm) generalForm.classList.add('hidden');
        
        // Reset student form steps when switching forms
        resetStudentFormSteps();
      }

      function resetStudentFormSteps() {
        // Reset all form steps to initial state
        const studentIdStep = document.getElementById('student-id-step');
        const studentProfileStep = document.getElementById('student-profile-step');
        const studentFoundStep = document.getElementById('student-found-step');
        
        if (studentIdStep) studentIdStep.classList.remove('hidden');
        if (studentProfileStep) studentProfileStep.classList.add('hidden');
        if (studentFoundStep) studentFoundStep.classList.add('hidden');
        
        // Clear form fields
        const studentIdInput = document.getElementById('student-id-input');
        const completeForm = document.getElementById('student-complete-form');
        
        if (studentIdInput) studentIdInput.value = '';
        if (completeForm) completeForm.reset();
        
        // Reset global variables
        currentStudentId = null;
        currentStudentData = null;
      }

      // Make functions globally accessible for onclick handlers
      window.showLoginModal = showLoginModal;
      window.showUserTypeSelection = showUserTypeSelection;
      window.resetStudentFormSteps = resetStudentFormSteps;

      // Fallback function for modal access - for GitHub Pages compatibility
      window.ensureModalAccess = function() {
        if (!globalLoginModal) {
          globalLoginModal = document.getElementById('login-modal');
        }
        if (!globalScreenshotsModal) {
          globalScreenshotsModal = document.getElementById('screenshots-modal');
        }
        return {
          loginModal: globalLoginModal,
          screenshotsModal: globalScreenshotsModal
        };
      };

      // Additional safety check for GitHub Pages
      if (typeof window !== 'undefined') {
        window.addEventListener('load', function() {
          console.log('Window loaded, ensuring modal access...');
          window.ensureModalAccess();
        });
      }

      // Particle System for Background Effect
      function createParticles() {
        const particles = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
          const particle = document.createElement('div');
          particle.className = 'absolute w-1 h-1 bg-primary/30 rounded-full animate-pulse';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.top = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 3 + 's';
          particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
          particles.appendChild(particle);
        }
      }

      // Authentication System
      class AuthManager {
        constructor() {
          this.currentUser = null;
          this.userType = null; // 'professor', 'student', 'general', 'guest'
          this.initializeAuth();
        }

        async initializeAuth() {
          // Initialize Firebase if not already done
          if (typeof firebase === 'undefined') {
            await this.loadFirebase();
          }
          
          // Check if user is already logged in
          const savedUser = localStorage.getItem('sci_high_user');
          if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            this.userType = this.currentUser.type;
          }

          // Update professor tab visibility
          this.updateProfessorTabVisibility();
          // Update user interface
          this.updateUserInterface();
        }

        // Helper method to ensure authentication before database operations
        async ensureAuthenticated() {
          try {
            if (typeof firebase !== 'undefined' && firebase.auth) {
              if (!firebase.auth().currentUser) {
                console.log('No authenticated user found, signing in anonymously...');
                await firebase.auth().signInAnonymously();
                console.log('âœ… Anonymous authentication successful');
              } else {
                console.log('âœ… User already authenticated:', firebase.auth().currentUser.uid);
              }
              return true;
            } else {
              console.warn('âš ï¸ Firebase Auth not available');
              return false;
            }
          } catch (error) {
            console.error('âŒ Authentication failed:', error);
            throw new Error(`Authentication failed: ${error.message}`);
          }
        }

        // Debug function to test Firebase connectivity
        async testFirebaseConnection() {
          try {
            console.log('Testing Firebase connection...');
            
            if (typeof firebase === 'undefined') {
              throw new Error('Firebase not loaded');
            }
            
            if (!firebase.auth) {
              throw new Error('Firebase Auth not available');
            }
            
            // Ensure authentication before database operations
            await this.ensureAuthenticated();
            
            // Test Realtime Database
            if (firebase.database) {
              try {
                await firebase.database().ref('test/connection').set({
                  timestamp: new Date().toISOString(),
                  test: true
                });
                console.log('âœ… Realtime Database write test successful');
                
                const snapshot = await firebase.database().ref('test/connection').once('value');
                console.log('âœ… Realtime Database read test successful:', snapshot.val());
              } catch (dbError) {
                console.warn('âŒ Realtime Database test failed:', dbError);
              }
            } else {
              console.warn('Realtime Database not available');
            }
            
            // Test Firestore (optional)
            if (firebase.firestore) {
              try {
                const testDoc = await firebase.firestore().collection('test').doc('connection').get();
                console.log('âœ… Firestore read test successful');
                
                await firebase.firestore().collection('test').doc('connection').set({
                  timestamp: new Date().toISOString(),
                  test: true
                });
                console.log('âœ… Firestore write test successful');
              } catch (firestoreError) {
                console.warn('âŒ Firestore test failed (likely security rules):', firestoreError);
              }
            } else {
              console.warn('Firestore not available');
            }
            
            console.log('Firebase connection test completed');
            return { success: true };
            
          } catch (error) {
            console.error('Firebase connection test failed:', error);
            return { success: false, error: error.message };
          }
        }

        async loadFirebase() {
          return new Promise((resolve, reject) => {
            if (typeof firebase !== 'undefined') {
              resolve();
              return;
            }

            const scripts = [
              'https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js',
              'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js',
              'https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js'
              // Temporarily disable Firestore to avoid connection errors
              // 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js'
            ];

            let loaded = 0;
            scripts.forEach(src => {
              const script = document.createElement('script');
              script.src = src;
              script.onload = () => {
                loaded++;
                if (loaded === scripts.length) {
                  // Initialize Firebase
                  const firebaseConfig = {
                    apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
                    authDomain: "sci-high-website.firebaseapp.com",
                    databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
                    projectId: "sci-high-website",
                    storageBucket: "sci-high-website.appspot.com",
                    messagingSenderId: "451463202515",
                    appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
                  };
                  
                  if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                  }
                  
                  // Ensure auth is ready
                  firebase.auth().onAuthStateChanged(() => {
                    console.log('Firebase Auth initialized');
                  });
                  
                  resolve();
                }
              };
              script.onerror = reject;
              document.head.appendChild(script);
            });
          });
        }

        async loginProfessor(email, password) {
          try {
            // For development: Check sample accounts first
            if (email === 'professor@sci-high.edu' && password === 'Prof123!') {
              this.currentUser = {
                uid: 'prof_sample_123',
                email: email,
                type: 'professor',
                profile: {
                  fullName: 'Dr. Sample Professor',
                  email: email,
                  institution: 'SCI-HIGH University',
                  isVerified: true
                }
              };
              
              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'professor';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();
              
              return { success: true, user: this.currentUser };
            }

            // Production Firebase login (using Realtime Database)
            if (typeof firebase !== 'undefined' && firebase.auth) {
              const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
              const user = userCredential.user;
              
              // Check if user is actually a professor in Realtime Database
              const professorSnapshot = await firebase.database().ref('professors').child(user.uid).once('value');
              if (!professorSnapshot.exists()) {
                await firebase.auth().signOut();
                throw new Error('Not registered as a professor');
              }

              const professorData = professorSnapshot.val();
              
              // Update last login timestamp
              await firebase.database().ref('professors').child(user.uid).update({
                lastLogin: new Date().toISOString(),
                lastLoginIP: 'unknown' // You can implement IP detection if needed
              });

              this.currentUser = {
                uid: user.uid,
                email: user.email,
                type: 'professor',
                profile: professorData
              };
              
              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'professor';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();
              
              return { success: true, user: this.currentUser };
            } else {
              throw new Error('Invalid credentials or Firebase not available');
            }
          } catch (error) {
            return { success: false, error: error.message };
          }
        }

        async loginStudent(studentId, password = null) {
          try {
            console.log('Attempting student login for ID:', studentId);
            
            // Sample student accounts for development
            const sampleStudents = {
              '24-2024-001': {
                profile: {
                  studentId: '24-2024-001',
                  fullName: 'Juan Dela Cruz',
                  academicInfo: { level: 'college', course: 'BS Computer Science', yearLevel: '3rd Year' },
                  accountStatus: { isFirstLogin: false, createdBy: 'prof_sample', lastLogin: new Date().toISOString() },
                  gameData: { totalPoints: 850, courseProgress: { python: { progress: 75, completed: 8, total: 12 }, javascript: { progress: 60, completed: 6, total: 10 } } }
                }
              },
              '24-2024-002': {
                profile: {
                  studentId: '24-2024-002',
                  fullName: 'Maria Santos',
                  academicInfo: { level: 'college', course: 'BS Information Technology', yearLevel: '2nd Year' },
                  accountStatus: { isFirstLogin: false, createdBy: 'prof_sample', lastLogin: new Date().toISOString() },
                  gameData: { totalPoints: 1200, courseProgress: { python: { progress: 90, completed: 11, total: 12 }, webdesign: { progress: 85, completed: 9, total: 10 } } }
                }
              },
              '24-2024-003': {
                profile: {
                  studentId: '24-2024-003',
                  fullName: 'Pedro Garcia',
                  academicInfo: { level: 'shs', strand: 'STEM', yearLevel: 'Grade 12' },
                  accountStatus: { isFirstLogin: true, createdBy: 'prof_sample', lastLogin: null },
                  gameData: { totalPoints: 300, courseProgress: { python: { progress: 30, completed: 3, total: 12 } } }
                }
              }
            };

            // Check sample accounts first (no password needed - only student ID)
            if (sampleStudents[studentId]) {
              console.log('Found sample student, logging in...');
              this.currentUser = {
                uid: 'stud_' + studentId.replace(/-/g, '_'),
                studentId: studentId,
                type: 'student',
                profile: sampleStudents[studentId].profile
              };

              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'student';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();

              return { success: true, user: this.currentUser };
            }

            // Production Firebase login (using Realtime Database when available)
            if (typeof firebase !== 'undefined' && firebase.database) {
              console.log('Using Firebase for student login...');
              
              // Ensure authentication before database access
              await this.ensureAuthenticated();
              
              // Query student by student ID in Realtime Database
              const studentsSnapshot = await firebase.database().ref('students').orderByChild('studentId').equalTo(studentId).once('value');
              
              if (!studentsSnapshot.exists()) {
                console.log('Student not found in database, creating new account...');
                // Student doesn't exist, create a new account automatically
                const newStudent = await this.createStudentAccount(studentId);
                if (newStudent.success) {
                  console.log('New student account created successfully');
                  this.currentUser = {
                    uid: newStudent.docId,
                    studentId: studentId,
                    type: 'student',
                    profile: newStudent.studentData
                  };

                  localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
                  this.userType = 'student';
                  this.updateProfessorTabVisibility();
                  this.updateUserInterface();

                  return { success: true, user: this.currentUser, isNewAccount: true };
                } else {
                  throw new Error(newStudent.error);
                }
              }

              console.log('Found existing student in database, loading data...');
              // Get the first (and should be only) student with this ID
              const studentData = Object.values(studentsSnapshot.val())[0];
              const studentKey = Object.keys(studentsSnapshot.val())[0];

              // Also check for career stats data which might have additional profile info
              let careerStatsData = null;
              try {
                const careerStatsSnapshot = await firebase.database().ref(`student_career_stats/${studentId}`).once('value');
                if (careerStatsSnapshot.exists()) {
                  careerStatsData = careerStatsSnapshot.val();
                  console.log('Found career stats data for student:', careerStatsData);
                }
              } catch (error) {
                console.log('No career stats found for student (this is normal for new students):', error.message);
              }

              // Merge career stats data with main student data if available
              const mergedStudentData = { ...studentData };
              if (careerStatsData) {
                // Merge profile information from career stats
                if (careerStatsData.firstName) mergedStudentData.firstName = careerStatsData.firstName;
                if (careerStatsData.lastName) mergedStudentData.lastName = careerStatsData.lastName;
                if (careerStatsData.department) mergedStudentData.department = careerStatsData.department;
                if (careerStatsData.strandYear) mergedStudentData.strandYear = careerStatsData.strandYear;
                
                // Update fullName if we have both first and last name
                if (careerStatsData.firstName && careerStatsData.lastName) {
                  mergedStudentData.fullName = `${careerStatsData.firstName} ${careerStatsData.lastName}`;
                }
              }

              // Update last login timestamp
              await firebase.database().ref('students').child(studentKey).update({
                lastLogin: new Date().toISOString(),
                'progress/lastActivity': new Date().toISOString()
              });

              // No password verification needed - students only need their student ID
              this.currentUser = {
                uid: studentKey,
                studentId: studentData.studentId,
                type: 'student',
                profile: mergedStudentData
              };

              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'student';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();

              return { success: true, user: this.currentUser };
            } else {
              console.log('Firebase not available, using local storage fallback...');
              // Fallback: Create account locally if Firebase not available
              const localStudents = JSON.parse(localStorage.getItem('sci_high_local_students') || '{}');
              
              if (!localStudents[studentId]) {
                console.log('Creating new local student account...');
                // Create new local account
                localStudents[studentId] = this.createLocalStudentAccount(studentId);
                localStorage.setItem('sci_high_local_students', JSON.stringify(localStudents));
                
                this.currentUser = {
                  uid: 'local_' + studentId.replace(/-/g, '_'),
                  studentId: studentId,
                  type: 'student',
                  profile: localStudents[studentId]
                };

                localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
                this.userType = 'student';
                this.updateProfessorTabVisibility();
                this.updateUserInterface();

                return { success: true, user: this.currentUser, isNewAccount: true };
              } else {
                console.log('Found existing local student account...');
                // Login with existing local account
                this.currentUser = {
                  uid: 'local_' + studentId.replace(/-/g, '_'),
                  studentId: studentId,
                  type: 'student',
                  profile: localStudents[studentId]
                };

                localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
                this.userType = 'student';
                this.updateProfessorTabVisibility();

                return { success: true, user: this.currentUser };
              }
            }
          } catch (error) {
            console.error('Student login error:', error);
            return { success: false, error: error.message };
          }
        }

        // Create a new student account in Firebase
        async createStudentAccount(studentId) {
          try {
            console.log('Creating new student account for ID:', studentId);
            
            // Ensure authentication before database operations
            await this.ensureAuthenticated();
            
            // Enhanced duplicate check - check multiple ways student might already exist
            console.log('Performing comprehensive duplicate check...');
            
            // Check 1: Query by studentId (primary check)
            const existingByIdSnapshot = await firebase.database().ref('students').orderByChild('studentId').equalTo(studentId).once('value');
            if (existingByIdSnapshot.exists()) {
              console.log('Student already exists with this Student ID:', studentId);
              throw new Error(`Student account already exists for ID: ${studentId}. Please contact administrator if you cannot access your account.`);
            }
            
            // Check 2: Check career stats to see if student has been playing
            const careerStatsSnapshot = await firebase.database().ref('student_career_stats').child(studentId).once('value');
            if (careerStatsSnapshot.exists()) {
              const careerData = careerStatsSnapshot.val();
              console.log('Found existing career stats for student:', studentId);
              
              // If career stats exist but no main student record, this might be a data inconsistency
              console.warn('Career stats exist but no main student record found. Creating main record...');
              // Continue with creation but use info from career stats if available
            }
            
            // Check 3: Additional safety check for recent students (last 24 hours)
            const recentStudentsSnapshot = await firebase.database().ref('students')
              .orderByChild('accountStatus/createdAt')
              .startAt(new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString())
              .once('value');
            
            if (recentStudentsSnapshot.exists()) {
              const recentStudents = recentStudentsSnapshot.val();
              for (const [key, student] of Object.entries(recentStudents)) {
                if (student.studentId === studentId) {
                  console.log('Found duplicate student created in last 24 hours:', studentId);
                  throw new Error(`Student account for ID ${studentId} was recently created. Please try logging in instead.`);
                }
              }
            }
            
            console.log('No duplicates found, proceeding with account creation...');
            
            const studentData = {
              studentId,
              fullName: `Student ${studentId}`, // Default name, can be updated later
              academicInfo: {
                level: 'unknown', // Will be set by student or administrator later
                course: null,
                yearLevel: null,
                strand: null
              },
              accountStatus: {
                isActive: true,
                isFirstLogin: true,
                createdBy: 'auto-created',
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
              },
              progress: {
                completedQuizzes: [],
                completedStories: [],
                totalScore: 0,
                lastActivity: new Date().toISOString()
              },
              gameData: {
                totalPoints: 0,
                achievements: [],
                currentLevel: 1,
                courseProgress: {
                  'Web_Design': { unlocked: true, completed: false, progress: 0 },
                  'Python': { unlocked: true, completed: false, progress: 0 },
                  'Java': { unlocked: false, completed: false, progress: 0 },
                  'C': { unlocked: false, completed: false, progress: 0 },
                  'CPlusPlus': { unlocked: false, completed: false, progress: 0 },
                  'CSharp': { unlocked: false, completed: false, progress: 0 }
                }
              },
              needsProfileCompletion: true, // Flag to show profile completion modal
              accountType: 'student'
            };

            // Use studentId as the key instead of auto-generated key for better consistency
            const studentRef = firebase.database().ref('students').child(studentId);
            await studentRef.set(studentData);
            
            console.log('Student account created successfully with key:', studentId);
            
            return { 
              success: true, 
              docId: studentId, // Return the studentId as the document ID
              studentData: studentData
            };
          } catch (error) {
            console.error('Error creating student account:', error);
            return { success: false, error: 'Failed to create student account: ' + error.message };
          }
        }

        // Create local student account for offline mode
        createLocalStudentAccount(studentId) {
          return {
            studentId,
            fullName: `Student ${studentId}`,
            academicInfo: {
              level: 'unknown',
              course: null,
              yearLevel: null,
              strand: null
            },
            accountStatus: {
              isActive: true,
              isFirstLogin: true,
              createdBy: 'auto-created-local',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString()
            },
            gameData: {
              totalPoints: 0,
              achievements: [],
              courseProgress: {
                'Web_Design': { unlocked: true, completed: false, progress: 0 },
                'Python': { unlocked: true, completed: false, progress: 0 },
                'Java': { unlocked: false, completed: false, progress: 0 },
                'C': { unlocked: false, completed: false, progress: 0 },
                'CPlusPlus': { unlocked: false, completed: false, progress: 0 },
                'CSharp': { unlocked: false, completed: false, progress: 0 }
              }
            }
          };
        }

        async loginGeneral(email, password) {
          try {
            const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            // Get user data from Realtime Database
            const userSnapshot = await firebase.database().ref('general_users').child(user.uid).once('value');
            if (!userSnapshot.exists()) {
              throw new Error('User profile not found');
            }

            const userData = userSnapshot.val();
            
            // Update last login timestamp
            await firebase.database().ref('general_users').child(user.uid).update({
              lastLogin: new Date().toISOString()
            });

            this.currentUser = {
              uid: user.uid,
              email: user.email,
              type: 'general',
              profile: userData
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'general';
            
            // Update professor tab visibility
            this.updateProfessorTabVisibility();
            // Update user interface
            this.updateUserInterface();
            
            return { success: true, user: this.currentUser };
          } catch (error) {
            return { success: false, error: error.message };
          }
        }

        async registerGeneral(formData) {
          try {
            const userCredential = await firebase.auth().createUserWithEmailAndPassword(formData.email, formData.password);
            const user = userCredential.user;

            // Save user data to Realtime Database
            await firebase.database().ref('general_users').child(user.uid).set({
              fullName: formData.fullName,
              email: formData.email,
              displayName: formData.displayName,
              createdAt: new Date().toISOString(),
              gameData: {
                totalPoints: 0,
                achievements: [],
                courseProgress: {}
              }
            });

            return { success: true, message: 'Account created successfully!' };
          } catch (error) {
            return { success: false, error: error.message };
          }
        }

        createGuestSession() {
          const guestId = 'guest_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          this.currentUser = {
            uid: guestId,
            type: 'guest',
            profile: {
              displayName: 'Guest Player',
              isGuest: true
            }
          };
          
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          this.userType = 'guest';
          
          // Update professor tab visibility
          this.updateProfessorTabVisibility();
          // Update user interface (guest won't show logout button)
          this.updateUserInterface();
          
          return this.currentUser;
        }

        logout() {
          // Show confirmation dialog
          modernConfirm('Are you sure you want to logout?', {
            title: 'Confirm Logout',
            type: 'warning',
            confirmText: 'Yes, Logout',
            cancelText: 'Cancel'
          }).then((confirmed) => {
            if (!confirmed) {
              return; // User cancelled logout
            }

            if (this.userType !== 'guest') {
              firebase.auth().signOut();
            }
            
            this.currentUser = null;
            this.userType = null;
            localStorage.removeItem('sci_high_user');
            
            // Update professor tab visibility (hide it)
            this.updateProfessorTabVisibility();
            // Update user interface (hide greeting and logout button)
            this.updateUserInterface();
            
            // Show success message
            showSuccess('You have been logged out successfully!');
          });
        }

        isAuthenticated() {
          return this.currentUser !== null;
        }

        redirectToGame() {
          // Store authentication state for game.html
          sessionStorage.setItem('sci_high_authenticated', 'true');
          sessionStorage.setItem('sci_high_user_type', this.userType);
          window.location.href = 'game.html';
        }

        // Update professor tab visibility based on user type
        updateProfessorTabVisibility() {
          const professorTab = document.getElementById('professor-nav-link');
          if (!professorTab) return;

          // Show professor tab only for professors and admins
          const canAccessProfessorDashboard = this.currentUser && 
            (this.userType === 'professor' || this.userType === 'admin');

          if (canAccessProfessorDashboard) {
            professorTab.classList.remove('hidden');
          } else {
            professorTab.classList.add('hidden');
          }
        }

        // Update user greeting and logout button visibility
        updateUserInterface() {
          const userGreeting = document.getElementById('user-greeting');
          const greetingText = document.getElementById('greeting-text');
          const logoutBtn = document.getElementById('logout-btn');
          const loginBtn = document.getElementById('login-btn');

          if (!userGreeting || !greetingText || !logoutBtn || !loginBtn) return;

          if (this.currentUser && this.userType !== 'guest') {
            // Show user greeting and logout button for logged-in users (except guests)
            userGreeting.classList.remove('hidden');
            logoutBtn.classList.remove('hidden');
            // Hide login button when user is logged in
            loginBtn.classList.add('hidden');

            // Set personalized greeting based on user type
            let greetingMessage = '';
            if (this.userType === 'student') {
              greetingMessage = `Hello, ${this.currentUser.profile?.fullName || this.currentUser.name || 'Student'}!`;
            } else if (this.userType === 'professor') {
              greetingMessage = `Hello, Prof. ${this.currentUser.profile?.fullName || this.currentUser.name || 'Professor'}!`;
            } else if (this.userType === 'admin') {
              greetingMessage = `Hello, Admin ${this.currentUser.profile?.fullName || this.currentUser.name || 'Admin'}!`;
            } else {
              greetingMessage = `Hello, ${this.currentUser.profile?.fullName || this.currentUser.name || 'User'}!`;
            }
            greetingText.textContent = greetingMessage;
          } else {
            // Hide user greeting and logout button for guests or non-logged-in users
            userGreeting.classList.add('hidden');
            logoutBtn.classList.add('hidden');
            // Show login button when user is not logged in
            loginBtn.classList.remove('hidden');
          }
        }

        // DEV MODE: Create admin user for testing
        async createAdminUser() {
          try {
            // Ensure authentication before database operations
            await this.ensureAuthenticated();
            
            const adminData = {
              fullName: 'System Administrator',
              email: 'admin@sci-high.edu',
              isAdmin: true,
              type: 'admin',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString(),
              permissions: ['read', 'write', 'delete', 'admin']
            };

            // Save to Firebase if available (using Realtime Database)
            if (typeof firebase !== 'undefined' && firebase.database) {
              const adminRef = firebase.database().ref('professors').child('admin_system');
              await adminRef.set(adminData);
              console.log('Admin user saved to Realtime Database');
            } else if (typeof firebase !== 'undefined' && firebase.firestore) {
              const adminRef = firebase.firestore().collection('professors').doc('admin_system');
              await adminRef.set(adminData);
              console.log('Admin user saved to Firestore (fallback)');
            }

            this.currentUser = {
              uid: 'admin_system',
              type: 'admin',
              profile: adminData
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'admin';
            this.updateProfessorTabVisibility();
            this.updateUserInterface();
            
            return this.currentUser;
          } catch (error) {
            console.error('Error creating admin user:', error);
            // Fallback to local storage only
            this.currentUser = {
              uid: 'admin_' + Date.now(),
              type: 'admin',
              profile: {
                fullName: 'System Administrator',
                email: 'admin@sci-high.edu',
                isAdmin: true
              }
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'admin';
            this.updateProfessorTabVisibility();
            this.updateUserInterface();
            
            return this.currentUser;
          }
        }

        // DEV MODE: Create professor user in Firebase (Realtime Database version)
        async createProfessorUser(email, password, fullName, institution = 'SCI-HIGH University') {
          try {
            // Ensure Firebase is loaded and initialized
            if (typeof firebase === 'undefined') {
              await this.loadFirebase();
            }
            
            if (!firebase.auth || !firebase.database) {
              throw new Error('Firebase services not available');
            }

            console.log('Creating professor user:', { email, fullName, institution });

            // Create Firebase Auth user
            const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            console.log('Firebase Auth user created:', user.uid);

            // Create professor profile in Realtime Database
            const professorData = {
              fullName: fullName,
              email: email,
              institution: institution,
              isVerified: true,
              type: 'professor',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString(),
              permissions: ['read', 'write'],
              classes: [],
              students: []
            };

            console.log('Saving professor data to Realtime Database...');
            
            // Add retry logic for Database write
            let retries = 3;
            while (retries > 0) {
              try {
                await firebase.database().ref('professors').child(user.uid).set(professorData);
                console.log('Professor data saved successfully');
                break;
              } catch (databaseError) {
                console.error(`Database write attempt failed (${4-retries}/3):`, databaseError);
                retries--;
                if (retries === 0) {
                  throw databaseError;
                }
                // Wait 1 second before retry
                await new Promise(resolve => setTimeout(resolve, 1000));
              }
            }

            console.log('Professor user created successfully:', {
              uid: user.uid,
              email: email,
              fullName: fullName
            });

            return {
              success: true,
              uid: user.uid,
              email: email,
              profile: professorData
            };

          } catch (error) {
            console.error('Error creating professor user:', error);
            
            // Enhanced error information
            if (error.code) {
              console.error('Firebase error code:', error.code);
            }
            if (error.message) {
              console.error('Firebase error message:', error.message);
            }
            
            return {
              success: false,
              error: error.message,
              code: error.code || 'unknown'
            };
          }
        }
      }

      // Global debug function for testing authentication
      window.debugAuth = async () => {
        console.log('ğŸ” Debugging Authentication...');
        
        try {
          // Test Firebase availability
          console.log('Firebase available:', typeof firebase !== 'undefined');
          if (typeof firebase !== 'undefined') {
            console.log('Firebase Auth available:', !!firebase.auth);
            console.log('Firebase Database available:', !!firebase.database);
            
            if (firebase.auth) {
              console.log('Current user:', firebase.auth().currentUser);
              
              // Test authentication
              if (!firebase.auth().currentUser) {
                console.log('Attempting anonymous authentication...');
                await firebase.auth().signInAnonymously();
                console.log('âœ… Authentication successful');
              }
              
              // Test database access
              if (firebase.database) {
                console.log('Testing database read access...');
                const testRef = firebase.database().ref('test/debug');
                await testRef.set({ timestamp: new Date().toISOString() });
                const snapshot = await testRef.once('value');
                console.log('âœ… Database access successful:', snapshot.val());
              }
            }
          }
          
          console.log('ğŸ‰ Debug completed successfully!');
        } catch (error) {
          console.error('âŒ Debug failed:', error);
        }
      };

      // Test student login function for debugging
      window.debugStudentLogin = async (studentId = '20-0774-140') => {
        console.log(`ğŸ” Debugging student login for ID: ${studentId}`);
        
        try {
          const result = await authManager.loginStudent(studentId);
          console.log('Login result:', result);
          return result;
        } catch (error) {
          console.error('âŒ Student login debug failed:', error);
          return { success: false, error: error.message };
        }
      };

      // Initialize AuthManager and ensure Firebase is ready
      const authManager = new AuthManager();
      
      // Add offline fallback for localhost testing
      authManager.createOfflineTestAccounts = function() {
        console.log('Creating offline test accounts for localhost development');
        
        // Add a simple offline authentication fallback
        this.loginStudentOffline = function(studentId) {
          console.log('Using offline student login for:', studentId);
          this.currentUser = {
            uid: 'offline_' + studentId,
            studentId: studentId,
            type: 'student',
            profile: {
              studentId: studentId,
              fullName: `Student ${studentId}`,
              isOffline: true
            }
          };
          this.userType = 'student';
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          return { success: true, user: this.currentUser, isNewAccount: true };
        };
        
        this.loginGeneralOffline = function(email) {
          console.log('Using offline general login for:', email);
          this.currentUser = {
            uid: 'offline_' + email.replace('@', '_'),
            email: email,
            type: 'general',
            profile: {
              fullName: 'Offline User',
              email: email,
              isOffline: true
            }
          };
          this.userType = 'general';
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          return { success: true, user: this.currentUser };
        };
        
        // Enhanced student profile methods
        this.getStudentProfile = async function(studentId) {
          console.log('getStudentProfile called with studentId:', studentId);
          
          try {
            // Try to get from Firebase first
            if (typeof firebase !== 'undefined' && firebase.database) {
              console.log('Querying Firebase for student:', studentId);
              await this.ensureAuthenticated(); // Make sure we're authenticated
              
              const snapshot = await firebase.database().ref('students').orderByChild('studentId').equalTo(studentId).once('value');
              const data = snapshot.val();
              console.log('Firebase query result:', data);
              
              if (data) {
                const studentKey = Object.keys(data)[0];
                const studentData = data[studentKey];
                console.log('Found student in Firebase:', studentData);
                
                // Also check for career stats data which might have additional profile info
                let careerStatsData = null;
                try {
                  const careerStatsSnapshot = await firebase.database().ref(`student_career_stats/${studentId}`).once('value');
                  if (careerStatsSnapshot.exists()) {
                    careerStatsData = careerStatsSnapshot.val();
                    console.log('Found career stats data for student:', careerStatsData);
                  }
                } catch (error) {
                  console.log('No career stats found for student (this is normal for new students):', error.message);
                }

                // Merge career stats data with main student data if available
                const mergedStudentData = { ...studentData };
                if (careerStatsData) {
                  // Merge profile information from career stats
                  if (careerStatsData.firstName) mergedStudentData.firstName = careerStatsData.firstName;
                  if (careerStatsData.lastName) mergedStudentData.lastName = careerStatsData.lastName;
                  if (careerStatsData.department) mergedStudentData.department = careerStatsData.department;
                  if (careerStatsData.strandYear) mergedStudentData.strandYear = careerStatsData.strandYear;
                  
                  // Update fullName if we have both first and last name
                  if (careerStatsData.firstName && careerStatsData.lastName) {
                    mergedStudentData.fullName = `${careerStatsData.firstName} ${careerStatsData.lastName}`;
                  }
                }
                
                console.log('Merged student data:', mergedStudentData);
                return mergedStudentData;
              } else {
                console.log('No student found in Firebase with studentId:', studentId);
              }
            } else {
              console.log('Firebase database not available');
            }
          } catch (error) {
            console.warn('Firebase getStudentProfile failed:', error);
          }
          
          // Fallback to offline storage
          console.log('Checking offline storage...');
          const offlineStudents = JSON.parse(localStorage.getItem('sci_high_offline_students') || '[]');
          const offlineResult = offlineStudents.find(s => s.studentId === studentId) || null;
          console.log('Offline storage result:', offlineResult);
          return offlineResult;
        };
        
        this.loginStudentWithProfile = async function(studentId, profileData) {
          try {
            // Try Firebase first
            if (typeof firebase !== 'undefined' && firebase.database) {
              await this.ensureAuthenticated(); // Make sure we're authenticated
              
              const studentsRef = firebase.database().ref('students');
              
              // Check if student exists
              const snapshot = await studentsRef.orderByChild('studentId').equalTo(studentId).once('value');
              const existingData = snapshot.val();
              let studentKey;
              
              if (existingData) {
                studentKey = Object.keys(existingData)[0];
                // Update existing student with new profile data
                await studentsRef.child(studentKey).update({
                  firstName: profileData.firstName,
                  lastName: profileData.lastName,
                  fullName: `${profileData.firstName} ${profileData.lastName}`,
                  department: profileData.department,
                  strandYear: profileData.strandYear,
                  strand: profileData.strand,
                  year: profileData.year,
                  lastLogin: new Date().toISOString(),
                  profileCompleted: true,
                  needsProfileCompletion: false // Clear the flag
                });
              } else {
                // Create new student
                const newStudentData = {
                  studentId,
                  firstName: profileData.firstName,
                  lastName: profileData.lastName,
                  fullName: `${profileData.firstName} ${profileData.lastName}`,
                  department: profileData.department,
                  strandYear: profileData.strandYear,
                  strand: profileData.strand,
                  year: profileData.year,
                  isActive: true,
                  createdAt: new Date().toISOString(),
                  lastLogin: new Date().toISOString(),
                  profileCompleted: true,
                  needsProfileCompletion: false, // Profile is now complete
                  progress: {
                    completedQuizzes: [],
                    completedStories: [],
                    totalScore: 0,
                    lastActivity: new Date().toISOString(),
                    gameData: {
                      currentLevel: 1,
                      totalPoints: 0,
                      achievements: [],
                      courseProgress: {}
                    }
                  }
                };
                
                const newRef = await studentsRef.push(newStudentData);
                studentKey = newRef.key;
              }
              
              // Set current user
              this.currentUser = {
                uid: studentKey,
                studentId: studentId,
                type: 'student',
                profile: {
                  studentId,
                  firstName: profileData.firstName,
                  lastName: profileData.lastName,
                  fullName: `${profileData.firstName} ${profileData.lastName}`,
                  department: profileData.department,
                  strandYear: profileData.strandYear,
                  profileCompleted: true
                }
              };
              this.userType = 'student';
              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              
              return { success: true, user: this.currentUser };
            }
          } catch (error) {
            console.warn('Firebase loginStudentWithProfile failed:', error);
          }
          
          // Fallback to offline
          return this.loginStudentOfflineWithProfile(studentId, profileData);
        };
        
        this.loginStudentOfflineWithProfile = function(studentId, profileData) {
          console.log('Using offline student login with profile for:', studentId);
          
          const studentData = {
            studentId,
            firstName: profileData.firstName,
            lastName: profileData.lastName,
            fullName: `${profileData.firstName} ${profileData.lastName}`,
            department: profileData.department,
            strandYear: profileData.strandYear,
            isOffline: true,
            profileCompleted: true,
            createdAt: new Date().toISOString(),
            lastLogin: new Date().toISOString()
          };
          
          // Save to offline storage
          const offlineStudents = JSON.parse(localStorage.getItem('sci_high_offline_students') || '[]');
          const existingIndex = offlineStudents.findIndex(s => s.studentId === studentId);
          
          if (existingIndex >= 0) {
            offlineStudents[existingIndex] = { ...offlineStudents[existingIndex], ...studentData };
          } else {
            offlineStudents.push(studentData);
          }
          
          localStorage.setItem('sci_high_offline_students', JSON.stringify(offlineStudents));
          
          this.currentUser = {
            uid: 'offline_' + studentId,
            studentId: studentId,
            type: 'student',
            profile: studentData
          };
          this.userType = 'student';
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          
          return { success: true, user: this.currentUser };
        };
      };
      
      // Initialize offline accounts
      authManager.createOfflineTestAccounts();

      // DOM-dependent initialization (run after DOM loads)
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded fired');
        
        // Initialize global modal variables
        globalLoginModal = document.getElementById('login-modal');
        globalScreenshotsModal = document.getElementById('screenshots-modal');
        
        // Check for critical elements
        const criticalElements = {
          'login-modal': globalLoginModal,
          'screenshots-modal': globalScreenshotsModal,
          'start-game-btn': document.getElementById('start-game-btn'),
          'professor-login-form': document.getElementById('professor-login-form'),
          'student-complete-form': document.getElementById('student-complete-form'),
          'general-login-form': document.getElementById('general-login-form'),
          'general-register-form': document.getElementById('general-register-form'),
          'guest-option': document.getElementById('guest-option')
        };
        
        console.log('Critical elements check:');
        Object.entries(criticalElements).forEach(([id, element]) => {
          console.log(`${id}:`, element ? 'âœ… Found' : 'âŒ Missing');
        });
        
        // Modal Management - Use global variables
        const loginModal = globalLoginModal;
        const screenshotsModal = globalScreenshotsModal;
        const startGameBtn = document.getElementById('start-game-btn');

        console.log('Elements found:', {
          loginModal: !!loginModal,
          screenshotsModal: !!screenshotsModal,
          startGameBtn: !!startGameBtn
        });

      // User Type Selection Elements
      const userTypeSelection = document.getElementById('user-type-selection');
      const professorForm = document.getElementById('professor-form');
      const studentForm = document.getElementById('student-form');
      const generalForm = document.getElementById('general-form');
      const backToSelection = document.getElementById('back-to-selection');

      // Show Specific Form
      function showForm(formType) {
        userTypeSelection.classList.add('hidden');
        professorForm.classList.add('hidden');
        studentForm.classList.add('hidden');
        generalForm.classList.add('hidden');
        backToSelection.classList.remove('hidden');

        switch(formType) {
          case 'professor':
            professorForm.classList.remove('hidden');
            break;
          case 'student':
            studentForm.classList.remove('hidden');
            break;
          case 'general':
            generalForm.classList.remove('hidden');
            break;
        }
      }

      // Event Listeners for User Type Selection
      document.getElementById('professor-option').addEventListener('click', () => showForm('professor'));
      document.getElementById('student-option').addEventListener('click', () => showForm('student'));
      document.getElementById('general-option').addEventListener('click', () => showForm('general'));
      
      document.getElementById('guest-option').addEventListener('click', () => {
        authManager.createGuestSession();
        loginModal.classList.add('hidden');
        authManager.redirectToGame();
      });

      // Back to selection
      backToSelection.addEventListener('click', showUserTypeSelection);

      // Form Submissions
      document.getElementById('professor-login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        // Use the local authManager instead of importing external service
        const result = await authManager.loginProfessor(formData.get('email'), formData.get('password'));
        
        if (result.success) {
          loginModal.classList.add('hidden');
          // Redirect to professor dashboard
          window.location.href = 'professor-dashboard.html';
        } else {
          showError('Login failed: ' + result.error, { title: 'Professor Login Failed' });
        }
      });

      // Student Login Process
      let currentStudentId = null;
      let currentStudentData = null;
      
      // Step 1: Verify Student ID
      document.getElementById('verify-student-id').addEventListener('click', async () => {
        const studentIdInput = document.getElementById('student-id-input');
        const studentId = studentIdInput.value.trim();
        
        // Validate student ID format (XX-XXXX-XXX)
        const studentIdPattern = /^[0-9]{2}-[0-9]{4}-[0-9]{3}$/;
        if (!studentIdPattern.test(studentId)) {
          showError('Invalid Student ID format!\n\nPlease use the format: XX-XXXX-XXX\nExample: 24-2024-001\n\nâ€¢ XX = 2-digit year/batch\nâ€¢ XXXX = 4-digit year\nâ€¢ XXX = 3-digit sequence number', {
            title: 'Invalid Student ID Format'
          });
          return;
        }
        
        currentStudentId = studentId;
        
        try {
          // Check if student exists in the database
          const studentData = await authManager.getStudentProfile(studentId);
          
          console.log('Retrieved student data:', studentData);
          
          if (studentData) {
            // Student exists in database, show welcome screen
            console.log('Student found in database, showing profile found step');
            showStudentFoundStep(studentData);
          } else {
            // Student doesn't exist, show profile completion form
            console.log('Student not found in database, showing profile completion form');
            showStudentProfileStep(null);
          }
        } catch (error) {
          console.warn('Error checking student profile:', error);
          // If Firebase is down, show profile completion form
          showStudentProfileStep(null);
        }
      });
      
      // Step 2: Complete Profile Form
      document.getElementById('student-complete-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        const strand = formData.get('strand');
        const year = formData.get('year');
        const strandYear = `${year} Year ${strand}`; // Combine strand and year
        
        const profileData = {
          studentId: currentStudentId,
          firstName: formData.get('firstName').trim(),
          lastName: formData.get('lastName').trim(),
          department: formData.get('department'),
          strandYear: strandYear,
          strand: strand,
          year: year
        };
        
        try {
          // Complete the student login with profile data
          const result = await authManager.loginStudentWithProfile(currentStudentId, profileData);
          
          if (result.success) {
            showSuccess('Welcome! Your profile has been set up successfully. Your progress will be saved automatically.', {
              title: 'ğŸ‰ Profile Complete!'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Profile setup failed: ' + result.error, { title: 'Setup Failed' });
          }
        } catch (error) {
          console.warn('Firebase profile setup failed, trying offline mode:', error);
          // Fallback to offline mode
          const offlineResult = authManager.loginStudentOfflineWithProfile(currentStudentId, profileData);
          if (offlineResult.success) {
            showInfo('Welcome! Your profile has been set up in offline mode. Progress will be saved locally.', {
              title: 'ğŸ“± Offline Mode'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Profile setup failed: Unable to save profile', { title: 'Setup Error' });
          }
        }
      });
      
      // Step 3: Login Existing Student
      document.getElementById('login-existing-student').addEventListener('click', async () => {
        try {
          const result = await authManager.loginStudent(currentStudentId);
          
          if (result.success) {
            showSuccess('Welcome back! Your progress has been loaded.', {
              title: 'ğŸ‘‹ Welcome Back!'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Login failed: ' + result.error, { title: 'Student Login Failed' });
          }
        } catch (error) {
          console.warn('Firebase login failed, trying offline mode:', error);
          // Fallback to offline mode
          const offlineResult = authManager.loginStudentOffline(currentStudentId);
          if (offlineResult.success) {
            showInfo('Welcome! You are playing in offline mode. Progress will be saved locally.', {
              title: 'ğŸ“± Offline Mode'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Login failed: Unable to authenticate', { title: 'Authentication Error' });
          }
        }
      });
      
      // Helper functions for step management
      function showStudentProfileStep(existingData) {
        document.getElementById('student-id-step').classList.add('hidden');
        document.getElementById('student-found-step').classList.add('hidden');
        document.getElementById('student-profile-step').classList.remove('hidden');
        
        // Pre-fill existing data if available
        if (existingData) {
          const form = document.getElementById('student-complete-form');
          if (existingData.firstName) form.querySelector('[name="firstName"]').value = existingData.firstName;
          if (existingData.lastName) form.querySelector('[name="lastName"]').value = existingData.lastName;
          if (existingData.department) form.querySelector('[name="department"]').value = existingData.department;
          
          // Handle separate strand and year fields
          if (existingData.strand) form.querySelector('[name="strand"]').value = existingData.strand;
          if (existingData.year) form.querySelector('[name="year"]').value = existingData.year;
          
          // If only strandYear exists (legacy data), try to parse it
          if (existingData.strandYear && !existingData.strand && !existingData.year) {
            const parseStrandYear = (strandYear) => {
              // Try to extract year and strand from combined string
              const yearMatch = strandYear.match(/(\d+)(st|nd|rd|th)/i);
              const year = yearMatch ? yearMatch[1] + (yearMatch[2] || '') : '';
              
              let strand = '';
              if (strandYear.includes('BSCS') || strandYear.includes('BS CS')) strand = 'BSCS';
              else if (strandYear.includes('BSIT') || strandYear.includes('BS IT')) strand = 'BSIT';
              else if (strandYear.includes('ICT')) strand = 'ICT';
              
              return { strand, year };
            };
            
            const { strand, year } = parseStrandYear(existingData.strandYear);
            if (strand) form.querySelector('[name="strand"]').value = strand;
            if (year) form.querySelector('[name="year"]').value = year;
          }
        }
      }
      
      function showStudentFoundStep(studentData) {
        document.getElementById('student-id-step').classList.add('hidden');
        document.getElementById('student-profile-step').classList.add('hidden');
        document.getElementById('student-found-step').classList.remove('hidden');
        
        // Extract student information from various possible data structures
        const firstName = studentData.firstName || (studentData.fullName ? studentData.fullName.split(' ')[0] : 'Student');
        const lastName = studentData.lastName || (studentData.fullName ? studentData.fullName.split(' ').slice(1).join(' ') : '');
        const fullName = studentData.fullName || `${firstName} ${lastName}`.trim();
        const department = studentData.department || studentData.academicInfo?.department || 'Unknown Department';
        const strandYear = studentData.strandYear || 
                          (studentData.strand && studentData.year ? `${studentData.year} Year ${studentData.strand}` : '') ||
                          studentData.academicInfo?.course || 'Unknown Program';
        const studentId = studentData.studentId || currentStudentId;
        
        // Show student profile preview
        const preview = document.getElementById('student-profile-preview');
        preview.innerHTML = `
          <p><strong>ğŸ‘¤ Name:</strong> ${fullName}</p>
          <p><strong>ğŸ“ Department:</strong> ${department}</p>
          <p><strong>ğŸ“š Program:</strong> ${strandYear}</p>
          <p><strong>ğŸ†” Student ID:</strong> ${studentId}</p>
        `;
        
        currentStudentData = studentData;
      }
      
      // Allow Enter key to trigger verification
      document.getElementById('student-id-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('verify-student-id').click();
        }
      });

      document.getElementById('general-login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        try {
          // Use the local authManager instead of importing external service
          const result = await authManager.loginGeneral(formData.get('email'), formData.get('password'));
          
          if (result.success) {
            loginModal.classList.add('hidden');
            authManager.redirectToGame();
          } else {
            showError('Login failed: ' + result.error, { title: 'General Login Failed' });
          }
        } catch (error) {
          console.warn('Firebase login failed, trying offline mode:', error);
          // Fallback to offline mode
          const offlineResult = authManager.loginGeneralOffline(formData.get('email'));
          if (offlineResult.success) {
            showInfo('Welcome! You are playing in offline mode. Progress will be saved locally.', {
              title: 'ğŸ“± Offline Mode'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Login failed: Unable to authenticate', { title: 'Authentication Error' });
          }
        }
      });

      document.getElementById('general-register-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        // Use the local authManager instead of importing external service
        const result = await authManager.registerGeneral({
          fullName: formData.get('fullName'),
          email: formData.get('email'),
          displayName: formData.get('displayName'),
          password: formData.get('password')
        });
        
        if (result.success) {
          showSuccess('Account created successfully!', { title: 'ğŸ‰ Registration Complete' }).then(() => {
            e.target.reset();
            // Auto-login after successful registration
            loginModal.classList.add('hidden');
            authManager.redirectToGame();
          });
        } else {
          showError('Registration failed: ' + result.error, { title: 'Registration Failed' });
        }
      });

      // Close Modal Functions with error handling
      const closeLoginModalBtn = document.getElementById('close-login-modal');
      if (closeLoginModalBtn) {
        closeLoginModalBtn.addEventListener('click', () => {
          if (loginModal) {
            loginModal.classList.add('hidden');
            resetStudentFormSteps(); // Reset student form when modal closes
          }
        });
      } else {
        console.warn('Close login modal button not found');
      }

      // Close modal on outside click
      if (loginModal) {
        loginModal.addEventListener('click', (e) => {
          if (e.target === loginModal) {
            loginModal.classList.add('hidden');
            resetStudentFormSteps(); // Reset student form when modal closes
          }
        });
      } else {
        console.warn('Login modal not found for outside click handler');
      }

      // Gaming Modal and Carousel System
      const screenshots = [
        'public/assets/classroom_day-7QRgWPJs.png',
        'public/assets/img/bg/libraryBG.png',
        'public/assets/img/mainhub/MainHubBG.png'
      ];
      
      const closeModalBtn = document.getElementById('close-screenshots-modal');
      const carouselImg = document.getElementById('carousel-image');
      const prevBtn = document.getElementById('carousel-prev');
      const nextBtn = document.getElementById('carousel-next');
      const dots = document.querySelectorAll('#carousel-dots .dot');
      let current = 0;

      function showScreenshot(idx) {
        carouselImg.src = screenshots[idx];
        carouselImg.style.transform = 'scale(0.95)';
        setTimeout(() => {
          carouselImg.style.transform = 'scale(1)';
        }, 150);
        
        dots.forEach((dot, i) => {
          if (i === idx) {
            dot.classList.add('bg-primary', 'scale-110');
            dot.classList.remove('bg-gray-500');
          } else {
            dot.classList.remove('bg-primary', 'scale-110');
            dot.classList.add('bg-gray-500');
          }
        });
        current = idx;
      }

      // Updated Start Game Button Event Listener
      if (startGameBtn) {
        console.log('Start game button found, adding event listener');
        startGameBtn.addEventListener('click', () => {
          console.log('Start game button clicked');
          console.log('Auth manager:', authManager);
          console.log('Is authenticated:', authManager.isAuthenticated());
          
          // Check if user is already authenticated
          if (authManager.isAuthenticated()) {
            console.log('User is authenticated, redirecting to game');
            authManager.redirectToGame();
          } else {
            // Show login modal first
            console.log('User not authenticated, showing login modal');
            showLoginModal();
          }
        });
      } else {
        console.error('Start game button not found - ID: start-game-btn');
        // Try to find button with a more generic search
        const allButtons = document.querySelectorAll('button');
        console.log('All buttons found:', allButtons.length);
        allButtons.forEach((btn, index) => {
          console.log(`Button ${index}:`, btn.id, btn.textContent?.trim());
        });
      }
      
      // Screenshots modal close handlers with error handling  
      if (closeModalBtn && screenshotsModal) {
        closeModalBtn.addEventListener('click', () => {
          screenshotsModal.classList.add('hidden');
        });
      } else {
        console.warn('Screenshots modal or close button not found:', {
          closeBtn: !!closeModalBtn,
          modal: !!screenshotsModal
        });
      }
      
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          let prev = (current - 1 + screenshots.length) % screenshots.length;
          showScreenshot(prev);
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          let next = (current + 1) % screenshots.length;
          showScreenshot(next);
        });
      }
      
      dots.forEach((dot, i) => {
        dot.addEventListener('click', () => showScreenshot(i));
      });
      
      // Close modal on outside click with error handling
      if (screenshotsModal) {
        screenshotsModal.addEventListener('click', (e) => {
          if (e.target === screenshotsModal) screenshotsModal.classList.add('hidden');
        });
      } else {
        console.warn('Screenshots modal not found for outside click handler');
      }

      // Smooth scrolling for navigation
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });

      // Gaming hover effects for nav links
      document.querySelectorAll('.gaming-nav-link').forEach(link => {
        link.addEventListener('mouseenter', function() {
          this.querySelector('div').style.transform = 'skewX(12deg) scaleX(1)';
        });
        link.addEventListener('mouseleave', function() {
          this.querySelector('div').style.transform = 'skewX(12deg) scaleX(0)';
        });
      });

      // Initialize particle system when page loads
      document.addEventListener('DOMContentLoaded', () => {
        createParticles();
        
        // Add random floating animation to particles
        setInterval(() => {
          const particles = document.querySelectorAll('#particles div');
          particles.forEach(particle => {
            if (Math.random() > 0.95) {
              particle.style.transform = `translateY(${Math.random() * 20 - 10}px)`;
              setTimeout(() => {
                particle.style.transform = 'translateY(0)';
              }, 2000);
            }
          });
        }, 3000);
      });

      // Easter egg: Konami code
      let konamiCode = [];
      const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // â†‘â†‘â†“â†“â†â†’â†â†’BA
      
      // Dev mode activation: Press D-E-V
      let devCode = [];
      const devKeys = [68, 69, 86]; // D-E-V
      
      document.addEventListener('keydown', (e) => {
        // Konami code for visual effect
        konamiCode.push(e.keyCode);
        if (konamiCode.length > konami.length) {
          konamiCode.shift();
        }
        if (konamiCode.join(',') === konami.join(',')) {
          document.body.style.filter = 'hue-rotate(180deg)';
          setTimeout(() => {
            document.body.style.filter = 'none';
          }, 3000);
          konamiCode = [];
        }

        // Dev mode activation
        devCode.push(e.keyCode);
        if (devCode.length > devKeys.length) {
          devCode.shift();
        }
        if (devCode.join(',') === devKeys.join(',')) {
          const devPanel = document.getElementById('dev-panel');
          devPanel.classList.toggle('hidden');
          if (!devPanel.classList.contains('hidden')) {
            showInfo('DEV MODE ACTIVATED!\nUse the panel or console commands to create test accounts.', {
              title: 'ğŸ”§ Developer Mode',
              type: 'info'
            });
          }
          devCode = [];
        }
      });

      // DEV MODE: Console functions for testing
      // Usage in browser console: createAdminUser()
      window.createAdminUser = async () => {
        const admin = await authManager.createAdminUser();
        console.log('Admin user created:', admin);
        showSuccess('Admin user created! Professor tab should now be visible.', {
          title: 'ğŸ”§ Admin Created'
        });
        return admin;
      };

      // Create professor user with Firebase integration
      window.createProfessorUser = async (email, password, fullName, institution) => {
        if (!email || !password || !fullName) {
          showWarning('Usage: createProfessorUser("email@domain.com", "password", "Full Name", "Institution (optional)")', {
            title: 'Missing Parameters'
          });
          return;
        }
        
        const result = await authManager.createProfessorUser(email, password, fullName, institution);
        if (result.success) {
          console.log('Professor user created successfully:', result);
          showSuccess(`Professor user created!\nEmail: ${email}\nUID: ${result.uid}\nThe professor can now login with their email and password.`, {
            title: 'âœ… Professor Created'
          });
        } else {
          console.error('Failed to create professor user:', result.error);
          showError(`Failed to create professor user: ${result.error}`, {
            title: 'âŒ Creation Failed'
          });
        }
        return result;
      };

      // Debug function to test Firebase connectivity
      window.testFirebase = async () => {
        const result = await authManager.testFirebaseConnection();
        if (result.success) {
          console.log('âœ… Firebase connection test passed');
          showSuccess('Firebase connection test passed! Check console for details.', {
            title: 'âœ… Connection Test Passed'
          });
        } else {
          console.error('âŒ Firebase connection test failed:', result.error);
          showError(`Firebase connection test failed: ${result.error}`, {
            title: 'âŒ Connection Test Failed'
          });
        }
        return result;
      };

      window.createSampleProfessor = () => {
        const professor = {
          uid: 'prof_' + Date.now(),
          type: 'professor',
          profile: {
            fullName: 'Dr. Sample Professor',
            email: 'professor@sci-high.edu',
            institution: 'SCI-HIGH University',
            isVerified: true
          }
        };
        
        authManager.currentUser = professor;
        authManager.userType = 'professor';
        localStorage.setItem('sci_high_user', JSON.stringify(professor));
        authManager.updateProfessorTabVisibility();
        authManager.updateUserInterface();
        
        console.log('Sample professor created:', professor);
        showSuccess('Sample professor created!\nEmail: professor@sci-high.edu\nPassword: Prof123!', {
          title: 'ğŸ‘¨â€ğŸ« Sample Professor Created'
        });
        return professor;
      };

      window.createSampleStudent = () => {
        const student = {
          uid: 'stud_' + Date.now(),
          type: 'student',
          studentId: '24-2024-001',
          profile: {
            studentId: '24-2024-001',
            fullName: 'Juan Dela Cruz',
            academicInfo: {
              level: 'college',
              course: 'BS Computer Science',
              yearLevel: '3rd Year'
            },
            accountStatus: {
              isFirstLogin: false,
              createdBy: 'prof_sample',
              lastLogin: new Date().toISOString()
            },
            gameData: {
              totalPoints: 850,
              courseProgress: {
                python: { progress: 75, completed: 8, total: 12 },
                javascript: { progress: 60, completed: 6, total: 10 },
                java: { progress: 45, completed: 4, total: 9 }
              }
            }
          }
        };
        
        authManager.currentUser = student;
        authManager.userType = 'student';
        localStorage.setItem('sci_high_user', JSON.stringify(student));
        authManager.updateProfessorTabVisibility();
        authManager.updateUserInterface();
        
        console.log('Sample student created:', student);
        showSuccess('Sample student created!\nStudent ID: 24-2024-001\nNo password needed!\n\nOther test accounts:\n- 24-2024-002 (Maria Santos)\n- 24-2024-003 (Pedro Garcia)', {
          title: 'ğŸ“ Sample Student Created'
        });
        return student;
      };

      window.createSampleGeneral = () => {
        const generalUser = {
          uid: 'gen_' + Date.now(),
          type: 'general',
          profile: {
            fullName: 'Maria Santos',
            email: 'maria@example.com',
            displayName: 'CodeMaster_Maria',
            gameData: {
              totalPoints: 1200,
              achievements: ['First Steps', 'Code Warrior', 'Puzzle Solver'],
              courseProgress: {
                python: { progress: 90, completed: 10, total: 12 },
                webdesign: { progress: 85, completed: 9, total: 10 }
              }
            }
          }
        };
        
        authManager.currentUser = generalUser;
        authManager.userType = 'general';
        localStorage.setItem('sci_high_user', JSON.stringify(generalUser));
        authManager.updateProfessorTabVisibility();
        authManager.updateUserInterface();
        
        console.log('Sample general user created:', generalUser);
        showSuccess('Sample general user created!\nEmail: maria@example.com\nPassword: General123!', {
          title: 'ğŸŒŸ General User Created'
        });
        return generalUser;
      };

      // Create 3 sample career stats entries
      window.createSampleCareerStats = async () => {
        try {
          console.log('Creating 3 sample career stats entries...');
          
          const sampleCareerStats = [
            {
              studentId: 'student_001',
              careerStats: {
                totalPoints: 2450,
                totalSessions: 18,
                averageAccuracy: 87.5,
                highestStreak: 15,
                totalQuestions: 180,
                totalPlayTime: 7200, // 2 hours in seconds
                courseCompletionStatus: {
                  python: true,
                  java: true,
                  csharp: false,
                  cpp: true,
                  c: false,
                  webdesign: true
                },
                globalRank: 1,
                departmentRank: 1
              },
              studentInfo: {
                fullName: 'Maria Santos',
                lastUpdated: new Date().toISOString()
              },
              firstName: 'Maria',
              lastName: 'Santos',
              department: 'College - BS Computer Science',
              strandYear: '3rd Year',
              recentSessions: {
                session_001: {
                  timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // 1 day ago
                  course: 'python',
                  score: 92,
                  questionsAnswered: 10,
                  points: 184,
                  accuracy: 92,
                  streak: 8
                },
                session_002: {
                  timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), // 3 days ago
                  course: 'java',
                  score: 85,
                  questionsAnswered: 12,
                  points: 170,
                  accuracy: 85,
                  streak: 6
                },
                session_003: {
                  timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 1 week ago
                  course: 'webdesign',
                  score: 88,
                  questionsAnswered: 8,
                  points: 140,
                  accuracy: 88,
                  streak: 5
                }
              }
            },
            {
              studentId: 'student_002',
              careerStats: {
                totalPoints: 1890,
                totalSessions: 14,
                averageAccuracy: 78.2,
                highestStreak: 12,
                totalQuestions: 140,
                totalPlayTime: 5400, // 1.5 hours in seconds
                courseCompletionStatus: {
                  python: true,
                  java: false,
                  csharp: true,
                  cpp: false,
                  c: true,
                  webdesign: false
                },
                globalRank: 2,
                departmentRank: 1
              },
              studentInfo: {
                fullName: 'John Carlo Reyes',
                lastUpdated: new Date().toISOString()
              },
              firstName: 'John Carlo',
              lastName: 'Reyes',
              department: 'Senior High - STEM',
              strandYear: 'Grade 12',
              recentSessions: {
                session_001: {
                  timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago
                  course: 'c',
                  score: 76,
                  questionsAnswered: 10,
                  points: 152,
                  accuracy: 76,
                  streak: 4
                },
                session_002: {
                  timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5 days ago
                  course: 'csharp',
                  score: 82,
                  questionsAnswered: 10,
                  points: 164,
                  accuracy: 82,
                  streak: 7
                },
                session_003: {
                  timestamp: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(), // 10 days ago
                  course: 'python',
                  score: 89,
                  questionsAnswered: 15,
                  points: 178,
                  accuracy: 89,
                  streak: 12
                }
              }
            },
            {
              studentId: 'student_003',
              careerStats: {
                totalPoints: 1230,
                totalSessions: 9,
                averageAccuracy: 73.8,
                highestStreak: 8,
                totalQuestions: 90,
                totalPlayTime: 3600, // 1 hour in seconds
                courseCompletionStatus: {
                  python: true,
                  java: false,
                  csharp: false,
                  cpp: false,
                  c: false,
                  webdesign: true
                },
                globalRank: 3,
                departmentRank: 2
              },
              studentInfo: {
                fullName: 'Anna Mae Garcia',
                lastUpdated: new Date().toISOString()
              },
              firstName: 'Anna Mae',
              lastName: 'Garcia',
              department: 'Senior High - ICT',
              strandYear: 'Grade 11',
              recentSessions: {
                session_001: {
                  timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(), // 1 day ago
                  course: 'webdesign',
                  score: 71,
                  questionsAnswered: 8,
                  points: 113,
                  accuracy: 71,
                  streak: 3
                },
                session_002: {
                  timestamp: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString(), // 4 days ago
                  course: 'python',
                  score: 78,
                  questionsAnswered: 12,
                  points: 156,
                  accuracy: 78,
                  streak: 6
                },
                session_003: {
                  timestamp: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(), // 8 days ago
                  course: 'webdesign',
                  score: 68,
                  questionsAnswered: 10,
                  points: 136,
                  accuracy: 68,
                  streak: 4
                }
              }
            }
          ];

          // Upload each sample career stat to Firebase
          const db = firebase.database();
          const promises = sampleCareerStats.map(async (careerData, index) => {
            const studentId = careerData.studentId;
            console.log(`Uploading career stats for ${careerData.studentInfo.fullName}...`);
            
            await db.ref(`student_career_stats/${studentId}`).set(careerData);
            console.log(`âœ… Career stats uploaded for ${careerData.studentInfo.fullName}`);
          });

          await Promise.all(promises);
          
          console.log('ğŸ‰ Successfully created 3 sample career stats entries!');
          console.log('ğŸ“Š Sample data includes:');
          console.log('   â€¢ Maria Santos (College CS, Rank #1): 2450 pts, 87.5% accuracy, 4/6 courses');
          console.log('   â€¢ John Carlo Reyes (SHS STEM, Rank #2): 1890 pts, 78.2% accuracy, 3/6 courses');
          console.log('   â€¢ Anna Mae Garcia (SHS ICT, Rank #3): 1230 pts, 73.8% accuracy, 2/6 courses');
          console.log('ğŸ”— View results at: leaderboards.html');
          
          return sampleCareerStats;
        } catch (error) {
          console.error('âŒ Error creating sample career stats:', error);
          throw error;
        }
      };

      window.logoutUser = () => {
        authManager.logout();
      };

      // Helper function to show all available console commands
      window.showDevCommands = () => {
        console.log(`
ğŸ”§ SCI-HIGH DEV MODE COMMANDS:
================================

USER MANAGEMENT:
1. createAdminUser()                    - Create admin account (can access professor dashboard)
2. createProfessorUser(email, password, fullName, institution) - Create professor in Firebase
3. createSampleProfessor()              - Create local professor account  
4. createSampleStudent()                - Create student account  
5. createSampleGeneral()                - Create general user account
6. createSampleCareerStats()            - Create 3 sample career stats entries for leaderboards
7. logoutUser()                        - Logout current user


DEBUGGING & TOOLS:
8. debugFirebaseConnection()           - Check Firebase connection and data storage
9. createRealFirebaseStudent(id)       - Force create student in Firebase (bypasses samples)
10. openDeveloperTools()                - Open advanced developer tools page
11. showDevCommands()                  - Show this help

USAGE:  
------
Open console (F12) and type any command, e.g.:
debugFirebaseConnection()              // Check why data isn't in Firebase
createRealFirebaseStudent("2024-YOUR-001")  // Create real Firebase student

For advanced tools: openDeveloperTools()
        `);
        showInfo('Dev commands shown in console! Press F12 to see all available commands.', {
          title: 'ğŸ“‹ Developer Commands'
        });
      };

      // Developer page access
      window.openDeveloperTools = () => {
        const isAuthorized = prompt('ğŸ” Enter developer access key:');
        if (isAuthorized === 'sci-high-dev-2025') {
          window.open('developer.html', '_blank');
        } else {
          showError('Invalid access key. Developer tools access denied.', {
            title: 'âŒ Access Denied'
          });
        }
      };

      // Debug Firebase connection and data storage
      window.debugFirebaseConnection = async () => {
        console.log('ğŸ” FIREBASE DEBUG REPORT');
        console.log('========================');
        
        // Check if Firebase is loaded
        if (typeof firebase === 'undefined') {
          console.log('âŒ Firebase SDK not loaded');
          return;
        }
        console.log('âœ… Firebase SDK loaded');
        
        // Check if Firebase is initialized
        if (!firebase.apps.length) {
          console.log('âŒ Firebase not initialized');
          return;
        }
        console.log('âœ… Firebase initialized');
        console.log('ğŸ“Š Project ID:', firebase.app().options.projectId);
        console.log('ğŸ“Š Auth Domain:', firebase.app().options.authDomain);
        
        // Check authentication
        const user = firebase.auth().currentUser;
        console.log('ğŸ‘¤ Current Auth User:', user ? user.uid : 'None');
        
        // Test Firestore connection with detailed error handling
        try {
          console.log('ğŸ”— Testing Firestore READ access...');
          const testDoc = await firebase.firestore().collection('test').limit(1).get();
          console.log('âœ… Firestore READ successful');
          
          // Test WRITE access
          console.log('ğŸ”— Testing Firestore WRITE access...');
          const testRef = firebase.firestore().collection('test').doc('debug-test');
          await testRef.set({
            timestamp: new Date().toISOString(),
            test: true,
            source: 'debug-script'
          });
          console.log('âœ… Firestore WRITE successful');
          
          // Clean up test document
          await testRef.delete();
          console.log('âœ… Test cleanup successful');
          
          // Check existing data
          console.log('ğŸ“‹ Checking existing collections...');
          
          const professors = await firebase.firestore().collection('professors').get();
          console.log(`ğŸ‘¨â€ğŸ« Professors: ${professors.size} documents`);
          
          const students = await firebase.firestore().collection('students').get();
          console.log(`ğŸ“ Students: ${students.size} documents`);
          
          const generalUsers = await firebase.firestore().collection('general_users').get();
          console.log(`ğŸ‘¤ General Users: ${generalUsers.size} documents`);
          
        } catch (error) {
          console.log('âŒ Firestore error:', error);
          console.log('âŒ Error code:', error.code);
          console.log('âŒ Error message:', error.message);
          
          if (error.code === 'permission-denied') {
            console.log('ï¿½ PERMISSION DENIED - This is likely a Firestore security rules issue');
            console.log('ğŸ’¡ Solution: Update your Firestore security rules in Firebase Console');
            console.log('ğŸ’¡ For development, try these rules:');
            console.log(`
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
            `);
          } else if (error.code === 'failed-precondition') {
            console.log('ğŸš« FAILED PRECONDITION - Database might not be properly set up');
          } else if (error.code === 'unauthenticated') {
            console.log('ğŸ” UNAUTHENTICATED - User needs to be signed in');
          }
        }
        
        // Check local storage
        console.log('ğŸ’¾ Local Storage Data:');
        const localUser = localStorage.getItem('sci_high_user');
        const localStudents = localStorage.getItem('sci_high_local_students');
        console.log('Current User:', localUser ? JSON.parse(localUser) : 'None');
        console.log('Local Students:', localStudents ? Object.keys(JSON.parse(localStudents)) : 'None');
        
        console.log('========================');
        console.log('ğŸ¯ Use this info to identify the exact issue!');
      };

      // Force create real Firebase student (bypasses sample data)
      window.createRealFirebaseStudent = async (studentId) => {
        if (!studentId) {
          console.log('Usage: createRealFirebaseStudent("YOUR-STUDENT-ID")');
          return;
        }
        
        try {
          console.log(`ğŸ”¥ Creating real Firebase student: ${studentId}`);
          const result = await authManager.createStudentAccount(studentId);
          if (result.success) {
            console.log('âœ… Student created in Firebase!');
            console.log('Document ID:', result.docId);
            console.log('Data:', result.studentData);
          } else {
            console.log('âŒ Failed:', result.error);
          }
        } catch (error) {
          console.log('âŒ Error:', error.message);
        }
      };

      // Auto-show dev commands on page load
      console.log('ğŸ® SCI-HIGH DEV MODE ACTIVE! Type showDevCommands() for help.');
      console.log('ğŸ› ï¸ Developer Tools: Type openDeveloperTools() to access advanced tools.');
      
      }); // Close DOMContentLoaded event listener
    </script>

    <!-- Virtual AI Assistant with improved positioning -->
    <div id="ai-assistant" class="fixed bottom-4 right-4 z-[200] md:bottom-6 md:right-6">
      <!-- Assistant Toggle Button -->
      <button id="assistant-toggle" class="group relative w-12 h-12 bg-gradient-to-r from-purple to-cyan rounded-full shadow-lg hover:shadow-purple/50 transform transition-all duration-300 hover:scale-110 animate-bounce-in border-2 border-purple/30 md:w-16 md:h-16">
        <div class="absolute inset-0 bg-gradient-to-r from-cyan to-purple rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        <span class="relative z-10 text-lg md:text-2xl">ğŸ¤–</span>
        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full animate-pulse md:-top-2 md:-right-2 md:w-4 md:h-4"></div>
      </button>

      <!-- Assistant Chat Panel with improved sizing -->
      <div id="assistant-panel" class="fixed bottom-20 right-2 w-[calc(100vw-1rem)] h-[550px] neon-border bg-cardBg/95 rounded-xl shadow-2xl backdrop-blur-md transform translate-x-full opacity-0 transition-all duration-300 overflow-hidden md:absolute md:bottom-20 md:right-0 md:w-[420px] md:h-[600px] max-w-[420px]">
        <!-- Header -->
        <div class="bg-gradient-to-r from-purple to-cyan p-4 flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-dark font-gaming font-bold text-sm">AI</div>
            <div>
              <h3 class="font-gaming text-white text-sm font-bold">SCI-HIGH AI Assistant</h3>
              <p class="text-xs text-gray-200">Powered by Google AI ğŸš€</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button id="assistant-settings" class="text-white hover:text-primary transition-colors text-sm" title="Settings">âš™ï¸</button>
            <button id="assistant-close" class="text-white hover:text-primary transition-colors text-xl">&times;</button>
          </div>
        </div>

        <!-- Enhanced Chat Messages Area with improved styling -->
        <div id="chat-messages" class="flex-1 p-3 h-72 overflow-y-auto scrollbar-thin scrollbar-thumb-purple scrollbar-track-dark md:h-80 md:p-4 space-y-3">
          <div class="assistant-message mb-4">
            <div class="bg-gradient-to-r from-purple/20 to-cyan/20 rounded-lg p-2 max-w-xs md:p-3 border border-purple/30">
              <div class="flex items-start space-x-2">
                <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center text-dark font-bold text-xs flex-shrink-0">AI</div>
                <div class="flex-1">
                  <p class="text-xs text-white md:text-sm">Hi! I'm your SCI-HIGH AI assistant! ğŸ¤–âœ¨ I can help with game features, thesis research, programming concepts, and technical questions. Try the quick buttons below or ask me anything!</p>
                  <div class="text-xs text-purple-300 mt-1">âœ¨ Enhanced with Google AI</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Panel (Initially Hidden) -->
        <div id="settings-panel" class="hidden absolute inset-0 bg-cardBg/95 rounded-xl backdrop-blur-md z-10">
          <div class="p-4 h-full flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-gaming text-white text-sm font-bold">AI Settings</h3>
            <div class="flex space-x-2">
              <button id="export-chat" class="text-white hover:text-primary transition-colors text-sm" title="Export Chat History">ğŸ’¾</button>
              <button id="clear-chat" class="text-white hover:text-red-400 transition-colors text-sm" title="Clear Chat History">ğŸ—‘ï¸</button>
              <button id="settings-close" class="text-white hover:text-primary transition-colors text-xl">&times;</button>
            </div>
          </div>
            
            <div class="flex-1 space-y-4">
              <div>
                <label class="block text-xs text-gray-300 mb-2">Google AI Studio API Key:</label>
                <input type="password" id="api-key-input" placeholder="Enter your API key..." 
                       class="w-full px-3 py-2 bg-dark/50 border border-purple/30 rounded-lg text-white text-xs focus:outline-none focus:border-purple focus:ring-1 focus:ring-purple/30" />
                <p class="text-xs text-gray-400 mt-1">Get your API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-primary hover:text-accent">Google AI Studio</a></p>
              </div>
              
              <div class="bg-dark/30 p-3 rounded-lg">
                <h4 class="text-xs font-bold text-primary mb-2">ï¿½ Config File Method:</h4>
                <ul class="text-xs text-gray-300 space-y-1">
                  <li>â€¢ Auto-loads from <code class="text-accent">config/api-key.txt</code></li>
                  <li>â€¢ No manual entry needed each time</li>
                  <li>â€¢ Keep file secure and private</li>
                  <li>â€¢ Add to .gitignore if using Git</li>
                </ul>
              </div>
              
              <div class="bg-dark/30 p-3 rounded-lg">
                <h4 class="text-xs font-bold text-primary mb-2">ï¿½ğŸ”’ Security Features:</h4>
                <ul class="text-xs text-gray-300 space-y-1">
                  <li>â€¢ Memory-only during runtime</li>
                  <li>â€¢ Auto-expires in 30 minutes per session</li>
                  <li>â€¢ Cleared when you leave the page</li>
                  <li>â€¢ Downloadable config file generation</li>
                </ul>
              </div>
              
              <div class="flex space-x-2">
                <button id="save-api-key" class="flex-1 px-3 py-2 bg-gradient-to-r from-accent to-cyan rounded-lg text-white text-xs font-gaming hover:shadow-lg transition-all duration-300">Save Key</button>
                <button id="test-ai" class="flex-1 px-3 py-2 bg-gradient-to-r from-purple to-primary rounded-lg text-white text-xs font-gaming hover:shadow-lg transition-all duration-300">Test AI</button>
              </div>
              
              <div id="api-status" class="text-xs text-center p-2 rounded-lg hidden"></div>
            </div>
            
            <div class="text-xs text-gray-400 text-center space-y-1">
              <p>ğŸ’¡ Without an API key, I'll use preset responses</p>
              <p>ï¿½ï¸ Maximum security: Key never touches disk storage</p>
            </div>
          </div>
        </div>

        <!-- Quick Action Buttons - Fixed Layout -->
        <div id="quick-actions" class="p-3 border-t border-purple/30 md:p-4 overflow-visible min-h-[150px]">
          <!-- Enhanced Quick Action Buttons with better organization and fixed positioning -->
          <div class="grid grid-cols-2 gap-1 mb-2 md:grid-cols-3 md:gap-2 md:mb-3">
            <button class="quick-btn text-xs px-2 py-1 bg-primary/20 text-primary rounded-lg hover:bg-primary/30 transition-all duration-300 hover:scale-105 border border-primary/30 min-h-[32px] flex items-center justify-center" data-question="What is SCI-HIGH and how does it work?">ğŸ® About Game</button>
            <button class="quick-btn text-xs px-2 py-1 bg-accent/20 text-accent rounded-lg hover:bg-accent/30 transition-all duration-300 hover:scale-105 border border-accent/30 min-h-[32px] flex items-center justify-center" data-question="Tell me about the thesis research methodology and findings">ğŸ“š Research</button>
            <button class="quick-btn text-xs px-2 py-1 bg-cyan/20 text-cyan rounded-lg hover:bg-cyan/30 transition-all duration-300 hover:scale-105 border border-cyan/30 min-h-[32px] flex items-center justify-center" data-question="How do I get started playing SCI-HIGH?">ğŸš€ Get Started</button>
            <button class="quick-btn text-xs px-2 py-1 bg-purple/20 text-purple rounded-lg hover:bg-purple/30 transition-all duration-300 hover:scale-105 border border-purple/30 min-h-[32px] flex items-center justify-center" data-question="What programming languages and concepts can I learn?">ğŸ’» Programming</button>
            <button class="quick-btn text-xs px-2 py-1 bg-orange-500/20 text-orange-400 rounded-lg hover:bg-orange-500/30 transition-all duration-300 hover:scale-105 border border-orange-500/30 min-h-[32px] flex items-center justify-center col-span-2 md:col-span-1" data-question="Show me the game features and technical details">âš™ï¸ Features</button>
          </div>
          
          <!-- Enhanced Input Area -->
          <div class="space-y-2">
            <!-- Input Row -->
            <div class="flex space-x-1 md:space-x-2">
              <div class="flex-1 relative">
                <textarea id="chat-input" placeholder="Ask me anything about SCI-HIGH, programming, or the thesis research..." 
                         class="w-full px-2 py-1 bg-dark/50 border border-purple/30 rounded-lg text-white text-xs focus:outline-none focus:border-purple focus:ring-1 focus:ring-purple/30 md:px-3 md:py-2 md:text-sm resize-none overflow-hidden" 
                         rows="1" maxlength="500"></textarea>
                <div id="char-counter" class="absolute bottom-0 right-1 text-xs text-gray-500 pointer-events-none">0/500</div>
              </div>
              <button id="voice-input" class="px-2 py-1 bg-gradient-to-r from-accent to-primary rounded-lg text-white text-xs hover:shadow-lg transition-all duration-300 md:px-3 md:py-2" title="Voice Input">ğŸ¤</button>
              <button id="send-message" class="px-3 py-1 bg-gradient-to-r from-purple to-cyan rounded-lg text-white text-xs font-gaming hover:shadow-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed md:px-4 md:py-2 md:text-sm">
                <span id="send-text">Send</span>
                <span id="send-loading" class="hidden">â—â—â—</span>
              </button>
            </div>
            
            <!-- Input Status -->
            <div id="input-status" class="text-xs text-center text-gray-400 hidden">
              <span id="typing-status">Press Enter to send or Shift+Enter for new line</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Assistant JavaScript -->
    <!--
    ï¿½ï¸ SECURE GOOGLE AI SETUP GUIDE:
    
    1. Go to https://makersuite.google.com/app/apikey
    2. Sign in with your Google account
    3. Click "Create API key"
    4. Copy the generated API key
    5. Click the settings (âš™ï¸) icon in the assistant
    6. Paste your API key and click "Save Key"
    7. Test the connection with "Test AI" button
    
    ï¿½ MAXIMUM SECURITY FEATURES:
    â€¢ Memory-only storage (never saved to disk)
    â€¢ Auto-expires after 30 minutes
    â€¢ Cleared when you leave the page
    â€¢ Input field cleared immediately after saving
    â€¢ API key validation before use
    â€¢ Automatic clearance on authentication errors
    
    ï¿½ğŸ“ Features with Google AI:
    â€¢ Natural conversation about your game and thesis
    â€¢ Context-aware responses about SCI-HIGH
    â€¢ Detailed explanations of programming concepts
    â€¢ Research methodology discussions
    â€¢ Personalized learning recommendations
    
    ï¿½ï¸ Privacy: This is the most secure client-side implementation possible
    For maximum security in production, consider implementing a backend proxy
    -->
    <script>
      class VirtualAssistant {
        constructor() {
          this.isOpen = false;
          this.isTyping = false;
          this.isRecording = false;
          this.currentRecognition = null;
          this.apiKey = ''; // Will be loaded from file
          this.apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
          this.keyExpiry = null; // Auto-clear API key after time limit
          this.maxKeyAge = 30 * 60 * 1000; // 30 minutes in milliseconds
          this.configFile = 'config/api-key.txt'; // Path to API key file
          this.conversationHistory = []; // Store conversation for context
          this.maxHistoryLength = 10; // Limit conversation history
          this.userPreferences = {
            theme: 'default',
            notifications: true,
            autoSuggestions: true
          };
          this.smartSuggestions = [
            "How do I create a student account?",
            "What's the difference between Story Mode and Computer Lab?",
            "Can you explain the research methodology?",
            "How does the achievement system work?",
            "What browsers are supported?",
            "Is SCI-HIGH mobile-friendly?"
          ];
          
          // Enhanced context about your game and thesis for the AI
          this.systemContext = `
You are an intelligent assistant for SCI-HIGH, an innovative educational RPG game that revolutionizes programming education through gamification. Here's comprehensive information:

ğŸ® GAME OVERVIEW:
- SCI-HIGH is a browser-based educational RPG that makes learning programming engaging and fun
- Features immersive story mode with 3 main characters: Noah (Web Development), Lily (Python), Damian (Java)
- Includes interactive computer lab, coding challenges, quizzes, achievements, and real-time progress tracking
- Supports multiple programming languages: HTML/CSS/JavaScript, Python, Java, C, C++, C#
- Built with Phaser.js game framework, modern web technologies, and responsive design
- Integrates gamification elements: XP system, levels, achievements, leaderboards, and badges

ğŸ“š THESIS RESEARCH:
- Research Question: "How does gamification affect student engagement and learning outcomes in computer science education?"
- Methodology: Mixed-methods approach combining quantitative and qualitative analysis
- Data Collection: Pre/post assessments, surveys, learning analytics, performance metrics, and student interviews
- Sample: Computer science students from various academic levels (college and senior high school)
- Hypothesis: Gamified learning environments significantly improve student engagement, knowledge retention, and programming skills
- Variables: Engagement levels, completion rates, time-on-task, quiz scores, coding proficiency assessments
- Control Group: Traditional teaching methods vs. Experimental Group: Game-based learning

ğŸ”§ TECHNICAL FEATURES:
- Frontend: HTML5, CSS3, JavaScript ES6+, Phaser.js 3.x for game engine
- Styling: Tailwind CSS for responsive design and modern UI components
- Backend: Firebase for authentication, real-time database, and cloud storage
- Architecture: Progressive Web App (PWA) with offline capabilities
- Mobile Support: Touch controls, responsive layouts, orientation handling
- Performance: Optimized assets, lazy loading, efficient memory management
- Accessibility: Screen reader support, keyboard navigation, high contrast modes

ğŸ¯ EDUCATIONAL OBJECTIVES:
- Improve programming concept understanding through interactive challenges
- Enhance problem-solving skills via puzzle-based learning
- Develop computational thinking through game mechanics
- Increase student motivation and engagement in computer science
- Provide personalized learning paths based on student progress
- Foster collaboration through multiplayer elements and leaderboards

ğŸŒŸ UNIQUE FEATURES:
- Story-driven narrative that contextualizes programming concepts
- Real-time code compilation and execution within the game environment
- Adaptive difficulty system that adjusts to student skill level
- Comprehensive analytics dashboard for educators
- Integration with Learning Management Systems (LMS)
- Multilingual support for international accessibility
- Cross-platform compatibility (desktop, tablet, mobile)

Always provide helpful, encouraging responses that match the gaming theme. Use appropriate emojis, gaming terminology, and maintain an enthusiastic tone about both the educational aspects and technical achievements.
`;

          this.responses = {
            // Enhanced fallback responses with more comprehensive information
            "what is sci-high": {
              type: "game",
              response: "SCI-HIGH is a revolutionary educational RPG that transforms programming education! ğŸ®âœ¨ It combines immersive storytelling, interactive coding challenges, and gamification elements to make learning computer science engaging and fun. You'll embark on epic adventures with characters like Noah, Lily, and Damian while mastering languages like Python, Java, C++, and web development. Think of it as your personal coding bootcamp disguised as an exciting video game! ğŸš€"
            },
            "about game": {
              type: "game", 
              response: "SCI-HIGH features an incredible blend of education and entertainment! ğŸŒŸ Here's what makes it special:\nâ€¢ Story Mode with 3 unique character paths\nâ€¢ Interactive Computer Lab with real coding environments\nâ€¢ Real-time progress tracking and analytics\nâ€¢ Achievement system with badges and rewards\nâ€¢ Cross-platform support (desktop, mobile, tablet)\nâ€¢ Offline play capabilities\nâ€¢ Multiplayer leaderboards and competitions\nâ€¢ Adaptive difficulty that grows with your skills\n\nIt's like having a personal programming mentor wrapped in an epic RPG adventure! âš”ï¸ğŸ‘¨â€ğŸ’»"
            },
            "thesis research": {
              type: "thesis",
              response: "The thesis explores how gamification revolutionizes computer science education! ğŸ“Š Our research uses mixed-methods analysis to study:\nâ€¢ Student engagement and motivation levels\nâ€¢ Learning outcomes and knowledge retention\nâ€¢ Time-on-task and completion rates\nâ€¢ Programming skill development\nâ€¢ Comparison with traditional teaching methods\n\nEarly findings show significant improvements in student engagement (+40%) and programming proficiency (+35%) compared to conventional approaches! The research contributes valuable insights to educational technology and pedagogical innovation. ğŸ“âœ¨"
            },
            "programming languages": {
              type: "technical",
              response: "SCI-HIGH supports a comprehensive range of programming languages! ğŸ’» You can master:\nâ€¢ **Web Development**: HTML5, CSS3, JavaScript ES6+\nâ€¢ **Python**: From basics to advanced concepts\nâ€¢ **Java**: Object-oriented programming fundamentals\nâ€¢ **C Programming**: System-level programming concepts\nâ€¢ **C++**: Advanced object-oriented development\nâ€¢ **C#**: Modern application development\n\nEach language is taught through interactive challenges, real-world projects, and gamified exercises that make complex concepts easy to understand! ğŸš€"
            },
            "how to start": {
              type: "game",
              response: "Getting started with SCI-HIGH is super easy! ğŸš€ Here's your adventure roadmap:\n1. **Choose Your Path**: Select Student, Professor, or General User account\n2. **Pick Your Character**: Noah (Web Dev), Lily (Python), or Damian (Java)\n3. **Complete the Tutorial**: Learn basic game mechanics and controls\n4. **Explore the Hub**: Visit the Classroom, Computer Lab, and Office\n5. **Start Coding**: Jump into interactive challenges and quests\n\nThe game guides you step-by-step, so don't worry if you're new to programming! Every expert was once a beginner. ğŸ’ªâœ¨"
            },
            "technical details": {
              type: "technical",
              response: "SCI-HIGH is built with cutting-edge web technologies! ğŸ”§ Technical highlights:\nâ€¢ **Frontend**: Phaser.js 3.x game engine with HTML5 Canvas\nâ€¢ **Styling**: Tailwind CSS for responsive, modern UI\nâ€¢ **Backend**: Firebase for real-time data and authentication\nâ€¢ **Architecture**: Progressive Web App (PWA) with offline support\nâ€¢ **Performance**: Optimized for 60fps gameplay across all devices\nâ€¢ **Security**: Encrypted data transmission and secure user authentication\nâ€¢ **Accessibility**: WCAG compliant with screen reader support\n\nThe codebase follows modern software engineering practices with modular architecture and comprehensive testing! ğŸ—ï¸"
            },
            "help": {
              type: "info",
              response: "I'm your dedicated SCI-HIGH assistant! ğŸ¤ I can help you with:\n\nğŸ® **Game Information**:\nâ€¢ How to play and navigate\nâ€¢ Character guides and story modes\nâ€¢ Feature explanations and tips\n\nğŸ“š **Research & Thesis**:\nâ€¢ Methodology and findings\nâ€¢ Educational theory behind the game\nâ€¢ Academic contributions\n\nğŸ’» **Technical Support**:\nâ€¢ Programming concepts and tutorials\nâ€¢ System requirements and compatibility\nâ€¢ Troubleshooting and optimization\n\nJust ask me anything or use the quick buttons for common topics! ğŸ’¬âœ¨"
            }
          };
          
          this.init();
        }
        
        init() {
          this.loadApiKeyFromFile();
          this.setupSecurityMeasures();
          this.bindEvents();
          this.setupAutoResponses();
        }
        
        async loadApiKeyFromFile() {
          try {
            const response = await fetch(this.configFile);
            if (response.ok) {
              const content = await response.text();
              // Extract API key from file (skip comments and empty lines)
              const lines = content.split('\n');
              for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed && !trimmed.startsWith('#')) {
                  if (this.validateApiKey(trimmed)) {
                    this.apiKey = trimmed;
                    this.keyExpiry = Date.now() + this.maxKeyAge;
                    console.log('âœ… API key loaded successfully from config file');
                    
                    // Update UI to show AI is available
                    this.updateAIStatus(true);
                    return;
                  }
                }
              }
              console.warn('âš ï¸ No valid API key found in config file');
            } else {
              console.warn('âš ï¸ Could not load API key config file. Manual entry will be required.');
            }
          } catch (error) {
            console.warn('âš ï¸ Error loading API key from file:', error.message);
          }
          
          // Update UI to show manual entry is needed
          this.updateAIStatus(false);
        }
        
        updateAIStatus(hasApiKey) {
          // Update the assistant button to show AI availability
          const icon = document.getElementById('assistant-toggle').querySelector('span');
          if (hasApiKey) {
            icon.textContent = 'ğŸ¤–âœ¨'; // AI enabled
          } else {
            icon.textContent = 'ğŸ¤–'; // Manual entry needed
          }
        }
        
        setupSecurityMeasures() {
          // Clear API key when user navigates away or closes tab
          window.addEventListener('beforeunload', () => {
            this.clearApiKey();
          });
          
          // Auto-clear API key after timeout
          this.setupKeyExpiration();
          
          // Clear key when tab becomes hidden (user switches tabs)
          document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
              // Optional: Clear immediately when tab is hidden for max security
              // this.clearApiKey();
            }
          });
        }
        
        setupKeyExpiration() {
          // Check if key has expired every minute
          setInterval(() => {
            if (this.keyExpiry && Date.now() > this.keyExpiry) {
              this.clearApiKey();
              this.showSecurityNotice('API key expired for security. Please re-enter if needed.');
            }
          }, 60000);
        }
        
        clearApiKey() {
          this.apiKey = '';
          this.keyExpiry = null;
          
          // Clear the input field too
          const input = document.getElementById('api-key-input');
          if (input) input.value = '';
        }
        
        showSecurityNotice(message) {
          if (this.isOpen) {
            this.addAssistantMessage(`ğŸ”’ Security Notice: ${message}`, 'security');
          }
        }
        
        saveApiKey() {
          const input = document.getElementById('api-key-input');
          const key = input.value.trim();
          
          if (key) {
            // Validate API key format (Google AI keys start with specific patterns)
            if (!this.validateApiKey(key)) {
              this.showStatus('âŒ Invalid API key format', 'error');
              return;
            }
            
            // Store in memory (secure for current session)
            this.apiKey = key;
            this.keyExpiry = Date.now() + this.maxKeyAge;
            
            // Update config file for future sessions
            this.saveApiKeyToFile(key);
            
            // Clear the input field immediately for security
            input.value = '';
            
            // Update UI
            this.updateAIStatus(true);
            
            this.showStatus(`ğŸ”’ API key saved to config file!\nAuto-expires in ${this.maxKeyAge / 60000} minutes per session`, 'success');
            setTimeout(() => this.hideSettings(), 2000);
          } else {
            this.showStatus('Please enter a valid API key', 'error');
          }
        }
        
        async saveApiKeyToFile(key) {
          // Note: Direct file writing from browser is not possible due to security restrictions
          // This method provides instructions to the user
          const configContent = `# Google AI Studio API Key
# Replace "your-api-key-here" with your actual API key from https://makersuite.google.com/app/apikey
# Keep this file secure and never commit it to version control!

${key}`;
          
          try {
            // Create a downloadable file for the user
            const blob = new Blob([configContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'api-key.txt';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            this.showStatus('ğŸ“ Config file downloaded! Place it in the config/ folder', 'info');
          } catch (error) {
            console.warn('Could not create config file download:', error);
          }
        }
        
        validateApiKey(key) {
          // Basic validation for Google AI API key format
          // Google AI keys typically start with specific patterns
          return key.length > 20 && /^[A-Za-z0-9_-]+$/.test(key);
        }
        
        async testAI() {
          if (!this.apiKey) {
            this.showStatus('Please enter an API key first', 'error');
            return;
          }
          
          if (this.keyExpiry && Date.now() > this.keyExpiry) {
            this.clearApiKey();
            this.showStatus('API key expired. Please enter again.', 'error');
            return;
          }
          
          this.showStatus('Testing AI connection... ğŸ”„', 'info');
          
          try {
            const response = await fetch(`${this.apiUrl}?key=${this.apiKey}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                contents: [{
                  parts: [{
                    text: 'Say "Hello! AI is working!" in a friendly way with an emoji.'
                  }]
                }],
                generationConfig: {
                  temperature: 0.7,
                  maxOutputTokens: 50,
                }
              })
            });

            if (response.ok) {
              const data = await response.json();
              const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;
              
              if (aiResponse) {
                this.showStatus(`âœ… AI Test Successful!\n"${aiResponse}"`, 'success');
              } else {
                this.showStatus('âŒ Unexpected AI response format', 'error');
              }
            } else {
              const errorData = await response.json();
              this.showStatus(`âŒ API Error: ${errorData.error?.message || 'Unknown error'}`, 'error');
              
              // If unauthorized, clear the key
              if (response.status === 401 || response.status === 403) {
                this.clearApiKey();
              }
            }
          } catch (error) {
            this.showStatus(`âŒ Connection Error: ${error.message}`, 'error');
          }
        }
        
        showStatus(message, type) {
          const statusEl = document.getElementById('api-status');
          statusEl.className = `text-xs text-center p-2 rounded-lg ${
            type === 'success' ? 'bg-accent/20 text-accent' : 
            type === 'error' ? 'bg-red-500/20 text-red-400' : 
            'bg-purple/20 text-purple'
          }`;
          statusEl.textContent = message;
          statusEl.classList.remove('hidden');
          
          if (type !== 'info') {
            setTimeout(() => statusEl.classList.add('hidden'), 3000);
          }
        }
        
        bindEvents() {
          const toggle = document.getElementById('assistant-toggle');
          const close = document.getElementById('assistant-close');
          const settings = document.getElementById('assistant-settings');
          const settingsClose = document.getElementById('settings-close');
          const saveKey = document.getElementById('save-api-key');
          const testAI = document.getElementById('test-ai');
          const sendBtn = document.getElementById('send-message');
          const input = document.getElementById('chat-input');
          const voiceBtn = document.getElementById('voice-input');
          const quickBtns = document.querySelectorAll('.quick-btn');
          const suggestionBtns = document.querySelectorAll('.suggestion-btn');
          const exportChat = document.getElementById('export-chat');
          const clearChat = document.getElementById('clear-chat');
          
          toggle.addEventListener('click', () => this.togglePanel());
          close.addEventListener('click', () => this.closePanel());
          settings.addEventListener('click', () => this.showSettings());
          settingsClose.addEventListener('click', () => this.hideSettings());
          saveKey.addEventListener('click', () => this.saveApiKey());
          testAI.addEventListener('click', () => this.testAI());
          sendBtn.addEventListener('click', () => this.sendMessage());
          voiceBtn.addEventListener('click', () => this.toggleVoiceInput());
          exportChat.addEventListener('click', () => this.exportChatHistory());
          clearChat.addEventListener('click', () => this.clearChatHistory());
          
          // Enhanced input handling
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              this.sendMessage();
            }
          });
          
          input.addEventListener('input', () => {
            this.updateCharCounter();
            this.autoResize();
          });
          
          input.addEventListener('focus', () => {
            document.getElementById('input-status').classList.remove('hidden');
          });
          
          input.addEventListener('blur', () => {
            document.getElementById('input-status').classList.add('hidden');
          });
          
          // Quick action buttons
          quickBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              const question = btn.getAttribute('data-question');
              this.handleQuickQuestion(question);
            });
          });
          
          // Suggestion buttons
          suggestionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              const text = btn.getAttribute('data-text');
              input.value = text;
              this.updateCharCounter();
              this.autoResize();
              input.focus();
            });
          });
        }
        
        showSettings() {
          document.getElementById('settings-panel').classList.remove('hidden');
          document.getElementById('chat-messages').style.display = 'none';
          document.getElementById('quick-actions').style.display = 'none';
        }
        
        hideSettings() {
          document.getElementById('settings-panel').classList.add('hidden');
          document.getElementById('chat-messages').style.display = 'block';
          document.getElementById('quick-actions').style.display = 'block';
        }
        
        togglePanel() {
          const panel = document.getElementById('assistant-panel');
          const toggle = document.getElementById('assistant-toggle');
          
          if (this.isOpen) {
            this.closePanel();
          } else {
            this.isOpen = true;
            panel.style.transform = 'translateX(0)';
            panel.style.opacity = '1';
            toggle.style.transform = 'scale(0.9)';
            
            // Auto-scroll to bottom
            setTimeout(() => {
              const messages = document.getElementById('chat-messages');
              messages.scrollTop = messages.scrollHeight;
            }, 100);
          }
        }
        
        closePanel() {
          const panel = document.getElementById('assistant-panel');
          const toggle = document.getElementById('assistant-toggle');
          
          this.isOpen = false;
          panel.style.transform = 'translateX(100%)';
          panel.style.opacity = '0';
          toggle.style.transform = 'scale(1)';
        }
        
        sendMessage() {
          if (this.isTyping) return; // Prevent sending while AI is thinking
          
          const input = document.getElementById('chat-input');
          const message = input.value.trim();
          
          if (message) {
            // Store in conversation history
            this.addToHistory('user', message);
            
            // Show loading state
            this.setButtonLoading(true);
            
            this.addUserMessage(message);
            input.value = '';
            this.updateCharCounter();
            this.autoResize();
            this.updateSmartSuggestions(message);
            
            setTimeout(() => {
              this.generateResponse(message);
            }, 500);
          }
        }
        
        addToHistory(role, content) {
          this.conversationHistory.push({
            role: role,
            content: content,
            timestamp: new Date().toISOString()
          });
          
          // Limit history length to prevent memory issues
          if (this.conversationHistory.length > this.maxHistoryLength * 2) {
            this.conversationHistory = this.conversationHistory.slice(-this.maxHistoryLength * 2);
          }
        }
        
        updateSmartSuggestions(userMessage) {
          // Add intelligent suggestions based on user input
          const keywords = userMessage.toLowerCase().split(' ');
          
          if (keywords.includes('start') || keywords.includes('begin')) {
            this.smartSuggestions.unshift("What are the system requirements?");
          } else if (keywords.includes('research') || keywords.includes('thesis')) {
            this.smartSuggestions.unshift("Can you explain the research findings?");
          } else if (keywords.includes('programming') || keywords.includes('code')) {
            this.smartSuggestions.unshift("Which programming language should I start with?");
          }
          
          // Keep only unique suggestions and limit to 8
          this.smartSuggestions = [...new Set(this.smartSuggestions)].slice(0, 8);
        }
        
        exportChatHistory() {
          if (this.conversationHistory.length === 0) {
            this.showStatus('No chat history to export', 'info');
            return;
          }
          
          const chatData = {
            title: 'SCI-HIGH AI Assistant Chat History',
            exportDate: new Date().toISOString(),
            totalMessages: this.conversationHistory.length,
            conversation: this.conversationHistory
          };
          
          const dataStr = JSON.stringify(chatData, null, 2);
          const blob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = `sci-high-chat-${new Date().toISOString().split('T')[0]}.json`;
          a.style.display = 'none';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          this.showStatus('ğŸ’¾ Chat history exported successfully!', 'success');
        }
        
        clearChatHistory() {
          if (confirm('Are you sure you want to clear all chat history? This action cannot be undone.')) {
            this.conversationHistory = [];
            
            // Clear visual chat messages except the welcome message
            const messagesContainer = document.getElementById('chat-messages');
            const messages = messagesContainer.querySelectorAll('.user-message, .assistant-message:not(:first-child)');
            messages.forEach(message => message.remove());
            
            this.showStatus('ğŸ—‘ï¸ Chat history cleared successfully!', 'success');
            
            // Add a fresh start message
            setTimeout(() => {
              this.addAssistantMessage('Chat cleared! Ready for a fresh conversation. How can I help you today? ğŸ¤–âœ¨', 'info');
            }, 1000);
          }
        }
        
        setButtonLoading(loading) {
          const sendBtn = document.getElementById('send-message');
          const sendText = document.getElementById('send-text');
          const sendLoading = document.getElementById('send-loading');
          
          if (loading) {
            sendBtn.disabled = true;
            sendText.classList.add('hidden');
            sendLoading.classList.remove('hidden');
          } else {
            sendBtn.disabled = false;
            sendText.classList.remove('hidden');
            sendLoading.classList.add('hidden');
          }
        }
        
        updateCharCounter() {
          const input = document.getElementById('chat-input');
          const counter = document.getElementById('char-counter');
          const length = input.value.length;
          const maxLength = input.maxLength;
          
          counter.textContent = `${length}/${maxLength}`;
          
          if (length > maxLength * 0.9) {
            counter.classList.add('text-yellow-400');
            counter.classList.remove('text-gray-500');
          } else if (length > maxLength * 0.8) {
            counter.classList.add('text-orange-400');
            counter.classList.remove('text-gray-500', 'text-yellow-400');
          } else {
            counter.classList.add('text-gray-500');
            counter.classList.remove('text-yellow-400', 'text-orange-400');
          }
        }
        
        autoResize() {
          const input = document.getElementById('chat-input');
          input.style.height = 'auto';
          const maxHeight = 80; // Max height in pixels
          const newHeight = Math.min(input.scrollHeight, maxHeight);
          input.style.height = newHeight + 'px';
        }
        
        toggleVoiceInput() {
          if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            this.addAssistantMessage('Sorry! Voice input is not supported in this browser. Try Chrome or Edge! ğŸ¤âŒ', 'info');
            return;
          }
          
          if (this.isRecording) {
            this.stopVoiceRecording();
          } else {
            this.startVoiceRecording();
          }
        }
        
        startVoiceRecording() {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          const recognition = new SpeechRecognition();
          
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          
          const voiceBtn = document.getElementById('voice-input');
          this.isRecording = true;
          voiceBtn.innerHTML = 'ğŸ”´';
          voiceBtn.title = 'Stop Recording';
          
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            const input = document.getElementById('chat-input');
            input.value = transcript;
            this.updateCharCounter();
            this.autoResize();
            
            this.addAssistantMessage(`ğŸ¤ Heard: "${transcript}"`, 'info');
          };
          
          recognition.onerror = (event) => {
            this.addAssistantMessage(`ğŸ¤âŒ Voice error: ${event.error}`, 'info');
            this.stopVoiceRecording();
          };
          
          recognition.onend = () => {
            this.stopVoiceRecording();
          };
          
          recognition.start();
          this.currentRecognition = recognition;
          
          this.addAssistantMessage('ğŸ¤ Listening... Speak your question!', 'info');
        }
        
        stopVoiceRecording() {
          if (this.currentRecognition) {
            this.currentRecognition.stop();
          }
          
          const voiceBtn = document.getElementById('voice-input');
          this.isRecording = false;
          voiceBtn.innerHTML = 'ğŸ¤';
          voiceBtn.title = 'Voice Input';
        }
        
        handleQuickQuestion(question) {
          if (this.isTyping) return; // Prevent sending while AI is thinking
          
          this.addUserMessage(question);
          setTimeout(() => {
            this.generateResponse(question);
          }, 500);
        }
        
        addUserMessage(message) {
          const messagesContainer = document.getElementById('chat-messages');
          const messageDiv = document.createElement('div');
          messageDiv.className = 'user-message mb-3 text-right animate-bounce-in';
          messageDiv.innerHTML = `
            <div class="bg-gradient-to-r from-primary/20 to-yellow-300/20 rounded-lg p-2 max-w-xs ml-auto md:p-3 border border-primary/30">
              <div class="flex items-start space-x-2 justify-end">
                <div class="flex-1 text-right">
                  <p class="text-xs text-white md:text-sm">${this.formatMessage(message)}</p>
                  <div class="text-xs text-yellow-300 mt-1 opacity-75">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                </div>
                <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center text-dark font-bold text-xs flex-shrink-0">You</div>
              </div>
            </div>
          `;
          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        addAssistantMessage(message, type = 'info') {
          const messagesContainer = document.getElementById('chat-messages');
          const messageDiv = document.createElement('div');
          messageDiv.className = 'assistant-message mb-3 animate-bounce-in';
          
          const bgColor = type === 'game' ? 'bg-gradient-to-r from-accent/20 to-green-500/20' : 
                         type === 'thesis' ? 'bg-gradient-to-r from-purple/20 to-indigo-500/20' : 
                         type === 'technical' ? 'bg-gradient-to-r from-cyan/20 to-blue-500/20' : 
                         type === 'ai' ? 'bg-gradient-to-r from-purple/20 to-cyan/20' :
                         type === 'security' ? 'bg-gradient-to-r from-red-500/20 to-orange-500/20' :
                         'bg-gradient-to-r from-purple/20 to-cyan/20';
          
          const borderColor = type === 'game' ? 'border-accent/30' :
                             type === 'thesis' ? 'border-purple/30' :
                             type === 'technical' ? 'border-cyan/30' :
                             type === 'ai' ? 'border-purple/30' :
                             type === 'security' ? 'border-red-500/30' :
                             'border-purple/30';
          
          const textColor = type === 'security' ? 'text-red-300' : 'text-white';
          const typeIcon = type === 'game' ? 'ğŸ®' :
                          type === 'thesis' ? 'ğŸ“š' :
                          type === 'technical' ? 'âš™ï¸' :
                          type === 'ai' ? 'ğŸ¤–' :
                          type === 'security' ? 'ğŸ”’' :
                          'ğŸ¤–';
          
          messageDiv.innerHTML = `
            <div class="${bgColor} rounded-lg p-2 max-w-xs md:p-3 border ${borderColor}">
              <div class="flex items-start space-x-2">
                <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center text-dark font-bold text-xs flex-shrink-0">AI</div>
                <div class="flex-1">
                  <p class="text-xs ${textColor} whitespace-pre-line md:text-sm">${this.formatMessage(message)}</p>
                  ${type === 'ai' ? '<div class="text-xs text-purple-300 mt-1 flex items-center"><span class="mr-1">âœ¨</span>Powered by Google AI</div>' : 
                    `<div class="text-xs text-gray-400 mt-1 flex items-center justify-between">
                      <span class="flex items-center"><span class="mr-1">${typeIcon}</span>${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                      <span>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                    </div>`}
                </div>
              </div>
            </div>
          `;
          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        formatMessage(message) {
          // Enhanced message formatting with better markdown-like support
          return message
            .replace(/\*\*(.*?)\*\*/g, '<strong class="text-primary">$1</strong>') // Bold text
            .replace(/\*(.*?)\*/g, '<em class="text-accent">$1</em>') // Italic text
            .replace(/`(.*?)`/g, '<code class="bg-dark/50 px-1 py-0.5 rounded text-cyan text-xs">$1</code>') // Inline code
            .replace(/\nâ€¢/g, '\n<span class="text-primary">â€¢</span>') // Bullet points
            .replace(/(\d+\.)/g, '<span class="text-primary font-bold">$1</span>') // Numbered lists
            .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-cyan hover:text-primary underline">$1</a>') // Links
            .replace(/#{1,6}\s?(.*)/g, '<strong class="text-primary text-sm">$1</strong>'); // Headers
        }
        
        generateResponse(userMessage) {
          const message = userMessage.toLowerCase();
          
          // Show typing indicator
          this.showTypingIndicator();
          
          // Try AI first, fallback to predefined responses
          if (this.apiKey && this.apiKey.length > 0) {
            this.generateAIResponse(userMessage);
          } else {
            this.generateFallbackResponse(message);
          }
        }
        
        async generateAIResponse(userMessage) {
          // Check if key has expired
          if (this.keyExpiry && Date.now() > this.keyExpiry) {
            this.clearApiKey();
            this.hideTypingIndicator();
            this.addAssistantMessage('ğŸ”’ API key expired for security. Using fallback responses.', 'security');
            this.generateFallbackResponse(userMessage.toLowerCase());
            return;
          }
          
          try {
            // Build conversation context from history
            const conversationContext = this.conversationHistory
              .slice(-6) // Use last 6 messages for context
              .map(entry => `${entry.role}: ${entry.content}`)
              .join('\n');
            
            const enhancedPrompt = `${this.systemContext}

Previous conversation context:
${conversationContext}

Current user question: ${userMessage}

Please provide a helpful, engaging response about SCI-HIGH or the thesis research. Consider the conversation context to provide more personalized and relevant answers. Keep responses concise (under 250 words) and include relevant emojis. Match the gaming/educational theme and maintain conversation flow.`;

            const response = await fetch(`${this.apiUrl}?key=${this.apiKey}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                contents: [{
                  parts: [{
                    text: enhancedPrompt
                  }]
                }],
                generationConfig: {
                  temperature: 0.8,
                  topK: 40,
                  topP: 0.95,
                  maxOutputTokens: 250,
                  candidateCount: 1
                }
              })
            });

            if (response.ok) {
              const data = await response.json();
              const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;
              
              if (aiResponse) {
                this.hideTypingIndicator();
                this.addToHistory('assistant', aiResponse);
                this.addAssistantMessage(aiResponse, 'ai');
                
                // Add follow-up suggestions based on the response
                this.addFollowUpSuggestions(aiResponse);
                return;
              }
            } else {
              // If unauthorized, clear the key for security
              if (response.status === 401 || response.status === 403) {
                this.clearApiKey();
                this.hideTypingIndicator();
                this.addAssistantMessage('ğŸ”’ API key invalid or expired. Cleared for security.', 'security');
              }
            }
          } catch (error) {
            console.warn('AI API failed, using fallback:', error);
          }
          
          // Fallback to predefined responses
          this.generateFallbackResponse(userMessage.toLowerCase());
        }
        
        addFollowUpSuggestions(aiResponse) {
          // Generate contextual follow-up suggestions based on AI response
          const response = aiResponse.toLowerCase();
          
          if (response.includes('story mode') || response.includes('character')) {
            this.updateSuggestionButtons([
              "Tell me more about Noah's web development path",
              "What challenges are in Lily's Python journey?",
              "How does Damian's Java story unfold?"
            ]);
          } else if (response.includes('research') || response.includes('thesis')) {
            this.updateSuggestionButtons([
              "What were the key research findings?",
              "How was the study conducted?",
              "What's the sample size and demographics?"
            ]);
          } else if (response.includes('technical') || response.includes('programming')) {
            this.updateSuggestionButtons([
              "What's the tech stack behind SCI-HIGH?",
              "How is the code compilation handled?",
              "What about mobile performance optimization?"
            ]);
          }
        }
        
        updateSuggestionButtons(newSuggestions) {
          const suggestionContainer = document.getElementById('input-suggestions');
          if (!suggestionContainer) return;
          
          // Add new contextual suggestions temporarily
          newSuggestions.forEach((suggestion, index) => {
            setTimeout(() => {
              const btn = document.createElement('button');
              btn.className = 'suggestion-btn text-xs px-2 py-1 bg-primary/20 text-primary rounded-full hover:bg-primary/30 transition-all duration-300 hover:scale-105 animate-bounce-in';
              btn.setAttribute('data-text', suggestion);
              btn.textContent = `ğŸ’¡ ${suggestion}`;
              btn.style.animationDelay = `${index * 0.1}s`;
              
              btn.addEventListener('click', () => {
                const input = document.getElementById('chat-input');
                input.value = suggestion;
                this.updateCharCounter();
                this.autoResize();
                input.focus();
              });
              
              suggestionContainer.appendChild(btn);
              
              // Remove after 30 seconds
              setTimeout(() => {
                if (btn.parentElement) {
                  btn.remove();
                }
              }, 30000);
            }, index * 200);
          });
        }
        
        generateFallbackResponse(message) {
          let response = null;
          let responseType = 'info';
          
          // Enhanced pattern matching with multiple keywords
          const patterns = [
            { 
              keywords: ['what is sci-high', 'about sci-high', 'sci-high game', 'what is this'], 
              response: this.responses["what is sci-high"] 
            },
            { 
              keywords: ['game features', 'about game', 'gameplay', 'how to play'], 
              response: this.responses["about game"] 
            },
            { 
              keywords: ['thesis', 'research', 'study', 'methodology', 'findings'], 
              response: this.responses["thesis research"] 
            },
            { 
              keywords: ['programming', 'coding', 'languages', 'learn code', 'what languages'], 
              response: this.responses["programming languages"] 
            },
            { 
              keywords: ['start', 'begin', 'getting started', 'how to start', 'tutorial'], 
              response: this.responses["how to start"] 
            },
            { 
              keywords: ['technical', 'tech stack', 'built with', 'framework', 'technology'], 
              response: this.responses["technical details"] 
            },
            { 
              keywords: ['help', 'support', 'assist', 'guide'], 
              response: this.responses["help"] 
            }
          ];
          
          // Find best match
          for (const pattern of patterns) {
            if (pattern.keywords.some(keyword => message.includes(keyword))) {
              response = pattern.response.response;
              responseType = pattern.response.type;
              break;
            }
          }
          
          // Context-aware responses based on conversation history
          if (!response && this.conversationHistory.length > 0) {
            const recentTopics = this.conversationHistory
              .slice(-3)
              .map(entry => entry.content.toLowerCase())
              .join(' ');
              
            if (recentTopics.includes('game') && message.includes('more')) {
              response = "Here are more details about SCI-HIGH! ğŸ® The game features:\nâ€¢ **Dynamic Storytelling**: Each character has unique adventures\nâ€¢ **Real-time Compilation**: Code executes instantly in the browser\nâ€¢ **Adaptive Learning**: Difficulty adjusts to your skill level\nâ€¢ **Progress Analytics**: Track your learning journey\nâ€¢ **Offline Support**: Play anywhere, anytime\nâ€¢ **Cross-platform**: Works on desktop, tablet, and mobile\n\nWhat specific aspect interests you most? ğŸ¤”";
              responseType = 'game';
            } else if (recentTopics.includes('research') && (message.includes('more') || message.includes('detail'))) {
              response = "Diving deeper into the research! ğŸ“Š The study examines:\nâ€¢ **Quantitative Metrics**: Performance scores, completion rates, time analysis\nâ€¢ **Qualitative Insights**: Student interviews, feedback surveys\nâ€¢ **Learning Analytics**: Behavioral patterns, engagement tracking\nâ€¢ **Comparative Analysis**: Traditional vs. gamified learning outcomes\nâ€¢ **Statistical Significance**: Pre/post assessment improvements\nâ€¢ **Long-term Retention**: Knowledge persistence over time\n\nThe results show promising evidence for gamification effectiveness! ğŸ“ˆ";
              responseType = 'thesis';
            }
          }
          
          // Smart fallback responses based on message characteristics
          if (!response) {
            if (message.includes('thank') || message.includes('thanks')) {
              response = "You're absolutely welcome! ğŸ˜Š I'm thrilled to help you explore SCI-HIGH! Whether you're curious about the game mechanics, research findings, or technical implementation, I'm here to guide your learning adventure. Feel free to ask anything else! ğŸš€âœ¨";
            } else if (message.includes('hi') || message.includes('hello') || message.includes('hey')) {
              response = "Hello there, future coding champion! ğŸ‘‹âœ¨ Welcome to the world of SCI-HIGH! I'm your dedicated AI assistant, ready to help you navigate this exciting educational gaming adventure. What brings you here today? Are you interested in:\nâ€¢ ğŸ® Learning about the game\nâ€¢ ğŸ“š Understanding the research\nâ€¢ ğŸ’» Exploring programming concepts\nâ€¢ ğŸš€ Getting started with your coding journey";
            } else if (message.includes('bye') || message.includes('goodbye')) {
              response = "Farewell, brave adventurer! ğŸ‘‹ May your coding journey be filled with epic discoveries and bug-free adventures! Remember, every expert was once a beginner. Keep learning, keep coding, and keep being awesome! See you next time in the SCI-HIGH universe! ğŸš€âœ¨";
            } else if (message.length < 3) {
              response = "Hmm, that's quite brief! ğŸ¤” Could you elaborate a bit more? I'm here to help with detailed questions about:\nâ€¢ ğŸ® Game features and mechanics\nâ€¢ ğŸ“š Research methodology and findings\nâ€¢ ğŸ’» Programming concepts and tutorials\nâ€¢ ğŸ› ï¸ Technical implementation details\n\nWhat would you like to explore? ğŸ’«";
            } else {
              response = "That's an interesting question! ğŸ¤” While I'd love to give you a perfect answer, I'm specifically designed to help with SCI-HIGH-related topics. I can assist you with:\n\nğŸ® **Game Information**:\nâ€¢ Gameplay mechanics and features\nâ€¢ Character stories and programming paths\nâ€¢ Achievement systems and progress tracking\n\nğŸ“š **Research & Thesis**:\nâ€¢ Educational methodology and findings\nâ€¢ Gamification effectiveness studies\nâ€¢ Academic contributions and implications\n\nğŸ’» **Programming & Technical**:\nâ€¢ Supported languages and concepts\nâ€¢ Technical architecture and implementation\nâ€¢ Learning resources and tutorials\n\nTry asking about any of these topics! ğŸš€";
            }
          }
          
          // Add contextual follow-up based on response type
          if (responseType === 'game') {
            response += "\n\nğŸ’¡ **Want to explore more?** Try asking about specific characters, programming challenges, or technical features!";
          } else if (responseType === 'thesis') {
            response += "\n\nğŸ“Š **Curious about methodology?** Ask about data collection methods, sample demographics, or statistical analysis!";
          } else if (responseType === 'technical') {
            response += "\n\nâš™ï¸ **Deep dive available!** Ask about specific technologies, performance optimizations, or development challenges!";
          }
          
          // Simulate more realistic typing delay based on response length
          const typingDelay = Math.min(Math.max(response.length * 20, 800), 2500);
          
          setTimeout(() => {
            this.hideTypingIndicator();
            this.addToHistory('assistant', response);
            this.addAssistantMessage(response, responseType);
          }, typingDelay);
        }
        
        showTypingIndicator() {
          this.isTyping = true;
          const messagesContainer = document.getElementById('chat-messages');
          const typingDiv = document.createElement('div');
          typingDiv.className = 'typing-indicator mb-3';
          typingDiv.id = 'typing-indicator';
          typingDiv.innerHTML = `
            <div class="bg-purple/20 rounded-lg p-2 max-w-xs md:p-3">
              <div class="flex items-center space-x-1">
                <div class="flex space-x-1">
                  <div class="w-2 h-2 bg-purple rounded-full animate-bounce"></div>
                  <div class="w-2 h-2 bg-purple rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                  <div class="w-2 h-2 bg-purple rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                </div>
                <span class="text-xs text-gray-400 md:text-sm">AI is thinking...</span>
              </div>
            </div>
          `;
          messagesContainer.appendChild(typingDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        hideTypingIndicator() {
          this.isTyping = false;
          this.setButtonLoading(false);
          const typingIndicator = document.getElementById('typing-indicator');
          if (typingIndicator) {
            typingIndicator.remove();
          }
        }
        
        setupAutoResponses() {
          // Add some helpful tips periodically when panel is open
          setInterval(() => {
            if (this.isOpen && Math.random() < 0.1) { // 10% chance every interval
              const tips = [
                "ğŸ’¡ Tip: Try the Story Mode for narrative-based learning!",
                "ğŸ¯ Pro tip: Complete challenges in the Computer Lab for hands-on practice!",
                "â­ Did you know? You can track your progress in the Office section!",
                "ğŸš€ Quick fact: SCI-HIGH supports both mobile and desktop play!"
              ];
              const randomTip = tips[Math.floor(Math.random() * tips.length)];
              setTimeout(() => this.addAssistantMessage(randomTip, 'info'), 2000);
            }
          }, 30000); // Check every 30 seconds
        }
      }
      
      // Initialize the virtual assistant when the page loads
      document.addEventListener('DOMContentLoaded', () => {
        new VirtualAssistant();
        
        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
        
        // Sync mobile menu visibility with desktop menu for user state
        const syncMobileMenu = () => {
          const loginBtn = document.getElementById('login-btn');
          const professorNavLink = document.getElementById('professor-nav-link');
          const userGreeting = document.getElementById('user-greeting');
          const logoutBtn = document.getElementById('logout-btn');
          
          const mobileLoginBtn = document.getElementById('mobile-login-btn');
          const mobileProfessorNavLink = document.getElementById('mobile-professor-nav-link');
          const mobileUserGreeting = document.getElementById('mobile-user-greeting');
          const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
          
          if (loginBtn && mobileLoginBtn) {
            mobileLoginBtn.style.display = loginBtn.classList.contains('hidden') ? 'none' : 'block';
          }
          if (professorNavLink && mobileProfessorNavLink) {
            mobileProfessorNavLink.style.display = professorNavLink.classList.contains('hidden') ? 'none' : 'block';
          }
          if (userGreeting && mobileUserGreeting) {
            mobileUserGreeting.style.display = userGreeting.classList.contains('hidden') ? 'none' : 'block';
            const greetingText = document.getElementById('greeting-text');
            const mobileGreetingText = document.getElementById('mobile-greeting-text');
            if (greetingText && mobileGreetingText) {
              mobileGreetingText.textContent = greetingText.textContent;
            }
          }
          if (logoutBtn && mobileLogoutBtn) {
            mobileLogoutBtn.style.display = logoutBtn.classList.contains('hidden') ? 'none' : 'block';
          }
        };
        
        // Call sync function periodically to keep mobile menu in sync
        setInterval(syncMobileMenu, 1000);
        syncMobileMenu(); // Initial sync
      });
    </script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="public/assets/img/logo/SCI-HIGH_LOGO.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCI-HIGH: Global Leaderboards</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Gaming Feel -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Modern Notification System -->
    <script src="js/notifications.js"></script>
    <script>
      // Suppress SES security warnings (they're informational only)
      const originalConsoleWarn = console.warn;
      console.warn = function(...args) {
        const message = args.join(' ');
        // Only suppress SES-related warnings
        if (message.includes('SES') || message.includes('lockdown-install.js') || message.includes('Removing intrinsics')) {
          return; // Suppress SES warnings
        }
        originalConsoleWarn.apply(console, args);
      };

      // Fallback functions in case notifications.js hasn't loaded yet
      window.ensureNotifications = function() {
        if (typeof window.modernConfirm === 'undefined') {
          console.warn('Notification system not loaded, using fallback');
          window.modernConfirm = function(message, options = {}) {
            return Promise.resolve(confirm(message));
          };
          window.modernAlert = function(message, options = {}) {
            alert(message);
            return Promise.resolve(true);
          };
          window.showSuccess = function(message, options = {}) {
            alert('âœ… ' + message);
            return Promise.resolve(true);
          };
          window.showError = function(message, options = {}) {
            alert('âŒ ' + message);
            return Promise.resolve(true);
          };
          window.showWarning = function(message, options = {}) {
            alert('âš ï¸ ' + message);
            return Promise.resolve(true);
          };
          window.showInfo = function(message, options = {}) {
            alert('â„¹ï¸ ' + message);
            return Promise.resolve(true);
          };
        }
      };
      
      // Ensure notifications are available immediately
      window.ensureNotifications();
    </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F4CE14', // yellow
              accent: '#379777', // green
              dark: '#1a1a2e',   // darker navy
              light: '#16213e',  // dark blue
              purple: '#9c27b0', // gaming purple
              cyan: '#00bcd4',   // gaming cyan
              textColor: '#ffffff',
              cardBg: 'rgba(22, 33, 62, 0.8)',
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace'],
              body: ['Exo 2', 'sans-serif'],
            },
            animation: {
              'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate',
              'float': 'float 6s ease-in-out infinite',
              'slide-in': 'slide-in 0.8s ease-out',
              'bounce-in': 'bounce-in 1s ease-out',
              'rank-glow': 'rank-glow 3s ease-in-out infinite',
            }
          }
        }
      }
    </script>
    <style>
      @keyframes pulse-glow {
        from { box-shadow: 0 0 20px #F4CE14; }
        to { box-shadow: 0 0 30px #F4CE14, 0 0 40px #F4CE14; }
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      @keyframes slide-in {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes bounce-in {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
      }
      @keyframes rank-glow {
        0%, 100% { box-shadow: 0 0 10px rgba(244, 206, 20, 0.3); }
        50% { box-shadow: 0 0 20px rgba(244, 206, 20, 0.8); }
      }
      
      .game-bg {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
        position: relative;
        overflow-x: hidden;
      }
      
      .game-bg::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
          radial-gradient(circle at 20% 80%, rgba(244, 206, 20, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(55, 151, 119, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(156, 39, 176, 0.1) 0%, transparent 50%);
        animation: float 8s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
      }
      
      .neon-border {
        border: 2px solid #F4CE14;
        background: rgba(22, 33, 62, 0.8);
        box-shadow: 0 0 10px rgba(244, 206, 20, 0.3);
      }
      
      /* Custom modal animations */
      .modal-enter {
        animation: modalFadeIn 0.3s ease-out;
      }
      
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      
      /* Gaming rank styles */
      .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); }
      .rank-2 { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); }
      .rank-3 { background: linear-gradient(135deg, #CD7F32, #B8860B); }
      
      /* Hover effects for clickable names */
      .player-name-link {
        transition: all 0.2s ease;
      }
      
      .player-name-link:hover {
        transform: translateY(-1px);
        text-shadow: 0 2px 4px rgba(244, 206, 20, 0.5);
      }
    </style>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <!-- Lightweight custom charts - no external dependencies needed -->
  </head>
  <body class="font-body game-bg text-textColor m-0 p-0 leading-relaxed min-h-screen flex flex-col">
    <!-- Particle Background Effect -->
    <div id="particles" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- Gaming HUD Navigation -->
    <nav class="relative z-50 bg-gradient-to-r from-dark/90 to-light/90 backdrop-blur-md border-b-2 border-primary/30 py-4 sticky top-0">
      <div class="max-w-6xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <img src="../public/assets/img/buko_productions-logo.png" alt="Buko Productions Logo" class="w-10 h-10 sm:w-12 sm:h-12 animate-bounce-in" />
            <span class="font-gaming text-lg sm:text-xl font-bold text-primary">SCI-HIGH</span>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="text-textColor hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex space-x-8">
            <a href="index.html" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">Home</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <a href="index.html#about" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">About</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <a href="index.html#contact" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">Contact</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-light/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <a href="index.html" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">ğŸ </span> Home
              </span>
            </a>
            <a href="index.html#about" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">â„¹ï¸</span> About
              </span>
            </a>
            <a href="index.html#contact" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">ğŸ“</span> Contact
              </span>
            </a>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Main content wrapper with flex-grow to push footer down -->
    <div class="flex-grow relative z-10">
      <!-- Hero Section -->
      <section class="py-12 sm:py-16 px-4 sm:px-6">
        <div class="max-w-6xl mx-auto text-center">
          <div class="mb-8 sm:mb-12 animate-bounce-in">
            <h1 class="font-gaming text-3xl sm:text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-primary via-accent to-cyan mb-4 sm:mb-6">
              ğŸ† Global Leaderboards
            </h1>
            <p class="text-base sm:text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-6 sm:mb-8 px-4">
              Compete with programmers worldwide and climb the ranks in the ultimate coding challenge!
            </p>
          </div>
          
          <!-- Gaming Filter Buttons -->
          <div class="flex flex-wrap justify-center gap-2 sm:gap-4 mb-8 sm:mb-12 animate-slide-in px-2 sm:px-4">
            <button class="filter-btn px-3 xs:px-4 sm:px-8 py-2 sm:py-3 font-gaming text-xs sm:text-sm uppercase tracking-wider rounded-xl font-bold text-dark bg-gradient-to-r from-primary to-yellow-300 transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-primary/50 border-2 border-primary touch-manipulation" data-filter="overall">
              <span class="relative z-10">ğŸŒŸ Overall</span>
            </button>
            <button class="filter-btn px-3 xs:px-4 sm:px-8 py-2 sm:py-3 font-gaming text-xs sm:text-sm uppercase tracking-wider rounded-xl font-bold text-textColor bg-gradient-to-r from-accent to-cyan transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-accent/50 border-2 border-accent/50 touch-manipulation" data-filter="college">
              <span class="relative z-10">ğŸ“ College</span>
            </button>
            <button class="filter-btn px-3 xs:px-4 sm:px-8 py-2 sm:py-3 font-gaming text-xs sm:text-sm uppercase tracking-wider rounded-xl font-bold text-textColor bg-gradient-to-r from-purple to-pink-500 transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple/50 border-2 border-purple/50 touch-manipulation" data-filter="seniorhigh">
              <span class="relative z-10">ğŸ“š Senior High</span>
            </button>
            <button class="filter-btn px-3 xs:px-4 sm:px-8 py-2 sm:py-3 font-gaming text-xs sm:text-sm uppercase tracking-wider rounded-xl font-bold text-textColor bg-gradient-to-r from-cyan to-blue-500 transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-cyan/50 border-2 border-cyan/50 touch-manipulation" data-filter="juniorhigh">
              <span class="relative z-10">ğŸ’ Junior High</span>
            </button>
          </div>
          
          <!-- Students Only Notice -->
          <div class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/50 rounded-lg p-4 mb-8 text-center">
            <p class="text-blue-300 font-gaming">
              <span class="text-yellow-300">ğŸ“</span> Student Leaderboard <span class="text-yellow-300">ğŸ“</span>
            </p>
            <p class="text-gray-300 text-sm mt-1">Only registered students appear on the leaderboards. Scores are linked to official student records.</p>
          </div>
        </div>
      </section>

      <!-- Leaderboard Section -->
      <section class="px-6 pb-16">
        <div class="max-w-6xl mx-auto">
          <div class="neon-border rounded-xl backdrop-blur-sm p-8">
            <div class="flex items-center justify-between mb-8">
              <h2 class="font-gaming text-2xl font-bold text-primary flex items-center gap-3">
                <span class="text-3xl">âš”ï¸</span>
                Battle Rankings
              </h2>
              <div class="flex items-center gap-4 text-sm text-gray-400">
                <span class="flex items-center gap-2">
                  <div class="w-3 h-3 bg-primary rounded-full animate-pulse"></div>
                  Live Updates
                </span>
                <span id="player-count">Loading...</span>
              </div>
            </div>

            <!-- Featured Players Section (Top 3) -->
            <div id="featured-players" class="mt-8 mb-8">
              <div class="neon-border rounded-xl shadow-xl overflow-hidden backdrop-blur-sm bg-dark/50">
                <div class="bg-gradient-to-r from-dark via-light to-dark text-white p-6 border-b-2 border-primary/30">
                  <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-primary to-yellow-300 rounded-lg flex items-center justify-center neon-border">
                      <img src="../public/assets/img/icons/office/achievements.png" alt="Featured" class="w-8 h-8 object-contain" />
                    </div>
                    <div>
                      <h2 class="font-gaming text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Top Champions</h2>
                      <p class="text-gray-300 font-body text-sm">The elite warriors leading the leaderboards</p>
                    </div>
                  </div>
                </div>
                
                <!-- Player Cards Grid -->
                <div id="player-cards-container" class="p-6">
                  <div id="player-cards-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Player cards will be inserted here by JavaScript -->
                  </div>
                  
                  <!-- Loading State for Player Cards -->
                  <div id="player-cards-loading" class="text-center py-8">
                    <div class="flex flex-col items-center space-y-3">
                      <div class="w-12 h-12 border-3 border-primary border-t-transparent rounded-full animate-spin"></div>
                      <p class="text-gray-400 font-gaming text-sm">Loading champions...</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div id="leaderboard-list" class="mt-8 space-y-8">
              <!-- Global Leaderboard Section -->
              <div id="global-leaderboard" class="leaderboard-section">
                <div class="neon-border rounded-xl shadow-xl overflow-hidden backdrop-blur-sm bg-dark/50">
                  <!-- Leaderboard Header -->
                  <div class="bg-gradient-to-r from-dark via-light to-dark text-white p-8 border-b-2 border-primary/30">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                      <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-primary to-yellow-300 rounded-xl flex items-center justify-center neon-border animate-float">
                          <img src="../public/assets/img/icons/office/achievements.png" alt="Achievements" class="w-10 h-10 object-contain" />
                        </div>
                        <div>
                          <h2 class="font-gaming text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Global Champions</h2>
                          <p class="text-gray-300 font-body">Top warriors across all departments</p>
                        </div>
                      </div>
                      <div class="text-center">
                        <div class="text-sm text-gray-400 font-gaming">Total Players</div>
                        <div id="total-players" class="text-2xl font-gaming font-bold text-primary">0</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Leaderboard Table -->
                  <div class="overflow-x-auto">
                    <table class="w-full">
                      <thead>
                        <tr class="bg-gradient-to-r from-primary/20 to-accent/20 border-b border-primary/30">
                          <th class="px-6 py-4 text-left font-gaming text-primary border-r border-primary/30">
                            <span class="flex items-center space-x-2">
                              <span>âš¡</span>
                              <span>Rank</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-primary border-r border-primary/30">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ®</span>
                              <span>Player</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-primary border-r border-primary/30">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ«</span>
                              <span>Department</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-primary border-r border-primary/30">
                            <span class="flex items-center space-x-2">
                              <span>â­</span>
                              <span>Battle Score</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-primary border-r border-primary/30">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ¯</span>
                              <span>Accuracy</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-primary">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ”¥</span>
                              <span>Max Combo</span>
                            </span>
                          </th>
                        </tr>
                      </thead>
                      <tbody id="global-leaderboard-body" class="divide-y divide-primary/20">
                        <!-- Leaderboard rows will be inserted here by JavaScript -->
                      </tbody>
                    </table>
                  </div>
                  
                  <!-- Loading State -->
                  <div id="global-loading" class="text-center py-16">
                    <div class="flex flex-col items-center space-y-4">
                      <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
                      <p class="text-gray-400 font-gaming">Loading battle results...</p>
                    </div>
                  </div>
                  
                  <!-- Empty State -->
                  <div id="global-empty" class="text-center py-16 hidden">
                    <div class="flex flex-col items-center space-y-4">
                      <div class="w-24 h-24 bg-gradient-to-br from-primary/20 to-accent/20 rounded-xl flex items-center justify-center">
                        <img src="../public/assets/img/mainhub/PLAY_BUTTON.png" alt="Play" class="w-16 h-16 object-contain" />
                      </div>
                      <h3 class="text-xl font-gaming font-bold text-gray-300">No Champions Yet</h3>
                      <p class="text-gray-400 font-body">Be the first to join the leaderboard!</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Department Leaderboard Section -->
              <div id="department-leaderboard" class="leaderboard-section hidden">
                <div class="neon-border rounded-xl shadow-xl overflow-hidden backdrop-blur-sm bg-dark/50">
                  <!-- Department Header -->
                  <div class="bg-gradient-to-r from-dark via-light to-dark text-white p-8 border-b-2 border-accent/30">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                      <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-accent to-cyan-400 rounded-xl flex items-center justify-center neon-border animate-float">
                          <img src="../public/assets/img/mainhub/office_icon.png" alt="Office" class="w-10 h-10 object-contain" />
                        </div>
                        <div>
                          <h2 class="font-gaming text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-accent to-cyan-400">Department Leaders</h2>
                          <p id="department-subtitle" class="text-gray-300 font-body">Elite warriors of the department</p>
                        </div>
                      </div>
                      <div class="text-center">
                        <div class="text-sm text-gray-400 font-gaming">Department Players</div>
                        <div id="dept-total-players" class="text-2xl font-gaming font-bold text-accent">0</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Department Table -->
                  <div class="overflow-x-auto">
                    <table class="w-full">
                      <thead>
                        <tr class="bg-gradient-to-r from-accent/20 to-cyan-400/20 border-b border-accent/30">
                          <th class="px-6 py-4 text-left font-gaming text-accent border-r border-accent/30">
                            <span class="flex items-center space-x-2">
                              <span>âš¡</span>
                              <span>Rank</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-accent border-r border-accent/30">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ®</span>
                              <span>Player</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-accent border-r border-accent/30">
                            <span class="flex items-center space-x-2">
                              <span>â­</span>
                              <span>Battle Score</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-accent border-r border-accent/30">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ¯</span>
                              <span>Accuracy</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-accent border-r border-accent/30">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ”¥</span>
                              <span>Max Combo</span>
                            </span>
                          </th>
                          <th class="px-6 py-4 text-left font-gaming text-accent">
                            <span class="flex items-center space-x-2">
                              <span>ğŸ“Š</span>
                              <span>Global Rank</span>
                            </span>
                          </th>
                        </tr>
                      </thead>
                      <tbody id="department-leaderboard-body" class="divide-y divide-accent/20">
                        <!-- Department leaderboard rows will be inserted here by JavaScript -->
                      </tbody>
                    </table>
                  </div>
                  
                  <!-- Department Loading State -->
                  <div id="department-loading" class="text-center py-16">
                    <div class="flex flex-col items-center space-y-4">
                      <div class="w-16 h-16 border-4 border-accent border-t-transparent rounded-full animate-spin"></div>
                      <p class="text-gray-400 font-gaming">Loading department champions...</p>
                    </div>
                  </div>
                  
                  <!-- Department Empty State -->
                  <div id="department-empty" class="text-center py-16 hidden">
                    <div class="flex flex-col items-center space-y-4">
                      <div class="w-24 h-24 bg-gradient-to-br from-accent/20 to-cyan-400/20 rounded-xl flex items-center justify-center">
                        <img src="../public/assets/img/mainhub/office_icon.png" alt="Office" class="w-16 h-16 object-contain" />
                      </div>
                      <h3 class="text-xl font-gaming font-bold text-gray-300">No Department Champions</h3>
                      <p class="text-gray-400 font-body">Rise up and claim your department's glory!</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Player Profile Modal -->
    <div id="player-profile-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center hidden">
      <div class="neon-border rounded-xl shadow-2xl max-w-7xl w-full mx-4 max-h-[95vh] overflow-y-auto">
        <div class="relative">
          <!-- Header Section with Avatar and Basic Info -->
          <div id="profile-header" class="relative bg-gradient-to-r from-dark via-light to-dark text-white p-8 rounded-t-xl">
            <!-- Close button -->
            <button onclick="closePlayerProfile()" class="absolute top-4 right-4 text-white hover:text-primary text-3xl font-gaming font-bold z-10 transition-colors duration-300">&times;</button>
            
            <!-- Player Info Container -->
            <div class="flex flex-col lg:flex-row items-start lg:items-end gap-6">
              <!-- Avatar Section -->
              <div class="flex-shrink-0">
                <div class="w-32 h-32 bg-gradient-to-br from-primary to-yellow-300 rounded-xl shadow-lg flex items-center justify-center neon-border">
                  <div id="player-avatar" class="w-24 h-24 bg-dark rounded-full flex items-center justify-center text-primary text-3xl font-gaming font-bold">
                    <!-- Avatar will be generated from player name -->
                  </div>
                </div>
              </div>
              
              <!-- Player Info -->
              <div class="flex-grow">
                <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4">
                  <!-- Name and Location -->
                  <div>
                    <h2 id="profile-player-name" class="font-gaming text-4xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Player Name</h2>
                    <p id="profile-department" class="text-xl opacity-90 flex items-center gap-2">
                      <span class="inline-block w-6 h-4 bg-primary rounded shadow"></span>
                      Department
                    </p>
                  </div>
                  
                  <!-- Rankings -->
                  <div class="flex gap-8">
                    <div class="text-center">
                      <div class="text-sm opacity-75 font-gaming">Global Rank</div>
                      <div id="global-rank" class="text-2xl font-gaming font-bold text-primary">#0</div>
                    </div>
                    <div class="text-center">
                      <div class="text-sm opacity-75 font-gaming">Department Rank</div>
                      <div id="dept-rank" class="text-2xl font-gaming font-bold text-accent">#0</div>
                    </div>
                  </div>
                </div>
                
                <!-- Stats Bar -->
                <div class="mt-6 grid grid-cols-2 lg:grid-cols-6 gap-4 text-center">
                  <div class="bg-cardBg rounded-lg p-3 neon-border">
                    <div class="text-xs opacity-75 font-gaming">Ranked Score</div>
                    <div id="ranked-score" class="text-lg font-gaming font-bold text-primary">0</div>
                  </div>
                  <div class="bg-cardBg rounded-lg p-3 neon-border">
                    <div class="text-xs opacity-75 font-gaming">Accuracy</div>
                    <div id="accuracy" class="text-lg font-gaming font-bold text-accent">0%</div>
                  </div>
                  <div class="bg-cardBg rounded-lg p-3 neon-border">
                    <div class="text-xs opacity-75 font-gaming">Quiz Count</div>
                    <div id="quiz-count" class="text-lg font-gaming font-bold text-cyan">0</div>
                  </div>
                  <div class="bg-cardBg rounded-lg p-3 neon-border">
                    <div class="text-xs opacity-75 font-gaming">Total Score</div>
                    <div id="total-score" class="text-lg font-gaming font-bold text-purple">0</div>
                  </div>
                  <div class="bg-cardBg rounded-lg p-3 neon-border">
                    <div class="text-xs opacity-75 font-gaming">Questions</div>
                    <div id="total-questions" class="text-lg font-gaming font-bold text-gray-300">0</div>
                  </div>
                  <div class="bg-cardBg rounded-lg p-3 neon-border">
                    <div class="text-xs opacity-75 font-gaming">Max Combo</div>
                    <div id="max-combo" class="text-lg font-gaming font-bold text-primary">0</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Grade/Level Bar -->
          <div class="bg-cardBg px-8 py-4 border-b border-primary/30">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="text-sm font-gaming font-medium text-primary">Level Progress</div>
                <div class="flex items-center gap-2">
                  <div id="level-badges" class="flex gap-1">
                    <!-- Level badges will be generated here -->
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm text-gray-400 font-gaming">Total Play Time</div>
                <div id="total-playtime" class="font-gaming font-bold text-accent">0h 0m</div>
              </div>
            </div>
          </div>
          
          <!-- Main Content -->
          <div class="p-8 bg-cardBg">
            <div id="profile-content" class="space-y-8">
              <!-- Content will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
    
    <!-- Gaming Footer -->
    <footer class="relative z-10 bg-gradient-to-r from-dark to-light border-t-2 border-primary/30 py-12 mt-auto">
      <div class="max-w-6xl mx-auto px-6 text-center">
        <div class="flex items-center justify-center space-x-4 mb-6">
          <img src="../public/assets/img/buko_productions-logo.png" alt="Buko Productions" class="w-16 h-16" />
          <div>
            <h3 class="font-gaming text-2xl font-bold text-primary">SCI-HIGH</h3>
            <p class="text-gray-400 text-sm">Level up your knowledge!</p>
          </div>
        </div>
        <div class="w-32 h-1 bg-gradient-to-r from-primary to-accent mx-auto rounded-full mb-6"></div>
        <p class="text-gray-400 font-gaming">&copy; 2025 SCI-HIGH Thesis Project. All rights reserved. Game on! ğŸ®</p>
      </div>
    </footer>
    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
        authDomain: "sci-high-website.firebaseapp.com",
        databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sci-high-website",
        storageBucket: "sci-high-website.appspot.com",
        messagingSenderId: "451463202515",
        appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // Helper function to format course names properly
      function formatCourseName(courseTopic) {
        if (!courseTopic || courseTopic === 'unknown') {
          return 'Unknown Course';
        }
        
        const courseMap = {
          'python': 'Python Programming',
          'java': 'Java Development',
          'csharp': 'C# Programming',
          'cpp': 'C++ Programming',
          'c': 'C Programming',
          'webdesign': 'Web Design'
        };
        
        return courseMap[courseTopic.toLowerCase()] || courseTopic.charAt(0).toUpperCase() + courseTopic.slice(1);
      }

      // Load Career Stats Data from Firebase
      async function loadCareerStatsData(filter = 'overall') {
        try {
          console.log('Loading career stats data with filter:', filter);
          
          // Get career stats data
          const careerSnapshot = await db.ref('student_career_stats').once('value');
          const careerData = careerSnapshot.val();
          
          if (!careerData) {
            console.log('No career stats data found');
            return [];
          }

          // Try to get main student data for correct names (fallback if permission denied)
          let studentNameMap = {};
          try {
            const studentsSnapshot = await db.ref('students').once('value');
            const studentsData = studentsSnapshot.val();
            
            if (studentsData) {
              Object.values(studentsData).forEach(student => {
                if (student.studentId) {
                  studentNameMap[student.studentId] = {
                    name: student.name || student.fullName || 'Unknown Student',
                    department: student.department || 'Unknown'
                  };
                }
              });
            }
          } catch (error) {
            console.warn('Could not access students database (permission denied), using career stats names:', error.message);
            // Continue without student names map - will use career stats names
          }

          // Use Map to accumulate data for students (to handle duplicates)
          const studentAccumulator = new Map();
          
          Object.entries(careerData).forEach(([studentId, statsData]) => {
            if (!statsData.careerStats || !statsData.studentInfo) {
              return; // Skip incomplete records
            }

            const career = statsData.careerStats;
            const info = statsData.studentInfo;
            
            // Get correct student name from main database, fallback to career stats
            const studentInfo = studentNameMap[studentId];
            
            // Enhanced name construction with better fallback logic
            let studentName = 'Unknown Student';
            
            if (studentInfo?.name) {
              // Use name from main students database
              studentName = studentInfo.name;
            } else if (info.fullName) {
              // Use fullName from career stats studentInfo
              studentName = info.fullName;
            } else if (statsData.firstName || statsData.lastName) {
              // Construct name from firstName and lastName, handling missing parts
              const firstName = statsData.firstName || '';
              const lastName = statsData.lastName || '';
              const middleName = statsData.middleName || '';
              
              if (firstName && lastName) {
                // If we have both first and last name
                studentName = middleName ? `${firstName} ${middleName} ${lastName}` : `${firstName} ${lastName}`;
              } else if (firstName) {
                // Only first name available
                studentName = firstName;
              } else if (lastName) {
                // Only last name available
                studentName = lastName;
              }
            } else if (statsData.studentInfo?.studentName) {
              // Check for alternative name field
              studentName = statsData.studentInfo.studentName;
            }
            
            // Ensure we don't have empty or just whitespace names
            studentName = studentName.trim() || `Student ${studentId}`;
            
            console.log(`Student ${studentId} name resolved as: "${studentName}"`, {
              fromMainDB: studentInfo?.name,
              fromCareerInfo: info.fullName,
              fromFirstLast: statsData.firstName + ' ' + statsData.lastName,
              final: studentName
            });
            
            // Determine department from main database first, then fallback
            let department = studentInfo?.department || statsData.department || 'Unknown';
            let departmentType = 'other';
            
            if (department) {
              departmentType = department.toLowerCase().includes('college') ? 'college' : 
                              department.toLowerCase().includes('senior') ? 'seniorhigh' : 
                              department.toLowerCase().includes('junior') ? 'juniorhigh' : 'other';
            }

            // Apply filter
            if (filter !== 'overall') {
              if (filter === 'college' && departmentType !== 'college') return;
              if (filter === 'seniorhigh' && departmentType !== 'seniorhigh') return;
              if (filter === 'juniorhigh' && departmentType !== 'juniorhigh') return;
            }

            // Use student name as key to accumulate data for same students
            const accumulatorKey = `${studentName}_${department}`.toLowerCase();
            
            if (studentAccumulator.has(accumulatorKey)) {
              // Accumulate existing student data
              const existing = studentAccumulator.get(accumulatorKey);
              
              // Add up scores and sessions
              existing.score += career.totalPoints || 0;
              existing.totalSessions += career.totalSessions || 0;
              
              // Calculate weighted average for accuracy
              const totalQuestions = existing.totalQuestions + (career.totalQuestions || 0);
              const totalCorrectAnswers = existing.totalCorrectAnswers + (career.totalCorrectAnswers || 0);
              existing.averageAccuracy = totalQuestions > 0 ? Math.round((totalCorrectAnswers / totalQuestions) * 100) : 0;
              existing.totalQuestions = totalQuestions;
              existing.totalCorrectAnswers = totalCorrectAnswers;
              
              // Keep highest streak
              existing.highestStreak = Math.max(existing.highestStreak, career.highestStreak || 0);
              
              // Merge course completion status
              const existingCompletion = existing.courseCompletionStatus;
              const newCompletion = career.courseCompletionStatus || {};
              Object.entries(newCompletion).forEach(([course, completed]) => {
                if (completed) existingCompletion[course] = true;
              });
              
              // Update completion percentage
              const totalCourses = Object.keys(existingCompletion).length;
              const completedCourses = Object.values(existingCompletion).filter(Boolean).length;
              existing.completedCourses = completedCourses;
              existing.totalCourses = totalCourses;
              existing.completionPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;
              
              // Update last updated time
              if (info.lastUpdated && (!existing.lastUpdated || new Date(info.lastUpdated) > new Date(existing.lastUpdated))) {
                existing.lastUpdated = info.lastUpdated;
              }
              
            } else {
              // First time seeing this student
              const completionStatus = career.courseCompletionStatus || {};
              const totalCourses = Object.keys(completionStatus).length;
              const completedCourses = Object.values(completionStatus).filter(Boolean).length;
              const completionPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;

              studentAccumulator.set(accumulatorKey, {
                studentId: studentId,
                userId: studentId, // For compatibility
                name: studentName,
                firstName: statsData.firstName || '',
                lastName: statsData.lastName || '',
                department: department,
                strandYear: statsData.strandYear || '',
                score: career.totalPoints || 0,
                totalSessions: career.totalSessions || 0,
                averageAccuracy: career.averageAccuracy || 0,
                totalQuestions: career.totalQuestions || 0,
                totalCorrectAnswers: career.totalCorrectAnswers || 0,
                highestStreak: career.highestStreak || 0,
                completedCourses: completedCourses,
                totalCourses: totalCourses,
                completionPercentage: completionPercentage,
                courseCompletionStatus: completionStatus,
                lastUpdated: info.lastUpdated || '',
                recentSessions: statsData.recentSessions || {}
              });
            }
          });

          // Convert Map back to array
          const leaderboardData = Array.from(studentAccumulator.values());

          // Sort by total accumulated points (descending)
          leaderboardData.sort((a, b) => b.score - a.score);
          
          console.log(`Loaded and consolidated ${leaderboardData.length} unique student records`);
          return leaderboardData;

        } catch (error) {
          console.error('Error loading career stats data:', error);
          return [];
        }
      }

      // Enhanced Leaderboard Rendering with Career Stats
      function renderLeaderboard(data) {
        const container = document.getElementById('leaderboard-list');
        if (!data || data.length === 0) {
          container.innerHTML = '<p class="text-gray-500 text-center font-gaming">No career stats available yet. Complete some quiz sessions!</p>';
          return;
        }

        let html = `
          <div class="overflow-x-auto">
            <table class="w-full text-left bg-dark/50 rounded-lg overflow-hidden">
              <thead class="bg-gradient-to-r from-primary to-accent">
                <tr class="text-dark font-gaming">
                  <th class="py-4 px-4 font-bold">Rank</th>
                  <th class="py-4 px-4 font-bold">Student</th>
                  <th class="py-4 px-4 font-bold">Total Points</th>
                  <th class="py-4 px-4 font-bold">Sessions</th>
                  <th class="py-4 px-4 font-bold">Avg Accuracy</th>
                  <th class="py-4 px-4 font-bold">Courses</th>
                  <th class="py-4 px-4 font-bold">Department</th>
                </tr>
              </thead>
              <tbody>
        `;

        data.forEach((entry, index) => {
          const rank = index + 1;
          let rankBadge = '';
          let rowClass = 'border-b border-light/30 hover:bg-light/20 transition-colors';
          
          if (rank === 1) {
            rankBadge = 'ğŸ‘‘';
            rowClass += ' bg-gradient-to-r from-yellow-400/10 to-yellow-600/10';
          } else if (rank === 2) {
            rankBadge = 'ğŸ¥ˆ';
            rowClass += ' bg-gradient-to-r from-gray-300/10 to-gray-500/10';
          } else if (rank === 3) {
            rankBadge = 'ğŸ¥‰';
            rowClass += ' bg-gradient-to-r from-orange-400/10 to-orange-600/10';
          }

          const playerNameHtml = `
            <button class="player-name-link text-primary hover:text-accent underline cursor-pointer font-medium transition-colors" 
                    onclick="showPlayerProfile('${entry.studentId}')">
              ${entry.name}
            </button>
          `;

          const coursesHtml = `
            <div class="text-center">
              <span class="text-accent font-bold">${entry.completedCourses}/${entry.totalCourses}</span>
              <div class="text-xs text-gray-400">${entry.completionPercentage}%</div>
            </div>
          `;

          html += `
            <tr class="${rowClass}">
              <td class="py-3 px-4">
                <div class="flex items-center space-x-2">
                  <span class="font-gaming font-bold text-primary">#${rank}</span>
                  <span class="text-lg">${rankBadge}</span>
                </div>
              </td>
              <td class="py-3 px-4">
                <div>
                  ${playerNameHtml}
                  <div class="text-xs text-gray-400">
                    ${entry.strand ? `${entry.strand}` : ''}${entry.strand && entry.year ? ' - ' : ''}${entry.year ? `${entry.year}` : ''}${!entry.strand && !entry.year && entry.strandYear ? entry.strandYear : ''}
                  </div>
                </div>
              </td>
              <td class="py-3 px-4">
                <span class="font-gaming font-bold text-primary text-lg">${entry.score.toLocaleString()}</span>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="font-gaming text-accent">${entry.totalSessions}</span>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="font-gaming text-cyan">${entry.averageAccuracy}%</span>
              </td>
              <td class="py-3 px-4">
                ${coursesHtml}
              </td>
              <td class="py-3 px-4">
                <span class="text-sm text-gray-300">${entry.department}</span>
              </td>
            </tr>
          `;
        });

        html += '</tbody></table></div>';
        container.innerHTML = html;
      }

      // Enhanced Player Cards with Career Stats
      function renderPlayerCards(data) {
        console.log('renderPlayerCards called with career stats data:', data);
        const container = document.getElementById('player-cards-grid');
        const loading = document.getElementById('player-cards-loading');
        
        if (!container) {
          console.error('ERROR: player-cards-grid element not found!');
          return;
        }
        
        if (!data || data.length === 0) {
          console.log('No career stats data for cards');
          if (loading) {
            loading.innerHTML = '<p class="text-gray-400 text-center font-gaming">No students with career stats found</p>';
            loading.style.display = 'block';
          }
          return;
        }
        
        console.log('Rendering', Math.min(data.length, 3), 'career stats cards');
        // Hide loading and show cards
        if (loading) {
          loading.style.display = 'none';
        }
        
        // Take only top 3 players for featured cards
        const topPlayers = data.slice(0, 3);
        
        let cardsHtml = '';
        topPlayers.forEach((player, index) => {
          // Safe name handling
          let playerName = player.name || 'Unknown Student';
          
          // Safe initials generation
          let initials = '??';
          try {
            if (playerName && typeof playerName === 'string' && playerName.trim().length > 0) {
              const words = playerName.trim().split(' ').filter(word => word.length > 0);
              if (words.length > 0) {
                initials = words.map(word => word[0] ? word[0].toUpperCase() : '').join('').substring(0, 2);
                if (!initials || initials.length === 0) initials = playerName.substring(0, 2).toUpperCase();
              }
            }
          } catch (e) {
            console.warn('Error generating initials:', e);
            initials = '??';
          }
          
          // Special styling for each position
          let cardStyle, rankIcon, rankColor;
          if (index === 0) {
            cardStyle = 'from-yellow-400/20 to-yellow-600/20';
            rankIcon = 'ğŸ‘‘';
            rankColor = 'from-yellow-400 to-yellow-600';
          } else if (index === 1) {
            cardStyle = 'from-gray-300/20 to-gray-500/20';
            rankIcon = 'ğŸ¥ˆ';
            rankColor = 'from-gray-300 to-gray-500';
          } else {
            cardStyle = 'from-orange-400/20 to-orange-600/20';
            rankIcon = 'ğŸ¥‰';
            rankColor = 'from-orange-400 to-orange-600';
          }
          
          cardsHtml += `
            <div class="relative group cursor-pointer transform transition-all duration-300 hover:scale-105" onclick="showPlayerProfile('${player.studentId}')">
              <div class="neon-border bg-gradient-to-br ${cardStyle} rounded-lg p-6 backdrop-blur-sm relative overflow-hidden">
                <!-- Rank Badge -->
                <div class="absolute -top-3 -right-3 w-12 h-12 bg-gradient-to-br ${rankColor} rounded-full flex items-center justify-center text-lg font-bold text-white border-3 border-white shadow-xl z-10">
                  ${rankIcon}
                </div>
                
                <!-- Player Avatar -->
                <div class="flex flex-col items-center mb-4">
                  <div class="w-20 h-20 bg-gradient-to-br from-primary to-accent rounded-full flex items-center justify-center text-2xl font-bold text-dark mb-3 border-3 border-primary/50 shadow-lg">
                    ${initials}
                  </div>
                  <div class="text-center">
                    <h3 class="font-gaming text-primary text-lg font-bold">${playerName}</h3>
                    <p class="text-gray-400 text-sm">${player.department || 'Unknown'}</p>
                  </div>
                </div>
                
                <!-- Enhanced Player Stats -->
                <div class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300 text-sm font-gaming">Career Points</span>
                    <span class="text-primary font-gaming font-bold text-lg">${(player.score || 0).toLocaleString()}</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300 text-sm font-gaming">Global Rank</span>
                    <span class="text-accent font-gaming font-bold text-lg">#${index + 1}</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300 text-sm font-gaming">Sessions</span>
                    <span class="text-cyan font-gaming font-bold">${player.totalSessions || 0}</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300 text-sm font-gaming">Accuracy</span>
                    <span class="text-purple font-gaming font-bold">${player.averageAccuracy || 0}%</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300 text-sm font-gaming">Courses</span>
                    <span class="text-orange-400 font-gaming font-bold">${player.completedCourses}/${player.totalCourses}</span>
                  </div>
                </div>
                
                <!-- Course Progress Bar -->
                <div class="mt-4">
                  <div class="flex justify-between text-xs text-gray-400 mb-1">
                    <span>Course Progress</span>
                    <span>${player.completionPercentage}%</span>
                  </div>
                  <div class="w-full bg-gray-700 rounded-full h-2">
                    <div class="bg-gradient-to-r from-accent to-cyan h-2 rounded-full transition-all duration-300" style="width: ${player.completionPercentage}%"></div>
                  </div>
                </div>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = cardsHtml;
      }

      // Enhanced Fetch Leaderboard using Career Stats
      async function fetchLeaderboard(filter) {
        try {
          console.log('Starting fetchLeaderboard with filter:', filter);
          
          // Load career stats data using the new function
          const careerStatsData = await loadCareerStatsData(filter);
          
          console.log(`Loaded ${careerStatsData.length} career stats entries for filter:`, filter);
          
          // Render results
          console.log('Calling renderPlayerCards with top 3...');
          renderPlayerCards(careerStatsData.slice(0, 3));
          
          console.log('Calling renderLeaderboard with career stats data...');
          renderLeaderboard(careerStatsData);
          
        } catch (error) {
          console.error('Error fetching career stats leaderboard:', error);
          console.error('Error details:', error.message);
          
          // Show error message
          const leaderboardList = document.getElementById('leaderboard-list');
          if (leaderboardList) {
            leaderboardList.innerHTML = `<div class="text-center py-8 text-red-400">âš ï¸ Database error: ${error.message}</div>`;
          }
          
          // Show error in player cards
          const loading = document.getElementById('player-cards-loading');
          if (loading) {
            loading.innerHTML = `<p class="text-red-400 text-center font-gaming">Database Error: ${error.message}</p>`;
            loading.style.display = 'block';
          }
        }
      }

      // Filter button logic
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('bg-primary', 'text-dark'));
          this.classList.add('bg-primary', 'text-dark');
          fetchLeaderboard(this.dataset.filter);
        });
      });

      // Initial load: overall
      fetchLeaderboard('overall');

      // Add missing functions for leaderboard API
      async function addScore(userId, playerName, score, department = 'Unknown', gameData = {}) {
        try {
          const scoreData = {
            name: playerName,
            score: score,
            department: department,
            timestamp: Date.now(),
            submissionDate: new Date().toISOString(),
            gameData: gameData
          };

          await db.ref('leaderboards/' + userId).set(scoreData);
          console.log('Score added successfully:', scoreData);
          return { success: true, data: scoreData };
        } catch (error) {
          console.error('Error adding score:', error);
          throw error;
        }
      }

      async function updateBestScore(userId, playerName, score, department = 'Unknown', gameData = {}) {
        try {
          const snapshot = await db.ref('leaderboards/' + userId).once('value');
          const existingData = snapshot.val();
          
          if (!existingData || score > existingData.score) {
            await addScore(userId, playerName, score, department, gameData);
            return { 
              success: true, 
              isNewBest: true, 
              previousBest: existingData ? existingData.score : 0,
              newBest: score
            };
          } else {
            return {
              success: true,
              isNewBest: false,
              currentBest: existingData.score,
              submittedScore: score
            };
          }
        } catch (error) {
          console.error('Error updating best score:', error);
          throw error;
        }
      }

      async function getPlayerBestScore(userId) {
        try {
          const snapshot = await db.ref('leaderboards/' + userId).once('value');
          const data = snapshot.val();
          return data ? data.score : 0;
        } catch (error) {
          console.error('Error getting player best score:', error);
          return 0;
        }
      }

      // Make functions globally accessible for game integration
      window.leaderboardAPI = {
        addScore,
        updateBestScore,
        getPlayerBestScore,
        fetchLeaderboard
      };

      // Enhanced Player Profile with Career Stats
      async function showPlayerProfile(userId) {
        console.log('Loading career stats profile for user:', userId);
        
        // Show modal with animation
        const modal = document.getElementById('player-profile-modal');
        modal.classList.remove('hidden');
        
        // Add modal enter animation to the modal content
        const modalContent = modal.querySelector('.neon-border');
        if (modalContent) {
          modalContent.classList.add('modal-enter');
        }
        
        // Show loading state
        document.getElementById('profile-content').innerHTML = `
          <div class="text-center py-8">
            <div class="flex flex-col items-center space-y-4">
              <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
              <p class="text-gray-300 font-gaming">Loading warrior profile...</p>
            </div>
          </div>
        `;
        
        try {
          // Fetch career stats data
          const careerStatsSnapshot = await db.ref('student_career_stats/' + userId).once('value');
          const careerStatsData = careerStatsSnapshot.val();
          
          if (careerStatsData && careerStatsData.careerStats && careerStatsData.studentInfo) {
            await renderPlayerProfileWithCareerStats(careerStatsData, userId);
          } else {
            document.getElementById('profile-content').innerHTML = `
              <div class="text-center py-8">
                <div class="text-red-400 font-gaming text-lg">âš ï¸ Career stats not found</div>
                <p class="text-gray-400 mt-2">This student might not have completed any quiz sessions yet.</p>
              </div>
            `;
          }
        } catch (error) {
          console.error('Error loading career stats profile:', error);
          document.getElementById('profile-content').innerHTML = `
            <div class="text-center py-8">
              <div class="text-red-400 font-gaming text-lg">âš ï¸ Error loading profile</div>
              <p class="text-gray-400 mt-2">${error.message}</p>
            </div>
          `;
        }
      }

      function closePlayerProfile() {
        document.getElementById('player-profile-modal').classList.add('hidden');
      }

      // Function to calculate player rankings
      async function calculatePlayerRankings(studentId, currentPlayerScore, currentPlayerDepartment) {
        try {
          // Load all career stats data for ranking calculation
          const allCareerStatsData = await loadCareerStatsData('overall');
          
          // Calculate global rank
          const globalRank = allCareerStatsData.findIndex(player => player.studentId === studentId) + 1;
          
          // Calculate department rank
          const departmentPlayers = allCareerStatsData.filter(player => 
            player.department === currentPlayerDepartment
          );
          const departmentRank = departmentPlayers.findIndex(player => player.studentId === studentId) + 1;
          
          return {
            globalRank: globalRank > 0 ? globalRank : '?',
            departmentRank: departmentRank > 0 ? departmentRank : '?'
          };
        } catch (error) {
          console.error('Error calculating rankings:', error);
          return {
            globalRank: '?',
            departmentRank: '?'
          };
        }
      }

      // New Enhanced Player Profile with Career Stats
      async function renderPlayerProfileWithCareerStats(careerStatsData, studentId) {
        const career = careerStatsData.careerStats;
        const info = careerStatsData.studentInfo;
        const recentSessions = careerStatsData.recentSessions || {};
        
        // Generate avatar initials
        let initials = '??';
        const fullName = info.fullName || 'Unknown Student';
        if (fullName && fullName.trim().length > 0) {
          const words = fullName.trim().split(' ').filter(word => word.length > 0);
          if (words.length > 0) {
            initials = words.map(word => word[0] ? word[0].toUpperCase() : '').join('').substring(0, 2);
          }
        }
        
        // Calculate course completion stats
        const completionStatus = career.courseCompletionStatus || {};
        const totalCourses = Object.keys(completionStatus).length;
        const completedCourses = Object.values(completionStatus).filter(Boolean).length;
        const completionPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;
        
        // Format department display
        let department = 'Unknown';
        if (careerStatsData.department) {
          department = careerStatsData.department;
        }
        
        // Update header information
        document.getElementById('player-avatar').textContent = initials;
        document.getElementById('profile-player-name').textContent = fullName;
        document.getElementById('profile-department').innerHTML = `
          <span class="inline-block w-6 h-4 bg-primary rounded shadow"></span>
          ${department}
        `;
        
        // Calculate and update rankings dynamically
        const rankings = await calculatePlayerRankings(studentId, career.totalPoints || 0, department);
        document.getElementById('global-rank').textContent = '#' + rankings.globalRank;
        document.getElementById('dept-rank').textContent = '#' + rankings.departmentRank;
        
        // Update stats with career data
        document.getElementById('ranked-score').textContent = (career.totalPoints || 0).toLocaleString();
        document.getElementById('accuracy').textContent = (career.averageAccuracy || 0).toFixed(1) + '%';
        document.getElementById('quiz-count').textContent = career.totalSessions || 0;
        document.getElementById('total-score').textContent = (career.totalPoints || 0).toLocaleString();
        document.getElementById('total-questions').textContent = career.totalQuestions || 0;
        document.getElementById('max-combo').textContent = career.highestStreak || 0;
        document.getElementById('total-playtime').textContent = formatPlayTime(career.totalPlayTime || 0);
        
        // Generate level badges based on career achievements
        generateLevelBadges(career.totalSessions || 0);
        
        // Create enhanced profile content with career stats
        const content = document.getElementById('profile-content');
        content.innerHTML = `
          <!-- Course Completion Progress -->
          <div class="bg-cardBg p-6 rounded-lg neon-border">
            <h3 class="text-xl font-bold text-primary mb-4 flex items-center gap-2 font-gaming">
              <span class="text-primary">ğŸ“</span>
              Course Completion Progress
            </h3>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-4">
              ${generateCourseCompletionBadges(completionStatus)}
            </div>
            <div class="mt-4">
              <div class="flex justify-between text-sm text-gray-400 mb-2">
                <span>Overall Progress</span>
                <span>${completedCourses}/${totalCourses} courses (${completionPercentage}%)</span>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-3">
                <div class="bg-gradient-to-r from-accent to-cyan h-3 rounded-full transition-all duration-300" style="width: ${completionPercentage}%"></div>
              </div>
            </div>
          </div>

          <!-- Career Statistics Overview -->
          <div class="grid lg:grid-cols-2 gap-6">
            <!-- Career Performance Chart -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-accent mb-4 font-gaming">Career Performance</h3>
              <div class="relative h-64 mb-4 bg-dark/50 rounded-lg flex items-center justify-center overflow-hidden">
                <canvas id="careerChart" class="max-w-full max-h-full"></canvas>
                <div id="careerChartFallback" class="text-gray-400 text-center absolute inset-0 flex flex-col items-center justify-center">
                  <div class="text-4xl mb-2">ğŸ“ˆ</div>
                  <div>Loading performance chart...</div>
                </div>
              </div>
              <div class="text-sm text-gray-300 text-center">
                Total Sessions: ${career.totalSessions || 0} â€¢ Best Streak: ${career.highestStreak || 0}
              </div>
            </div>

            <!-- Recent Session Activity -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-cyan mb-4 font-gaming">Recent Activity</h3>
              <div class="space-y-3 max-h-64 overflow-y-auto">
                ${generateRecentSessionsDisplay(recentSessions)}
              </div>
            </div>
          </div>

          <!-- Detailed Career Statistics -->
          <div class="grid lg:grid-cols-2 gap-6">
            <!-- Performance Metrics -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-purple mb-4 font-gaming">Performance Metrics</h3>
              <div class="relative h-64 mb-4 bg-dark/50 rounded-lg flex items-center justify-center overflow-hidden">
                <canvas id="performanceRadar" class="max-w-full max-h-full"></canvas>
                <div id="radarChartFallback" class="text-gray-400 text-center absolute inset-0 flex flex-col items-center justify-center">
                  <div class="text-4xl mb-2">ğŸ¯</div>
                  <div>Loading skill assessment...</div>
                </div>
              </div>
              <div class="text-sm text-gray-300 text-center">
                Comprehensive skill assessment
              </div>
            </div>

            <!-- Course Progress Breakdown -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-primary mb-4 font-gaming">Course Progress</h3>
              <div class="space-y-3">
                ${generateCourseProgressBars(completionStatus, career)}
              </div>
            </div>
          </div>

          <!-- Career Summary -->
          <div class="bg-cardBg p-6 rounded-lg neon-border">
            <h3 class="text-lg font-semibold text-cyan mb-4 font-gaming">Career Summary</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-primary font-gaming">${(career.totalPoints || 0).toLocaleString()}</div>
                <div class="text-sm text-gray-400">Total Points</div>
              </div>
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-accent font-gaming">${career.totalSessions || 0}</div>
                <div class="text-sm text-gray-400">Total Sessions</div>
              </div>
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-cyan font-gaming">${(career.averageAccuracy || 0).toFixed(1)}%</div>
                <div class="text-sm text-gray-400">Average Accuracy</div>
              </div>
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-purple font-gaming">${career.highestStreak || 0}</div>
                <div class="text-sm text-gray-400">Best Streak</div>
              </div>
            </div>
          </div>
        `;
        
        // Initialize charts with career stats data
        setTimeout(() => {
          console.log('â° Chart initialization timeout triggered');
          console.log('ğŸ“Š Chart data check - career:', career);
          console.log('âœ… Chart data check - completionStatus:', completionStatus);
          initializeCareerStatsCharts(career, completionStatus, recentSessions);
        }, 100);
      }

      function renderPlayerProfile(playerData) {
        // Restore sanitized Firebase keys if they exist
        const gameData = playerData.gameData || {};
        const topicPoints = restoreFirebaseKeys(gameData.topicPoints || {});
        
        // Calculate additional stats
        const submissionDate = playerData.submissionDate ? new Date(playerData.submissionDate).toLocaleDateString() : 'Unknown';
        const playTimeFormatted = formatPlayTime(gameData.playTime || 0);
        
        // Calculate derived statistics
        const totalTopicPoints = Object.values(topicPoints).reduce((sum, points) => sum + points, 0);
        const averageTopicScore = totalTopicPoints > 0 ? Math.round(totalTopicPoints / Object.keys(topicPoints).length) : 0;
        const estimatedQuizCount = Math.floor(totalTopicPoints / 100) || 1; // Estimate based on points
        const estimatedTotalQuestions = estimatedQuizCount * 10; // Estimate 10 questions per quiz
        const estimatedAccuracy = Math.min(95, Math.max(60, 70 + (playerData.score / 100))); // Estimate accuracy
        const maxCombo = Math.floor(playerData.score / 50) || 1; // Estimate max combo
        
        // Generate avatar initials
        const initials = playerData.name.split(' ').map(word => word[0]).join('').substring(0, 2).toUpperCase();
        
        // Update header information
        document.getElementById('player-avatar').textContent = initials;
        document.getElementById('profile-player-name').textContent = playerData.name;
        document.getElementById('profile-department').innerHTML = `
          <span class="inline-block w-6 h-4 bg-primary rounded shadow"></span>
          ${playerData.department || 'Unknown'}
        `;
        
        // Update rankings (calculate proper rankings based on score)
        // For now, use a simple approximation until we can get proper user ID
        const estimatedGlobalRank = Math.max(1, Math.floor((5000 - playerData.score) / 10) + 1);
        const estimatedDeptRank = Math.max(1, Math.floor((2000 - playerData.score) / 15) + 1);
        document.getElementById('global-rank').textContent = '#' + estimatedGlobalRank;
        document.getElementById('dept-rank').textContent = '#' + estimatedDeptRank;
        
        // Update stats
        document.getElementById('ranked-score').textContent = playerData.score.toLocaleString();
        document.getElementById('accuracy').textContent = estimatedAccuracy.toFixed(1) + '%';
        document.getElementById('quiz-count').textContent = estimatedQuizCount;
        document.getElementById('total-score').textContent = (gameData.totalPoints || playerData.score).toLocaleString();
        document.getElementById('total-questions').textContent = estimatedTotalQuestions;
        document.getElementById('max-combo').textContent = maxCombo;
        document.getElementById('total-playtime').textContent = playTimeFormatted;
        
        // Generate level badges
        generateLevelBadges(gameData.achievementCount || 0);
        
        // Update main content area
        const content = document.getElementById('profile-content');
        content.innerHTML = `
          <!-- Badges Section -->
          <div class="bg-cardBg p-6 rounded-lg neon-border">
            <h3 class="text-xl font-bold text-primary mb-4 flex items-center gap-2 font-gaming">
              <span class="text-primary">ğŸ†</span>
              Badges & Achievements
            </h3>
            <div id="badges-container" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 min-h-[100px]">
              ${generateAchievementBadges(gameData.achievementCount || 0)}
            </div>
            ${(gameData.achievementCount || 0) === 0 ? '<p class="text-gray-400 text-center mt-4">No badges earned yet. Keep playing to unlock achievements!</p>' : ''}
          </div>

          <!-- Performance Charts Section -->
          <div class="grid lg:grid-cols-2 gap-6">
            <!-- Topic Performance Chart -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-accent mb-4 font-gaming">Topic Performance</h3>
              ${Object.keys(topicPoints).length > 0 ? `
                <div class="relative h-64 mb-4 bg-white rounded-lg p-4">
                  <canvas id="topicChart"></canvas>
                </div>
                <div class="text-sm text-gray-300 text-center">
                  Best Topic: ${getBestTopic(topicPoints)} â€¢ Average: ${averageTopicScore} pts
                </div>
              ` : `
                <div class="h-64 flex items-center justify-center text-gray-400">
                  <div class="text-center">
                    <div class="text-4xl mb-2">ğŸ“Š</div>
                    <div>No topic data available</div>
                  </div>
                </div>
              `}
            </div>

            <!-- Score Analysis Chart -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-cyan mb-4 font-gaming">Score Analysis</h3>
              <div class="relative h-64 mb-4 bg-white rounded-lg p-4">
                <canvas id="scoreChart"></canvas>
              </div>
              <div class="text-sm text-gray-300 text-center">
                Total Contribution Analysis
              </div>
            </div>
          </div>

          <!-- Detailed Statistics -->
          <div class="grid lg:grid-cols-2 gap-6">
            <!-- Performance Metrics -->
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-purple mb-4 font-gaming">Performance Radar</h3>
              <div class="relative h-64 mb-4 bg-white rounded-lg p-4">
                <canvas id="radarChart"></canvas>
              </div>
              <div class="text-sm text-gray-300 text-center">
                Overall performance across all metrics
              </div>
            </div>

            <!-- Course Progress -->
            ${gameData.courseProgress ? `
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-primary mb-4 font-gaming">Course Progress</h3>
              <div class="relative h-64 mb-4 bg-white rounded-lg p-4">
                <canvas id="progressChart"></canvas>
              </div>
              <div class="text-sm text-gray-300 text-center">
                ${formatCourseProgress(gameData.courseProgress)}
              </div>
            </div>
            ` : `
            <div class="bg-cardBg p-6 rounded-lg neon-border">
              <h3 class="text-lg font-semibold text-accent mb-4 font-gaming">Recent Activity</h3>
              <div class="space-y-3">
                <div class="flex items-center gap-3 p-3 bg-dark/50 rounded neon-border">
                  <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-dark font-bold">
                    ${playerData.score >= 1000 ? 'S' : playerData.score >= 500 ? 'A' : 'B'}
                  </div>
                  <div>
                    <div class="font-medium text-primary">Best Score Achieved</div>
                    <div class="text-sm text-gray-400">${submissionDate} â€¢ ${playerData.score} points</div>
                  </div>
                </div>
                <div class="text-center text-gray-400 mt-4">
                  More activity data will appear as you play more games!
                </div>
              </div>
            </div>
            `}
          </div>

          <!-- Topic Breakdown Table -->
          ${Object.keys(topicPoints).length > 0 ? `
          <div class="bg-cardBg p-6 rounded-lg neon-border">
            <h3 class="text-lg font-semibold text-primary mb-4 font-gaming">Topic Performance Breakdown</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="border-b border-primary/30">
                    <th class="text-left py-2 px-4 text-primary font-gaming">Topic</th>
                    <th class="text-center py-2 px-4 text-accent font-gaming">Score</th>
                    <th class="text-center py-2 px-4 text-cyan font-gaming">Percentage</th>
                    <th class="text-center py-2 px-4 text-purple font-gaming">Rank</th>
                  </tr>
                </thead>
                <tbody>
                  ${Object.entries(topicPoints)
                    .sort(([,a], [,b]) => b - a)
                    .map(([topic, points], index) => `
                    <tr class="border-b border-primary/20 hover:bg-dark/30">
                      <td class="py-3 px-4">
                        <div class="flex items-center gap-2">
                          <div class="w-3 h-3 rounded-full" style="background-color: ${getTopicColor(topic)}"></div>
                          <span class="font-medium text-gray-200">${formatTopicName(topic)}</span>
                        </div>
                      </td>
                      <td class="text-center py-3 px-4 font-bold text-primary">${points}</td>
                      <td class="text-center py-3 px-4 text-gray-300">${((points / totalTopicPoints) * 100).toFixed(1)}%</td>
                      <td class="text-center py-3 px-4">
                        <span class="inline-block px-2 py-1 rounded text-sm ${index === 0 ? 'bg-primary/20 text-primary' : index < 3 ? 'bg-accent/20 text-accent' : 'bg-gray-600/20 text-gray-300'}">
                          #${index + 1}
                        </span>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
          ` : ''}

          <!-- Player Statistics Summary -->
          <div class="bg-cardBg p-6 rounded-lg neon-border">
            <h3 class="text-lg font-semibold text-cyan mb-4 font-gaming">Player Summary</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-primary font-gaming">${playerData.score}</div>
                <div class="text-sm text-gray-400">Highest Score</div>
              </div>
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-accent font-gaming">${gameData.achievementCount || 0}</div>
                <div class="text-sm text-gray-400">Achievements</div>
              </div>
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-cyan font-gaming">${Object.keys(topicPoints).length}</div>
                <div class="text-sm text-gray-400">Topics Mastered</div>
              </div>
              <div class="bg-dark/50 p-4 rounded text-center neon-border">
                <div class="text-2xl font-bold text-purple font-gaming">${playTimeFormatted}</div>
                <div class="text-sm text-gray-400">Time Invested</div>
              </div>
            </div>
          </div>
        `;

        // Create charts after DOM is updated
        setTimeout(() => {
          createPlayerCharts(playerData, topicPoints, gameData);
        }, 100);
      }

      // Chart Creation Functions

      function createPlayerCharts(playerData, topicPoints, gameData) {
        // Create Topic Performance Chart (Doughnut)
        if (Object.keys(topicPoints).length > 0) {
          createTopicChart(topicPoints);
        }

        // Create Score Analysis Chart (Bar)
        createScoreChart(playerData, gameData);

        // Create Course Progress Chart (if data available)
        if (gameData.courseProgress) {
          createProgressChart(gameData.courseProgress);
        }

        // Create Performance Radar Chart
        createRadarChart(playerData, gameData, topicPoints);
      }

      function createTopicChart(topicPoints) {
        const ctx = document.getElementById('topicChart');
        if (!ctx) return;

        const topics = Object.keys(topicPoints);
        const scores = Object.values(topicPoints);
        
        // Generate colors for each topic
        const colors = generateChartColors(topics.length);

        const chart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: topics.map(topic => formatTopicName(topic)),
            datasets: [{
              data: scores,
              backgroundColor: colors.backgrounds,
              borderColor: colors.borders,
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 15,
                  usePointStyle: true
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${value} pts (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      }

      function createScoreChart(playerData, gameData) {
        const ctx = document.getElementById('scoreChart');
        if (!ctx) return;

        // Create score breakdown data
        const totalScore = playerData.score;
        const achievementBonus = (gameData.achievementCount || 0) * 100; // Estimate
        const baseScore = totalScore - achievementBonus;
        const timeBonus = Math.max(0, totalScore * 0.1); // Estimate

        const chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Base Score', 'Achievement Bonus', 'Time Bonus'],
            datasets: [{
              label: 'Score Breakdown',
              data: [baseScore, achievementBonus, timeBonus],
              backgroundColor: [
                'rgba(244, 206, 20, 0.8)',   // primary
                'rgba(55, 151, 119, 0.8)',   // accent
                'rgba(69, 71, 75, 0.8)'      // dark
              ],
              borderColor: [
                'rgb(244, 206, 20)',
                'rgb(55, 151, 119)',
                'rgb(69, 71, 75)'
              ],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.parsed.y} points`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Points'
                }
              }
            }
          }
        });
      }

      function createProgressChart(courseProgress) {
        const ctx = document.getElementById('progressChart');
        if (!ctx) return;

        const courses = Object.keys(courseProgress);
        const completed = courses.map(course => courseProgress[course] ? 1 : 0);
        
        const chart = new Chart(ctx, {
          type: 'polarArea',
          data: {
            labels: courses.map(course => formatCourseName(course)),
            datasets: [{
              data: completed,
              backgroundColor: completed.map(status => 
                status ? 'rgba(55, 151, 119, 0.7)' : 'rgba(231, 76, 60, 0.7)'
              ),
              borderColor: completed.map(status => 
                status ? 'rgb(55, 151, 119)' : 'rgb(231, 76, 60)'
              ),
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 10,
                  usePointStyle: true
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const status = context.parsed ? 'Completed' : 'In Progress';
                    return `${context.label}: ${status}`;
                  }
                }
              }
            },
            scales: {
              r: {
                display: false
              }
            }
          }
        });
      }

      function createRadarChart(playerData, gameData, topicPoints) {
        const ctx = document.getElementById('radarChart');
        if (!ctx) return;

        // Normalize values to 0-10 scale for radar chart
        const maxScore = Math.max(playerData.score, 1000);
        const maxAchievements = Math.max(gameData.achievementCount || 1, 10);
        const maxPlayTime = Math.max(gameData.playTime || 1, 7200); // 2 hours max
        const maxTopics = Math.max(Object.keys(topicPoints).length, 6);

        const normalizedScore = (playerData.score / maxScore) * 10;
        const normalizedAchievements = ((gameData.achievementCount || 0) / maxAchievements) * 10;
        const normalizedPlayTime = ((gameData.playTime || 0) / maxPlayTime) * 10;
        const normalizedTopics = (Object.keys(topicPoints).length / maxTopics) * 10;
        const normalizedConsistency = Object.keys(topicPoints).length > 0 ? 
          (Math.min(...Object.values(topicPoints)) / Math.max(...Object.values(topicPoints))) * 10 : 0;

        const chart = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: ['Score', 'Achievements', 'Experience', 'Diversity', 'Consistency'],
            datasets: [{
              label: 'Performance Metrics',
              data: [normalizedScore, normalizedAchievements, normalizedPlayTime, normalizedTopics, normalizedConsistency],
              backgroundColor: 'rgba(244, 206, 20, 0.2)',
              borderColor: 'rgb(244, 206, 20)',
              borderWidth: 2,
              pointBackgroundColor: 'rgb(244, 206, 20)',
              pointBorderColor: '#fff',
              pointHoverBackgroundColor: '#fff',
              pointHoverBorderColor: 'rgb(244, 206, 20)'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              r: {
                beginAtZero: true,
                max: 10,
                ticks: {
                  display: false
                }
              }
            }
          }
        });
      }

      // Utility Functions for Charts
      function generateChartColors(count) {
        const baseColors = [
          { bg: 'rgba(244, 206, 20, 0.8)', border: 'rgb(244, 206, 20)' },   // primary
          { bg: 'rgba(55, 151, 119, 0.8)', border: 'rgb(55, 151, 119)' },   // accent
          { bg: 'rgba(69, 71, 75, 0.8)', border: 'rgb(69, 71, 75)' },       // dark
          { bg: 'rgba(52, 152, 219, 0.8)', border: 'rgb(52, 152, 219)' },   // blue
          { bg: 'rgba(155, 89, 182, 0.8)', border: 'rgb(155, 89, 182)' },   // purple
          { bg: 'rgba(231, 76, 60, 0.8)', border: 'rgb(231, 76, 60)' },     // red
        ];

        const backgrounds = [];
        const borders = [];

        for (let i = 0; i < count; i++) {
          const colorIndex = i % baseColors.length;
          backgrounds.push(baseColors[colorIndex].bg);
          borders.push(baseColors[colorIndex].border);
        }

        return { backgrounds, borders };
      }

      function formatCourseName(course) {
        return course.replace(/_/g, ' ')
                    .replace(/\b\w/g, l => l.toUpperCase());
      }

      // Additional helper functions for osu!-style profile
      function generateLevelBadges(achievementCount) {
        const levelContainer = document.getElementById('level-badges');
        levelContainer.innerHTML = '';
        
        // Generate level badges based on achievement count
        const levels = ['D', 'C', 'B', 'A', 'S', 'SS'];
        const currentLevel = Math.min(Math.floor(achievementCount / 2), levels.length - 1);
        
        for (let i = 0; i <= currentLevel; i++) {
          const badge = document.createElement('div');
          badge.className = `w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold ${
            i === currentLevel ? 'bg-primary' : 'bg-accent'
          }`;
          badge.textContent = levels[i];
          levelContainer.appendChild(badge);
        }
      }

      function generateAchievementBadges(achievementCount) {
        if (achievementCount === 0) {
          return `
            <div class="col-span-full flex items-center justify-center py-8 text-gray-400">
              <div class="text-center">
                <div class="text-4xl mb-2">ğŸ†</div>
                <div>No badges yet</div>
                <div class="text-sm">Complete challenges to earn badges!</div>
              </div>
            </div>
          `;
        }

        const badges = [
          { name: 'First Steps', icon: 'ğŸ‘¶', description: 'Completed first quiz', color: 'bg-blue-500' },
          { name: 'Dedicated', icon: 'â°', description: 'Played for 1 hour', color: 'bg-green-500' },
          { name: 'Scholar', icon: 'ğŸ“š', description: 'Earned 1000 points', color: 'bg-purple-500' },
          { name: 'Combo Master', icon: 'ğŸ”¥', description: 'Achieved 50+ combo', color: 'bg-red-500' },
          { name: 'Multi-talented', icon: 'ğŸŒŸ', description: 'Mastered 3+ topics', color: 'bg-yellow-500' },
          { name: 'Perfectionist', icon: 'ğŸ’¯', description: 'Perfect quiz score', color: 'bg-pink-500' },
          { name: 'Speed Demon', icon: 'âš¡', description: 'Lightning fast answers', color: 'bg-indigo-500' },
          { name: 'Persistent', icon: 'ğŸ’ª', description: 'Completed 10+ quizzes', color: 'bg-teal-500' },
          { name: 'Top Scorer', icon: 'ğŸ†', description: 'Reached leaderboard top 10', color: 'bg-orange-500' },
          { name: 'Legend', icon: 'ğŸ‘‘', description: 'Ultimate achievement', color: 'bg-gradient-to-r from-yellow-400 to-orange-500' }
        ];

        let badgeHTML = '';
        const earnedBadges = badges.slice(0, Math.min(achievementCount, badges.length));
        
        earnedBadges.forEach(badge => {
          badgeHTML += `
            <div class="group relative">
              <div class="w-16 h-16 ${badge.color} rounded-lg flex items-center justify-center text-white text-2xl shadow-lg transform transition-transform group-hover:scale-110 cursor-pointer">
                ${badge.icon}
              </div>
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10">
                <div class="font-bold">${badge.name}</div>
                <div>${badge.description}</div>
              </div>
            </div>
          `;
        });

        // Add placeholder badges for future achievements
        const remainingSlots = Math.max(0, 6 - earnedBadges.length);
        for (let i = 0; i < remainingSlots; i++) {
          badgeHTML += `
            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-xl border-2 border-dashed border-gray-300">
              ğŸ”’
            </div>
          `;
        }

        return badgeHTML;
      }

      function getBestTopic(topicPoints) {
        if (Object.keys(topicPoints).length === 0) return 'None';
        const [bestTopic] = Object.entries(topicPoints).reduce((a, b) => a[1] > b[1] ? a : b);
        return formatTopicName(bestTopic);
      }

      function getTopicColor(topic) {
        const colors = {
          'python': '#3776ab',
          'java': '#f89820',
          'C': '#00599c',
          'C++': '#00599c',
          'C_plus_plus_': '#00599c',
          'C#': '#239120',
          'C_sharp_': '#239120',
          'csharp': '#239120',
          'webdesign': '#e34c26',
          'webDesign': '#e34c26',
          'javascript': '#f7df1e',
          'html': '#e34c26',
          'css': '#1572b6'
        };
        return colors[topic] || '#6b7280';
      }
      function restoreFirebaseKeys(obj) {
        if (!obj || typeof obj !== 'object') return {};
        
        const restored = {};
        for (const [key, value] of Object.entries(obj)) {
          const restoredKey = key
            .replace(/_sharp_/g, '#')
            .replace(/_plus_/g, '+')
            .replace(/_dot_/g, '.')
            .replace(/_dollar_/g, '$')
            .replace(/_slash_/g, '/')
            .replace(/_lbracket_/g, '[')
            .replace(/_rbracket_/g, ']');
          
          restored[restoredKey] = value;
        }
        return restored;
      }

      function formatTopicName(topic) {
        // Convert topic names to readable format
        const topicMap = {
          'C': 'C Programming',
          'C++': 'C++',
          'C#': 'C#',
          'csharp': 'C#',
          'java': 'Java',
          'python': 'Python',
          'webdesign': 'Web Design',
          'webDesign': 'Web Design'
        };
        return topicMap[topic] || topic.charAt(0).toUpperCase() + topic.slice(1);
      }

      function formatPlayTime(seconds) {
        if (!seconds || seconds === 0) return 'No data';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        
        if (hours > 0) {
          return `${hours}h ${minutes}m`;
        } else if (minutes > 0) {
          return `${minutes}m`;
        } else {
          return `${seconds}s`;
        }
      }

      function formatCourseProgress(progress) {
        if (!progress || typeof progress !== 'object') return 'No data';
        
        const completed = Object.values(progress).filter(Boolean).length;
        const total = Object.keys(progress).length;
        
        if (total === 0) return 'No data';
        
        const percentage = Math.round((completed / total) * 100);
        return `${completed}/${total} courses (${percentage}%)`;
      }

      // Close modal when clicking outside
      document.getElementById('player-profile-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closePlayerProfile();
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closePlayerProfile();
        }
      });

      // Test functions for the buttons
      function testUpdateBestScore() {
        const userId = 'testUser_' + Date.now();
        const name = 'Test Player';
        const score = Math.floor(Math.random() * 5000) + 1000; // Random score between 1000-6000
        const department = 'College of Computer Studies';
        
        updateBestScore(userId, name, score, department).then(result => {
          showInfo(`Test Result: ${result.isNewBest ? 'New Best Score!' : 'Score not better than existing'}\nScore: ${score}`, {
            title: 'Test Result'
          });
          fetchLeaderboard('overall'); // Refresh the display
        }).catch(error => {
          showError('Error: ' + error.message, { title: 'Test Error' });
        });
      }

      function testGameIntegration() {
        // Simulate what the game would send
        const score = Math.floor(Math.random() * 10000) + 1500;
        const gameData = {
          userId: 'game_player_' + Date.now(),
          playerName: 'Advanced Player',
          score: score,
          department: 'College of Computer Studies',
          gameStats: {
            totalQuizzes: 12,
            correctAnswers: 89,
            comboScore: 25,
            playTime: 4800, // 80 minutes
            topicPoints: {
              'python': Math.floor(score * 0.28),
              'java': Math.floor(score * 0.24),
              'C_sharp_': Math.floor(score * 0.20), // Sanitized C# key
              'webdesign': Math.floor(score * 0.15),
              'C': Math.floor(score * 0.08),
              'C_plus_plus_': Math.floor(score * 0.05)
            },
            achievementCount: 9,
            courseProgress: {
              'intro_to_programming': true,
              'data_structures': true,
              'web_development': true,
              'algorithms': true,
              'advanced_topics': Math.random() > 0.5,
              'software_engineering': Math.random() > 0.3,
              'machine_learning': Math.random() > 0.8
            }
          }
        };
        
        console.log('Simulating game integration with data:', gameData);
        
        // Use addScore with enhanced data structure
        const userId = gameData.userId;
        const scoreData = {
          name: gameData.playerName,
          score: gameData.score,
          department: gameData.department,
          timestamp: Date.now(),
          submissionDate: new Date().toISOString(),
          gameData: {
            totalPoints: gameData.score,
            topicPoints: gameData.gameStats.topicPoints,
            achievementCount: gameData.gameStats.achievementCount,
            playTime: gameData.gameStats.playTime,
            courseProgress: gameData.gameStats.courseProgress
          }
        };
        
        db.ref('leaderboards/' + userId).set(scoreData)
          .then(() => {
            console.log('Game integration successful:', scoreData);
            showSuccess(`Game Integration Test: Advanced player created!\nScore: ${gameData.score}\nClick the player name to view detailed profile with charts.`, {
              title: 'ğŸ® Game Integration Test'
            });
            fetchLeaderboard('overall');
          })
          .catch(error => {
            console.error('Game integration error:', error);
            showError('Integration Error: ' + error.message, { title: 'Integration Error' });
          });
      }

      // Function to test student score submission (for development)
      async function testStudentScore(studentId, score) {
        try {
          // Check if student exists first
          const studentsSnapshot = await db.ref('students').orderByChild('studentId').equalTo(studentId).once('value');
          
          if (!studentsSnapshot.exists()) {
            console.error('Student not found:', studentId);
            showWarning(`Student ${studentId} not found in the database. Please create the student first using developer tools.`, {
              title: 'Student Not Found'
            });
            return;
          }
          
          const studentData = Object.values(studentsSnapshot.val())[0];
          
          await addScore(studentId, studentData.name, score, 'Test Department');
          console.log(`Score ${score} submitted for student ${studentId}`);
          showSuccess(`Score submitted successfully for ${studentData.name}!`, {
            title: 'Score Submitted'
          });
          fetchLeaderboard('overall');
        } catch (error) {
          console.error('Error testing student score:', error);
          showError('Error: ' + error.message, { title: 'Submission Error' });
        }
      }

      // Helper Functions for Career Stats Display
      
      function generateCourseCompletionBadges(completionStatus) {
        const courses = {
          python: { name: 'Python', color: 'bg-blue-500', icon: 'ğŸ' },
          java: { name: 'Java', color: 'bg-orange-500', icon: 'â˜•' },
          csharp: { name: 'C#', color: 'bg-purple-500', icon: 'ğŸ’' },
          cpp: { name: 'C++', color: 'bg-green-500', icon: 'âš¡' },
          c: { name: 'C', color: 'bg-gray-500', icon: 'ğŸ”§' },
          webdesign: { name: 'Web Design', color: 'bg-pink-500', icon: 'ğŸ¨' }
        };
        
        return Object.entries(courses).map(([courseKey, course]) => {
          const isCompleted = completionStatus[courseKey] || false;
          return `
            <div class="bg-dark/50 p-3 rounded-lg text-center transition-all duration-300 ${isCompleted ? 'neon-border-success' : 'neon-border opacity-50'}">
              <div class="text-2xl mb-1">${course.icon}</div>
              <div class="text-xs font-gaming text-gray-300">${course.name}</div>
              <div class="text-xs mt-1 ${isCompleted ? 'text-green-400' : 'text-gray-500'}">
                ${isCompleted ? 'âœ… Complete' : 'â³ Pending'}
              </div>
            </div>
          `;
        }).join('');
      }
      
      function generateCourseProgressBars(completionStatus, careerStats = null) {
        const courses = {
          python: { name: 'Python Programming', color: 'bg-blue-400' },
          java: { name: 'Java Development', color: 'bg-orange-400' },
          csharp: { name: 'C# Programming', color: 'bg-purple-400' },
          cpp: { name: 'C++ Programming', color: 'bg-green-400' },
          c: { name: 'C Programming', color: 'bg-gray-400' },
          webdesign: { name: 'Web Design', color: 'bg-pink-400' }
        };
        
        return Object.entries(courses).map(([courseKey, course]) => {
          const isCompleted = completionStatus[courseKey] || false;
          let percentage = 0;
          let statusText = 'Not Started';
          let sessionsInfo = '';
          
          // Calculate actual progress based on sessions
          if (careerStats && careerStats.coursesCompleted) {
            // Look for the course by key or by formatted name
            const courseData = careerStats.coursesCompleted[courseKey] || 
                              careerStats.coursesCompleted[course.name] ||
                              careerStats.coursesCompleted[course.name.toLowerCase()];
                              
            if (courseData && courseData.completedCount > 0) {
              const sessionsCompleted = courseData.completedCount;
              // Assume 3 intensities = 100% completion, but show progress even for partial completion
              percentage = isCompleted ? 100 : Math.min((sessionsCompleted / 3) * 100, 90); // Cap at 90% unless fully completed
              
              sessionsInfo = `${sessionsCompleted} session${sessionsCompleted > 1 ? 's' : ''} completed`;
              
              if (isCompleted) {
                statusText = '100% Complete';
              } else if (sessionsCompleted >= 2) {
                statusText = `${Math.round(percentage)}% (Intensity ${sessionsCompleted})`;
              } else {
                statusText = `${Math.round(percentage)}% (Intensity ${sessionsCompleted})`;
              }
            }
          } else if (isCompleted) {
            percentage = 100;
            statusText = '100% Complete';
          }
          
          const progressColor = isCompleted ? 'text-green-400' : percentage > 0 ? 'text-yellow-400' : 'text-gray-500';
          
          return `
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-gray-300">${course.name}</span>
                <span class="${progressColor}">${statusText}</span>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-2">
                <div class="${course.color} h-2 rounded-full transition-all duration-300" style="width: ${percentage}%"></div>
              </div>
              ${sessionsInfo ? `<div class="text-xs text-gray-400">${sessionsInfo}</div>` : ''}
            </div>
          `;
        }).join('');
      }
      
      function generateRecentSessionsDisplay(recentSessions) {
        if (!recentSessions || Object.keys(recentSessions).length === 0) {
          return `
            <div class="text-center text-gray-400 py-8">
              <div class="text-4xl mb-2">ğŸ“š</div>
              <div>No recent sessions</div>
              <div class="text-sm">Complete some quizzes to see activity here!</div>
            </div>
          `;
        }
        
        // Get the last 5 sessions
        const sessions = Object.entries(recentSessions)
          .sort(([,a], [,b]) => new Date(b.timestamp) - new Date(a.timestamp))
          .slice(0, 5);
        
        return sessions.map(([sessionId, session]) => {
          const date = new Date(session.timestamp).toLocaleDateString();
          const accuracy = session.accuracyPercentage || 0;
          const scoreColor = accuracy >= 80 ? 'text-green-400' : accuracy >= 60 ? 'text-yellow-400' : 'text-red-400';
          
          // Use courseTopic instead of course, and format it nicely
          const courseName = session.courseTopic || 'Unknown';
          const formattedCourseName = formatCourseName(courseName);
          
          return `
            <div class="flex items-center gap-3 p-3 bg-dark/50 rounded neon-border">
              <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-dark font-bold">
                ${formattedCourseName.charAt(0).toUpperCase()}
              </div>
              <div class="flex-1">
                <div class="font-medium text-primary">${formattedCourseName}</div>
                <div class="text-xs text-gray-400">${date} â€¢ ${(session.correctAnswers || 0) + (session.wrongAnswers || 0)} questions</div>
              </div>
              <div class="text-right">
                <div class="font-bold ${scoreColor}">${accuracy.toFixed(1)}%</div>
                <div class="text-xs text-gray-400">${session.totalScore || 0} pts</div>
              </div>
            </div>
          `;
        }).join('');
      }
      
      function initializeCareerStatsCharts(career, completionStatus, recentSessions) {
        console.log('ğŸ¨ Initializing lightweight custom charts...');
        console.log('ğŸ“Š Career data:', career);
        
        // Create Career Performance Line Chart
        createCareerLineChart(career);
        
        // Create Performance Radar Chart
        createPerformanceRadarChart(career, completionStatus);
        
        console.log('âœ… Custom charts initialized');
      }

      // Lightweight Line Chart for Career Performance
      function createCareerLineChart(career) {
        const canvas = document.getElementById('careerChart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const container = canvas.parentElement;
        
        // Set canvas size to match container with proper centering
        const containerRect = container.getBoundingClientRect();
        const size = Math.min(containerRect.width, containerRect.height) * 0.9; // 90% of container
        
        canvas.width = size * window.devicePixelRatio;
        canvas.height = size * window.devicePixelRatio;
        canvas.style.width = size + 'px';
        canvas.style.height = size + 'px';
        
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        
        const width = size;
        const height = size;
        const padding = 30;
        
        // Clear canvas
        ctx.clearRect(0, 0, width, height);
        
        // Chart data
        const totalPoints = career.totalPoints || 0;
        const data = [
          0,
          Math.floor(totalPoints * 0.2),
          Math.floor(totalPoints * 0.5),
          Math.floor(totalPoints * 0.8),
          totalPoints
        ];
        const labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Current'];
        
        const maxValue = Math.max(...data) || 100;
        
        // Draw background
        ctx.fillStyle = 'rgba(26, 26, 46, 0.8)';
        ctx.fillRect(0, 0, width, height);
        
        // Draw grid lines
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.lineWidth = 1;
        
        for (let i = 0; i <= 4; i++) {
          const y = padding + (i * (height - 2 * padding)) / 4;
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(width - padding, y);
          ctx.stroke();
        }
        
        // Draw data line
        ctx.strokeStyle = '#00ff88';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        for (let i = 0; i < data.length; i++) {
          const x = padding + (i * (width - 2 * padding)) / (data.length - 1);
          const y = height - padding - (data[i] / maxValue) * (height - 2 * padding);
          
          if (i === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        }
        ctx.stroke();
        
        // Draw data points
        ctx.fillStyle = '#00ff88';
        for (let i = 0; i < data.length; i++) {
          const x = padding + (i * (width - 2 * padding)) / (data.length - 1);
          const y = height - padding - (data[i] / maxValue) * (height - 2 * padding);
          
          ctx.beginPath();
          ctx.arc(x, y, 4, 0, 2 * Math.PI);
          ctx.fill();
        }
        
        // Draw labels
        ctx.fillStyle = '#ffffff';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        
        for (let i = 0; i < labels.length; i++) {
          const x = padding + (i * (width - 2 * padding)) / (labels.length - 1);
          ctx.fillText(labels[i], x, height - 10);
        }
        
        // Draw values
        ctx.textAlign = 'left';
        for (let i = 0; i <= 4; i++) {
          const value = Math.round((maxValue * (4 - i)) / 4);
          const y = padding + (i * (height - 2 * padding)) / 4;
          ctx.fillText(value.toString(), 5, y + 4);
        }
        
        // Hide fallback
        const fallback = document.getElementById('careerChartFallback');
        if (fallback) fallback.style.display = 'none';
        
        console.log('âœ… Career line chart created');
      }

      // Lightweight Radar Chart for Performance Metrics
      function createPerformanceRadarChart(career, completionStatus) {
        const canvas = document.getElementById('performanceRadar');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const container = canvas.parentElement;
        
        // Set canvas size to match container with proper centering
        const containerRect = container.getBoundingClientRect();
        const size = Math.min(containerRect.width, containerRect.height) * 0.9; // 90% of container
        
        canvas.width = size * window.devicePixelRatio;
        canvas.height = size * window.devicePixelRatio;
        canvas.style.width = size + 'px';
        canvas.style.height = size + 'px';
        
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        
        const width = size;
        const height = size;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = Math.min(width, height) / 2 - 30;
        
        // Clear canvas
        ctx.clearRect(0, 0, width, height);
        
        // Chart data
        const completedCourses = Object.values(completionStatus).filter(Boolean).length;
        const totalCourses = Object.keys(completionStatus).length;
        const completionPercentage = totalCourses > 0 ? (completedCourses / totalCourses) * 100 : 0;
        
        const data = [
          career.averageAccuracy || 0,
          Math.min(100, (career.totalSessions || 0) * 10),
          Math.min(100, (career.highestStreak || 0) * 5),
          completedCourses * 16.67,
          completionPercentage
        ];
        
        const labels = ['Accuracy', 'Speed', 'Consistency', 'Difficulty', 'Completion'];
        const angles = labels.map((_, i) => (i * 2 * Math.PI) / labels.length - Math.PI / 2);
        
        // Draw background
        ctx.fillStyle = 'rgba(26, 26, 46, 0.8)';
        ctx.fillRect(0, 0, width, height);
        
        // Draw grid circles
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.lineWidth = 1;
        
        for (let i = 1; i <= 5; i++) {
          ctx.beginPath();
          ctx.arc(centerX, centerY, (radius * i) / 5, 0, 2 * Math.PI);
          ctx.stroke();
        }
        
        // Draw grid lines
        for (let i = 0; i < angles.length; i++) {
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.lineTo(
            centerX + Math.cos(angles[i]) * radius,
            centerY + Math.sin(angles[i]) * radius
          );
          ctx.stroke();
        }
        
        // Draw data area
        ctx.fillStyle = 'rgba(0, 255, 136, 0.2)';
        ctx.strokeStyle = '#00ff88';
        ctx.lineWidth = 2;
        
        ctx.beginPath();
        for (let i = 0; i < data.length; i++) {
          const value = data[i] / 100; // Normalize to 0-1
          const x = centerX + Math.cos(angles[i]) * radius * value;
          const y = centerY + Math.sin(angles[i]) * radius * value;
          
          if (i === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        }
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        
        // Draw data points
        ctx.fillStyle = '#00ff88';
        for (let i = 0; i < data.length; i++) {
          const value = data[i] / 100;
          const x = centerX + Math.cos(angles[i]) * radius * value;
          const y = centerY + Math.sin(angles[i]) * radius * value;
          
          ctx.beginPath();
          ctx.arc(x, y, 3, 0, 2 * Math.PI);
          ctx.fill();
        }
        
        // Draw labels
        ctx.fillStyle = '#ffffff';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        
        for (let i = 0; i < labels.length; i++) {
          const labelRadius = radius + 20;
          const x = centerX + Math.cos(angles[i]) * labelRadius;
          const y = centerY + Math.sin(angles[i]) * labelRadius;
          
          ctx.fillText(labels[i], x, y + 4);
        }
        
        // Hide fallback
        const fallback = document.getElementById('radarChartFallback');
        if (fallback) fallback.style.display = 'none';
        
        console.log('âœ… Performance radar chart created');
      }

      // Enhanced API for external access
      window.leaderboardAPI = {
        loadCareerStatsData,
        fetchLeaderboard,
        showPlayerProfile: showPlayerProfile
      };

      // Make test function available globally
      window.testStudentScore = testStudentScore;

      // Mobile menu functionality
      document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
      });
    </script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="public/assets/img/logo/SCI-HIGH_LOGO.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCI-HIGH: Professor Dashboard</title>
    <!-- Last updated: August 8, 2025 - Force GitHub Pages refresh -->
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Modern Notification System -->
    <script src="../js/notifications.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script>
      // Fallback functions in case notifications.js hasn't loaded yet
      window.ensureNotifications = function() {
        if (typeof window.modernConfirm === 'undefined') {
          console.warn('Notification system not loaded, using fallback');
          window.modernConfirm = function(message, options = {}) {
            return Promise.resolve(confirm(message));
          };
          window.modernAlert = function(message, options = {}) {
            alert(message);
            return Promise.resolve(true);
          };
          window.showSuccess = function(message, options = {}) {
            alert('âœ… ' + message);
            return Promise.resolve(true);
          };
          window.showError = function(message, options = {}) {
            alert('âŒ ' + message);
            return Promise.resolve(true);
          };
          window.showWarning = function(message, options = {}) {
            alert('âš ï¸ ' + message);
            return Promise.resolve(true);
          };
          window.showInfo = function(message, options = {}) {
            alert('â„¹ï¸ ' + message);
            return Promise.resolve(true);
          };
        }
      };
      
      // Ensure notifications are available immediately
      window.ensureNotifications();
    </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F4CE14',
              accent: '#379777',
              dark: '#1a1a2e',
              light: '#16213e',
              purple: '#9c27b0',
              cyan: '#00bcd4',
              textColor: '#ffffff',
              cardBg: 'rgba(22, 33, 62, 0.8)',
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace'],
              body: ['Exo 2', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      .game-bg {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
      }
      
      .neon-border {
        border: 2px solid #F4CE14;
        background: rgba(22, 33, 62, 0.8);
        box-shadow: 0 0 10px rgba(244, 206, 20, 0.3);
      }
    </style>
  </head>
  <body class="font-body game-bg text-textColor min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-dark/90 to-light/90 backdrop-blur-md border-b-2 border-primary/30 py-4">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <img src="../public/assets/img/buko_productions-logo.png" alt="SCI-HIGH Logo" class="w-10 h-10 sm:w-12 sm:h-12" />
            <span class="font-gaming text-lg sm:text-xl font-bold text-primary hidden sm:inline">Professor Dashboard</span>
            <span class="font-gaming text-sm font-bold text-primary sm:hidden">Professor</span>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="text-textColor hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex items-center space-x-4">
            <span class="text-gray-300 text-sm lg:text-base" id="professor-name">Loading...</span>
            <button id="logout-btn" class="px-3 sm:px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-gaming text-sm transition-colors">
              Logout
            </button>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-light/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <div class="px-4 py-3 text-gray-300 font-gaming text-sm bg-dark/30 rounded-lg border border-gray-600" id="mobile-professor-name">Loading...</div>
            <button id="mobile-logout-btn" class="block w-full text-left px-4 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-gaming text-sm transition-colors">
              <span class="flex items-center">
                <span class="mr-2">ğŸšª</span> Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8">
      <!-- Dashboard Header -->
      <div class="mb-6 sm:mb-8">
        <h1 class="font-gaming text-2xl sm:text-4xl font-bold text-primary mb-2">Student Management</h1>
        <p class="text-gray-300 text-sm sm:text-base">View and manage your students' progress</p>
      </div>

      <!-- Quick Actions -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <button id="view-analytics-btn" class="neon-border bg-cardBg rounded-lg p-4 hover:scale-105 transition-transform">
          <div class="text-2xl mb-2">ï¿½</div>
          <div class="font-gaming text-primary">Analytics</div>
        </button>
        <button id="export-data-btn" class="neon-border bg-cardBg rounded-lg p-4 hover:scale-105 transition-transform">
          <div class="text-2xl mb-2">ï¿½</div>
          <div class="font-gaming text-accent">Export Data</div>
        </button>
        <button id="refresh-students-btn" class="neon-border bg-cardBg rounded-lg p-4 hover:scale-105 transition-transform">
          <div class="text-2xl mb-2">ğŸ”„</div>
          <div class="font-gaming text-cyan">Refresh</div>
        </button>
      </div>

      <!-- Student List -->
      <div class="neon-border bg-cardBg rounded-xl p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="font-gaming text-2xl text-primary">Student List</h2>
          <div class="flex space-x-4">
            <input type="search" id="search-students" placeholder="Search students..." 
                   class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white placeholder-gray-400">
            <select id="filter-strand" class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white">
              <option value="">All Strands/Courses</option>
              <option value="ICT">ICT</option>
              <option value="BSCS">BSCS</option>
              <option value="BSIT">BSIT</option>
              <option value="STEM">STEM</option>
              <option value="ABM">ABM</option>
              <option value="HUMSS">HUMSS</option>
            </select>
            <select id="filter-year" class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white">
              <option value="">All Years</option>
              <option value="1st">1st Year</option>
              <option value="2nd">2nd Year</option>
              <option value="3rd">3rd Year</option>
              <option value="4th">4th Year</option>
              <option value="5th">5th Year</option>
              <option value="Grade 11">Grade 11</option>
              <option value="Grade 12">Grade 12</option>
            </select>
            <select id="sort-by" class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white">
              <option value="name">Sort by Name</option>
              <option value="studentId">Sort by Student ID</option>
              <option value="progress">Sort by Progress</option>
              <option value="lastActive">Sort by Last Active</option>
              <option value="points">Sort by Points</option>
            </select>
          </div>
        </div>

        <!-- Student Table -->
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
              <tr class="border-b border-gray-600">
                <th class="py-3 px-4 font-gaming text-primary">Student ID</th>
                <th class="py-3 px-4 font-gaming text-primary">Name</th>
                <th class="py-3 px-4 font-gaming text-primary">Course/Strand</th>
                <th class="py-3 px-4 font-gaming text-primary">Year Level</th>
                <th class="py-3 px-4 font-gaming text-primary">Progress</th>
                <th class="py-3 px-4 font-gaming text-primary">Last Active</th>
                <th class="py-3 px-4 font-gaming text-primary">Actions</th>
              </tr>
            </thead>
            <tbody id="students-table-body">
              <tr>
                <td colspan="7" class="py-8 text-center text-gray-400">
                  Loading students...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Information Panel -->
    <div class="mb-8 neon-border bg-cardBg rounded-xl p-6">
      <div class="text-center">
        <div class="text-4xl mb-4">ğŸ“‹</div>
        <h3 class="font-gaming text-lg text-accent mb-3">How Student Accounts Work</h3>
        <p class="text-gray-300 text-sm mb-4">
          Students create their own accounts automatically by entering their Student ID. 
          You can view and manage existing students below.
        </p>
        <div class="text-xs text-gray-400 bg-dark/50 rounded-lg p-3 max-w-md mx-auto">
          <p class="mb-2">â„¹ï¸ <strong>How it works:</strong></p>
          <p>â€¢ Students enter their ID on the login page</p>
          <p>â€¢ New accounts are created automatically</p>
          <p>â€¢ Students can continue their progress seamlessly</p>
        </div>
      </div>
    </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      class ProfessorDashboard {
        constructor() {
          this.students = [];
          this.filteredStudents = [];
          this.currentUser = null;
          this.database = null;
          this.isFirebaseInitialized = false;
          this.init();
        }

        async init() {
          // Initialize Firebase first
          await this.initializeFirebase();
          
          // Check if user is authenticated professor or admin
          const savedUser = localStorage.getItem('sci_high_user');
          if (!savedUser) {
            window.location.href = 'index.html';
            return;
          }

          this.currentUser = JSON.parse(savedUser);
          if (!this.currentUser || (this.currentUser.type !== 'professor' && this.currentUser.type !== 'admin')) {
            window.location.href = 'index.html';
            return;
          }

          this.setupUI();
          this.setupEventListeners();
          await this.loadStudents();
        }

        setupUI() {
          document.getElementById('professor-name').textContent = this.currentUser.profile.fullName;
        }

        setupEventListeners() {
          // Logout
          document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('sci_high_user');
            sessionStorage.removeItem('sci_high_authenticated');
            sessionStorage.removeItem('sci_high_user_type');
            window.location.href = 'index.html';
          });

          // Quick action buttons  
          document.getElementById('view-analytics-btn').addEventListener('click', () => {
            this.showInfo('Analytics dashboard coming soon!');
          });

          document.getElementById('export-data-btn').addEventListener('click', () => {
            this.showInfo('Data export feature coming soon!');
          });

          document.getElementById('refresh-students-btn').addEventListener('click', () => {
            this.loadStudents();
            this.showSuccess('Student list refreshed!');
          });

          // Search and filter
          document.getElementById('search-students').addEventListener('input', (e) => {
            this.filterStudents();
          });

          document.getElementById('filter-strand').addEventListener('change', (e) => {
            this.filterStudents();
          });

          document.getElementById('filter-year').addEventListener('change', (e) => {
            this.filterStudents();
          });

          document.getElementById('sort-by').addEventListener('change', (e) => {
            this.filterStudents();
          });
        }

        async initializeFirebase() {
          try {
            const firebaseConfig = {
              apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
              authDomain: "sci-high-website.firebaseapp.com",
              databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
              projectId: "sci-high-website",
              storageBucket: "sci-high-website.appspot.com",
              messagingSenderId: "451463202515",
              appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
            };

            if (!firebase.apps.length) {
              firebase.initializeApp(firebaseConfig);
            }

            this.database = firebase.database();
            this.isFirebaseInitialized = true;
            console.log('Firebase initialized successfully');
            
            // Monitor connection status
            this.database.ref('.info/connected').on('value', (snapshot) => {
              if (snapshot.val() === true) {
                console.log('Connected to Firebase');
              } else {
                console.log('Disconnected from Firebase');
                this.showWarning('Connection to Firebase lost. Some features may not work properly.');
              }
            });
          } catch (error) {
            console.error('Firebase initialization error:', error);
            this.isFirebaseInitialized = false;
          }
        }

        async loadStudents() {
          try {
            if (!this.isFirebaseInitialized) {
              console.warn('Firebase not initialized, loading sample data');
              this.loadSampleData();
              return;
            }

            console.log('Loading students from Firebase...');
            const studentsRef = this.database.ref('students');
            const snapshot = await studentsRef.once('value');
            const studentsData = snapshot.val();

            if (!studentsData) {
              console.log('No students found in Firebase');
              this.students = [];
              this.filteredStudents = [];
              this.renderStudentsTable();
              return;
            }

            // Convert Firebase data to our format
            this.students = Object.keys(studentsData).map(studentId => {
              const student = studentsData[studentId];
              
              // Parse strand and year from strandYear if needed
              let strand = student.strand;
              let year = student.year;
              
              if (!strand && !year && student.strandYear) {
                const parseResult = this.parseStrandYear(student.strandYear);
                strand = parseResult.strand;
                year = parseResult.year;
              }

              return {
                id: studentId,
                studentId: student.studentId || studentId,
                fullName: `${student.firstName || ''} ${student.lastName || ''}`.trim() || 'Unknown',
                academicInfo: {
                  level: student.department === 'College Department' ? 'college' : 'shs',
                  strand: strand || 'N/A',
                  year: year || 'N/A',
                  course: student.strandYear || 'N/A', // Legacy field
                  yearLevel: student.strandYear || 'N/A', // Legacy field
                  department: student.department || 'N/A'
                },
                accountStatus: {
                  createdBy: 'system',
                  lastLogin: student.lastLogin || null,
                  isFirstLogin: !student.lastLogin
                },
                gameData: {
                  totalPoints: student.totalPoints || 0,
                  courseProgress: student.courseProgress || {}
                }
              };
            });

            console.log(`Loaded ${this.students.length} students from Firebase`);
            this.filteredStudents = [...this.students];
            this.renderStudentsTable();

          } catch (error) {
            console.error('Error loading students from Firebase:', error);
            this.showError('Failed to load students from database. Loading sample data instead.');
            this.loadSampleData();
          }
        }

        parseStrandYear(strandYear) {
          let strand = '';
          let year = '';
          
          // Extract year
          const yearMatch = strandYear.match(/(\d+)(st|nd|rd|th)/i);
          if (yearMatch) {
            year = yearMatch[1] + (yearMatch[2] || '');
          } else if (strandYear.includes('Grade')) {
            const gradeMatch = strandYear.match(/Grade\s*(\d+)/i);
            if (gradeMatch) {
              year = `Grade ${gradeMatch[1]}`;
            }
          }
          
          // Extract strand
          if (strandYear.includes('BSCS') || strandYear.includes('BS CS') || strandYear.includes('Computer Science')) {
            strand = 'BSCS';
          } else if (strandYear.includes('BSIT') || strandYear.includes('BS IT') || strandYear.includes('Information Technology')) {
            strand = 'BSIT';
          } else if (strandYear.includes('ICT')) {
            strand = 'ICT';
          } else if (strandYear.includes('STEM')) {
            strand = 'STEM';
          } else if (strandYear.includes('ABM')) {
            strand = 'ABM';
          } else if (strandYear.includes('HUMSS')) {
            strand = 'HUMSS';
          }
          
          return { strand, year };
        }

        loadSampleData() {
          // Fallback sample data when Firebase is not available
          this.students = [
            {
              id: 'stud_sample_001',
              studentId: '24-2024-001',
              fullName: 'Juan Dela Cruz',
              academicInfo: {
                level: 'college',
                strand: 'BSCS',
                year: '3rd',
                course: 'BS Computer Science', // Legacy field
                yearLevel: '3rd Year' // Legacy field
              },
              accountStatus: {
                createdBy: 'sample',
                lastLogin: new Date('2024-01-15').toISOString(),
                isFirstLogin: false
              },
              gameData: {
                totalPoints: 850,
                courseProgress: {
                  python: { progress: 75, completed: 8, total: 12 },
                  javascript: { progress: 60, completed: 6, total: 10 }
                }
              }
            },
            {
              id: 'stud_sample_002',
              studentId: '24-2024-002',
              fullName: 'Maria Santos',
              academicInfo: {
                level: 'college',
                strand: 'BSIT',
                year: '2nd',
                course: 'BS Information Technology', // Legacy field
                yearLevel: '2nd Year' // Legacy field
              },
              accountStatus: {
                createdBy: 'sample',
                lastLogin: new Date('2024-01-20').toISOString(),
                isFirstLogin: false
              },
              gameData: {
                totalPoints: 1200,
                courseProgress: {
                  python: { progress: 90, completed: 11, total: 12 },
                  webdesign: { progress: 85, completed: 9, total: 10 }
                }
              }
            }
          ];

          this.filteredStudents = [...this.students];
          this.renderStudentsTable();
        }

        // Methods for student management
        filterStudents() {
          const searchTerm = document.getElementById('search-students').value.toLowerCase();
          const strandFilter = document.getElementById('filter-strand').value;
          const yearFilter = document.getElementById('filter-year').value;
          const sortBy = document.getElementById('sort-by').value;

          this.filteredStudents = this.students.filter(student => {
            const matchesSearch = !searchTerm || 
              student.studentId.toLowerCase().includes(searchTerm) ||
              student.fullName.toLowerCase().includes(searchTerm);
            
            const matchesStrand = !strandFilter || 
              student.academicInfo.strand === strandFilter ||
              (student.academicInfo.course && student.academicInfo.course.includes(strandFilter));

            const matchesYear = !yearFilter || 
              student.academicInfo.year === yearFilter ||
              student.academicInfo.yearLevel === yearFilter ||
              student.academicInfo.yearLevel === `${yearFilter} Year`;

            return matchesSearch && matchesStrand && matchesYear;
          });

          // Sort the filtered results
          this.filteredStudents.sort((a, b) => {
            switch (sortBy) {
              case 'name':
                return a.fullName.localeCompare(b.fullName);
              case 'studentId':
                return a.studentId.localeCompare(b.studentId);
              case 'progress':
                return this.calculateProgress(b) - this.calculateProgress(a); // Descending
              case 'lastActive':
                const aDate = a.accountStatus.lastLogin ? new Date(a.accountStatus.lastLogin) : new Date(0);
                const bDate = b.accountStatus.lastLogin ? new Date(b.accountStatus.lastLogin) : new Date(0);
                return bDate - aDate; // Most recent first
              case 'points':
                const aPoints = a.gameData?.totalPoints || 0;
                const bPoints = b.gameData?.totalPoints || 0;
                return bPoints - aPoints; // Highest first
              default:
                return 0;
            }
          });

          this.renderStudentsTable();
        }

        renderStudentsTable() {
          const tbody = document.getElementById('students-table-body');
          
          if (this.filteredStudents.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="7" class="py-8 text-center text-gray-400">
                  No students found
                </td>
              </tr>
            `;
            return;
          }

          tbody.innerHTML = this.filteredStudents.map(student => `
            <tr class="border-b border-gray-700 hover:bg-dark/20">
              <td class="py-3 px-4 font-mono">${student.studentId}</td>
              <td class="py-3 px-4">${student.fullName}</td>
              <td class="py-3 px-4">
                ${student.academicInfo.strand || 
                  (student.academicInfo.level === 'college' ? 
                    student.academicInfo.course : 
                    student.academicInfo.strand)}
              </td>
              <td class="py-3 px-4">
                ${student.academicInfo.year ? `${student.academicInfo.year} Year` : student.academicInfo.yearLevel}
              </td>
              <td class="py-3 px-4">
                <div class="w-full bg-gray-700 rounded-full h-2">
                  <div class="bg-primary h-2 rounded-full" style="width: ${this.calculateProgress(student)}%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-400 mt-1">
                  <span>${this.calculateProgress(student)}%</span>
                  <span>${student.gameData?.totalPoints || 0} pts</span>
                </div>
              </td>
              <td class="py-3 px-4 text-sm text-gray-400">
                ${student.accountStatus.lastLogin ? 
                  new Date(student.accountStatus.lastLogin).toLocaleDateString() : 
                  'Never'}
              </td>
              <td class="py-3 px-4">
                <div class="flex space-x-2">
                  <button onclick="dashboard.viewStudent('${student.id}')" 
                          class="px-2 py-1 bg-cyan text-white text-xs rounded hover:bg-cyan/80">
                    View
                  </button>
                  <button onclick="dashboard.resetProgress('${student.id}')" 
                          class="px-2 py-1 bg-yellow-600 text-white text-xs rounded hover:bg-yellow-700">
                    Reset
                  </button>
                </div>
              </td>
            </tr>
          `).join('');
        }

        calculateProgress(student) {
          if (!student.gameData || !student.gameData.courseProgress) return 0;
          
          const courses = Object.values(student.gameData.courseProgress);
          const totalProgress = courses.reduce((sum, course) => sum + (course.progress || 0), 0);
          return Math.round(totalProgress / courses.length);
        }

        showSuccess(message) {
          showSuccess(message, { title: 'Success' });
        }

        showError(message) {
          showError(message, { title: 'Error' });
        }

        showWarning(message) {
          showWarning(message, { title: 'Warning' });
        }

        showInfo(message) {
          showInfo(message, { title: 'Information' });
        }

        // Global methods for inline onclick handlers
        viewStudent(studentId) {
          const student = this.students.find(s => s.id === studentId);
          if (student) {
            this.showInfo(`Student Details:\n\nName: ${student.fullName}\nID: ${student.studentId}\nStrand: ${student.academicInfo.strand}\nYear: ${student.academicInfo.year}\nTotal Points: ${student.gameData?.totalPoints || 0}\nProgress: ${this.calculateProgress(student)}%`, {
              title: `ğŸ“Š ${student.fullName}'s Profile`
            });
          }
        }

        async resetProgress(studentId) {
          const confirmed = await modernConfirm('Reset all progress for this student? This action cannot be undone.', {
            title: 'Reset Student Progress',
            type: 'warning',
            confirmText: 'Yes, Reset',
            cancelText: 'Cancel'
          });
          
          if (confirmed) {
            try {
              console.log('Resetting progress for student:', studentId);
              
              if (this.isFirebaseInitialized) {
                // Update Firebase
                const studentRef = this.database.ref(`students/${studentId}`);
                await studentRef.update({
                  totalPoints: 0,
                  courseProgress: {},
                  lastUpdated: new Date().toISOString()
                });
                console.log('Firebase update completed');
              }
              
              // Update local data
              const student = this.students.find(s => s.id === studentId);
              if (student) {
                student.gameData = {
                  totalPoints: 0,
                  courseProgress: {}
                };
                this.renderStudentsTable();
              }
              
              this.showSuccess('Student progress has been reset successfully.');
            } catch (error) {
              console.error('Error resetting student progress:', error);
              this.showError('Failed to reset student progress: ' + error.message);
            }
          }
        }

        async resetPassword(studentId) {
          const confirmed = await modernConfirm('Reset password for this student?', {
            title: 'Reset Password',
            type: 'warning',
            confirmText: 'Yes, Reset',
            cancelText: 'Cancel'
          });
          
          if (confirmed) {
            try {
              const newPassword = 'Student123!';
              
              // In production, this would update Firebase
              console.log(`Password reset for student ${studentId}: ${newPassword}`);
              
              this.showSuccess(`Password reset! New password: ${newPassword}`);
            } catch (error) {
              this.showError('Failed to reset password: ' + error.message);
            }
          }
        }
      }

      // Initialize dashboard
      const dashboard = new ProfessorDashboard();
      window.dashboard = dashboard; // Make available for inline handlers

      // Mobile menu functionality
      document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
        
        // Sync mobile menu professor name with desktop
        const syncProfessorName = () => {
          const professorName = document.getElementById('professor-name');
          const mobileProfessorName = document.getElementById('mobile-professor-name');
          
          if (professorName && mobileProfessorName) {
            mobileProfessorName.textContent = professorName.textContent;
          }
        };
        
        // Call sync function periodically
        setInterval(syncProfessorName, 1000);
        syncProfessorName(); // Initial sync
        
        // Mobile logout functionality
        document.getElementById('mobile-logout-btn').addEventListener('click', () => {
          dashboard.logoutUser();
        });
      });
    </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCI-HIGH: Student Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              dark: '#0d1117',
              primary: '#00ff88',
              accent: '#ff6b6b',
              secondary: '#4ecdc4',
              light: '#f8f9fa',
              gray: {
                850: '#1a1d26'
              }
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace']
            }
          }
        }
      }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <style>
      .neon-border {
        border: 2px solid #00ff88;
        box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
      }
      
      .neon-border-accent {
        border: 2px solid #ff6b6b;
        box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
      }
      
      .neon-border-success {
        border: 2px solid #4ade80;
        box-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
      }
      
      .bg-cardBg {
        background: rgba(13, 17, 23, 0.8);
        backdrop-filter: blur(10px);
      }
      
      .gaming-card {
        background: linear-gradient(135deg, rgba(13, 17, 23, 0.9) 0%, rgba(26, 29, 38, 0.9) 100%);
        border: 1px solid rgba(0, 255, 136, 0.3);
        transition: all 0.3s ease;
      }
      
      .gaming-card:hover {
        border-color: #00ff88;
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        transform: translateY(-2px);
      }
      
      .stat-card {
        background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
        border: 1px solid rgba(0, 255, 136, 0.3);
      }
      
      .course-card {
        background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
        border: 1px solid rgba(255, 107, 107, 0.3);
      }
      
      .course-card.completed {
        background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, rgba(74, 222, 128, 0.05) 100%);
        border: 1px solid rgba(74, 222, 128, 0.3);
      }
      
      .progress-bar {
        background: linear-gradient(90deg, #00ff88 0%, #4ecdc4 100%);
      }
      
      body {
        background: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #21262d 100%);
        min-height: 100vh;
      }
    </style>
  </head>
  
  <body class="text-light">
    <!-- Navigation -->
    <nav class="bg-dark/95 backdrop-blur-md border-b border-primary/30 sticky top-0 z-50">
      <div class="container mx-auto px-3 sm:px-4 py-3 sm:py-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <a href="index.html" class="flex items-center space-x-2">
              <div class="w-8 h-8 sm:w-10 sm:h-10 bg-primary rounded-lg flex items-center justify-center">
                <span class="font-gaming font-bold text-dark text-xs sm:text-base">SH</span>
              </div>
              <span class="font-gaming text-sm sm:text-xl font-bold text-primary hidden sm:inline">Student Dashboard</span>
              <span class="font-gaming text-xs font-bold text-primary sm:hidden">Dashboard</span>
            </a>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="p-2 text-light hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300 bg-dark/50 rounded-lg border border-primary/30" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex items-center space-x-4">
            <a href="game.html" class="bg-primary text-dark px-3 sm:px-4 py-2 rounded-lg font-gaming font-bold hover:bg-primary/80 transition-all text-sm lg:text-base">
              Continue Learning
            </a>
            <a href="leaderboards.html" class="text-primary hover:text-accent transition-all font-gaming text-sm lg:text-base">
              Leaderboards
            </a>
            <button id="logout-btn" class="text-gray-400 hover:text-primary transition-all font-gaming text-sm lg:text-base">
              Logout
            </button>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-gray-850/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <a href="game.html" class="block px-4 py-3 text-center bg-primary text-dark font-gaming font-bold hover:bg-primary/80 transition-all rounded-lg shadow-lg">
              <span class="flex items-center justify-center">
                <span class="mr-2">âš¡</span> Continue Learning
              </span>
            </a>
            <a href="leaderboards.html" class="block px-4 py-3 text-primary hover:text-accent hover:bg-primary/10 transition-all font-gaming rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">ğŸ†</span> Leaderboards
              </span>
            </a>
            <button id="mobile-logout-btn" class="block w-full text-left px-4 py-3 text-gray-400 hover:text-red-400 hover:bg-red-500/10 transition-all font-gaming rounded-lg border border-transparent hover:border-red-500/30">
              <span class="flex items-center">
                <span class="mr-2">ğŸšª</span> Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Dashboard Content -->
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-8">
      <!-- Welcome Section -->
      <div class="mb-4 sm:mb-8">
        <div class="gaming-card rounded-xl p-3 sm:p-6">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div class="mb-3 sm:mb-0">
              <h1 class="text-xl sm:text-3xl font-bold text-primary font-gaming mb-1 sm:mb-2">
                Welcome back, <span id="student-name">Student</span>!
              </h1>
              <p class="text-gray-400 font-gaming text-xs sm:text-base">
                Continue your programming journey â€¢ <span id="student-department">Department</span>
              </p>
            </div>
            <div class="text-left sm:text-right">
              <div class="text-lg sm:text-2xl font-bold text-accent font-gaming" id="total-points">0</div>
              <div class="text-xs sm:text-sm text-gray-400">Career Points</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Stats Row -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-6 mb-4 sm:mb-8">
        <div class="stat-card rounded-lg p-4 text-center">
          <div class="text-2xl font-bold text-primary font-gaming" id="total-sessions">0</div>
          <div class="text-sm text-gray-400">Total Sessions</div>
        </div>
        <div class="stat-card rounded-lg p-4 text-center">
          <div class="text-2xl font-bold text-secondary font-gaming" id="average-accuracy">0%</div>
          <div class="text-sm text-gray-400">Average Accuracy</div>
        </div>
        <div class="stat-card rounded-lg p-4 text-center">
          <div class="text-2xl font-bold text-accent font-gaming" id="highest-streak">0</div>
          <div class="text-sm text-gray-400">Best Streak</div>
        </div>
        <div class="stat-card rounded-lg p-4 text-center">
          <div class="text-2xl font-bold text-primary font-gaming" id="courses-completed">0/6</div>
          <div class="text-sm text-gray-400">Courses Completed</div>
        </div>
      </div>

      <!-- Course Progress Section -->
      <div class="grid lg:grid-cols-2 gap-8 mb-8">
        <!-- Course Completion -->
        <div class="gaming-card rounded-lg p-6">
          <h2 class="text-xl font-bold text-primary font-gaming mb-4 flex items-center gap-2">
            <span>ğŸ“</span>
            Course Progress
          </h2>
          <div id="course-progress-grid" class="grid grid-cols-2 gap-4">
            <!-- Courses will be populated here -->
          </div>
          <div class="mt-4">
            <div class="flex justify-between text-sm text-gray-400 mb-2">
              <span>Overall Progress</span>
              <span id="overall-progress-text">0%</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-3">
              <div id="overall-progress-bar" class="progress-bar h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="gaming-card rounded-lg p-6">
          <h2 class="text-xl font-bold text-secondary font-gaming mb-4 flex items-center gap-2">
            <span>ğŸ“ˆ</span>
            Recent Activity
          </h2>
          <div id="recent-activity" class="space-y-3 max-h-80 overflow-y-auto">
            <!-- Recent sessions will be populated here -->
          </div>
        </div>
      </div>

      <!-- Performance Analytics -->
      <div class="grid lg:grid-cols-2 gap-8 mb-8">
        <!-- Performance Chart -->
        <div class="gaming-card rounded-lg p-6">
          <h2 class="text-xl font-bold text-accent font-gaming mb-4 flex items-center gap-2">
            <span>ğŸ“Š</span>
            Performance Trends
          </h2>
          <div class="relative h-64 bg-dark/50 rounded-lg p-4">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>

        <!-- Skills Radar -->
        <div class="gaming-card rounded-lg p-6">
          <h2 class="text-xl font-bold text-primary font-gaming mb-4 flex items-center gap-2">
            <span>ğŸ¯</span>
            Skills Assessment
          </h2>
          <div class="relative h-64 bg-dark/50 rounded-lg p-4">
            <canvas id="skillsRadar"></canvas>
          </div>
        </div>
      </div>

      <!-- Achievement Showcase -->
      <div class="gaming-card rounded-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-secondary font-gaming mb-4 flex items-center gap-2">
          <span>ğŸ†</span>
          Recent Achievements
        </h2>
        <div id="achievements-grid" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4">
          <!-- Achievement badges will be populated here -->
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="grid md:grid-cols-3 gap-6">
        <a href="game.html" class="gaming-card rounded-lg p-6 text-center hover:scale-105 transition-all duration-300">
          <div class="text-4xl mb-3">ğŸ®</div>
          <h3 class="font-gaming text-primary font-bold mb-2">Continue Playing</h3>
          <p class="text-gray-400 text-sm">Resume your programming adventure</p>
        </a>
        
        <a href="leaderboards.html" class="gaming-card rounded-lg p-6 text-center hover:scale-105 transition-all duration-300">
          <div class="text-4xl mb-3">ğŸ†</div>
          <h3 class="font-gaming text-accent font-bold mb-2">View Leaderboards</h3>
          <p class="text-gray-400 text-sm">Compare your progress with others</p>
        </a>
        
        <button onclick="viewFullProfile()" class="gaming-card rounded-lg p-6 text-center hover:scale-105 transition-all duration-300">
          <div class="text-4xl mb-3">ğŸ“‹</div>
          <h3 class="font-gaming text-secondary font-bold mb-2">Full Profile</h3>
          <p class="text-gray-400 text-sm">View detailed statistics</p>
        </button>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-dark/90 flex items-center justify-center z-50">
      <div class="text-center">
        <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-primary font-gaming">Loading your dashboard...</p>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
        authDomain: "sci-high-website.firebaseapp.com",
        databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sci-high-website",
        storageBucket: "sci-high-website.appspot.com",
        messagingSenderId: "451463202515",
        appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const auth = firebase.auth();

      class StudentDashboard {
        constructor() {
          this.currentUser = null;
          this.careerStats = null;
          this.charts = [];
          this.init();
        }

        async init() {
          try {
            // Check authentication state
            await this.checkAuthState();
            
            if (this.currentUser) {
              await this.loadStudentData();
              this.renderDashboard();
              this.initializeCharts();
            } else {
              // Redirect to login if not authenticated
              window.location.href = 'index.html';
            }
            
            this.hideLoading();
          } catch (error) {
            console.error('Error initializing dashboard:', error);
            this.showError('Failed to load dashboard. Please try refreshing.');
            this.hideLoading();
          }
        }

        checkAuthState() {
          return new Promise((resolve) => {
            auth.onAuthStateChanged((user) => {
              this.currentUser = user;
              resolve();
            });
          });
        }

        async loadStudentData() {
          if (!this.currentUser) return;

          try {
            // Load career stats
            const careerStatsRef = db.ref(`student_career_stats/${this.currentUser.uid}`);
            const careerSnapshot = await careerStatsRef.once('value');
            this.careerStats = careerSnapshot.val();

            if (!this.careerStats) {
              console.log('No career stats found, user needs to play the game first');
              this.showError('Please play the game first to see your statistics.');
              return;
            }

            console.log('Loaded career stats:', this.careerStats);
          } catch (error) {
            console.error('Error loading student data:', error);
            throw error;
          }
        }

        renderDashboard() {
          if (!this.careerStats) return;

          const stats = this.careerStats.careerStats || {};
          const info = this.careerStats.studentInfo || {};
          const completionStatus = stats.courseCompletionStatus || {};

          // Update header
          document.getElementById('student-name').textContent = info.fullName || 'Student';
          document.getElementById('student-department').textContent = this.careerStats.department || 'Unknown Department';
          document.getElementById('total-points').textContent = (stats.totalPoints || 0).toLocaleString();

          // Update quick stats
          document.getElementById('total-sessions').textContent = stats.totalSessions || 0;
          document.getElementById('average-accuracy').textContent = `${(stats.averageAccuracy || 0).toFixed(1)}%`;
          document.getElementById('highest-streak').textContent = stats.highestStreak || 0;

          // Update course completion
          const completedCourses = Object.values(completionStatus).filter(Boolean).length;
          const totalCourses = Object.keys(completionStatus).length;
          const completionPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;

          document.getElementById('courses-completed').textContent = `${completedCourses}/${totalCourses}`;
          document.getElementById('overall-progress-text').textContent = `${completionPercentage}%`;
          document.getElementById('overall-progress-bar').style.width = `${completionPercentage}%`;

          // Render course grid
          this.renderCourseProgress(completionStatus);

          // Render recent activity
          this.renderRecentActivity(this.careerStats.recentSessions || {});

          // Render achievements
          this.renderAchievements(stats);
        }

        renderCourseProgress(completionStatus) {
          const courses = {
            python: { name: 'Python', icon: 'ğŸ', color: 'text-blue-400' },
            java: { name: 'Java', icon: 'â˜•', color: 'text-orange-400' },
            csharp: { name: 'C#', icon: 'ğŸ’', color: 'text-purple-400' },
            cpp: { name: 'C++', icon: 'âš¡', color: 'text-green-400' },
            c: { name: 'C', icon: 'ğŸ”§', color: 'text-gray-400' },
            webdesign: { name: 'Web Design', icon: 'ğŸ¨', color: 'text-pink-400' }
          };

          const grid = document.getElementById('course-progress-grid');
          grid.innerHTML = Object.entries(courses).map(([courseKey, course]) => {
            const isCompleted = completionStatus[courseKey] || false;
            return `
              <div class="course-card ${isCompleted ? 'completed' : ''} rounded-lg p-4 text-center transition-all duration-300">
                <div class="text-2xl mb-2">${course.icon}</div>
                <div class="text-sm font-gaming ${course.color} font-bold">${course.name}</div>
                <div class="text-xs mt-1 ${isCompleted ? 'text-green-400' : 'text-gray-500'}">
                  ${isCompleted ? 'âœ… Complete' : 'â³ In Progress'}
                </div>
              </div>
            `;
          }).join('');
        }

        renderRecentActivity(recentSessions) {
          const container = document.getElementById('recent-activity');
          
          if (!recentSessions || Object.keys(recentSessions).length === 0) {
            container.innerHTML = `
              <div class="text-center text-gray-400 py-8">
                <div class="text-4xl mb-2">ğŸ“š</div>
                <div>No recent activity</div>
                <div class="text-sm">Start playing to see your progress here!</div>
              </div>
            `;
            return;
          }

          const sessions = Object.entries(recentSessions)
            .sort(([,a], [,b]) => new Date(b.timestamp) - new Date(a.timestamp))
            .slice(0, 5);

          container.innerHTML = sessions.map(([sessionId, session]) => {
            const date = new Date(session.timestamp).toLocaleDateString();
            const scoreColor = session.score >= 80 ? 'text-green-400' : session.score >= 60 ? 'text-yellow-400' : 'text-red-400';
            
            return `
              <div class="flex items-center gap-3 p-3 bg-dark/50 rounded-lg border border-primary/20">
                <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-dark font-bold">
                  ${session.course ? session.course.charAt(0).toUpperCase() : '?'}
                </div>
                <div class="flex-1">
                  <div class="font-medium text-primary font-gaming">${session.course || 'Unknown Course'}</div>
                  <div class="text-xs text-gray-400">${date} â€¢ ${session.questionsAnswered || 0} questions</div>
                </div>
                <div class="text-right">
                  <div class="font-bold ${scoreColor} font-gaming">${session.score || 0}%</div>
                  <div class="text-xs text-gray-400">${session.points || 0} pts</div>
                </div>
              </div>
            `;
          }).join('');
        }

        renderAchievements(stats) {
          const container = document.getElementById('achievements-grid');
          const achievements = this.generateAchievements(stats);
          
          container.innerHTML = achievements.map(achievement => `
            <div class="gaming-card rounded-lg p-4 text-center ${achievement.unlocked ? 'neon-border-success' : 'opacity-50'}">
              <div class="text-2xl mb-2">${achievement.icon}</div>
              <div class="text-xs font-gaming ${achievement.unlocked ? 'text-green-400' : 'text-gray-500'}">
                ${achievement.name}
              </div>
            </div>
          `).join('');
        }

        generateAchievements(stats) {
          return [
            { name: 'First Steps', icon: 'ğŸ¯', unlocked: (stats.totalSessions || 0) >= 1 },
            { name: 'Getting Started', icon: 'ğŸŒŸ', unlocked: (stats.totalSessions || 0) >= 5 },
            { name: 'Dedicated', icon: 'ğŸ”¥', unlocked: (stats.totalSessions || 0) >= 10 },
            { name: 'Expert', icon: 'ğŸ‘‘', unlocked: (stats.totalSessions || 0) >= 25 },
            { name: 'Accurate', icon: 'ğŸ¯', unlocked: (stats.averageAccuracy || 0) >= 80 },
            { name: 'Perfect', icon: 'ğŸ’', unlocked: (stats.averageAccuracy || 0) >= 95 },
            { name: 'Combo King', icon: 'âš¡', unlocked: (stats.highestStreak || 0) >= 10 },
            { name: 'Unstoppable', icon: 'ğŸš€', unlocked: (stats.highestStreak || 0) >= 20 },
            { name: 'Scholar', icon: 'ğŸ“š', unlocked: (stats.totalPoints || 0) >= 1000 },
            { name: 'Master', icon: 'ğŸ†', unlocked: (stats.totalPoints || 0) >= 5000 }
          ];
        }

        initializeCharts() {
          if (!this.careerStats) return;

          const stats = this.careerStats.careerStats || {};
          const recentSessions = this.careerStats.recentSessions || {};

          // Performance Trends Chart
          this.createPerformanceChart(recentSessions);
          
          // Skills Radar Chart
          this.createSkillsRadar(stats);
        }

        createPerformanceChart(recentSessions) {
          const canvas = document.getElementById('performanceChart');
          if (!canvas) return;

          // Get last 10 sessions for trend
          const sessions = Object.entries(recentSessions)
            .sort(([,a], [,b]) => new Date(a.timestamp) - new Date(b.timestamp))
            .slice(-10);

          const labels = sessions.map((_, index) => `Session ${index + 1}`);
          const scores = sessions.map(([, session]) => session.score || 0);

          const chart = new Chart(canvas, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: 'Score %',
                data: scores,
                borderColor: '#00ff88',
                backgroundColor: 'rgba(0, 255, 136, 0.1)',
                tension: 0.4,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100,
                  grid: { color: 'rgba(255, 255, 255, 0.1)' },
                  ticks: { color: '#fff' }
                },
                x: {
                  grid: { color: 'rgba(255, 255, 255, 0.1)' },
                  ticks: { color: '#fff' }
                }
              }
            }
          });

          this.charts.push(chart);
        }

        createSkillsRadar(stats) {
          const canvas = document.getElementById('skillsRadar');
          if (!canvas) return;

          const completionStatus = stats.courseCompletionStatus || {};
          const completedCount = Object.values(completionStatus).filter(Boolean).length;
          const totalCount = Object.keys(completionStatus).length;

          const chart = new Chart(canvas, {
            type: 'radar',
            data: {
              labels: ['Accuracy', 'Consistency', 'Speed', 'Completion', 'Dedication'],
              datasets: [{
                label: 'Skills',
                data: [
                  Math.min(100, stats.averageAccuracy || 0),
                  Math.min(100, (stats.highestStreak || 0) * 5),
                  Math.min(100, (stats.totalSessions || 0) * 4),
                  totalCount > 0 ? (completedCount / totalCount) * 100 : 0,
                  Math.min(100, (stats.totalSessions || 0) * 2)
                ],
                borderColor: '#00ff88',
                backgroundColor: 'rgba(0, 255, 136, 0.2)',
                pointBackgroundColor: '#00ff88'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false }
              },
              scales: {
                r: {
                  beginAtZero: true,
                  max: 100,
                  grid: { color: 'rgba(255, 255, 255, 0.1)' },
                  angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                  pointLabels: { color: '#fff' },
                  ticks: { color: '#fff', display: false }
                }
              }
            }
          });

          this.charts.push(chart);
        }

        showError(message) {
          console.error(message);
          // Could add a toast notification here
        }

        hideLoading() {
          document.getElementById('loading-overlay').style.display = 'none';
        }

        // Cleanup charts when navigating away
        destroy() {
          this.charts.forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
              chart.destroy();
            }
          });
          this.charts = [];
        }
      }

      // Global functions
      function viewFullProfile() {
        if (dashboard.currentUser) {
          window.open(`leaderboards.html#profile=${dashboard.currentUser.uid}`, '_blank');
        }
      }

      // Logout functionality
      document.getElementById('logout-btn').addEventListener('click', async () => {
        try {
          await auth.signOut();
          window.location.href = 'index.html';
        } catch (error) {
          console.error('Error signing out:', error);
        }
      });

      // Mobile logout functionality
      document.getElementById('mobile-logout-btn').addEventListener('click', async () => {
        try {
          await auth.signOut();
          window.location.href = 'index.html';
        } catch (error) {
          console.error('Error signing out:', error);
        }
      });

      // Mobile menu functionality
      document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
      });

      // Initialize dashboard
      const dashboard = new StudentDashboard();

      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        dashboard.destroy();
      });
    </script>
  </body>
</html>
