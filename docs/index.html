<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="./public/assets/img/logo/SCI-HIGH_LOGO.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>SCI-HIGH: A Byte-Size Learning Adventure!</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Gaming Feel -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Modern Notification System -->
    <script src="js/notifications.js"></script>
    <script>
      // Fallback functions in case notifications.js hasn't loaded yet
      window.ensureNotifications = function() {
        if (typeof window.modernConfirm === 'undefined') {
          console.warn('Notification system not loaded, using fallback');
          window.modernConfirm = function(message, options = {}) {
            return Promise.resolve(confirm(message));
          };
          window.modernAlert = function(message, options = {}) {
            alert(message);
            return Promise.resolve(true);
          };
          window.showSuccess = function(message, options = {}) {
            alert('‚úÖ ' + message);
            return Promise.resolve(true);
          };
          window.showError = function(message, options = {}) {
            alert('‚ùå ' + message);
            return Promise.resolve(true);
          };
          window.showWarning = function(message, options = {}) {
            alert('‚ö†Ô∏è ' + message);
            return Promise.resolve(true);
          };
          window.showInfo = function(message, options = {}) {
            alert('‚ÑπÔ∏è ' + message);
            return Promise.resolve(true);
          };
        }
      };
      
      // Ensure notifications are available immediately
      window.ensureNotifications();
    </script>
    <script>
      tailwind.config = {
        theme: {
          screens: {
            'xs': '475px',
            'sm': '640px',
            'md': '768px',
            'lg': '1024px',
            'xl': '1280px',
            '2xl': '1536px',
          },
          extend: {
            colors: {
              primary: '#F4CE14', // yellow
              accent: '#379777', // green
              dark: '#1a1a2e',   // darker navy
              light: '#16213e',  // dark blue
              purple: '#9c27b0', // gaming purple
              cyan: '#00bcd4',   // gaming cyan
              textColor: '#ffffff',
              cardBg: 'rgba(22, 33, 62, 0.8)',
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace'],
              body: ['Exo 2', 'sans-serif'],
            },
            animation: {
              'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate',
              'float': 'float 6s ease-in-out infinite',
              'slide-in': 'slide-in 0.8s ease-out',
              'bounce-in': 'bounce-in 1s ease-out',
            }
          }
        }
      }
    </script>
    <style>
      @keyframes pulse-glow {
        from { box-shadow: 0 0 20px #F4CE14; }
        to { box-shadow: 0 0 30px #F4CE14, 0 0 40px #F4CE14; }
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      @keyframes slide-in {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes bounce-in {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
      }
      
      .game-bg {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
        position: relative;
        overflow-x: hidden;
      }
      
      .game-bg::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
          radial-gradient(circle at 20% 80%, rgba(244, 206, 20, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(55, 151, 119, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(156, 39, 176, 0.1) 0%, transparent 50%);
        animation: float 8s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
      }
      
      .pixelated {
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }
      
      .neon-border {
        border: 2px solid #F4CE14;
        background: rgba(22, 33, 62, 0.8);
        box-shadow: 0 0 10px rgba(244, 206, 20, 0.3);
      }
      
      /* Custom scrollbar for chat */
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      .scrollbar-thumb-purple {
        scrollbar-color: #9c27b0 #1a1a2e;
      }
      .scrollbar-track-dark {
        scrollbar-color: #9c27b0 #1a1a2e;
      }
      
      /* Enhanced chat button styles */
      .quick-btn, .suggestion-btn {
        white-space: nowrap;
        cursor: pointer;
        user-select: none;
        position: relative;
        z-index: 10;
        min-width: fit-content;
      }
      
      .quick-btn:active, .suggestion-btn:active {
        transform: scale(0.95);
      }
      
      /* Ensure chat panel buttons are always clickable */
      #quick-actions {
        position: relative;
        z-index: 20;
      }
      
      #input-suggestions {
        position: relative;
        z-index: 20;
      }
      
      /* Webkit browsers scrollbar */
      #chat-messages::-webkit-scrollbar {
        width: 6px;
      }
      #chat-messages::-webkit-scrollbar-track {
        background: #1a1a2e;
        border-radius: 3px;
      }
      #chat-messages::-webkit-scrollbar-thumb {
        background: #9c27b0;
        border-radius: 3px;
      }
      #chat-messages::-webkit-scrollbar-thumb:hover {
        background: #ba68c8;
      }
      
      /* Chat message animations */
      .assistant-message, .user-message {
        animation: message-slide-in 0.3s ease-out;
      }
      
      @keyframes message-slide-in {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Assistant button glow effect */
      #assistant-toggle {
        animation: assistant-glow 3s ease-in-out infinite alternate;
      }
      
      @keyframes assistant-glow {
        from {
          box-shadow: 0 0 20px rgba(156, 39, 176, 0.3);
        }
        to {
          box-shadow: 0 0 30px rgba(156, 39, 176, 0.6), 0 0 40px rgba(0, 188, 212, 0.3);
        }
      }
      
      /* Loading dots animation */
      #send-loading {
        animation: loading-dots 1.5s ease-in-out infinite;
      }
      
      @keyframes loading-dots {
        0%, 20% {
          color: rgba(255, 255, 255, 0.3);
        }
        40% {
          color: rgba(255, 255, 255, 1);
        }
        60%, 100% {
          color: rgba(255, 255, 255, 0.3);
        }
      }
      
      /* Suggestion buttons hover effect */
      .suggestion-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(156, 39, 176, 0.3);
      }
      
      /* Mobile-specific improvements */
      @media (max-width: 768px) {
        /* Better touch targets */
        button, a {
          min-height: 44px;
        }
        
        /* Prevent zoom on inputs */
        input, select, textarea {
          font-size: 16px;
        }
        
        /* Smooth scrolling for mobile */
        html {
          scroll-behavior: smooth;
          -webkit-overflow-scrolling: touch;
        }
        
        /* Prevent horizontal scroll */
        body {
          overflow-x: hidden;
        }
        
        /* Better mobile menu animations */
        #mobile-menu {
          animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        /* Mobile-friendly card spacing */
        .gaming-card, .neon-border {
          margin-bottom: 1rem;
        }
        
        /* Optimize text for mobile reading */
        .font-gaming {
          letter-spacing: 0.05em;
        }
      }
      
      /* Very small screens (phones in portrait) */
      @media (max-width: 475px) {
        .container {
          padding-left: 1rem;
          padding-right: 1rem;
        }
        
        /* Smaller text on very small screens */
        h1 {
          font-size: 2rem;
          line-height: 1.2;
        }
      }
    </style>
  </head>
  <body class="font-body game-bg text-textColor m-0 p-0 leading-relaxed">
    <!-- Particle Background Effect -->
    <div id="particles" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- Gaming HUD Navigation -->
    <nav class="relative z-50 bg-gradient-to-r from-dark/95 to-light/95 backdrop-blur-md border-b-2 border-primary/30 py-3 sm:py-4 sticky top-0">
      <div class="max-w-6xl mx-auto px-3 sm:px-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <img src="./public/assets/img/buko_productions-logo.png" alt="Buko Productions Logo" class="w-10 h-10 sm:w-16 sm:h-16 animate-bounce-in" />
            <span class="font-gaming text-base sm:text-xl font-bold text-primary">SCI-HIGH</span>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="p-2 text-textColor hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300 bg-dark/50 rounded-lg border border-primary/30" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex space-x-8">
            <a href="#home" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">Home</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <a href="#about" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">About</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <a href="#contact" class="gaming-nav-link text-textColor hover:text-primary transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative">
              <span class="relative z-10">Contact</span>
              <div class="absolute inset-0 bg-primary/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <!-- Login Button - Hidden when user is logged in -->
            <button id="login-btn" class="gaming-nav-link text-textColor hover:text-accent transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative" onclick="showLoginModal()">
              <span class="relative z-10">üîê Login</span>
              <div class="absolute inset-0 bg-accent/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </button>
            <!-- Professor Tab - Hidden by default, shown only for admin/professor users -->
            <a href="professor-dashboard.html" id="professor-nav-link" class="gaming-nav-link text-textColor hover:text-accent transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative hidden">
              <span class="relative z-10">üë®‚Äçüè´ Professor</span>
              <div class="absolute inset-0 bg-accent/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </a>
            <!-- User Greeting - Hidden by default, shown for logged-in users -->
            <span id="user-greeting" class="text-textColor font-gaming text-sm uppercase tracking-wider hidden">
              <span id="greeting-text">Hello, User!</span>
            </span>
            <!-- Logout Button - Hidden by default, shown for logged-in users (except guests) -->
            <button id="logout-btn" class="gaming-nav-link text-textColor hover:text-red-400 transition-all duration-300 font-gaming text-sm uppercase tracking-wider relative hidden" onclick="logoutUser()">
              <span class="relative z-10">üö™ Logout</span>
              <div class="absolute inset-0 bg-red-500/20 transform skew-x-12 scale-x-0 transition-transform duration-300 hover:scale-x-100"></div>
            </button>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-light/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <a href="#home" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">üè†</span> Home
              </span>
            </a>
            <a href="#about" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">‚ÑπÔ∏è</span> About
              </span>
            </a>
            <a href="#contact" class="block px-4 py-3 text-textColor hover:text-primary hover:bg-primary/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-primary/30">
              <span class="flex items-center">
                <span class="mr-2">üìû</span> Contact
              </span>
            </a>
            <button id="mobile-login-btn" class="block w-full text-left px-4 py-3 text-textColor hover:text-accent hover:bg-accent/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-accent/30" onclick="showLoginModal()">
              <span class="flex items-center">
                <span class="mr-2">üîê</span> Login
              </span>
            </button>
            <a href="professor-dashboard.html" id="mobile-professor-nav-link" class="block px-4 py-3 text-textColor hover:text-accent hover:bg-accent/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-accent/30 hidden">
              <span class="flex items-center">
                <span class="mr-2">üë®‚Äçüè´</span> Professor
              </span>
            </a>
            <div id="mobile-user-greeting" class="block px-4 py-3 text-primary font-gaming text-sm uppercase tracking-wider bg-primary/10 rounded-lg border border-primary/30 hidden">
              <span id="mobile-greeting-text">Hello, User!</span>
            </div>
            <button id="mobile-logout-btn" class="block w-full text-left px-4 py-3 text-red-400 hover:text-red-300 hover:bg-red-500/10 font-gaming text-sm uppercase tracking-wider transition-all duration-300 rounded-lg border border-transparent hover:border-red-500/30 hidden" onclick="logoutUser()">
              <span class="flex items-center">
                <span class="mr-2">üö™</span> Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="relative z-10 min-h-screen flex items-center justify-center px-3 sm:px-6 py-12 sm:py-20">
      <div class="max-w-6xl mx-auto text-center">
        <!-- Main Hero Content -->
        <div class="mb-6 sm:mb-12 animate-slide-in">
          <div class="mb-4 sm:mb-8 relative">
            <img src="./public/assets/img/buko_productions-logo.png" alt="Buko Productions - SCI-HIGH" class="mx-auto w-24 h-24 sm:w-32 sm:h-32 md:w-48 md:h-48 animate-float drop-shadow-2xl relative z-10" />
            <div class="absolute inset-0 bg-primary/20 blur-2xl sm:blur-3xl rounded-full animate-pulse-glow"></div>
          </div>
          
          <h1 class="font-gaming text-3xl xs:text-4xl sm:text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-primary via-accent to-cyan mb-3 sm:mb-6 animate-bounce-in px-2">
            SCI-HIGH
          </h1>
          
          <div class="font-gaming text-sm xs:text-base sm:text-xl md:text-2xl text-primary mb-3 sm:mb-4 tracking-wide sm:tracking-widest animate-bounce-in px-2" style="animation-delay: 0.2s;">
            A BYTE-SIZE LEARNING ADVENTURE!
          </div>
          
          <p class="text-sm xs:text-base sm:text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-6 sm:mb-12 px-4 sm:px-6 animate-bounce-in leading-relaxed" style="animation-delay: 0.4s;">
            Embark on an epic educational journey where programming meets adventure. 
            Battle bugs, solve coding puzzles, and level up your skills in this immersive learning experience!
          </p>
        </div>

        <!-- Gaming Action Buttons -->
        <div class="flex flex-col gap-3 sm:gap-4 md:flex-row md:gap-6 justify-center items-center mb-8 sm:mb-16 animate-bounce-in px-3 sm:px-4" style="animation-delay: 0.6s;">
          <button id="start-game-btn" class="group relative w-full sm:max-w-sm md:w-auto px-6 sm:px-8 md:px-12 py-3 sm:py-4 font-gaming text-sm sm:text-base md:text-lg font-bold text-dark bg-gradient-to-r from-primary to-yellow-300 rounded-xl transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-primary/50 uppercase tracking-wider touch-manipulation">
            <span class="relative z-10">‚ö° Start Adventure</span>
            <div class="absolute inset-0 bg-gradient-to-r from-yellow-300 to-primary rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </button>
          
          <a href="leaderboards.html" class="group relative w-full sm:max-w-sm md:w-auto px-6 sm:px-8 md:px-12 py-3 sm:py-4 font-gaming text-sm sm:text-base md:text-lg font-bold text-textColor bg-gradient-to-r from-accent to-cyan rounded-xl transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-accent/50 uppercase tracking-wider border-2 border-accent/50 touch-manipulation">
            <span class="relative z-10">üèÜ Leaderboards</span>
            <div class="absolute inset-0 bg-gradient-to-r from-cyan to-accent rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </a>
        </div>

        <!-- Game Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6 max-w-4xl mx-auto animate-bounce-in px-4" style="animation-delay: 0.8s;">
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
            <div class="text-3xl mb-2">üéÆ</div>
            <h3 class="font-gaming text-primary text-lg mb-2">Interactive Learning</h3>
            <p class="text-gray-300 text-sm">Hands-on coding challenges</p>
            <div class="mt-4 text-xs text-gray-400">
              <span class="bg-primary/20 text-primary px-2 py-1 rounded">5+ Languages</span>
            </div>
          </div>
          
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
            <div class="text-3xl mb-2">‚öîÔ∏è</div>
            <h3 class="font-gaming text-accent text-lg mb-2">Fast-paced Gameplay</h3>
            <p class="text-gray-300 text-sm">Fast Roguelike Gameplay</p>
            <div class="mt-4 text-xs text-gray-400">
              <span class="bg-accent/20 text-accent px-2 py-1 rounded">Blitz</span>
            </div>
          </div>
          
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
            <div class="text-3xl mb-2">üìö</div>
            <h3 class="font-gaming text-cyan text-lg mb-2">Trial-and-Error</h3>
            <p class="text-gray-300 text-sm">Level up your programming knowledge</p>
            <div class="mt-4 text-xs text-gray-400">
              <span class="bg-cyan/20 text-cyan px-2 py-1 rounded">Learning System</span>
            </div>
          </div>
        </div>

        <!-- Additional Feature Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto mt-12 animate-bounce-in" style="animation-delay: 1s;">
          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="./public/assets/img/mainhub/CLASSROOM_ICON.png" alt="Classroom" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-purple text-md mb-2">Interactive Lessons</h4>
            <p class="text-gray-400 text-xs">Immersive classroom experiences with hands-on coding</p>
          </div>

          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="./public/assets/img/mainhub/PUZZLE.png" alt="Puzzles" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-primary text-md mb-2">Logic Puzzles</h4>
            <p class="text-gray-400 text-xs">Brain-teasing challenges that teach programming concepts</p>
          </div>

          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="./public/assets/img/mainhub/COMLAB_ICON.png" alt="Computer Lab" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-accent text-md mb-2">Real-time Leaderboards</h4>
            <p class="text-gray-400 text-xs">Compete with other players</p>
          </div>

          <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
            <div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center">
              <img src="./public/assets/img/icons/office/achievements.png" alt="Achievements" class="w-12 h-12 object-contain" />
            </div>
            <h4 class="font-gaming text-cyan text-md mb-2">Achievements</h4>
            <p class="text-gray-400 text-xs">Unlock badges and celebrate your coding victories</p>
          </div>
        </div>
      </div>
    </section>
    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-[100] hidden backdrop-blur-sm">
      <div class="neon-border bg-cardBg rounded-xl shadow-2xl w-full mx-2 sm:mx-4 md:mx-6 lg:mx-8 xl:max-w-4xl p-3 sm:p-4 md:p-6 lg:p-8 relative animate-bounce-in max-h-[95vh] overflow-y-auto">
        <button id="close-login-modal" class="absolute top-4 right-4 text-3xl text-gray-400 hover:text-primary transition-colors duration-300 font-gaming">&times;</button>
        
        <!-- User Type Selection -->
        <div id="user-type-selection" class="text-center">
          <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-3 sm:mb-4 text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">üöÄ Join the Adventure</h2>
          <p class="text-gray-300 text-sm sm:text-base md:text-lg mb-4 sm:mb-6 md:mb-8 leading-relaxed px-2">Choose your path to begin your programming quest!</p>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 md:gap-6 mb-4 sm:mb-6 md:mb-8">
            <!-- Professor Option -->
            <div class="neon-border bg-cardBg rounded-lg p-3 sm:p-4 md:p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 cursor-pointer" id="professor-option">
              <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl mb-2 sm:mb-3 md:mb-4">üë®‚Äçüè´</div>
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-primary mb-1 sm:mb-2 md:mb-3">Professor</h3>
              <p class="text-gray-300 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4 leading-tight">Manage student accounts, track progress, and access advanced analytics</p>
              <div class="text-xs text-gray-400">
                <span class="bg-primary/20 text-primary px-2 py-1 rounded text-xs">Admin Access</span>
              </div>
            </div>

            <!-- Student Option -->
            <div class="neon-border bg-cardBg rounded-lg p-3 sm:p-4 md:p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 cursor-pointer" id="student-option">
              <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl mb-2 sm:mb-3 md:mb-4">üéì</div>
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-accent mb-1 sm:mb-2 md:mb-3">Student</h3>
              <p class="text-gray-300 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4 leading-tight">Access your courses, track progress, and compete in leaderboards</p>
              <div class="text-xs text-gray-400">
                <span class="bg-accent/20 text-accent px-2 py-1 rounded text-xs">School Account</span>
              </div>
            </div>

            <!-- General User Option -->
            <div class="neon-border bg-cardBg rounded-lg p-3 sm:p-4 md:p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 cursor-pointer sm:col-span-2 lg:col-span-1" id="general-option">
              <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl mb-2 sm:mb-3 md:mb-4">üåü</div>
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-cyan mb-1 sm:mb-2 md:mb-3">General User</h3>
              <p class="text-gray-300 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4 leading-tight">Create a personal account and learn at your own pace</p>
              <div class="text-xs text-gray-400">
                <span class="bg-cyan/20 text-cyan px-2 py-1 rounded text-xs">Personal Account</span>
              </div>
            </div>
          </div>

          <!-- Guest Option -->
          <div class="border-t border-gray-600 pt-3 sm:pt-4 md:pt-6">
            <p class="text-gray-400 text-xs sm:text-sm mb-2 sm:mb-3 md:mb-4">Just want to try the game?</p>
            <button id="guest-option" class="w-full sm:w-auto px-4 sm:px-6 md:px-8 py-2 sm:py-2 md:py-3 font-gaming text-sm sm:text-base md:text-lg font-bold text-textColor bg-gradient-to-r from-purple to-pink-500 rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple/50 uppercase tracking-wider">
              üéÆ Play as Guest
            </button>
          </div>
        </div>

        <!-- Professor Login Form -->
        <div id="professor-form" class="hidden">
          <div class="text-center mb-3 sm:mb-4 md:mb-6">
            <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl font-bold mb-2 text-primary">üë®‚Äçüè´ Professor Portal</h2>
            <p class="text-gray-300 text-sm sm:text-base">Access your teaching dashboard</p>
          </div>
          
          <!-- Only Login Form -->
          <div class="max-w-md mx-auto px-2 sm:px-0">
            <form id="professor-login-form" class="space-y-6">
              <div>
                <label class="block text-gray-300 text-sm mb-2">Email</label>
                <input type="email" name="email" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-primary focus:outline-none">
              </div>
              <div>
                <label class="block text-gray-300 text-sm mb-2">Password</label>
                <input type="password" name="password" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-primary focus:outline-none">
              </div>
              <button type="submit" class="w-full px-6 py-3 font-gaming text-dark bg-gradient-to-r from-primary to-yellow-300 rounded-lg transform transition-all duration-300 hover:scale-105">
                Access Dashboard
              </button>
            </form>
            
            <div class="text-center mt-6 pt-6 border-t border-gray-600">
              <p class="text-gray-400 text-sm">
                Don't have an account? Contact your system administrator for professor access.
              </p>
              <div class="mt-4 p-3 bg-dark/30 rounded-lg">
                <p class="text-xs text-gray-500 mb-2">üîß Dev Mode Test Account:</p>
                <p class="text-xs text-primary">Email: professor@sci-high.edu</p>
                <p class="text-xs text-primary">Password: Prof123!</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Student Login Form -->
        <div id="student-form" class="hidden">
          <div class="text-center mb-4 sm:mb-6 md:mb-8">
            <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl font-bold mb-2 text-accent">üéì Student Portal</h2>
            <p class="text-gray-300 text-sm sm:text-base">Enter your Student ID to begin your adventure</p>
            <p class="text-xs sm:text-sm text-gray-400 mt-2">‚ú® New student? An account will be created automatically for you!</p>
          </div>
          
          <div class="max-w-2xl mx-auto px-2 sm:px-0">
            <!-- Step 1: Student ID Input -->
            <div id="student-id-step" class="space-y-6">
              <div class="max-w-md mx-auto">
                <label class="block text-gray-300 text-sm mb-2">Student ID</label>
                <input type="text" id="student-id-input" required placeholder="e.g., 24-2024-001" 
                       class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none text-center font-gaming">
                <p class="text-xs text-gray-400 mt-1">Format: XX-XXXX-XXX (numbers and dashes only)</p>
              </div>
              <div class="text-center">
                <button type="button" id="verify-student-id" class="px-8 py-3 font-gaming text-white bg-gradient-to-r from-accent to-cyan rounded-lg transform transition-all duration-300 hover:scale-105">
                  üîç Verify Student ID
                </button>
              </div>
            </div>

            <!-- Step 2: Profile Completion (shown only if needed) -->
            <div id="student-profile-step" class="hidden space-y-6">
              <div class="text-center mb-6">
                <h3 class="font-gaming text-lg text-cyan mb-2">üìù Complete Your Profile</h3>
                <p class="text-gray-300 text-sm">We need a bit more information to set up your account</p>
              </div>
              
              <form id="student-complete-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-4">
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">First Name *</label>
                    <input type="text" name="firstName" required placeholder="Enter your first name" 
                           class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none">
                  </div>
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Last Name *</label>
                    <input type="text" name="lastName" required placeholder="Enter your last name" 
                           class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent focus:outline-none">
                  </div>
                </div>
                
                <div class="space-y-4">
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Department *</label>
                    <select name="department" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white focus:border-accent focus:outline-none">
                      <option value="">Select your department</option>
                      <option value="Senior High School Department">Senior High School Department</option>
                      <option value="College Department">College Department</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Strand/Course *</label>
                    <select name="strand" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white focus:border-accent focus:outline-none">
                      <option value="">Select your strand/course</option>
                      <option value="ICT">ICT</option>
                      <option value="BSCS">BSCS</option>
                      <option value="BSIT">BSIT</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 text-sm mb-2">Year *</label>
                    <select name="year" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white focus:border-accent focus:outline-none">
                      <option value="">Select your year</option>
                      <option value="1st">1st</option>
                      <option value="2nd">2nd</option>
                      <option value="3rd">3rd</option>
                      <option value="4th">4th</option>
                      <option value="5th">5th</option>
                    </select>
                  </div>
                </div>
                
                <div class="md:col-span-2 text-center pt-4">
                  <button type="submit" class="px-8 py-3 font-gaming text-white bg-gradient-to-r from-accent to-cyan rounded-lg transform transition-all duration-300 hover:scale-105">
                    üöÄ Complete Setup & Enter Adventure
                  </button>
                </div>
              </form>
            </div>

            <!-- Step 3: Profile Found (for existing users) -->
            <div id="student-found-step" class="hidden space-y-6">
              <div class="text-center">
                <div class="bg-dark/30 rounded-lg p-6">
                  <h3 class="font-gaming text-lg text-green-400 mb-4">‚úÖ Profile Found!</h3>
                  <div id="student-profile-preview" class="text-left space-y-2 text-gray-300 max-w-md mx-auto">
                    <!-- Profile details will be inserted here -->
                  </div>
                  <button type="button" id="login-existing-student" class="mt-4 px-8 py-3 font-gaming text-white bg-gradient-to-r from-green-500 to-green-600 rounded-lg transform transition-all duration-300 hover:scale-105">
                    üöÄ Continue Adventure
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Help Section -->
            <div class="text-center mt-6 pt-6 border-t border-gray-600">
              <p class="text-gray-400 text-sm">üìã Only your Student ID is needed - no password required!</p>
              <div class="mt-4 p-3 bg-dark/30 rounded-lg">
                <hr class="my-2 border-gray-600">
                <p class="text-cyan text-xs">üí° Or try any Student ID (XX-XXXX-XXX format) to create a new account!</p>
              </div>
            </div>
          </div>
        </div>

        <!-- General User Form -->
        <div id="general-form" class="hidden">
          <div class="text-center mb-3 sm:mb-4 md:mb-6">
            <h2 class="font-gaming text-xl sm:text-2xl md:text-3xl font-bold mb-2 text-cyan">üåü Personal Account</h2>
            <p class="text-gray-300 text-sm sm:text-base">Create your learning account</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 md:gap-8 px-2 sm:px-0">
            <!-- Login Form -->
            <div class="space-y-4">
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-cyan mb-3 sm:mb-4">Login</h3>
              <form id="general-login-form" class="space-y-4">
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Email</label>
                  <input type="email" name="email" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Password</label>
                  <input type="password" name="password" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <button type="submit" class="w-full px-6 py-3 font-gaming text-white bg-gradient-to-r from-cyan to-blue-500 rounded-lg transform transition-all duration-300 hover:scale-105">
                  Login
                </button>
              </form>
            </div>

            <!-- Register Form -->
            <div class="space-y-4">
              <h3 class="font-gaming text-base sm:text-lg md:text-xl text-cyan mb-3 sm:mb-4">Register</h3>
              <form id="general-register-form" class="space-y-4">
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Full Name</label>
                  <input type="text" name="fullName" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Email</label>
                  <input type="email" name="email" required class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Display Name</label>
                  <input type="text" name="displayName" required placeholder="For leaderboards" class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <div>
                  <label class="block text-gray-300 text-sm mb-2">Password</label>
                  <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 bg-dark/50 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-cyan focus:outline-none">
                </div>
                <button type="submit" class="w-full px-6 py-3 font-gaming text-white bg-gradient-to-r from-cyan to-blue-500 rounded-lg transform transition-all duration-300 hover:scale-105">
                  Create Account
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Back Button -->
        <div class="text-center mt-8">
          <button id="back-to-selection" class="hidden px-6 py-2 text-gray-400 hover:text-white transition-colors duration-300 font-gaming">
            ‚Üê Back to Options
          </button>
        </div>
      </div>
    </div>

    <!-- Game Screenshots Modal -->
    <div id="screenshots-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-[100] hidden backdrop-blur-sm">
      <div class="neon-border bg-cardBg rounded-xl shadow-2xl max-w-2xl w-full mx-4 p-8 relative animate-bounce-in">
        <button id="close-screenshots-modal" class="absolute top-4 right-4 text-3xl text-gray-400 hover:text-primary transition-colors duration-300 font-gaming">&times;</button>
        
        <div class="text-center mb-6">
          <h2 class="font-gaming text-3xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Game Preview</h2>
          <p class="text-gray-300 text-lg max-w-lg mx-auto leading-relaxed">
            Experience the ultimate educational adventure! Battle through coding challenges, explore mystical dungeons, and master programming languages in an epic quest for knowledge.
          </p>
        </div>
        
        <div class="relative mb-6">
          <div class="relative w-full flex items-center justify-center">
            <button id="carousel-prev" class="absolute left-2 top-1/2 -translate-y-1/2 bg-gradient-to-r from-primary to-yellow-300 border-none rounded-full w-12 h-12 flex items-center justify-center text-xl text-dark shadow-lg hover:shadow-primary/50 transition-all duration-300 transform hover:scale-110 z-10">‚Äπ</button>
            <div class="w-full flex items-center justify-center px-16">
              <img id="carousel-image" src="./public/assets/classroom_day-7QRgWPJs.png" alt="Game Screenshot" class="rounded-lg object-cover h-64 w-full max-w-md transition-all duration-500 shadow-2xl border-2 border-primary/30" />
            </div>
            <button id="carousel-next" class="absolute right-2 top-1/2 -translate-y-1/2 bg-gradient-to-r from-primary to-yellow-300 border-none rounded-full w-12 h-12 flex items-center justify-center text-xl text-dark shadow-lg hover:shadow-primary/50 transition-all duration-300 transform hover:scale-110 z-10">‚Ä∫</button>
          </div>
        </div>
        
        <div class="flex justify-center gap-3 mb-6" id="carousel-dots">
          <span class="dot w-4 h-4 rounded-full bg-primary scale-110 inline-block cursor-pointer transition-all duration-300"></span>
          <span class="dot w-4 h-4 rounded-full bg-gray-500 inline-block cursor-pointer transition-all duration-300 hover:bg-gray-400"></span>
          <span class="dot w-4 h-4 rounded-full bg-gray-500 inline-block cursor-pointer transition-all duration-300 hover:bg-gray-400"></span>
        </div>
        
        <div class="text-center">
          <a href="game.html" id="play-game-btn" class="inline-block px-10 py-4 font-gaming text-lg font-bold text-dark bg-gradient-to-r from-primary to-yellow-300 rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-primary/50 uppercase tracking-wider">
            üöÄ Launch Game
          </a>
        </div>
      </div>
    </div>

    <!-- About Section -->
    <section id="about" class="relative z-10 py-20 px-6">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="font-gaming text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-accent to-cyan mb-6">About Our Quest</h2>
          <div class="w-32 h-1 bg-gradient-to-r from-accent to-cyan mx-auto rounded-full"></div>
        </div>

        <!-- Hero Banner with Gaming Style -->
        <div class="neon-border rounded-xl overflow-hidden shadow-2xl mb-12 transform transition-all duration-300 hover:scale-105">
          <div class="relative">
            <img src="./public/assets/ABOUT_US-Drs9y4b1.jpg" alt="About Us - SCI-HIGH Team" class="w-full h-80 object-cover object-top" />
            <div class="absolute inset-0 bg-gradient-to-t from-dark/80 via-transparent to-transparent"></div>
            <div class="absolute bottom-6 left-6 right-6">
              <h3 class="font-gaming text-2xl font-bold text-primary mb-2">The Development Team</h3>
              <p class="text-gray-200 text-lg">Crafting the future of educational gaming</p>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <!-- Mission Description -->
          <div class="space-y-6">
            <div class="neon-border bg-cardBg rounded-lg p-8 backdrop-blur-sm">
              <h3 class="font-gaming text-2xl text-primary mb-4 flex items-center">
                <span class="mr-3">üéØ</span> Our Mission
              </h3>
              <p class="text-gray-300 text-lg leading-relaxed">
                SCI-HIGH is a thesis project that transforms learning programming fundamentals into a roguelike-style game. 
                The game combines the trial-and-error process of the roguelike genre with programming education, creating an engaging way for students to learn.
              </p>
            </div>
            
            <div class="neon-border bg-cardBg rounded-lg p-8 backdrop-blur-sm">
              <h3 class="font-gaming text-2xl text-accent mb-4 flex items-center">
                <span class="mr-3">üéÆ</span> Game Features
              </h3>
              <ul class="text-gray-300 space-y-2">
                <li class="flex items-center"><span class="text-primary mr-2">‚ñ∂</span> Narrative in Learning Programming Fundamentals</li>
                <li class="flex items-center"><span class="text-primary mr-2">‚ñ∂</span> Multiple programming languages and concepts</li>
                <li class="flex items-center"><span class="text-primary mr-2">‚ñ∂</span> Fast-paced, roguelike-style game.</li>
                <li class="flex items-center"><span class="text-primary mr-2">‚ñ∂</span> Increasing difficulty. </li>
                <li class="flex items-center"><span class="text-primary mr-2">‚ñ∂</span> Real-time progress tracking</li>
                <li class="flex items-center"><span class="text-primary mr-2">‚ñ∂</span> Achievement system with rewards</li>
              </ul>
            </div>

            <!-- Game Statistics -->
            <div class="neon-border bg-cardBg rounded-lg p-8 backdrop-blur-sm">
              <h3 class="font-gaming text-2xl text-purple mb-4 flex items-center">
                <span class="mr-3">üìä</span> Game Stats
              </h3>
              <div class="grid grid-cols-2 gap-4 text-center">
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-primary">500+</div>
                  <div class="text-xs text-gray-400">Challenges</div>
                </div>
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-accent">50+</div>
                  <div class="text-xs text-gray-400">Levels</div>
                </div>
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-cyan">15+</div>
                  <div class="text-xs text-gray-400">Characters</div>
                </div>
                <div class="bg-dark/50 rounded-lg p-4">
                  <div class="text-2xl font-gaming text-purple">100+</div>
                  <div class="text-xs text-gray-400">Achievements</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Team Members -->
          <div class="space-y-6">
            <h3 class="font-gaming text-3xl text-cyan mb-8 text-center">‚öîÔ∏è The Guild</h3>
            <div class="space-y-4">
              <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-primary to-yellow-300 rounded-full flex items-center justify-center text-2xl font-gaming font-bold text-dark">JS</div>
                  <div>
                    <h4 class="font-gaming text-xl text-primary font-bold">Baronia, James Scott</h4>
                    <p class="text-gray-400">Project Lead & Developer</p>
                    <p class="text-sm text-gray-500">Quest Designer & System Architect</p>
                  </div>
                </div>
              </div>
              
              <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-accent to-cyan rounded-full flex items-center justify-center text-2xl font-gaming font-bold text-white">RJ</div>
                  <div>
                    <h4 class="font-gaming text-xl text-accent font-bold">Dela Cruz, Richard Joseph</h4>
                    <p class="text-gray-400">Documentation & QA Tester</p>
                    <p class="text-sm text-gray-500">Lore Master & Quality Guardian</p>
                  </div>
                </div>
              </div>
              
              <div class="neon-border bg-cardBg rounded-lg p-6 backdrop-blur-sm transform transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-purple to-pink-500 rounded-full flex items-center justify-center text-2xl font-gaming font-bold text-white">JE</div>
                  <div>
                    <h4 class="font-gaming text-xl text-purple font-bold">Verceles, James Edward</h4>
                    <p class="text-gray-400">Lead Developer</p>
                    <p class="text-sm text-gray-500">Code Wizard & Technical Lead</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Programming Languages Section -->
        <div class="mt-16">
          <div class="flex items-center justify-center gap-4 mb-8">
            <img src="./public/assets/img/mainhub/PLAY_BUTTON.png" alt="Play" class="w-8 h-8 object-contain" />
            <h3 class="font-gaming text-3xl text-center text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Master These Languages</h3>
            <img src="./public/assets/img/mainhub/PLAY_BUTTON.png" alt="Play" class="w-8 h-8 object-contain" />
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 max-w-6xl mx-auto">
            <!-- HTML/CSS/JavaScript -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="./public/assets/img/comlab/icons/web-design_logo.png" alt="Web Design" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-primary text-sm">HTML/CSS/JS</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-primary h-2 rounded-full" style="width: 90%"></div>
              </div>
            </div>

            <!-- Python -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="./public/assets/img/comlab/icons/python_logo.png" alt="Python" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-accent text-sm">Python</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-accent h-2 rounded-full" style="width: 85%"></div>
              </div>
            </div>

            <!-- Java -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="./public/assets/img/comlab/icons/java_logo.png" alt="Java" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-cyan text-sm">Java</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-cyan h-2 rounded-full" style="width: 75%"></div>
              </div>
            </div>

            <!-- C Programming -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="./public/assets/img/comlab/icons/c_logo.png" alt="C Programming" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-purple text-sm">C Programming</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-purple h-2 rounded-full" style="width: 80%"></div>
              </div>
            </div>

            <!-- C++ -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="./public/assets/img/comlab/icons/cplus_logo.png" alt="C++" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-primary text-sm">C++</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-primary h-2 rounded-full" style="width: 70%"></div>
              </div>
            </div>

            <!-- C# -->
            <div class="neon-border bg-cardBg rounded-lg p-4 backdrop-blur-sm transform transition-all duration-300 hover:scale-105 text-center">
              <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                <img src="./public/assets/img/comlab/icons/csharp_logo.png" alt="C#" class="w-10 h-10 object-contain" />
              </div>
              <h4 class="font-gaming text-accent text-sm">C#</h4>
              <div class="w-full bg-dark/50 rounded-full h-2 mt-2">
                <div class="bg-accent h-2 rounded-full" style="width: 65%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="relative z-10 py-20 px-6">
      <div class="max-w-4xl mx-auto text-center">
        <div class="neon-border bg-cardBg rounded-xl p-12 backdrop-blur-sm">
          <h2 class="font-gaming text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent mb-8">üì° Contact Command Center</h2>
          <p class="text-gray-300 text-xl mb-8 leading-relaxed">
            Ready to join the adventure or have questions about our quest? Send us a transmission!
          </p>
          <div class="inline-block neon-border bg-dark/50 rounded-lg p-6">
            <p class="text-lg text-gray-300 mb-4">üìß Mission Control:</p>
            <a href="mailto:info@sci-high-thesis.com" class="font-gaming text-xl text-primary hover:text-accent transition-colors duration-300 underline decoration-primary/50">
              info@sci-high-thesis.com
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- DEV MODE Panel - Hidden by default -->
    <div id="dev-panel" class="fixed bottom-4 right-4 z-[200] hidden">
      <div class="neon-border bg-cardBg rounded-lg p-4 max-w-xs">
        <h3 class="font-gaming text-primary text-sm mb-3">üîß Dev Mode</h3>
        <div class="space-y-2">
          <button onclick="createAdminUser()" class="w-full px-3 py-1 bg-purple text-white text-xs rounded hover:bg-purple/80">
            Admin Account
          </button>
          <button onclick="createSampleProfessor()" class="w-full px-3 py-1 bg-primary text-dark text-xs rounded hover:bg-yellow-300">
            Professor Account
          </button>
          <button onclick="createSampleStudent()" class="w-full px-3 py-1 bg-accent text-white text-xs rounded hover:bg-green-600">
            Student Account
          </button>
          <button onclick="createSampleGeneral()" class="w-full px-3 py-1 bg-cyan text-white text-xs rounded hover:bg-blue-500">
            General Account
          </button>
          <button onclick="createSampleCareerStats()" class="w-full px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700">
            üìä Career Stats Data
          </button>
          <button onclick="logoutUser()" class="w-full px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700">
            Logout
          </button>
          <button onclick="document.getElementById('dev-panel').classList.add('hidden')" class="w-full px-3 py-1 bg-gray-600 text-white text-xs rounded hover:bg-gray-700">
            Close Panel
          </button>
        </div>
      </div>
    </div>

    <!-- Gaming Footer -->
    <footer class="relative z-10 bg-gradient-to-r from-dark to-light border-t-2 border-primary/30 py-12">
      <div class="max-w-6xl mx-auto px-6 text-center">
        <div class="flex items-center justify-center space-x-4 mb-6">
          <img src="./public/assets/img/buko_productions-logo.png" alt="Buko Productions" class="w-16 h-16" />
          <div>
            <h3 class="font-gaming text-2xl font-bold text-primary">SCI-HIGH</h3>
            <p class="text-gray-400 text-sm">Level up your knowledge!</p>
          </div>
        </div>
        <div class="w-32 h-1 bg-gradient-to-r from-primary to-accent mx-auto rounded-full mb-6"></div>
        <p class="text-gray-400 font-gaming">&copy; 2025 SCI-HIGH Thesis Project. All rights reserved. Game on! üéÆ</p>
      </div>
    </footer>
    
    <script>
      // Global variables for modal management
      let globalLoginModal = null;
      let globalScreenshotsModal = null;

      // Global Modal Functions (defined early for immediate onclick access)
      function showLoginModal() {
        console.log('showLoginModal called');
        // Use global variable or find element
        const loginModal = globalLoginModal || document.getElementById('login-modal');
        console.log('Login modal element:', loginModal);
        if (loginModal) {
          loginModal.classList.remove('hidden');
          showUserTypeSelection();
        } else {
          console.error('Login modal not found');
          // Retry after a short delay in case DOM isn't ready
          setTimeout(() => {
            const retryModal = document.getElementById('login-modal');
            if (retryModal) {
              retryModal.classList.remove('hidden');
              showUserTypeSelection();
            }
          }, 100);
        }
      }

      function showUserTypeSelection() {
        const userTypeSelection = document.getElementById('user-type-selection');
        const professorForm = document.getElementById('professor-form');
        const studentForm = document.getElementById('student-form');
        const generalForm = document.getElementById('general-form');
        
        if (userTypeSelection) userTypeSelection.classList.remove('hidden');
        if (professorForm) professorForm.classList.add('hidden');
        if (studentForm) studentForm.classList.add('hidden');
        if (generalForm) generalForm.classList.add('hidden');
        
        // Reset student form steps when switching forms
        resetStudentFormSteps();
      }

      function resetStudentFormSteps() {
        // Reset all form steps to initial state
        const studentIdStep = document.getElementById('student-id-step');
        const studentProfileStep = document.getElementById('student-profile-step');
        const studentFoundStep = document.getElementById('student-found-step');
        
        if (studentIdStep) studentIdStep.classList.remove('hidden');
        if (studentProfileStep) studentProfileStep.classList.add('hidden');
        if (studentFoundStep) studentFoundStep.classList.add('hidden');
        
        // Clear form fields
        const studentIdInput = document.getElementById('student-id-input');
        const completeForm = document.getElementById('student-complete-form');
        
        if (studentIdInput) studentIdInput.value = '';
        if (completeForm) completeForm.reset();
        
        // Reset global variables
        currentStudentId = null;
        currentStudentData = null;
      }

      // Make functions globally accessible for onclick handlers
      window.showLoginModal = showLoginModal;
      window.showUserTypeSelection = showUserTypeSelection;
      window.resetStudentFormSteps = resetStudentFormSteps;

      // Fallback function for modal access - for GitHub Pages compatibility
      window.ensureModalAccess = function() {
        if (!globalLoginModal) {
          globalLoginModal = document.getElementById('login-modal');
        }
        if (!globalScreenshotsModal) {
          globalScreenshotsModal = document.getElementById('screenshots-modal');
        }
        return {
          loginModal: globalLoginModal,
          screenshotsModal: globalScreenshotsModal
        };
      };

      // Additional safety check for GitHub Pages
      if (typeof window !== 'undefined') {
        window.addEventListener('load', function() {
          console.log('Window loaded, ensuring modal access...');
          window.ensureModalAccess();
        });
      }

      // Particle System for Background Effect
      function createParticles() {
        const particles = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
          const particle = document.createElement('div');
          particle.className = 'absolute w-1 h-1 bg-primary/30 rounded-full animate-pulse';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.top = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 3 + 's';
          particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
          particles.appendChild(particle);
        }
      }

      // Authentication System
      class AuthManager {
        constructor() {
          this.currentUser = null;
          this.userType = null; // 'professor', 'student', 'general', 'guest'
          this.initializeAuth();
        }

        async initializeAuth() {
          // Initialize Firebase if not already done
          if (typeof firebase === 'undefined') {
            await this.loadFirebase();
          }
          
          // Check if user is already logged in
          const savedUser = localStorage.getItem('sci_high_user');
          if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            this.userType = this.currentUser.type;
          }

          // Update professor tab visibility
          this.updateProfessorTabVisibility();
          // Update user interface
          this.updateUserInterface();
        }

        // Helper method to ensure authentication before database operations
        async ensureAuthenticated() {
          try {
            if (typeof firebase !== 'undefined' && firebase.auth) {
              if (!firebase.auth().currentUser) {
                console.log('No authenticated user found, signing in anonymously...');
                await firebase.auth().signInAnonymously();
                console.log('‚úÖ Anonymous authentication successful');
              } else {
                console.log('‚úÖ User already authenticated:', firebase.auth().currentUser.uid);
              }
              return true;
            } else {
              console.warn('‚ö†Ô∏è Firebase Auth not available');
              return false;
            }
          } catch (error) {
            console.error('‚ùå Authentication failed:', error);
            throw new Error(`Authentication failed: ${error.message}`);
          }
        }

        // Debug function to test Firebase connectivity
        async testFirebaseConnection() {
          try {
            console.log('Testing Firebase connection...');
            
            if (typeof firebase === 'undefined') {
              throw new Error('Firebase not loaded');
            }
            
            if (!firebase.auth) {
              throw new Error('Firebase Auth not available');
            }
            
            // Ensure authentication before database operations
            await this.ensureAuthenticated();
            
            // Test Realtime Database
            if (firebase.database) {
              try {
                await firebase.database().ref('test/connection').set({
                  timestamp: new Date().toISOString(),
                  test: true
                });
                console.log('‚úÖ Realtime Database write test successful');
                
                const snapshot = await firebase.database().ref('test/connection').once('value');
                console.log('‚úÖ Realtime Database read test successful:', snapshot.val());
              } catch (dbError) {
                console.warn('‚ùå Realtime Database test failed:', dbError);
              }
            } else {
              console.warn('Realtime Database not available');
            }
            
            // Test Firestore (optional)
            if (firebase.firestore) {
              try {
                const testDoc = await firebase.firestore().collection('test').doc('connection').get();
                console.log('‚úÖ Firestore read test successful');
                
                await firebase.firestore().collection('test').doc('connection').set({
                  timestamp: new Date().toISOString(),
                  test: true
                });
                console.log('‚úÖ Firestore write test successful');
              } catch (firestoreError) {
                console.warn('‚ùå Firestore test failed (likely security rules):', firestoreError);
              }
            } else {
              console.warn('Firestore not available');
            }
            
            console.log('Firebase connection test completed');
            return { success: true };
            
          } catch (error) {
            console.error('Firebase connection test failed:', error);
            return { success: false, error: error.message };
          }
        }

        async loadFirebase() {
          return new Promise((resolve, reject) => {
            if (typeof firebase !== 'undefined') {
              resolve();
              return;
            }

            const scripts = [
              'https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js',
              'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js',
              'https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js'
              // Temporarily disable Firestore to avoid connection errors
              // 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js'
            ];

            let loaded = 0;
            scripts.forEach(src => {
              const script = document.createElement('script');
              script.src = src;
              script.onload = () => {
                loaded++;
                if (loaded === scripts.length) {
                  // Initialize Firebase
                  const firebaseConfig = {
                    apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
                    authDomain: "sci-high-website.firebaseapp.com",
                    databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
                    projectId: "sci-high-website",
                    storageBucket: "sci-high-website.appspot.com",
                    messagingSenderId: "451463202515",
                    appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
                  };
                  
                  if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                  }
                  
                  // Ensure auth is ready
                  firebase.auth().onAuthStateChanged(() => {
                    console.log('Firebase Auth initialized');
                  });
                  
                  resolve();
                }
              };
              script.onerror = reject;
              document.head.appendChild(script);
            });
          });
        }

        async loginProfessor(email, password) {
          try {
            // For development: Check sample accounts first
            if (email === 'professor@sci-high.edu' && password === 'Prof123!') {
              this.currentUser = {
                uid: 'prof_sample_123',
                email: email,
                type: 'professor',
                profile: {
                  fullName: 'Dr. Sample Professor',
                  email: email,
                  institution: 'SCI-HIGH University',
                  isVerified: true
                }
              };
              
              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'professor';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();
              
              return { success: true, user: this.currentUser };
            }

            // Production Firebase login (using Realtime Database)
            if (typeof firebase !== 'undefined' && firebase.auth) {
              const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
              const user = userCredential.user;
              
              // Check if user is actually a professor in Realtime Database
              const professorSnapshot = await firebase.database().ref('professors').child(user.uid).once('value');
              if (!professorSnapshot.exists()) {
                await firebase.auth().signOut();
                throw new Error('Not registered as a professor');
              }

              const professorData = professorSnapshot.val();
              
              // Update last login timestamp
              await firebase.database().ref('professors').child(user.uid).update({
                lastLogin: new Date().toISOString(),
                lastLoginIP: 'unknown' // You can implement IP detection if needed
              });

              this.currentUser = {
                uid: user.uid,
                email: user.email,
                type: 'professor',
                profile: professorData
              };
              
              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'professor';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();
              
              return { success: true, user: this.currentUser };
            } else {
              throw new Error('Invalid credentials or Firebase not available');
            }
          } catch (error) {
            return { success: false, error: error.message };
          }
        }

        async loginStudent(studentId, password = null) {
          try {
            console.log('Attempting student login for ID:', studentId);
            
            // Sample student accounts for development
            const sampleStudents = {
              '24-2024-001': {
                profile: {
                  studentId: '24-2024-001',
                  fullName: 'Juan Dela Cruz',
                  academicInfo: { level: 'college', course: 'BS Computer Science', yearLevel: '3rd Year' },
                  accountStatus: { isFirstLogin: false, createdBy: 'prof_sample', lastLogin: new Date().toISOString() },
                  gameData: { totalPoints: 850, courseProgress: { python: { progress: 75, completed: 8, total: 12 }, javascript: { progress: 60, completed: 6, total: 10 } } }
                }
              },
              '24-2024-002': {
                profile: {
                  studentId: '24-2024-002',
                  fullName: 'Maria Santos',
                  academicInfo: { level: 'college', course: 'BS Information Technology', yearLevel: '2nd Year' },
                  accountStatus: { isFirstLogin: false, createdBy: 'prof_sample', lastLogin: new Date().toISOString() },
                  gameData: { totalPoints: 1200, courseProgress: { python: { progress: 90, completed: 11, total: 12 }, webdesign: { progress: 85, completed: 9, total: 10 } } }
                }
              },
              '24-2024-003': {
                profile: {
                  studentId: '24-2024-003',
                  fullName: 'Pedro Garcia',
                  academicInfo: { level: 'shs', strand: 'STEM', yearLevel: 'Grade 12' },
                  accountStatus: { isFirstLogin: true, createdBy: 'prof_sample', lastLogin: null },
                  gameData: { totalPoints: 300, courseProgress: { python: { progress: 30, completed: 3, total: 12 } } }
                }
              }
            };

            // Check sample accounts first (no password needed - only student ID)
            if (sampleStudents[studentId]) {
              console.log('Found sample student, logging in...');
              this.currentUser = {
                uid: 'stud_' + studentId.replace(/-/g, '_'),
                studentId: studentId,
                type: 'student',
                profile: sampleStudents[studentId].profile
              };

              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'student';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();

              return { success: true, user: this.currentUser };
            }

            // Production Firebase login (using Realtime Database when available)
            if (typeof firebase !== 'undefined' && firebase.database) {
              console.log('Using Firebase for student login...');
              
              // Ensure authentication before database access
              await this.ensureAuthenticated();
              
              // Query student by student ID in Realtime Database
              const studentsSnapshot = await firebase.database().ref('students').orderByChild('studentId').equalTo(studentId).once('value');
              
              if (!studentsSnapshot.exists()) {
                console.log('Student not found in database, creating new account...');
                // Student doesn't exist, create a new account automatically
                const newStudent = await this.createStudentAccount(studentId);
                if (newStudent.success) {
                  console.log('New student account created successfully');
                  this.currentUser = {
                    uid: newStudent.docId,
                    studentId: studentId,
                    type: 'student',
                    profile: newStudent.studentData
                  };

                  localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
                  this.userType = 'student';
                  this.updateProfessorTabVisibility();
                  this.updateUserInterface();

                  return { success: true, user: this.currentUser, isNewAccount: true };
                } else {
                  throw new Error(newStudent.error);
                }
              }

              console.log('Found existing student in database, loading data...');
              // Get the first (and should be only) student with this ID
              const studentData = Object.values(studentsSnapshot.val())[0];
              const studentKey = Object.keys(studentsSnapshot.val())[0];

              // Also check for career stats data which might have additional profile info
              let careerStatsData = null;
              try {
                const careerStatsSnapshot = await firebase.database().ref(`student_career_stats/${studentId}`).once('value');
                if (careerStatsSnapshot.exists()) {
                  careerStatsData = careerStatsSnapshot.val();
                  console.log('Found career stats data for student:', careerStatsData);
                }
              } catch (error) {
                console.log('No career stats found for student (this is normal for new students):', error.message);
              }

              // Merge career stats data with main student data if available
              const mergedStudentData = { ...studentData };
              if (careerStatsData) {
                // Merge profile information from career stats
                if (careerStatsData.firstName) mergedStudentData.firstName = careerStatsData.firstName;
                if (careerStatsData.lastName) mergedStudentData.lastName = careerStatsData.lastName;
                if (careerStatsData.department) mergedStudentData.department = careerStatsData.department;
                if (careerStatsData.strandYear) mergedStudentData.strandYear = careerStatsData.strandYear;
                
                // Update fullName if we have both first and last name
                if (careerStatsData.firstName && careerStatsData.lastName) {
                  mergedStudentData.fullName = `${careerStatsData.firstName} ${careerStatsData.lastName}`;
                }
              }

              // Update last login timestamp
              await firebase.database().ref('students').child(studentKey).update({
                lastLogin: new Date().toISOString(),
                'progress/lastActivity': new Date().toISOString()
              });

              // No password verification needed - students only need their student ID
              this.currentUser = {
                uid: studentKey,
                studentId: studentData.studentId,
                type: 'student',
                profile: mergedStudentData
              };

              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              this.userType = 'student';
              this.updateProfessorTabVisibility();
              this.updateUserInterface();

              return { success: true, user: this.currentUser };
            } else {
              console.log('Firebase not available, using local storage fallback...');
              // Fallback: Create account locally if Firebase not available
              const localStudents = JSON.parse(localStorage.getItem('sci_high_local_students') || '{}');
              
              if (!localStudents[studentId]) {
                console.log('Creating new local student account...');
                // Create new local account
                localStudents[studentId] = this.createLocalStudentAccount(studentId);
                localStorage.setItem('sci_high_local_students', JSON.stringify(localStudents));
                
                this.currentUser = {
                  uid: 'local_' + studentId.replace(/-/g, '_'),
                  studentId: studentId,
                  type: 'student',
                  profile: localStudents[studentId]
                };

                localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
                this.userType = 'student';
                this.updateProfessorTabVisibility();
                this.updateUserInterface();

                return { success: true, user: this.currentUser, isNewAccount: true };
              } else {
                console.log('Found existing local student account...');
                // Login with existing local account
                this.currentUser = {
                  uid: 'local_' + studentId.replace(/-/g, '_'),
                  studentId: studentId,
                  type: 'student',
                  profile: localStudents[studentId]
                };

                localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
                this.userType = 'student';
                this.updateProfessorTabVisibility();

                return { success: true, user: this.currentUser };
              }
            }
          } catch (error) {
            console.error('Student login error:', error);
            return { success: false, error: error.message };
          }
        }

        // Create a new student account in Firebase
        async createStudentAccount(studentId) {
          try {
            console.log('Creating new student account for ID:', studentId);
            
            // Ensure authentication before database operations
            await this.ensureAuthenticated();
            
            // Enhanced duplicate check - check multiple ways student might already exist
            console.log('Performing comprehensive duplicate check...');
            
            // Check 1: Query by studentId (primary check)
            const existingByIdSnapshot = await firebase.database().ref('students').orderByChild('studentId').equalTo(studentId).once('value');
            if (existingByIdSnapshot.exists()) {
              console.log('Student already exists with this Student ID:', studentId);
              throw new Error(`Student account already exists for ID: ${studentId}. Please contact administrator if you cannot access your account.`);
            }
            
            // Check 2: Check career stats to see if student has been playing
            const careerStatsSnapshot = await firebase.database().ref('student_career_stats').child(studentId).once('value');
            if (careerStatsSnapshot.exists()) {
              const careerData = careerStatsSnapshot.val();
              console.log('Found existing career stats for student:', studentId);
              
              // If career stats exist but no main student record, this might be a data inconsistency
              console.warn('Career stats exist but no main student record found. Creating main record...');
              // Continue with creation but use info from career stats if available
            }
            
            // Check 3: Additional safety check for recent students (last 24 hours)
            const recentStudentsSnapshot = await firebase.database().ref('students')
              .orderByChild('accountStatus/createdAt')
              .startAt(new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString())
              .once('value');
            
            if (recentStudentsSnapshot.exists()) {
              const recentStudents = recentStudentsSnapshot.val();
              for (const [key, student] of Object.entries(recentStudents)) {
                if (student.studentId === studentId) {
                  console.log('Found duplicate student created in last 24 hours:', studentId);
                  throw new Error(`Student account for ID ${studentId} was recently created. Please try logging in instead.`);
                }
              }
            }
            
            console.log('No duplicates found, proceeding with account creation...');
            
            const studentData = {
              studentId,
              fullName: `Student ${studentId}`, // Default name, can be updated later
              academicInfo: {
                level: 'unknown', // Will be set by student or administrator later
                course: null,
                yearLevel: null,
                strand: null
              },
              accountStatus: {
                isActive: true,
                isFirstLogin: true,
                createdBy: 'auto-created',
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
              },
              progress: {
                completedQuizzes: [],
                completedStories: [],
                totalScore: 0,
                lastActivity: new Date().toISOString()
              },
              gameData: {
                totalPoints: 0,
                achievements: [],
                currentLevel: 1,
                courseProgress: {
                  'Web_Design': { unlocked: true, completed: false, progress: 0 },
                  'Python': { unlocked: true, completed: false, progress: 0 },
                  'Java': { unlocked: false, completed: false, progress: 0 },
                  'C': { unlocked: false, completed: false, progress: 0 },
                  'CPlusPlus': { unlocked: false, completed: false, progress: 0 },
                  'CSharp': { unlocked: false, completed: false, progress: 0 }
                }
              },
              needsProfileCompletion: true, // Flag to show profile completion modal
              accountType: 'student'
            };

            // Use studentId as the key instead of auto-generated key for better consistency
            const studentRef = firebase.database().ref('students').child(studentId);
            await studentRef.set(studentData);
            
            console.log('Student account created successfully with key:', studentId);
            
            return { 
              success: true, 
              docId: studentId, // Return the studentId as the document ID
              studentData: studentData
            };
          } catch (error) {
            console.error('Error creating student account:', error);
            return { success: false, error: 'Failed to create student account: ' + error.message };
          }
        }

        // Create local student account for offline mode
        createLocalStudentAccount(studentId) {
          return {
            studentId,
            fullName: `Student ${studentId}`,
            academicInfo: {
              level: 'unknown',
              course: null,
              yearLevel: null,
              strand: null
            },
            accountStatus: {
              isActive: true,
              isFirstLogin: true,
              createdBy: 'auto-created-local',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString()
            },
            gameData: {
              totalPoints: 0,
              achievements: [],
              courseProgress: {
                'Web_Design': { unlocked: true, completed: false, progress: 0 },
                'Python': { unlocked: true, completed: false, progress: 0 },
                'Java': { unlocked: false, completed: false, progress: 0 },
                'C': { unlocked: false, completed: false, progress: 0 },
                'CPlusPlus': { unlocked: false, completed: false, progress: 0 },
                'CSharp': { unlocked: false, completed: false, progress: 0 }
              }
            }
          };
        }

        async loginGeneral(email, password) {
          try {
            const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            // Get user data from Realtime Database
            const userSnapshot = await firebase.database().ref('general_users').child(user.uid).once('value');
            if (!userSnapshot.exists()) {
              throw new Error('User profile not found');
            }

            const userData = userSnapshot.val();
            
            // Update last login timestamp
            await firebase.database().ref('general_users').child(user.uid).update({
              lastLogin: new Date().toISOString()
            });

            this.currentUser = {
              uid: user.uid,
              email: user.email,
              type: 'general',
              profile: userData
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'general';
            
            // Update professor tab visibility
            this.updateProfessorTabVisibility();
            // Update user interface
            this.updateUserInterface();
            
            return { success: true, user: this.currentUser };
          } catch (error) {
            return { success: false, error: error.message };
          }
        }

        async registerGeneral(formData) {
          try {
            const userCredential = await firebase.auth().createUserWithEmailAndPassword(formData.email, formData.password);
            const user = userCredential.user;

            // Save user data to Realtime Database
            await firebase.database().ref('general_users').child(user.uid).set({
              fullName: formData.fullName,
              email: formData.email,
              displayName: formData.displayName,
              createdAt: new Date().toISOString(),
              gameData: {
                totalPoints: 0,
                achievements: [],
                courseProgress: {}
              }
            });

            return { success: true, message: 'Account created successfully!' };
          } catch (error) {
            return { success: false, error: error.message };
          }
        }

        createGuestSession() {
          const guestId = 'guest_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          this.currentUser = {
            uid: guestId,
            type: 'guest',
            profile: {
              displayName: 'Guest Player',
              isGuest: true
            }
          };
          
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          this.userType = 'guest';
          
          // Update professor tab visibility
          this.updateProfessorTabVisibility();
          // Update user interface (guest won't show logout button)
          this.updateUserInterface();
          
          return this.currentUser;
        }

        logout() {
          // Show confirmation dialog
          modernConfirm('Are you sure you want to logout?', {
            title: 'Confirm Logout',
            type: 'warning',
            confirmText: 'Yes, Logout',
            cancelText: 'Cancel'
          }).then((confirmed) => {
            if (!confirmed) {
              return; // User cancelled logout
            }

            if (this.userType !== 'guest') {
              firebase.auth().signOut();
            }
            
            this.currentUser = null;
            this.userType = null;
            localStorage.removeItem('sci_high_user');
            
            // Update professor tab visibility (hide it)
            this.updateProfessorTabVisibility();
            // Update user interface (hide greeting and logout button)
            this.updateUserInterface();
            
            // Show success message
            showSuccess('You have been logged out successfully!');
          });
        }

        isAuthenticated() {
          return this.currentUser !== null;
        }

        redirectToGame() {
          // Store authentication state for game.html
          sessionStorage.setItem('sci_high_authenticated', 'true');
          sessionStorage.setItem('sci_high_user_type', this.userType);
          window.location.href = 'game.html';
        }

        // Update professor tab visibility based on user type
        updateProfessorTabVisibility() {
          const professorTab = document.getElementById('professor-nav-link');
          if (!professorTab) return;

          // Show professor tab only for professors and admins
          const canAccessProfessorDashboard = this.currentUser && 
            (this.userType === 'professor' || this.userType === 'admin');

          if (canAccessProfessorDashboard) {
            professorTab.classList.remove('hidden');
          } else {
            professorTab.classList.add('hidden');
          }
        }

        // Update user greeting and logout button visibility
        updateUserInterface() {
          const userGreeting = document.getElementById('user-greeting');
          const greetingText = document.getElementById('greeting-text');
          const logoutBtn = document.getElementById('logout-btn');
          const loginBtn = document.getElementById('login-btn');

          if (!userGreeting || !greetingText || !logoutBtn || !loginBtn) return;

          if (this.currentUser && this.userType !== 'guest') {
            // Show user greeting and logout button for logged-in users (except guests)
            userGreeting.classList.remove('hidden');
            logoutBtn.classList.remove('hidden');
            // Hide login button when user is logged in
            loginBtn.classList.add('hidden');

            // Set personalized greeting based on user type
            let greetingMessage = '';
            if (this.userType === 'student') {
              greetingMessage = `Hello, ${this.currentUser.profile?.fullName || this.currentUser.name || 'Student'}!`;
            } else if (this.userType === 'professor') {
              greetingMessage = `Hello, Prof. ${this.currentUser.profile?.fullName || this.currentUser.name || 'Professor'}!`;
            } else if (this.userType === 'admin') {
              greetingMessage = `Hello, Admin ${this.currentUser.profile?.fullName || this.currentUser.name || 'Admin'}!`;
            } else {
              greetingMessage = `Hello, ${this.currentUser.profile?.fullName || this.currentUser.name || 'User'}!`;
            }
            greetingText.textContent = greetingMessage;
          } else {
            // Hide user greeting and logout button for guests or non-logged-in users
            userGreeting.classList.add('hidden');
            logoutBtn.classList.add('hidden');
            // Show login button when user is not logged in
            loginBtn.classList.remove('hidden');
          }
        }

        // DEV MODE: Create admin user for testing
        async createAdminUser() {
          try {
            // Ensure authentication before database operations
            await this.ensureAuthenticated();
            
            const adminData = {
              fullName: 'System Administrator',
              email: 'admin@sci-high.edu',
              isAdmin: true,
              type: 'admin',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString(),
              permissions: ['read', 'write', 'delete', 'admin']
            };

            // Save to Firebase if available (using Realtime Database)
            if (typeof firebase !== 'undefined' && firebase.database) {
              const adminRef = firebase.database().ref('professors').child('admin_system');
              await adminRef.set(adminData);
              console.log('Admin user saved to Realtime Database');
            } else if (typeof firebase !== 'undefined' && firebase.firestore) {
              const adminRef = firebase.firestore().collection('professors').doc('admin_system');
              await adminRef.set(adminData);
              console.log('Admin user saved to Firestore (fallback)');
            }

            this.currentUser = {
              uid: 'admin_system',
              type: 'admin',
              profile: adminData
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'admin';
            this.updateProfessorTabVisibility();
            this.updateUserInterface();
            
            return this.currentUser;
          } catch (error) {
            console.error('Error creating admin user:', error);
            // Fallback to local storage only
            this.currentUser = {
              uid: 'admin_' + Date.now(),
              type: 'admin',
              profile: {
                fullName: 'System Administrator',
                email: 'admin@sci-high.edu',
                isAdmin: true
              }
            };
            
            localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
            this.userType = 'admin';
            this.updateProfessorTabVisibility();
            this.updateUserInterface();
            
            return this.currentUser;
          }
        }

        // DEV MODE: Create professor user in Firebase (Realtime Database version)
        async createProfessorUser(email, password, fullName, institution = 'SCI-HIGH University') {
          try {
            // Ensure Firebase is loaded and initialized
            if (typeof firebase === 'undefined') {
              await this.loadFirebase();
            }
            
            if (!firebase.auth || !firebase.database) {
              throw new Error('Firebase services not available');
            }

            console.log('Creating professor user:', { email, fullName, institution });

            // Create Firebase Auth user
            const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            console.log('Firebase Auth user created:', user.uid);

            // Create professor profile in Realtime Database
            const professorData = {
              fullName: fullName,
              email: email,
              institution: institution,
              isVerified: true,
              type: 'professor',
              createdAt: new Date().toISOString(),
              lastLogin: new Date().toISOString(),
              permissions: ['read', 'write'],
              classes: [],
              students: []
            };

            console.log('Saving professor data to Realtime Database...');
            
            // Add retry logic for Database write
            let retries = 3;
            while (retries > 0) {
              try {
                await firebase.database().ref('professors').child(user.uid).set(professorData);
                console.log('Professor data saved successfully');
                break;
              } catch (databaseError) {
                console.error(`Database write attempt failed (${4-retries}/3):`, databaseError);
                retries--;
                if (retries === 0) {
                  throw databaseError;
                }
                // Wait 1 second before retry
                await new Promise(resolve => setTimeout(resolve, 1000));
              }
            }

            console.log('Professor user created successfully:', {
              uid: user.uid,
              email: email,
              fullName: fullName
            });

            return {
              success: true,
              uid: user.uid,
              email: email,
              profile: professorData
            };

          } catch (error) {
            console.error('Error creating professor user:', error);
            
            // Enhanced error information
            if (error.code) {
              console.error('Firebase error code:', error.code);
            }
            if (error.message) {
              console.error('Firebase error message:', error.message);
            }
            
            return {
              success: false,
              error: error.message,
              code: error.code || 'unknown'
            };
          }
        }
      }

      // Global debug function for testing authentication
      window.debugAuth = async () => {
        console.log('üîç Debugging Authentication...');
        
        try {
          // Test Firebase availability
          console.log('Firebase available:', typeof firebase !== 'undefined');
          if (typeof firebase !== 'undefined') {
            console.log('Firebase Auth available:', !!firebase.auth);
            console.log('Firebase Database available:', !!firebase.database);
            
            if (firebase.auth) {
              console.log('Current user:', firebase.auth().currentUser);
              
              // Test authentication
              if (!firebase.auth().currentUser) {
                console.log('Attempting anonymous authentication...');
                await firebase.auth().signInAnonymously();
                console.log('‚úÖ Authentication successful');
              }
              
              // Test database access
              if (firebase.database) {
                console.log('Testing database read access...');
                const testRef = firebase.database().ref('test/debug');
                await testRef.set({ timestamp: new Date().toISOString() });
                const snapshot = await testRef.once('value');
                console.log('‚úÖ Database access successful:', snapshot.val());
              }
            }
          }
          
          console.log('üéâ Debug completed successfully!');
        } catch (error) {
          console.error('‚ùå Debug failed:', error);
        }
      };

      // Test student login function for debugging
      window.debugStudentLogin = async (studentId = '20-0774-140') => {
        console.log(`üîç Debugging student login for ID: ${studentId}`);
        
        try {
          const result = await authManager.loginStudent(studentId);
          console.log('Login result:', result);
          return result;
        } catch (error) {
          console.error('‚ùå Student login debug failed:', error);
          return { success: false, error: error.message };
        }
      };

      // Initialize AuthManager and ensure Firebase is ready
      const authManager = new AuthManager();
      
      // Add offline fallback for localhost testing
      authManager.createOfflineTestAccounts = function() {
        console.log('Creating offline test accounts for localhost development');
        
        // Add a simple offline authentication fallback
        this.loginStudentOffline = function(studentId) {
          console.log('Using offline student login for:', studentId);
          this.currentUser = {
            uid: 'offline_' + studentId,
            studentId: studentId,
            type: 'student',
            profile: {
              studentId: studentId,
              fullName: `Student ${studentId}`,
              isOffline: true
            }
          };
          this.userType = 'student';
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          return { success: true, user: this.currentUser, isNewAccount: true };
        };
        
        this.loginGeneralOffline = function(email) {
          console.log('Using offline general login for:', email);
          this.currentUser = {
            uid: 'offline_' + email.replace('@', '_'),
            email: email,
            type: 'general',
            profile: {
              fullName: 'Offline User',
              email: email,
              isOffline: true
            }
          };
          this.userType = 'general';
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          return { success: true, user: this.currentUser };
        };
        
        // Enhanced student profile methods
        this.getStudentProfile = async function(studentId) {
          console.log('getStudentProfile called with studentId:', studentId);
          
          try {
            // Try to get from Firebase first
            if (typeof firebase !== 'undefined' && firebase.database) {
              console.log('Querying Firebase for student:', studentId);
              await this.ensureAuthenticated(); // Make sure we're authenticated
              
              const snapshot = await firebase.database().ref('students').orderByChild('studentId').equalTo(studentId).once('value');
              const data = snapshot.val();
              console.log('Firebase query result:', data);
              
              if (data) {
                const studentKey = Object.keys(data)[0];
                const studentData = data[studentKey];
                console.log('Found student in Firebase:', studentData);
                
                // Also check for career stats data which might have additional profile info
                let careerStatsData = null;
                try {
                  const careerStatsSnapshot = await firebase.database().ref(`student_career_stats/${studentId}`).once('value');
                  if (careerStatsSnapshot.exists()) {
                    careerStatsData = careerStatsSnapshot.val();
                    console.log('Found career stats data for student:', careerStatsData);
                  }
                } catch (error) {
                  console.log('No career stats found for student (this is normal for new students):', error.message);
                }

                // Merge career stats data with main student data if available
                const mergedStudentData = { ...studentData };
                if (careerStatsData) {
                  // Merge profile information from career stats
                  if (careerStatsData.firstName) mergedStudentData.firstName = careerStatsData.firstName;
                  if (careerStatsData.lastName) mergedStudentData.lastName = careerStatsData.lastName;
                  if (careerStatsData.department) mergedStudentData.department = careerStatsData.department;
                  if (careerStatsData.strandYear) mergedStudentData.strandYear = careerStatsData.strandYear;
                  
                  // Update fullName if we have both first and last name
                  if (careerStatsData.firstName && careerStatsData.lastName) {
                    mergedStudentData.fullName = `${careerStatsData.firstName} ${careerStatsData.lastName}`;
                  }
                }
                
                console.log('Merged student data:', mergedStudentData);
                return mergedStudentData;
              } else {
                console.log('No student found in Firebase with studentId:', studentId);
              }
            } else {
              console.log('Firebase database not available');
            }
          } catch (error) {
            console.warn('Firebase getStudentProfile failed:', error);
          }
          
          // Fallback to offline storage
          console.log('Checking offline storage...');
          const offlineStudents = JSON.parse(localStorage.getItem('sci_high_offline_students') || '[]');
          const offlineResult = offlineStudents.find(s => s.studentId === studentId) || null;
          console.log('Offline storage result:', offlineResult);
          return offlineResult;
        };
        
        this.loginStudentWithProfile = async function(studentId, profileData) {
          try {
            // Try Firebase first
            if (typeof firebase !== 'undefined' && firebase.database) {
              await this.ensureAuthenticated(); // Make sure we're authenticated
              
              const studentsRef = firebase.database().ref('students');
              
              // Check if student exists
              const snapshot = await studentsRef.orderByChild('studentId').equalTo(studentId).once('value');
              const existingData = snapshot.val();
              let studentKey;
              
              if (existingData) {
                studentKey = Object.keys(existingData)[0];
                // Update existing student with new profile data
                await studentsRef.child(studentKey).update({
                  firstName: profileData.firstName,
                  lastName: profileData.lastName,
                  fullName: `${profileData.firstName} ${profileData.lastName}`,
                  department: profileData.department,
                  strandYear: profileData.strandYear,
                  strand: profileData.strand,
                  year: profileData.year,
                  lastLogin: new Date().toISOString(),
                  profileCompleted: true,
                  needsProfileCompletion: false // Clear the flag
                });
              } else {
                // Create new student
                const newStudentData = {
                  studentId,
                  firstName: profileData.firstName,
                  lastName: profileData.lastName,
                  fullName: `${profileData.firstName} ${profileData.lastName}`,
                  department: profileData.department,
                  strandYear: profileData.strandYear,
                  strand: profileData.strand,
                  year: profileData.year,
                  isActive: true,
                  createdAt: new Date().toISOString(),
                  lastLogin: new Date().toISOString(),
                  profileCompleted: true,
                  needsProfileCompletion: false, // Profile is now complete
                  progress: {
                    completedQuizzes: [],
                    completedStories: [],
                    totalScore: 0,
                    lastActivity: new Date().toISOString(),
                    gameData: {
                      currentLevel: 1,
                      totalPoints: 0,
                      achievements: [],
                      courseProgress: {}
                    }
                  }
                };
                
                const newRef = await studentsRef.push(newStudentData);
                studentKey = newRef.key;
              }
              
              // Set current user
              this.currentUser = {
                uid: studentKey,
                studentId: studentId,
                type: 'student',
                profile: {
                  studentId,
                  firstName: profileData.firstName,
                  lastName: profileData.lastName,
                  fullName: `${profileData.firstName} ${profileData.lastName}`,
                  department: profileData.department,
                  strandYear: profileData.strandYear,
                  profileCompleted: true
                }
              };
              this.userType = 'student';
              localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
              
              return { success: true, user: this.currentUser };
            }
          } catch (error) {
            console.warn('Firebase loginStudentWithProfile failed:', error);
          }
          
          // Fallback to offline
          return this.loginStudentOfflineWithProfile(studentId, profileData);
        };
        
        this.loginStudentOfflineWithProfile = function(studentId, profileData) {
          console.log('Using offline student login with profile for:', studentId);
          
          const studentData = {
            studentId,
            firstName: profileData.firstName,
            lastName: profileData.lastName,
            fullName: `${profileData.firstName} ${profileData.lastName}`,
            department: profileData.department,
            strandYear: profileData.strandYear,
            isOffline: true,
            profileCompleted: true,
            createdAt: new Date().toISOString(),
            lastLogin: new Date().toISOString()
          };
          
          // Save to offline storage
          const offlineStudents = JSON.parse(localStorage.getItem('sci_high_offline_students') || '[]');
          const existingIndex = offlineStudents.findIndex(s => s.studentId === studentId);
          
          if (existingIndex >= 0) {
            offlineStudents[existingIndex] = { ...offlineStudents[existingIndex], ...studentData };
          } else {
            offlineStudents.push(studentData);
          }
          
          localStorage.setItem('sci_high_offline_students', JSON.stringify(offlineStudents));
          
          this.currentUser = {
            uid: 'offline_' + studentId,
            studentId: studentId,
            type: 'student',
            profile: studentData
          };
          this.userType = 'student';
          localStorage.setItem('sci_high_user', JSON.stringify(this.currentUser));
          
          return { success: true, user: this.currentUser };
        };
      };
      
      // Initialize offline accounts
      authManager.createOfflineTestAccounts();

      // DOM-dependent initialization (run after DOM loads)
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded fired');
        
        // Initialize global modal variables
        globalLoginModal = document.getElementById('login-modal');
        globalScreenshotsModal = document.getElementById('screenshots-modal');
        
        // Check for critical elements
        const criticalElements = {
          'login-modal': globalLoginModal,
          'screenshots-modal': globalScreenshotsModal,
          'start-game-btn': document.getElementById('start-game-btn'),
          'professor-login-form': document.getElementById('professor-login-form'),
          'student-complete-form': document.getElementById('student-complete-form'),
          'general-login-form': document.getElementById('general-login-form'),
          'general-register-form': document.getElementById('general-register-form'),
          'guest-option': document.getElementById('guest-option')
        };
        
        console.log('Critical elements check:');
        Object.entries(criticalElements).forEach(([id, element]) => {
          console.log(`${id}:`, element ? '‚úÖ Found' : '‚ùå Missing');
        });
        
        // Modal Management - Use global variables
        const loginModal = globalLoginModal;
        const screenshotsModal = globalScreenshotsModal;
        const startGameBtn = document.getElementById('start-game-btn');

        console.log('Elements found:', {
          loginModal: !!loginModal,
          screenshotsModal: !!screenshotsModal,
          startGameBtn: !!startGameBtn
        });

      // User Type Selection Elements
      const userTypeSelection = document.getElementById('user-type-selection');
      const professorForm = document.getElementById('professor-form');
      const studentForm = document.getElementById('student-form');
      const generalForm = document.getElementById('general-form');
      const backToSelection = document.getElementById('back-to-selection');

      // Show Specific Form
      function showForm(formType) {
        userTypeSelection.classList.add('hidden');
        professorForm.classList.add('hidden');
        studentForm.classList.add('hidden');
        generalForm.classList.add('hidden');
        backToSelection.classList.remove('hidden');

        switch(formType) {
          case 'professor':
            professorForm.classList.remove('hidden');
            break;
          case 'student':
            studentForm.classList.remove('hidden');
            break;
          case 'general':
            generalForm.classList.remove('hidden');
            break;
        }
      }

      // Event Listeners for User Type Selection
      document.getElementById('professor-option').addEventListener('click', () => showForm('professor'));
      document.getElementById('student-option').addEventListener('click', () => showForm('student'));
      document.getElementById('general-option').addEventListener('click', () => showForm('general'));
      
      document.getElementById('guest-option').addEventListener('click', () => {
        authManager.createGuestSession();
        loginModal.classList.add('hidden');
        authManager.redirectToGame();
      });

      // Back to selection
      backToSelection.addEventListener('click', showUserTypeSelection);

      // Form Submissions
      document.getElementById('professor-login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        // Use the local authManager instead of importing external service
        const result = await authManager.loginProfessor(formData.get('email'), formData.get('password'));
        
        if (result.success) {
          loginModal.classList.add('hidden');
          // Redirect to professor dashboard
          window.location.href = 'professor-dashboard.html';
        } else {
          showError('Login failed: ' + result.error, { title: 'Professor Login Failed' });
        }
      });

      // Student Login Process
      let currentStudentId = null;
      let currentStudentData = null;
      
      // Step 1: Verify Student ID
      document.getElementById('verify-student-id').addEventListener('click', async () => {
        const studentIdInput = document.getElementById('student-id-input');
        const studentId = studentIdInput.value.trim();
        
        // Validate student ID format (XX-XXXX-XXX)
        const studentIdPattern = /^[0-9]{2}-[0-9]{4}-[0-9]{3}$/;
        if (!studentIdPattern.test(studentId)) {
          showError('Invalid Student ID format!\n\nPlease use the format: XX-XXXX-XXX\nExample: 24-2024-001\n\n‚Ä¢ XX = 2-digit year/batch\n‚Ä¢ XXXX = 4-digit year\n‚Ä¢ XXX = 3-digit sequence number', {
            title: 'Invalid Student ID Format'
          });
          return;
        }
        
        currentStudentId = studentId;
        
        try {
          // Check if student exists in the database
          const studentData = await authManager.getStudentProfile(studentId);
          
          console.log('Retrieved student data:', studentData);
          
          if (studentData) {
            // Student exists in database, show welcome screen
            console.log('Student found in database, showing profile found step');
            showStudentFoundStep(studentData);
          } else {
            // Student doesn't exist, show profile completion form
            console.log('Student not found in database, showing profile completion form');
            showStudentProfileStep(null);
          }
        } catch (error) {
          console.warn('Error checking student profile:', error);
          // If Firebase is down, show profile completion form
          showStudentProfileStep(null);
        }
      });
      
      // Step 2: Complete Profile Form
      document.getElementById('student-complete-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        const strand = formData.get('strand');
        const year = formData.get('year');
        const strandYear = `${year} Year ${strand}`; // Combine strand and year
        
        const profileData = {
          studentId: currentStudentId,
          firstName: formData.get('firstName').trim(),
          lastName: formData.get('lastName').trim(),
          department: formData.get('department'),
          strandYear: strandYear,
          strand: strand,
          year: year
        };
        
        try {
          // Complete the student login with profile data
          const result = await authManager.loginStudentWithProfile(currentStudentId, profileData);
          
          if (result.success) {
            showSuccess('Welcome! Your profile has been set up successfully. Your progress will be saved automatically.', {
              title: 'üéâ Profile Complete!'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Profile setup failed: ' + result.error, { title: 'Setup Failed' });
          }
        } catch (error) {
          console.warn('Firebase profile setup failed, trying offline mode:', error);
          // Fallback to offline mode
          const offlineResult = authManager.loginStudentOfflineWithProfile(currentStudentId, profileData);
          if (offlineResult.success) {
            showInfo('Welcome! Your profile has been set up in offline mode. Progress will be saved locally.', {
              title: 'üì± Offline Mode'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Profile setup failed: Unable to save profile', { title: 'Setup Error' });
          }
        }
      });
      
      // Step 3: Login Existing Student
      document.getElementById('login-existing-student').addEventListener('click', async () => {
        try {
          const result = await authManager.loginStudent(currentStudentId);
          
          if (result.success) {
            showSuccess('Welcome back! Your progress has been loaded.', {
              title: 'üëã Welcome Back!'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Login failed: ' + result.error, { title: 'Student Login Failed' });
          }
        } catch (error) {
          console.warn('Firebase login failed, trying offline mode:', error);
          // Fallback to offline mode
          const offlineResult = authManager.loginStudentOffline(currentStudentId);
          if (offlineResult.success) {
            showInfo('Welcome! You are playing in offline mode. Progress will be saved locally.', {
              title: 'üì± Offline Mode'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Login failed: Unable to authenticate', { title: 'Authentication Error' });
          }
        }
      });
      
      // Helper functions for step management
      function showStudentProfileStep(existingData) {
        document.getElementById('student-id-step').classList.add('hidden');
        document.getElementById('student-found-step').classList.add('hidden');
        document.getElementById('student-profile-step').classList.remove('hidden');
        
        // Pre-fill existing data if available
        if (existingData) {
          const form = document.getElementById('student-complete-form');
          if (existingData.firstName) form.querySelector('[name="firstName"]').value = existingData.firstName;
          if (existingData.lastName) form.querySelector('[name="lastName"]').value = existingData.lastName;
          if (existingData.department) form.querySelector('[name="department"]').value = existingData.department;
          
          // Handle separate strand and year fields
          if (existingData.strand) form.querySelector('[name="strand"]').value = existingData.strand;
          if (existingData.year) form.querySelector('[name="year"]').value = existingData.year;
          
          // If only strandYear exists (legacy data), try to parse it
          if (existingData.strandYear && !existingData.strand && !existingData.year) {
            const parseStrandYear = (strandYear) => {
              // Try to extract year and strand from combined string
              const yearMatch = strandYear.match(/(\d+)(st|nd|rd|th)/i);
              const year = yearMatch ? yearMatch[1] + (yearMatch[2] || '') : '';
              
              let strand = '';
              if (strandYear.includes('BSCS') || strandYear.includes('BS CS')) strand = 'BSCS';
              else if (strandYear.includes('BSIT') || strandYear.includes('BS IT')) strand = 'BSIT';
              else if (strandYear.includes('ICT')) strand = 'ICT';
              
              return { strand, year };
            };
            
            const { strand, year } = parseStrandYear(existingData.strandYear);
            if (strand) form.querySelector('[name="strand"]').value = strand;
            if (year) form.querySelector('[name="year"]').value = year;
          }
        }
      }
      
      function showStudentFoundStep(studentData) {
        document.getElementById('student-id-step').classList.add('hidden');
        document.getElementById('student-profile-step').classList.add('hidden');
        document.getElementById('student-found-step').classList.remove('hidden');
        
        // Extract student information from various possible data structures
        const firstName = studentData.firstName || (studentData.fullName ? studentData.fullName.split(' ')[0] : 'Student');
        const lastName = studentData.lastName || (studentData.fullName ? studentData.fullName.split(' ').slice(1).join(' ') : '');
        const fullName = studentData.fullName || `${firstName} ${lastName}`.trim();
        const department = studentData.department || studentData.academicInfo?.department || 'Unknown Department';
        const strandYear = studentData.strandYear || 
                          (studentData.strand && studentData.year ? `${studentData.year} Year ${studentData.strand}` : '') ||
                          studentData.academicInfo?.course || 'Unknown Program';
        const studentId = studentData.studentId || currentStudentId;
        
        // Show student profile preview
        const preview = document.getElementById('student-profile-preview');
        preview.innerHTML = `
          <p><strong>üë§ Name:</strong> ${fullName}</p>
          <p><strong>üéì Department:</strong> ${department}</p>
          <p><strong>üìö Program:</strong> ${strandYear}</p>
          <p><strong>üÜî Student ID:</strong> ${studentId}</p>
        `;
        
        currentStudentData = studentData;
      }
      
      // Allow Enter key to trigger verification
      document.getElementById('student-id-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('verify-student-id').click();
        }
      });

      document.getElementById('general-login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        try {
          // Use the local authManager instead of importing external service
          const result = await authManager.loginGeneral(formData.get('email'), formData.get('password'));
          
          if (result.success) {
            loginModal.classList.add('hidden');
            authManager.redirectToGame();
          } else {
            showError('Login failed: ' + result.error, { title: 'General Login Failed' });
          }
        } catch (error) {
          console.warn('Firebase login failed, trying offline mode:', error);
          // Fallback to offline mode
          const offlineResult = authManager.loginGeneralOffline(formData.get('email'));
          if (offlineResult.success) {
            showInfo('Welcome! You are playing in offline mode. Progress will be saved locally.', {
              title: 'üì± Offline Mode'
            }).then(() => {
              loginModal.classList.add('hidden');
              authManager.redirectToGame();
            });
          } else {
            showError('Login failed: Unable to authenticate', { title: 'Authentication Error' });
          }
        }
      });

      document.getElementById('general-register-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        // Use the local authManager instead of importing external service
        const result = await authManager.registerGeneral({
          fullName: formData.get('fullName'),
          email: formData.get('email'),
          displayName: formData.get('displayName'),
          password: formData.get('password')
        });
        
        if (result.success) {
          showSuccess('Account created successfully!', { title: 'üéâ Registration Complete' }).then(() => {
            e.target.reset();
            // Auto-login after successful registration
            loginModal.classList.add('hidden');
            authManager.redirectToGame();
          });
        } else {
          showError('Registration failed: ' + result.error, { title: 'Registration Failed' });
        }
      });

      // Close Modal Functions with error handling
      const closeLoginModalBtn = document.getElementById('close-login-modal');
      if (closeLoginModalBtn) {
        closeLoginModalBtn.addEventListener('click', () => {
          if (loginModal) {
            loginModal.classList.add('hidden');
            resetStudentFormSteps(); // Reset student form when modal closes
          }
        });
      } else {
        console.warn('Close login modal button not found');
      }

      // Close modal on outside click
      if (loginModal) {
        loginModal.addEventListener('click', (e) => {
          if (e.target === loginModal) {
            loginModal.classList.add('hidden');
            resetStudentFormSteps(); // Reset student form when modal closes
          }
        });
      } else {
        console.warn('Login modal not found for outside click handler');
      }

      // Gaming Modal and Carousel System
      const screenshots = [
        'public/assets/classroom_day-7QRgWPJs.png',
        'public/assets/img/bg/libraryBG.png',
        'public/assets/img/mainhub/MainHubBG.png'
      ];
      
      const closeModalBtn = document.getElementById('close-screenshots-modal');
      const carouselImg = document.getElementById('carousel-image');
      const prevBtn = document.getElementById('carousel-prev');
      const nextBtn = document.getElementById('carousel-next');
      const dots = document.querySelectorAll('#carousel-dots .dot');
      let current = 0;

      function showScreenshot(idx) {
        carouselImg.src = screenshots[idx];
        carouselImg.style.transform = 'scale(0.95)';
        setTimeout(() => {
          carouselImg.style.transform = 'scale(1)';
        }, 150);
        
        dots.forEach((dot, i) => {
          if (i === idx) {
            dot.classList.add('bg-primary', 'scale-110');
            dot.classList.remove('bg-gray-500');
          } else {
            dot.classList.remove('bg-primary', 'scale-110');
            dot.classList.add('bg-gray-500');
          }
        });
        current = idx;
      }

      // Updated Start Game Button Event Listener
      if (startGameBtn) {
        console.log('Start game button found, adding event listener');
        startGameBtn.addEventListener('click', () => {
          console.log('Start game button clicked');
          console.log('Auth manager:', authManager);
          console.log('Is authenticated:', authManager.isAuthenticated());
          
          // Check if user is already authenticated
          if (authManager.isAuthenticated()) {
            console.log('User is authenticated, redirecting to game');
            authManager.redirectToGame();
          } else {
            // Show login modal first
            console.log('User not authenticated, showing login modal');
            showLoginModal();
          }
        });
      } else {
        console.error('Start game button not found - ID: start-game-btn');
        // Try to find button with a more generic search
        const allButtons = document.querySelectorAll('button');
        console.log('All buttons found:', allButtons.length);
        allButtons.forEach((btn, index) => {
          console.log(`Button ${index}:`, btn.id, btn.textContent?.trim());
        });
      }
      
      // Screenshots modal close handlers with error handling  
      if (closeModalBtn && screenshotsModal) {
        closeModalBtn.addEventListener('click', () => {
          screenshotsModal.classList.add('hidden');
        });
      } else {
        console.warn('Screenshots modal or close button not found:', {
          closeBtn: !!closeModalBtn,
          modal: !!screenshotsModal
        });
      }
      
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          let prev = (current - 1 + screenshots.length) % screenshots.length;
          showScreenshot(prev);
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          let next = (current + 1) % screenshots.length;
          showScreenshot(next);
        });
      }
      
      dots.forEach((dot, i) => {
        dot.addEventListener('click', () => showScreenshot(i));
      });
      
      // Close modal on outside click with error handling
      if (screenshotsModal) {
        screenshotsModal.addEventListener('click', (e) => {
          if (e.target === screenshotsModal) screenshotsModal.classList.add('hidden');
        });
      } else {
        console.warn('Screenshots modal not found for outside click handler');
      }

      // Smooth scrolling for navigation
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });

      // Gaming hover effects for nav links
      document.querySelectorAll('.gaming-nav-link').forEach(link => {
        link.addEventListener('mouseenter', function() {
          this.querySelector('div').style.transform = 'skewX(12deg) scaleX(1)';
        });
        link.addEventListener('mouseleave', function() {
          this.querySelector('div').style.transform = 'skewX(12deg) scaleX(0)';
        });
      });

      // Initialize particle system when page loads
      document.addEventListener('DOMContentLoaded', () => {
        createParticles();
        
        // Add random floating animation to particles
        setInterval(() => {
          const particles = document.querySelectorAll('#particles div');
          particles.forEach(particle => {
            if (Math.random() > 0.95) {
              particle.style.transform = `translateY(${Math.random() * 20 - 10}px)`;
              setTimeout(() => {
                particle.style.transform = 'translateY(0)';
              }, 2000);
            }
          });
        }, 3000);
      });

      // Easter egg: Konami code
      let konamiCode = [];
      const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // ‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA
      
      // Dev mode activation: Press D-E-V
      let devCode = [];
      const devKeys = [68, 69, 86]; // D-E-V
      
      document.addEventListener('keydown', (e) => {
        // Konami code for visual effect
        konamiCode.push(e.keyCode);
        if (konamiCode.length > konami.length) {
          konamiCode.shift();
        }
        if (konamiCode.join(',') === konami.join(',')) {
          document.body.style.filter = 'hue-rotate(180deg)';
          setTimeout(() => {
            document.body.style.filter = 'none';
          }, 3000);
          konamiCode = [];
        }

        // Dev mode activation
        devCode.push(e.keyCode);
        if (devCode.length > devKeys.length) {
          devCode.shift();
        }
        if (devCode.join(',') === devKeys.join(',')) {
          const devPanel = document.getElementById('dev-panel');
          devPanel.classList.toggle('hidden');
          if (!devPanel.classList.contains('hidden')) {
            showInfo('DEV MODE ACTIVATED!\nUse the panel or console commands to create test accounts.', {
              title: 'üîß Developer Mode',
              type: 'info'
            });
          }
          devCode = [];
        }
      });

      // DEV MODE: Console functions for testing
      // Usage in browser console: createAdminUser()
      window.createAdminUser = async () => {
        const admin = await authManager.createAdminUser();
        console.log('Admin user created:', admin);
        showSuccess('Admin user created! Professor tab should now be visible.', {
          title: 'üîß Admin Created'
        });
        return admin;
      };

      // Create professor user with Firebase integration
      window.createProfessorUser = async (email, password, fullName, institution) => {
        if (!email || !password || !fullName) {
          showWarning('Usage: createProfessorUser("email@domain.com", "password", "Full Name", "Institution (optional)")', {
            title: 'Missing Parameters'
          });
          return;
        }
        
        const result = await authManager.createProfessorUser(email, password, fullName, institution);
        if (result.success) {
          console.log('Professor user created successfully:', result);
          showSuccess(`Professor user created!\nEmail: ${email}\nUID: ${result.uid}\nThe professor can now login with their email and password.`, {
            title: '‚úÖ Professor Created'
          });
        } else {
          console.error('Failed to create professor user:', result.error);
          showError(`Failed to create professor user: ${result.error}`, {
            title: '‚ùå Creation Failed'
          });
        }
        return result;
      };

      // Debug function to test Firebase connectivity
      window.testFirebase = async () => {
        const result = await authManager.testFirebaseConnection();
        if (result.success) {
          console.log('‚úÖ Firebase connection test passed');
          showSuccess('Firebase connection test passed! Check console for details.', {
            title: '‚úÖ Connection Test Passed'
          });
        } else {
          console.error('‚ùå Firebase connection test failed:', result.error);
          showError(`Firebase connection test failed: ${result.error}`, {
            title: '‚ùå Connection Test Failed'
          });
        }
        return result;
      };

      window.createSampleProfessor = () => {
        const professor = {
          uid: 'prof_' + Date.now(),
          type: 'professor',
          profile: {
            fullName: 'Dr. Sample Professor',
            email: 'professor@sci-high.edu',
            institution: 'SCI-HIGH University',
            isVerified: true
          }
        };
        
        authManager.currentUser = professor;
        authManager.userType = 'professor';
        localStorage.setItem('sci_high_user', JSON.stringify(professor));
        authManager.updateProfessorTabVisibility();
        authManager.updateUserInterface();
        
        console.log('Sample professor created:', professor);
        showSuccess('Sample professor created!\nEmail: professor@sci-high.edu\nPassword: Prof123!', {
          title: 'üë®‚Äçüè´ Sample Professor Created'
        });
        return professor;
      };

      window.createSampleStudent = () => {
        const student = {
          uid: 'stud_' + Date.now(),
          type: 'student',
          studentId: '24-2024-001',
          profile: {
            studentId: '24-2024-001',
            fullName: 'Juan Dela Cruz',
            academicInfo: {
              level: 'college',
              course: 'BS Computer Science',
              yearLevel: '3rd Year'
            },
            accountStatus: {
              isFirstLogin: false,
              createdBy: 'prof_sample',
              lastLogin: new Date().toISOString()
            },
            gameData: {
              totalPoints: 850,
              courseProgress: {
                python: { progress: 75, completed: 8, total: 12 },
                javascript: { progress: 60, completed: 6, total: 10 },
                java: { progress: 45, completed: 4, total: 9 }
              }
            }
          }
        };
        
        authManager.currentUser = student;
        authManager.userType = 'student';
        localStorage.setItem('sci_high_user', JSON.stringify(student));
        authManager.updateProfessorTabVisibility();
        authManager.updateUserInterface();
        
        console.log('Sample student created:', student);
        showSuccess('Sample student created!\nStudent ID: 24-2024-001\nNo password needed!\n\nOther test accounts:\n- 24-2024-002 (Maria Santos)\n- 24-2024-003 (Pedro Garcia)', {
          title: 'üéì Sample Student Created'
        });
        return student;
      };

      window.createSampleGeneral = () => {
        const generalUser = {
          uid: 'gen_' + Date.now(),
          type: 'general',
          profile: {
            fullName: 'Maria Santos',
            email: 'maria@example.com',
            displayName: 'CodeMaster_Maria',
            gameData: {
              totalPoints: 1200,
              achievements: ['First Steps', 'Code Warrior', 'Puzzle Solver'],
              courseProgress: {
                python: { progress: 90, completed: 10, total: 12 },
                webdesign: { progress: 85, completed: 9, total: 10 }
              }
            }
          }
        };
        
        authManager.currentUser = generalUser;
        authManager.userType = 'general';
        localStorage.setItem('sci_high_user', JSON.stringify(generalUser));
        authManager.updateProfessorTabVisibility();
        authManager.updateUserInterface();
        
        console.log('Sample general user created:', generalUser);
        showSuccess('Sample general user created!\nEmail: maria@example.com\nPassword: General123!', {
          title: 'üåü General User Created'
        });
        return generalUser;
      };

      // Create 3 sample career stats entries
      window.createSampleCareerStats = async () => {
        try {
          console.log('Creating 3 sample career stats entries...');
          
          const sampleCareerStats = [
            {
              studentId: 'student_001',
              careerStats: {
                totalPoints: 2450,
                totalSessions: 18,
                averageAccuracy: 87.5,
                highestStreak: 15,
                totalQuestions: 180,
                totalPlayTime: 7200, // 2 hours in seconds
                courseCompletionStatus: {
                  python: true,
                  java: true,
                  csharp: false,
                  cpp: true,
                  c: false,
                  webdesign: true
                },
                globalRank: 1,
                departmentRank: 1
              },
              studentInfo: {
                fullName: 'Maria Santos',
                lastUpdated: new Date().toISOString()
              },
              firstName: 'Maria',
              lastName: 'Santos',
              department: 'College - BS Computer Science',
              strandYear: '3rd Year',
              recentSessions: {
                session_001: {
                  timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // 1 day ago
                  course: 'python',
                  score: 92,
                  questionsAnswered: 10,
                  points: 184,
                  accuracy: 92,
                  streak: 8
                },
                session_002: {
                  timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), // 3 days ago
                  course: 'java',
                  score: 85,
                  questionsAnswered: 12,
                  points: 170,
                  accuracy: 85,
                  streak: 6
                },
                session_003: {
                  timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 1 week ago
                  course: 'webdesign',
                  score: 88,
                  questionsAnswered: 8,
                  points: 140,
                  accuracy: 88,
                  streak: 5
                }
              }
            },
            {
              studentId: 'student_002',
              careerStats: {
                totalPoints: 1890,
                totalSessions: 14,
                averageAccuracy: 78.2,
                highestStreak: 12,
                totalQuestions: 140,
                totalPlayTime: 5400, // 1.5 hours in seconds
                courseCompletionStatus: {
                  python: true,
                  java: false,
                  csharp: true,
                  cpp: false,
                  c: true,
                  webdesign: false
                },
                globalRank: 2,
                departmentRank: 1
              },
              studentInfo: {
                fullName: 'John Carlo Reyes',
                lastUpdated: new Date().toISOString()
              },
              firstName: 'John Carlo',
              lastName: 'Reyes',
              department: 'Senior High - STEM',
              strandYear: 'Grade 12',
              recentSessions: {
                session_001: {
                  timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago
                  course: 'c',
                  score: 76,
                  questionsAnswered: 10,
                  points: 152,
                  accuracy: 76,
                  streak: 4
                },
                session_002: {
                  timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5 days ago
                  course: 'csharp',
                  score: 82,
                  questionsAnswered: 10,
                  points: 164,
                  accuracy: 82,
                  streak: 7
                },
                session_003: {
                  timestamp: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(), // 10 days ago
                  course: 'python',
                  score: 89,
                  questionsAnswered: 15,
                  points: 178,
                  accuracy: 89,
                  streak: 12
                }
              }
            },
            {
              studentId: 'student_003',
              careerStats: {
                totalPoints: 1230,
                totalSessions: 9,
                averageAccuracy: 73.8,
                highestStreak: 8,
                totalQuestions: 90,
                totalPlayTime: 3600, // 1 hour in seconds
                courseCompletionStatus: {
                  python: true,
                  java: false,
                  csharp: false,
                  cpp: false,
                  c: false,
                  webdesign: true
                },
                globalRank: 3,
                departmentRank: 2
              },
              studentInfo: {
                fullName: 'Anna Mae Garcia',
                lastUpdated: new Date().toISOString()
              },
              firstName: 'Anna Mae',
              lastName: 'Garcia',
              department: 'Senior High - ICT',
              strandYear: 'Grade 11',
              recentSessions: {
                session_001: {
                  timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(), // 1 day ago
                  course: 'webdesign',
                  score: 71,
                  questionsAnswered: 8,
                  points: 113,
                  accuracy: 71,
                  streak: 3
                },
                session_002: {
                  timestamp: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString(), // 4 days ago
                  course: 'python',
                  score: 78,
                  questionsAnswered: 12,
                  points: 156,
                  accuracy: 78,
                  streak: 6
                },
                session_003: {
                  timestamp: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(), // 8 days ago
                  course: 'webdesign',
                  score: 68,
                  questionsAnswered: 10,
                  points: 136,
                  accuracy: 68,
                  streak: 4
                }
              }
            }
          ];

          // Upload each sample career stat to Firebase
          const db = firebase.database();
          const promises = sampleCareerStats.map(async (careerData, index) => {
            const studentId = careerData.studentId;
            console.log(`Uploading career stats for ${careerData.studentInfo.fullName}...`);
            
            await db.ref(`student_career_stats/${studentId}`).set(careerData);
            console.log(`‚úÖ Career stats uploaded for ${careerData.studentInfo.fullName}`);
          });

          await Promise.all(promises);
          
          console.log('üéâ Successfully created 3 sample career stats entries!');
          console.log('üìä Sample data includes:');
          console.log('   ‚Ä¢ Maria Santos (College CS, Rank #1): 2450 pts, 87.5% accuracy, 4/6 courses');
          console.log('   ‚Ä¢ John Carlo Reyes (SHS STEM, Rank #2): 1890 pts, 78.2% accuracy, 3/6 courses');
          console.log('   ‚Ä¢ Anna Mae Garcia (SHS ICT, Rank #3): 1230 pts, 73.8% accuracy, 2/6 courses');
          console.log('üîó View results at: leaderboards.html');
          
          return sampleCareerStats;
        } catch (error) {
          console.error('‚ùå Error creating sample career stats:', error);
          throw error;
        }
      };

      window.logoutUser = () => {
        authManager.logout();
      };

      // Helper function to show all available console commands
      window.showDevCommands = () => {
        console.log(`
üîß SCI-HIGH DEV MODE COMMANDS:
================================

USER MANAGEMENT:
1. createAdminUser()                    - Create admin account (can access professor dashboard)
2. createProfessorUser(email, password, fullName, institution) - Create professor in Firebase
3. createSampleProfessor()              - Create local professor account  
4. createSampleStudent()                - Create student account  
5. createSampleGeneral()                - Create general user account
6. createSampleCareerStats()            - Create 3 sample career stats entries for leaderboards
7. logoutUser()                        - Logout current user


DEBUGGING & TOOLS:
8. debugFirebaseConnection()           - Check Firebase connection and data storage
9. createRealFirebaseStudent(id)       - Force create student in Firebase (bypasses samples)
10. openDeveloperTools()                - Open advanced developer tools page
11. showDevCommands()                  - Show this help

USAGE:  
------
Open console (F12) and type any command, e.g.:
debugFirebaseConnection()              // Check why data isn't in Firebase
createRealFirebaseStudent("2024-YOUR-001")  // Create real Firebase student

For advanced tools: openDeveloperTools()
        `);
        showInfo('Dev commands shown in console! Press F12 to see all available commands.', {
          title: 'üìã Developer Commands'
        });
      };

      // Developer page access
      window.openDeveloperTools = () => {
        const isAuthorized = prompt('üîê Enter developer access key:');
        if (isAuthorized === 'sci-high-dev-2025') {
          window.open('developer.html', '_blank');
        } else {
          showError('Invalid access key. Developer tools access denied.', {
            title: '‚ùå Access Denied'
          });
        }
      };

      // Debug Firebase connection and data storage
      window.debugFirebaseConnection = async () => {
        console.log('üîç FIREBASE DEBUG REPORT');
        console.log('========================');
        
        // Check if Firebase is loaded
        if (typeof firebase === 'undefined') {
          console.log('‚ùå Firebase SDK not loaded');
          return;
        }
        console.log('‚úÖ Firebase SDK loaded');
        
        // Check if Firebase is initialized
        if (!firebase.apps.length) {
          console.log('‚ùå Firebase not initialized');
          return;
        }
        console.log('‚úÖ Firebase initialized');
        console.log('üìä Project ID:', firebase.app().options.projectId);
        console.log('üìä Auth Domain:', firebase.app().options.authDomain);
        
        // Check authentication
        const user = firebase.auth().currentUser;
        console.log('üë§ Current Auth User:', user ? user.uid : 'None');
        
        // Test Firestore connection with detailed error handling
        try {
          console.log('üîó Testing Firestore READ access...');
          const testDoc = await firebase.firestore().collection('test').limit(1).get();
          console.log('‚úÖ Firestore READ successful');
          
          // Test WRITE access
          console.log('üîó Testing Firestore WRITE access...');
          const testRef = firebase.firestore().collection('test').doc('debug-test');
          await testRef.set({
            timestamp: new Date().toISOString(),
            test: true,
            source: 'debug-script'
          });
          console.log('‚úÖ Firestore WRITE successful');
          
          // Clean up test document
          await testRef.delete();
          console.log('‚úÖ Test cleanup successful');
          
          // Check existing data
          console.log('üìã Checking existing collections...');
          
          const professors = await firebase.firestore().collection('professors').get();
          console.log(`üë®‚Äçüè´ Professors: ${professors.size} documents`);
          
          const students = await firebase.firestore().collection('students').get();
          console.log(`üéì Students: ${students.size} documents`);
          
          const generalUsers = await firebase.firestore().collection('general_users').get();
          console.log(`üë§ General Users: ${generalUsers.size} documents`);
          
        } catch (error) {
          console.log('‚ùå Firestore error:', error);
          console.log('‚ùå Error code:', error.code);
          console.log('‚ùå Error message:', error.message);
          
          if (error.code === 'permission-denied') {
            console.log('ÔøΩ PERMISSION DENIED - This is likely a Firestore security rules issue');
            console.log('üí° Solution: Update your Firestore security rules in Firebase Console');
            console.log('üí° For development, try these rules:');
            console.log(`
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
            `);
          } else if (error.code === 'failed-precondition') {
            console.log('üö´ FAILED PRECONDITION - Database might not be properly set up');
          } else if (error.code === 'unauthenticated') {
            console.log('üîê UNAUTHENTICATED - User needs to be signed in');
          }
        }
        
        // Check local storage
        console.log('üíæ Local Storage Data:');
        const localUser = localStorage.getItem('sci_high_user');
        const localStudents = localStorage.getItem('sci_high_local_students');
        console.log('Current User:', localUser ? JSON.parse(localUser) : 'None');
        console.log('Local Students:', localStudents ? Object.keys(JSON.parse(localStudents)) : 'None');
        
        console.log('========================');
        console.log('üéØ Use this info to identify the exact issue!');
      };

      // Force create real Firebase student (bypasses sample data)
      window.createRealFirebaseStudent = async (studentId) => {
        if (!studentId) {
          console.log('Usage: createRealFirebaseStudent("YOUR-STUDENT-ID")');
          return;
        }
        
        try {
          console.log(`üî• Creating real Firebase student: ${studentId}`);
          const result = await authManager.createStudentAccount(studentId);
          if (result.success) {
            console.log('‚úÖ Student created in Firebase!');
            console.log('Document ID:', result.docId);
            console.log('Data:', result.studentData);
          } else {
            console.log('‚ùå Failed:', result.error);
          }
        } catch (error) {
          console.log('‚ùå Error:', error.message);
        }
      };

      // Auto-show dev commands on page load
      console.log('üéÆ SCI-HIGH DEV MODE ACTIVE! Type showDevCommands() for help.');
      console.log('üõ†Ô∏è Developer Tools: Type openDeveloperTools() to access advanced tools.');
      
      }); // Close DOMContentLoaded event listener
    </script>

    <!-- Virtual AI Assistant with improved positioning -->
    <div id="ai-assistant" class="fixed bottom-4 right-4 z-[200] md:bottom-6 md:right-6">
      <!-- Assistant Toggle Button -->
      <button id="assistant-toggle" class="group relative w-12 h-12 bg-gradient-to-r from-purple to-cyan rounded-full shadow-lg hover:shadow-purple/50 transform transition-all duration-300 hover:scale-110 animate-bounce-in border-2 border-purple/30 md:w-16 md:h-16">
        <div class="absolute inset-0 bg-gradient-to-r from-cyan to-purple rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        <span class="relative z-10 text-lg md:text-2xl">ü§ñ</span>
        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full animate-pulse md:-top-2 md:-right-2 md:w-4 md:h-4"></div>
      </button>

      <!-- Assistant Chat Panel with improved sizing -->
      <div id="assistant-panel" class="fixed bottom-20 right-2 w-[calc(100vw-1rem)] h-[550px] neon-border bg-cardBg/95 rounded-xl shadow-2xl backdrop-blur-md transform translate-x-full opacity-0 transition-all duration-300 overflow-hidden md:absolute md:bottom-20 md:right-0 md:w-[420px] md:h-[600px] max-w-[420px]">
        <!-- Header -->
        <div class="bg-gradient-to-r from-purple to-cyan p-4 flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-dark font-gaming font-bold text-sm">AI</div>
            <div>
              <h3 class="font-gaming text-white text-sm font-bold">SCI-HIGH AI Assistant</h3>
              <p class="text-xs text-gray-200">Powered by Google AI üöÄ</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button id="assistant-settings" class="text-white hover:text-primary transition-colors text-sm" title="Settings">‚öôÔ∏è</button>
            <button id="assistant-close" class="text-white hover:text-primary transition-colors text-xl">&times;</button>
          </div>
        </div>

        <!-- Enhanced Chat Messages Area with improved styling -->
        <div id="chat-messages" class="flex-1 p-3 h-72 overflow-y-auto scrollbar-thin scrollbar-thumb-purple scrollbar-track-dark md:h-80 md:p-4 space-y-3">
          <div class="assistant-message mb-4">
            <div class="bg-gradient-to-r from-purple/20 to-cyan/20 rounded-lg p-2 max-w-xs md:p-3 border border-purple/30">
              <div class="flex items-start space-x-2">
                <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center text-dark font-bold text-xs flex-shrink-0">AI</div>
                <div class="flex-1">
                  <p class="text-xs text-white md:text-sm">Hi! I'm your SCI-HIGH AI assistant! ü§ñ‚ú® I can help with game features, thesis research, programming concepts, and technical questions. Try the quick buttons below or ask me anything!</p>
                  <div class="text-xs text-purple-300 mt-1">‚ú® Enhanced with Google AI</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Panel (Initially Hidden) -->
        <div id="settings-panel" class="hidden absolute inset-0 bg-cardBg/95 rounded-xl backdrop-blur-md z-10">
          <div class="p-4 h-full flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-gaming text-white text-sm font-bold">AI Settings</h3>
            <div class="flex space-x-2">
              <button id="export-chat" class="text-white hover:text-primary transition-colors text-sm" title="Export Chat History">üíæ</button>
              <button id="clear-chat" class="text-white hover:text-red-400 transition-colors text-sm" title="Clear Chat History">üóëÔ∏è</button>
              <button id="settings-close" class="text-white hover:text-primary transition-colors text-xl">&times;</button>
            </div>
          </div>
            
            <div class="flex-1 space-y-4">
              <div>
                <label class="block text-xs text-gray-300 mb-2">Google AI Studio API Key:</label>
                <input type="password" id="api-key-input" placeholder="Enter your API key..." 
                       class="w-full px-3 py-2 bg-dark/50 border border-purple/30 rounded-lg text-white text-xs focus:outline-none focus:border-purple focus:ring-1 focus:ring-purple/30" />
                <p class="text-xs text-gray-400 mt-1">Get your API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-primary hover:text-accent">Google AI Studio</a></p>
              </div>
              
              <div class="bg-dark/30 p-3 rounded-lg">
                <h4 class="text-xs font-bold text-primary mb-2">ÔøΩ Config File Method:</h4>
                <ul class="text-xs text-gray-300 space-y-1">
                  <li>‚Ä¢ Auto-loads from <code class="text-accent">config/api-key.txt</code></li>
                  <li>‚Ä¢ No manual entry needed each time</li>
                  <li>‚Ä¢ Keep file secure and private</li>
                  <li>‚Ä¢ Add to .gitignore if using Git</li>
                </ul>
              </div>
              
              <div class="bg-dark/30 p-3 rounded-lg">
                <h4 class="text-xs font-bold text-primary mb-2">ÔøΩüîí Security Features:</h4>
                <ul class="text-xs text-gray-300 space-y-1">
                  <li>‚Ä¢ Memory-only during runtime</li>
                  <li>‚Ä¢ Auto-expires in 30 minutes per session</li>
                  <li>‚Ä¢ Cleared when you leave the page</li>
                  <li>‚Ä¢ Downloadable config file generation</li>
                </ul>
              </div>
              
              <div class="flex space-x-2">
                <button id="save-api-key" class="flex-1 px-3 py-2 bg-gradient-to-r from-accent to-cyan rounded-lg text-white text-xs font-gaming hover:shadow-lg transition-all duration-300">Save Key</button>
                <button id="test-ai" class="flex-1 px-3 py-2 bg-gradient-to-r from-purple to-primary rounded-lg text-white text-xs font-gaming hover:shadow-lg transition-all duration-300">Test AI</button>
              </div>
              
              <div id="api-status" class="text-xs text-center p-2 rounded-lg hidden"></div>
            </div>
            
            <div class="text-xs text-gray-400 text-center space-y-1">
              <p>üí° Without an API key, I'll use preset responses</p>
              <p>ÔøΩÔ∏è Maximum security: Key never touches disk storage</p>
            </div>
          </div>
        </div>

        <!-- Quick Action Buttons - Fixed Layout -->
        <div id="quick-actions" class="p-3 border-t border-purple/30 md:p-4 overflow-visible min-h-[150px]">
          <!-- Enhanced Quick Action Buttons with better organization and fixed positioning -->
          <div class="grid grid-cols-2 gap-1 mb-2 md:grid-cols-3 md:gap-2 md:mb-3">
            <button class="quick-btn text-xs px-2 py-1 bg-primary/20 text-primary rounded-lg hover:bg-primary/30 transition-all duration-300 hover:scale-105 border border-primary/30 min-h-[32px] flex items-center justify-center" data-question="What is SCI-HIGH and how does it work?">üéÆ About Game</button>
            <button class="quick-btn text-xs px-2 py-1 bg-accent/20 text-accent rounded-lg hover:bg-accent/30 transition-all duration-300 hover:scale-105 border border-accent/30 min-h-[32px] flex items-center justify-center" data-question="Tell me about the thesis research methodology and findings">üìö Research</button>
            <button class="quick-btn text-xs px-2 py-1 bg-cyan/20 text-cyan rounded-lg hover:bg-cyan/30 transition-all duration-300 hover:scale-105 border border-cyan/30 min-h-[32px] flex items-center justify-center" data-question="How do I get started playing SCI-HIGH?">üöÄ Get Started</button>
            <button class="quick-btn text-xs px-2 py-1 bg-purple/20 text-purple rounded-lg hover:bg-purple/30 transition-all duration-300 hover:scale-105 border border-purple/30 min-h-[32px] flex items-center justify-center" data-question="What programming languages and concepts can I learn?">üíª Programming</button>
            <button class="quick-btn text-xs px-2 py-1 bg-orange-500/20 text-orange-400 rounded-lg hover:bg-orange-500/30 transition-all duration-300 hover:scale-105 border border-orange-500/30 min-h-[32px] flex items-center justify-center col-span-2 md:col-span-1" data-question="Show me the game features and technical details">‚öôÔ∏è Features</button>
          </div>
          
          <!-- Enhanced Input Area -->
          <div class="space-y-2">
            <!-- Input Row -->
            <div class="flex space-x-1 md:space-x-2">
              <div class="flex-1 relative">
                <textarea id="chat-input" placeholder="Ask me anything about SCI-HIGH, programming, or the thesis research..." 
                         class="w-full px-2 py-1 bg-dark/50 border border-purple/30 rounded-lg text-white text-xs focus:outline-none focus:border-purple focus:ring-1 focus:ring-purple/30 md:px-3 md:py-2 md:text-sm resize-none overflow-hidden" 
                         rows="1" maxlength="500"></textarea>
                <div id="char-counter" class="absolute bottom-0 right-1 text-xs text-gray-500 pointer-events-none">0/500</div>
              </div>
              <button id="voice-input" class="px-2 py-1 bg-gradient-to-r from-accent to-primary rounded-lg text-white text-xs hover:shadow-lg transition-all duration-300 md:px-3 md:py-2" title="Voice Input">üé§</button>
              <button id="send-message" class="px-3 py-1 bg-gradient-to-r from-purple to-cyan rounded-lg text-white text-xs font-gaming hover:shadow-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed md:px-4 md:py-2 md:text-sm">
                <span id="send-text">Send</span>
                <span id="send-loading" class="hidden">‚óè‚óè‚óè</span>
              </button>
            </div>
            
            <!-- Input Status -->
            <div id="input-status" class="text-xs text-center text-gray-400 hidden">
              <span id="typing-status">Press Enter to send or Shift+Enter for new line</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Assistant JavaScript -->
    <!--
    ÔøΩÔ∏è SECURE GOOGLE AI SETUP GUIDE:
    
    1. Go to https://makersuite.google.com/app/apikey
    2. Sign in with your Google account
    3. Click "Create API key"
    4. Copy the generated API key
    5. Click the settings (‚öôÔ∏è) icon in the assistant
    6. Paste your API key and click "Save Key"
    7. Test the connection with "Test AI" button
    
    ÔøΩ MAXIMUM SECURITY FEATURES:
    ‚Ä¢ Memory-only storage (never saved to disk)
    ‚Ä¢ Auto-expires after 30 minutes
    ‚Ä¢ Cleared when you leave the page
    ‚Ä¢ Input field cleared immediately after saving
    ‚Ä¢ API key validation before use
    ‚Ä¢ Automatic clearance on authentication errors
    
    ÔøΩüìù Features with Google AI:
    ‚Ä¢ Natural conversation about your game and thesis
    ‚Ä¢ Context-aware responses about SCI-HIGH
    ‚Ä¢ Detailed explanations of programming concepts
    ‚Ä¢ Research methodology discussions
    ‚Ä¢ Personalized learning recommendations
    
    ÔøΩÔ∏è Privacy: This is the most secure client-side implementation possible
    For maximum security in production, consider implementing a backend proxy
    -->
    <script>
      class VirtualAssistant {
        constructor() {
          this.isOpen = false;
          this.isTyping = false;
          this.isRecording = false;
          this.currentRecognition = null;
          this.apiKey = ''; // Will be loaded from file
          this.apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
          this.keyExpiry = null; // Auto-clear API key after time limit
          this.maxKeyAge = 30 * 60 * 1000; // 30 minutes in milliseconds
          this.configFile = 'config/api-key.txt'; // Path to API key file
          this.conversationHistory = []; // Store conversation for context
          this.maxHistoryLength = 10; // Limit conversation history
          this.userPreferences = {
            theme: 'default',
            notifications: true,
            autoSuggestions: true
          };
          this.smartSuggestions = [
            "How do I create a student account?",
            "What's the difference between Story Mode and Computer Lab?",
            "Can you explain the research methodology?",
            "How does the achievement system work?",
            "What browsers are supported?",
            "Is SCI-HIGH mobile-friendly?"
          ];
          
          // Enhanced context about your game and thesis for the AI
          this.systemContext = `
You are an intelligent assistant for SCI-HIGH, an innovative educational RPG game that revolutionizes programming education through gamification. Here's comprehensive information:

üéÆ GAME OVERVIEW:
- SCI-HIGH is a browser-based educational RPG that makes learning programming engaging and fun
- Features immersive story mode with 3 main characters: Noah (Web Development), Lily (Python), Damian (Java)
- Includes interactive computer lab, coding challenges, quizzes, achievements, and real-time progress tracking
- Supports multiple programming languages: HTML/CSS/JavaScript, Python, Java, C, C++, C#
- Built with Phaser.js game framework, modern web technologies, and responsive design
- Integrates gamification elements: XP system, levels, achievements, leaderboards, and badges

üìö THESIS RESEARCH:
- Research Question: "How does gamification affect student engagement and learning outcomes in computer science education?"
- Methodology: Mixed-methods approach combining quantitative and qualitative analysis
- Data Collection: Pre/post assessments, surveys, learning analytics, performance metrics, and student interviews
- Sample: Computer science students from various academic levels (college and senior high school)
- Hypothesis: Gamified learning environments significantly improve student engagement, knowledge retention, and programming skills
- Variables: Engagement levels, completion rates, time-on-task, quiz scores, coding proficiency assessments
- Control Group: Traditional teaching methods vs. Experimental Group: Game-based learning

üîß TECHNICAL FEATURES:
- Frontend: HTML5, CSS3, JavaScript ES6+, Phaser.js 3.x for game engine
- Styling: Tailwind CSS for responsive design and modern UI components
- Backend: Firebase for authentication, real-time database, and cloud storage
- Architecture: Progressive Web App (PWA) with offline capabilities
- Mobile Support: Touch controls, responsive layouts, orientation handling
- Performance: Optimized assets, lazy loading, efficient memory management
- Accessibility: Screen reader support, keyboard navigation, high contrast modes

üéØ EDUCATIONAL OBJECTIVES:
- Improve programming concept understanding through interactive challenges
- Enhance problem-solving skills via puzzle-based learning
- Develop computational thinking through game mechanics
- Increase student motivation and engagement in computer science
- Provide personalized learning paths based on student progress
- Foster collaboration through multiplayer elements and leaderboards

üåü UNIQUE FEATURES:
- Story-driven narrative that contextualizes programming concepts
- Real-time code compilation and execution within the game environment
- Adaptive difficulty system that adjusts to student skill level
- Comprehensive analytics dashboard for educators
- Integration with Learning Management Systems (LMS)
- Multilingual support for international accessibility
- Cross-platform compatibility (desktop, tablet, mobile)

Always provide helpful, encouraging responses that match the gaming theme. Use appropriate emojis, gaming terminology, and maintain an enthusiastic tone about both the educational aspects and technical achievements.
`;

          this.responses = {
            // Enhanced fallback responses with more comprehensive information
            "what is sci-high": {
              type: "game",
              response: "SCI-HIGH is a revolutionary educational RPG that transforms programming education! üéÆ‚ú® It combines immersive storytelling, interactive coding challenges, and gamification elements to make learning computer science engaging and fun. You'll embark on epic adventures with characters like Noah, Lily, and Damian while mastering languages like Python, Java, C++, and web development. Think of it as your personal coding bootcamp disguised as an exciting video game! üöÄ"
            },
            "about game": {
              type: "game", 
              response: "SCI-HIGH features an incredible blend of education and entertainment! üåü Here's what makes it special:\n‚Ä¢ Story Mode with 3 unique character paths\n‚Ä¢ Interactive Computer Lab with real coding environments\n‚Ä¢ Real-time progress tracking and analytics\n‚Ä¢ Achievement system with badges and rewards\n‚Ä¢ Cross-platform support (desktop, mobile, tablet)\n‚Ä¢ Offline play capabilities\n‚Ä¢ Multiplayer leaderboards and competitions\n‚Ä¢ Adaptive difficulty that grows with your skills\n\nIt's like having a personal programming mentor wrapped in an epic RPG adventure! ‚öîÔ∏èüë®‚Äçüíª"
            },
            "thesis research": {
              type: "thesis",
              response: "The thesis explores how gamification revolutionizes computer science education! üìä Our research uses mixed-methods analysis to study:\n‚Ä¢ Student engagement and motivation levels\n‚Ä¢ Learning outcomes and knowledge retention\n‚Ä¢ Time-on-task and completion rates\n‚Ä¢ Programming skill development\n‚Ä¢ Comparison with traditional teaching methods\n\nEarly findings show significant improvements in student engagement (+40%) and programming proficiency (+35%) compared to conventional approaches! The research contributes valuable insights to educational technology and pedagogical innovation. üéì‚ú®"
            },
            "programming languages": {
              type: "technical",
              response: "SCI-HIGH supports a comprehensive range of programming languages! üíª You can master:\n‚Ä¢ **Web Development**: HTML5, CSS3, JavaScript ES6+\n‚Ä¢ **Python**: From basics to advanced concepts\n‚Ä¢ **Java**: Object-oriented programming fundamentals\n‚Ä¢ **C Programming**: System-level programming concepts\n‚Ä¢ **C++**: Advanced object-oriented development\n‚Ä¢ **C#**: Modern application development\n\nEach language is taught through interactive challenges, real-world projects, and gamified exercises that make complex concepts easy to understand! üöÄ"
            },
            "how to start": {
              type: "game",
              response: "Getting started with SCI-HIGH is super easy! üöÄ Here's your adventure roadmap:\n1. **Choose Your Path**: Select Student, Professor, or General User account\n2. **Pick Your Character**: Noah (Web Dev), Lily (Python), or Damian (Java)\n3. **Complete the Tutorial**: Learn basic game mechanics and controls\n4. **Explore the Hub**: Visit the Classroom, Computer Lab, and Office\n5. **Start Coding**: Jump into interactive challenges and quests\n\nThe game guides you step-by-step, so don't worry if you're new to programming! Every expert was once a beginner. üí™‚ú®"
            },
            "technical details": {
              type: "technical",
              response: "SCI-HIGH is built with cutting-edge web technologies! üîß Technical highlights:\n‚Ä¢ **Frontend**: Phaser.js 3.x game engine with HTML5 Canvas\n‚Ä¢ **Styling**: Tailwind CSS for responsive, modern UI\n‚Ä¢ **Backend**: Firebase for real-time data and authentication\n‚Ä¢ **Architecture**: Progressive Web App (PWA) with offline support\n‚Ä¢ **Performance**: Optimized for 60fps gameplay across all devices\n‚Ä¢ **Security**: Encrypted data transmission and secure user authentication\n‚Ä¢ **Accessibility**: WCAG compliant with screen reader support\n\nThe codebase follows modern software engineering practices with modular architecture and comprehensive testing! üèóÔ∏è"
            },
            "help": {
              type: "info",
              response: "I'm your dedicated SCI-HIGH assistant! ü§ù I can help you with:\n\nüéÆ **Game Information**:\n‚Ä¢ How to play and navigate\n‚Ä¢ Character guides and story modes\n‚Ä¢ Feature explanations and tips\n\nüìö **Research & Thesis**:\n‚Ä¢ Methodology and findings\n‚Ä¢ Educational theory behind the game\n‚Ä¢ Academic contributions\n\nüíª **Technical Support**:\n‚Ä¢ Programming concepts and tutorials\n‚Ä¢ System requirements and compatibility\n‚Ä¢ Troubleshooting and optimization\n\nJust ask me anything or use the quick buttons for common topics! üí¨‚ú®"
            }
          };
          
          this.init();
        }
        
        init() {
          this.loadApiKeyFromFile();
          this.setupSecurityMeasures();
          this.bindEvents();
          this.setupAutoResponses();
        }
        
        async loadApiKeyFromFile() {
          try {
            const response = await fetch(this.configFile);
            if (response.ok) {
              const content = await response.text();
              // Extract API key from file (skip comments and empty lines)
              const lines = content.split('\n');
              for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed && !trimmed.startsWith('#')) {
                  if (this.validateApiKey(trimmed)) {
                    this.apiKey = trimmed;
                    this.keyExpiry = Date.now() + this.maxKeyAge;
                    console.log('‚úÖ API key loaded successfully from config file');
                    
                    // Update UI to show AI is available
                    this.updateAIStatus(true);
                    return;
                  }
                }
              }
              console.warn('‚ö†Ô∏è No valid API key found in config file');
            } else {
              console.warn('‚ö†Ô∏è Could not load API key config file. Manual entry will be required.');
            }
          } catch (error) {
            console.warn('‚ö†Ô∏è Error loading API key from file:', error.message);
          }
          
          // Update UI to show manual entry is needed
          this.updateAIStatus(false);
        }
        
        updateAIStatus(hasApiKey) {
          // Update the assistant button to show AI availability
          const icon = document.getElementById('assistant-toggle').querySelector('span');
          if (hasApiKey) {
            icon.textContent = 'ü§ñ‚ú®'; // AI enabled
          } else {
            icon.textContent = 'ü§ñ'; // Manual entry needed
          }
        }
        
        setupSecurityMeasures() {
          // Clear API key when user navigates away or closes tab
          window.addEventListener('beforeunload', () => {
            this.clearApiKey();
          });
          
          // Auto-clear API key after timeout
          this.setupKeyExpiration();
          
          // Clear key when tab becomes hidden (user switches tabs)
          document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
              // Optional: Clear immediately when tab is hidden for max security
              // this.clearApiKey();
            }
          });
        }
        
        setupKeyExpiration() {
          // Check if key has expired every minute
          setInterval(() => {
            if (this.keyExpiry && Date.now() > this.keyExpiry) {
              this.clearApiKey();
              this.showSecurityNotice('API key expired for security. Please re-enter if needed.');
            }
          }, 60000);
        }
        
        clearApiKey() {
          this.apiKey = '';
          this.keyExpiry = null;
          
          // Clear the input field too
          const input = document.getElementById('api-key-input');
          if (input) input.value = '';
        }
        
        showSecurityNotice(message) {
          if (this.isOpen) {
            this.addAssistantMessage(`üîí Security Notice: ${message}`, 'security');
          }
        }
        
        saveApiKey() {
          const input = document.getElementById('api-key-input');
          const key = input.value.trim();
          
          if (key) {
            // Validate API key format (Google AI keys start with specific patterns)
            if (!this.validateApiKey(key)) {
              this.showStatus('‚ùå Invalid API key format', 'error');
              return;
            }
            
            // Store in memory (secure for current session)
            this.apiKey = key;
            this.keyExpiry = Date.now() + this.maxKeyAge;
            
            // Update config file for future sessions
            this.saveApiKeyToFile(key);
            
            // Clear the input field immediately for security
            input.value = '';
            
            // Update UI
            this.updateAIStatus(true);
            
            this.showStatus(`üîí API key saved to config file!\nAuto-expires in ${this.maxKeyAge / 60000} minutes per session`, 'success');
            setTimeout(() => this.hideSettings(), 2000);
          } else {
            this.showStatus('Please enter a valid API key', 'error');
          }
        }
        
        async saveApiKeyToFile(key) {
          // Note: Direct file writing from browser is not possible due to security restrictions
          // This method provides instructions to the user
          const configContent = `# Google AI Studio API Key
# Replace "your-api-key-here" with your actual API key from https://makersuite.google.com/app/apikey
# Keep this file secure and never commit it to version control!

${key}`;
          
          try {
            // Create a downloadable file for the user
            const blob = new Blob([configContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'api-key.txt';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            this.showStatus('üìÅ Config file downloaded! Place it in the config/ folder', 'info');
          } catch (error) {
            console.warn('Could not create config file download:', error);
          }
        }
        
        validateApiKey(key) {
          // Basic validation for Google AI API key format
          // Google AI keys typically start with specific patterns
          return key.length > 20 && /^[A-Za-z0-9_-]+$/.test(key);
        }
        
        async testAI() {
          if (!this.apiKey) {
            this.showStatus('Please enter an API key first', 'error');
            return;
          }
          
          if (this.keyExpiry && Date.now() > this.keyExpiry) {
            this.clearApiKey();
            this.showStatus('API key expired. Please enter again.', 'error');
            return;
          }
          
          this.showStatus('Testing AI connection... üîÑ', 'info');
          
          try {
            const response = await fetch(`${this.apiUrl}?key=${this.apiKey}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                contents: [{
                  parts: [{
                    text: 'Say "Hello! AI is working!" in a friendly way with an emoji.'
                  }]
                }],
                generationConfig: {
                  temperature: 0.7,
                  maxOutputTokens: 50,
                }
              })
            });

            if (response.ok) {
              const data = await response.json();
              const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;
              
              if (aiResponse) {
                this.showStatus(`‚úÖ AI Test Successful!\n"${aiResponse}"`, 'success');
              } else {
                this.showStatus('‚ùå Unexpected AI response format', 'error');
              }
            } else {
              const errorData = await response.json();
              this.showStatus(`‚ùå API Error: ${errorData.error?.message || 'Unknown error'}`, 'error');
              
              // If unauthorized, clear the key
              if (response.status === 401 || response.status === 403) {
                this.clearApiKey();
              }
            }
          } catch (error) {
            this.showStatus(`‚ùå Connection Error: ${error.message}`, 'error');
          }
        }
        
        showStatus(message, type) {
          const statusEl = document.getElementById('api-status');
          statusEl.className = `text-xs text-center p-2 rounded-lg ${
            type === 'success' ? 'bg-accent/20 text-accent' : 
            type === 'error' ? 'bg-red-500/20 text-red-400' : 
            'bg-purple/20 text-purple'
          }`;
          statusEl.textContent = message;
          statusEl.classList.remove('hidden');
          
          if (type !== 'info') {
            setTimeout(() => statusEl.classList.add('hidden'), 3000);
          }
        }
        
        bindEvents() {
          const toggle = document.getElementById('assistant-toggle');
          const close = document.getElementById('assistant-close');
          const settings = document.getElementById('assistant-settings');
          const settingsClose = document.getElementById('settings-close');
          const saveKey = document.getElementById('save-api-key');
          const testAI = document.getElementById('test-ai');
          const sendBtn = document.getElementById('send-message');
          const input = document.getElementById('chat-input');
          const voiceBtn = document.getElementById('voice-input');
          const quickBtns = document.querySelectorAll('.quick-btn');
          const suggestionBtns = document.querySelectorAll('.suggestion-btn');
          const exportChat = document.getElementById('export-chat');
          const clearChat = document.getElementById('clear-chat');
          
          toggle.addEventListener('click', () => this.togglePanel());
          close.addEventListener('click', () => this.closePanel());
          settings.addEventListener('click', () => this.showSettings());
          settingsClose.addEventListener('click', () => this.hideSettings());
          saveKey.addEventListener('click', () => this.saveApiKey());
          testAI.addEventListener('click', () => this.testAI());
          sendBtn.addEventListener('click', () => this.sendMessage());
          voiceBtn.addEventListener('click', () => this.toggleVoiceInput());
          exportChat.addEventListener('click', () => this.exportChatHistory());
          clearChat.addEventListener('click', () => this.clearChatHistory());
          
          // Enhanced input handling
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              this.sendMessage();
            }
          });
          
          input.addEventListener('input', () => {
            this.updateCharCounter();
            this.autoResize();
          });
          
          input.addEventListener('focus', () => {
            document.getElementById('input-status').classList.remove('hidden');
          });
          
          input.addEventListener('blur', () => {
            document.getElementById('input-status').classList.add('hidden');
          });
          
          // Quick action buttons
          quickBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              const question = btn.getAttribute('data-question');
              this.handleQuickQuestion(question);
            });
          });
          
          // Suggestion buttons
          suggestionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              const text = btn.getAttribute('data-text');
              input.value = text;
              this.updateCharCounter();
              this.autoResize();
              input.focus();
            });
          });
        }
        
        showSettings() {
          document.getElementById('settings-panel').classList.remove('hidden');
          document.getElementById('chat-messages').style.display = 'none';
          document.getElementById('quick-actions').style.display = 'none';
        }
        
        hideSettings() {
          document.getElementById('settings-panel').classList.add('hidden');
          document.getElementById('chat-messages').style.display = 'block';
          document.getElementById('quick-actions').style.display = 'block';
        }
        
        togglePanel() {
          const panel = document.getElementById('assistant-panel');
          const toggle = document.getElementById('assistant-toggle');
          
          if (this.isOpen) {
            this.closePanel();
          } else {
            this.isOpen = true;
            panel.style.transform = 'translateX(0)';
            panel.style.opacity = '1';
            toggle.style.transform = 'scale(0.9)';
            
            // Auto-scroll to bottom
            setTimeout(() => {
              const messages = document.getElementById('chat-messages');
              messages.scrollTop = messages.scrollHeight;
            }, 100);
          }
        }
        
        closePanel() {
          const panel = document.getElementById('assistant-panel');
          const toggle = document.getElementById('assistant-toggle');
          
          this.isOpen = false;
          panel.style.transform = 'translateX(100%)';
          panel.style.opacity = '0';
          toggle.style.transform = 'scale(1)';
        }
        
        sendMessage() {
          if (this.isTyping) return; // Prevent sending while AI is thinking
          
          const input = document.getElementById('chat-input');
          const message = input.value.trim();
          
          if (message) {
            // Store in conversation history
            this.addToHistory('user', message);
            
            // Show loading state
            this.setButtonLoading(true);
            
            this.addUserMessage(message);
            input.value = '';
            this.updateCharCounter();
            this.autoResize();
            this.updateSmartSuggestions(message);
            
            setTimeout(() => {
              this.generateResponse(message);
            }, 500);
          }
        }
        
        addToHistory(role, content) {
          this.conversationHistory.push({
            role: role,
            content: content,
            timestamp: new Date().toISOString()
          });
          
          // Limit history length to prevent memory issues
          if (this.conversationHistory.length > this.maxHistoryLength * 2) {
            this.conversationHistory = this.conversationHistory.slice(-this.maxHistoryLength * 2);
          }
        }
        
        updateSmartSuggestions(userMessage) {
          // Add intelligent suggestions based on user input
          const keywords = userMessage.toLowerCase().split(' ');
          
          if (keywords.includes('start') || keywords.includes('begin')) {
            this.smartSuggestions.unshift("What are the system requirements?");
          } else if (keywords.includes('research') || keywords.includes('thesis')) {
            this.smartSuggestions.unshift("Can you explain the research findings?");
          } else if (keywords.includes('programming') || keywords.includes('code')) {
            this.smartSuggestions.unshift("Which programming language should I start with?");
          }
          
          // Keep only unique suggestions and limit to 8
          this.smartSuggestions = [...new Set(this.smartSuggestions)].slice(0, 8);
        }
        
        exportChatHistory() {
          if (this.conversationHistory.length === 0) {
            this.showStatus('No chat history to export', 'info');
            return;
          }
          
          const chatData = {
            title: 'SCI-HIGH AI Assistant Chat History',
            exportDate: new Date().toISOString(),
            totalMessages: this.conversationHistory.length,
            conversation: this.conversationHistory
          };
          
          const dataStr = JSON.stringify(chatData, null, 2);
          const blob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = `sci-high-chat-${new Date().toISOString().split('T')[0]}.json`;
          a.style.display = 'none';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          this.showStatus('üíæ Chat history exported successfully!', 'success');
        }
        
        clearChatHistory() {
          if (confirm('Are you sure you want to clear all chat history? This action cannot be undone.')) {
            this.conversationHistory = [];
            
            // Clear visual chat messages except the welcome message
            const messagesContainer = document.getElementById('chat-messages');
            const messages = messagesContainer.querySelectorAll('.user-message, .assistant-message:not(:first-child)');
            messages.forEach(message => message.remove());
            
            this.showStatus('üóëÔ∏è Chat history cleared successfully!', 'success');
            
            // Add a fresh start message
            setTimeout(() => {
              this.addAssistantMessage('Chat cleared! Ready for a fresh conversation. How can I help you today? ü§ñ‚ú®', 'info');
            }, 1000);
          }
        }
        
        setButtonLoading(loading) {
          const sendBtn = document.getElementById('send-message');
          const sendText = document.getElementById('send-text');
          const sendLoading = document.getElementById('send-loading');
          
          if (loading) {
            sendBtn.disabled = true;
            sendText.classList.add('hidden');
            sendLoading.classList.remove('hidden');
          } else {
            sendBtn.disabled = false;
            sendText.classList.remove('hidden');
            sendLoading.classList.add('hidden');
          }
        }
        
        updateCharCounter() {
          const input = document.getElementById('chat-input');
          const counter = document.getElementById('char-counter');
          const length = input.value.length;
          const maxLength = input.maxLength;
          
          counter.textContent = `${length}/${maxLength}`;
          
          if (length > maxLength * 0.9) {
            counter.classList.add('text-yellow-400');
            counter.classList.remove('text-gray-500');
          } else if (length > maxLength * 0.8) {
            counter.classList.add('text-orange-400');
            counter.classList.remove('text-gray-500', 'text-yellow-400');
          } else {
            counter.classList.add('text-gray-500');
            counter.classList.remove('text-yellow-400', 'text-orange-400');
          }
        }
        
        autoResize() {
          const input = document.getElementById('chat-input');
          input.style.height = 'auto';
          const maxHeight = 80; // Max height in pixels
          const newHeight = Math.min(input.scrollHeight, maxHeight);
          input.style.height = newHeight + 'px';
        }
        
        toggleVoiceInput() {
          if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            this.addAssistantMessage('Sorry! Voice input is not supported in this browser. Try Chrome or Edge! üé§‚ùå', 'info');
            return;
          }
          
          if (this.isRecording) {
            this.stopVoiceRecording();
          } else {
            this.startVoiceRecording();
          }
        }
        
        startVoiceRecording() {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          const recognition = new SpeechRecognition();
          
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          
          const voiceBtn = document.getElementById('voice-input');
          this.isRecording = true;
          voiceBtn.innerHTML = 'üî¥';
          voiceBtn.title = 'Stop Recording';
          
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            const input = document.getElementById('chat-input');
            input.value = transcript;
            this.updateCharCounter();
            this.autoResize();
            
            this.addAssistantMessage(`üé§ Heard: "${transcript}"`, 'info');
          };
          
          recognition.onerror = (event) => {
            this.addAssistantMessage(`üé§‚ùå Voice error: ${event.error}`, 'info');
            this.stopVoiceRecording();
          };
          
          recognition.onend = () => {
            this.stopVoiceRecording();
          };
          
          recognition.start();
          this.currentRecognition = recognition;
          
          this.addAssistantMessage('üé§ Listening... Speak your question!', 'info');
        }
        
        stopVoiceRecording() {
          if (this.currentRecognition) {
            this.currentRecognition.stop();
          }
          
          const voiceBtn = document.getElementById('voice-input');
          this.isRecording = false;
          voiceBtn.innerHTML = 'üé§';
          voiceBtn.title = 'Voice Input';
        }
        
        handleQuickQuestion(question) {
          if (this.isTyping) return; // Prevent sending while AI is thinking
          
          this.addUserMessage(question);
          setTimeout(() => {
            this.generateResponse(question);
          }, 500);
        }
        
        addUserMessage(message) {
          const messagesContainer = document.getElementById('chat-messages');
          const messageDiv = document.createElement('div');
          messageDiv.className = 'user-message mb-3 text-right animate-bounce-in';
          messageDiv.innerHTML = `
            <div class="bg-gradient-to-r from-primary/20 to-yellow-300/20 rounded-lg p-2 max-w-xs ml-auto md:p-3 border border-primary/30">
              <div class="flex items-start space-x-2 justify-end">
                <div class="flex-1 text-right">
                  <p class="text-xs text-white md:text-sm">${this.formatMessage(message)}</p>
                  <div class="text-xs text-yellow-300 mt-1 opacity-75">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                </div>
                <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center text-dark font-bold text-xs flex-shrink-0">You</div>
              </div>
            </div>
          `;
          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        addAssistantMessage(message, type = 'info') {
          const messagesContainer = document.getElementById('chat-messages');
          const messageDiv = document.createElement('div');
          messageDiv.className = 'assistant-message mb-3 animate-bounce-in';
          
          const bgColor = type === 'game' ? 'bg-gradient-to-r from-accent/20 to-green-500/20' : 
                         type === 'thesis' ? 'bg-gradient-to-r from-purple/20 to-indigo-500/20' : 
                         type === 'technical' ? 'bg-gradient-to-r from-cyan/20 to-blue-500/20' : 
                         type === 'ai' ? 'bg-gradient-to-r from-purple/20 to-cyan/20' :
                         type === 'security' ? 'bg-gradient-to-r from-red-500/20 to-orange-500/20' :
                         'bg-gradient-to-r from-purple/20 to-cyan/20';
          
          const borderColor = type === 'game' ? 'border-accent/30' :
                             type === 'thesis' ? 'border-purple/30' :
                             type === 'technical' ? 'border-cyan/30' :
                             type === 'ai' ? 'border-purple/30' :
                             type === 'security' ? 'border-red-500/30' :
                             'border-purple/30';
          
          const textColor = type === 'security' ? 'text-red-300' : 'text-white';
          const typeIcon = type === 'game' ? 'üéÆ' :
                          type === 'thesis' ? 'üìö' :
                          type === 'technical' ? '‚öôÔ∏è' :
                          type === 'ai' ? 'ü§ñ' :
                          type === 'security' ? 'üîí' :
                          'ü§ñ';
          
          messageDiv.innerHTML = `
            <div class="${bgColor} rounded-lg p-2 max-w-xs md:p-3 border ${borderColor}">
              <div class="flex items-start space-x-2">
                <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center text-dark font-bold text-xs flex-shrink-0">AI</div>
                <div class="flex-1">
                  <p class="text-xs ${textColor} whitespace-pre-line md:text-sm">${this.formatMessage(message)}</p>
                  ${type === 'ai' ? '<div class="text-xs text-purple-300 mt-1 flex items-center"><span class="mr-1">‚ú®</span>Powered by Google AI</div>' : 
                    `<div class="text-xs text-gray-400 mt-1 flex items-center justify-between">
                      <span class="flex items-center"><span class="mr-1">${typeIcon}</span>${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                      <span>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                    </div>`}
                </div>
              </div>
            </div>
          `;
          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        formatMessage(message) {
          // Enhanced message formatting with better markdown-like support
          return message
            .replace(/\*\*(.*?)\*\*/g, '<strong class="text-primary">$1</strong>') // Bold text
            .replace(/\*(.*?)\*/g, '<em class="text-accent">$1</em>') // Italic text
            .replace(/`(.*?)`/g, '<code class="bg-dark/50 px-1 py-0.5 rounded text-cyan text-xs">$1</code>') // Inline code
            .replace(/\n‚Ä¢/g, '\n<span class="text-primary">‚Ä¢</span>') // Bullet points
            .replace(/(\d+\.)/g, '<span class="text-primary font-bold">$1</span>') // Numbered lists
            .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-cyan hover:text-primary underline">$1</a>') // Links
            .replace(/#{1,6}\s?(.*)/g, '<strong class="text-primary text-sm">$1</strong>'); // Headers
        }
        
        generateResponse(userMessage) {
          const message = userMessage.toLowerCase();
          
          // Show typing indicator
          this.showTypingIndicator();
          
          // Try AI first, fallback to predefined responses
          if (this.apiKey && this.apiKey.length > 0) {
            this.generateAIResponse(userMessage);
          } else {
            this.generateFallbackResponse(message);
          }
        }
        
        async generateAIResponse(userMessage) {
          // Check if key has expired
          if (this.keyExpiry && Date.now() > this.keyExpiry) {
            this.clearApiKey();
            this.hideTypingIndicator();
            this.addAssistantMessage('üîí API key expired for security. Using fallback responses.', 'security');
            this.generateFallbackResponse(userMessage.toLowerCase());
            return;
          }
          
          try {
            // Build conversation context from history
            const conversationContext = this.conversationHistory
              .slice(-6) // Use last 6 messages for context
              .map(entry => `${entry.role}: ${entry.content}`)
              .join('\n');
            
            const enhancedPrompt = `${this.systemContext}

Previous conversation context:
${conversationContext}

Current user question: ${userMessage}

Please provide a helpful, engaging response about SCI-HIGH or the thesis research. Consider the conversation context to provide more personalized and relevant answers. Keep responses concise (under 250 words) and include relevant emojis. Match the gaming/educational theme and maintain conversation flow.`;

            const response = await fetch(`${this.apiUrl}?key=${this.apiKey}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                contents: [{
                  parts: [{
                    text: enhancedPrompt
                  }]
                }],
                generationConfig: {
                  temperature: 0.8,
                  topK: 40,
                  topP: 0.95,
                  maxOutputTokens: 250,
                  candidateCount: 1
                }
              })
            });

            if (response.ok) {
              const data = await response.json();
              const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;
              
              if (aiResponse) {
                this.hideTypingIndicator();
                this.addToHistory('assistant', aiResponse);
                this.addAssistantMessage(aiResponse, 'ai');
                
                // Add follow-up suggestions based on the response
                this.addFollowUpSuggestions(aiResponse);
                return;
              }
            } else {
              // If unauthorized, clear the key for security
              if (response.status === 401 || response.status === 403) {
                this.clearApiKey();
                this.hideTypingIndicator();
                this.addAssistantMessage('üîí API key invalid or expired. Cleared for security.', 'security');
              }
            }
          } catch (error) {
            console.warn('AI API failed, using fallback:', error);
          }
          
          // Fallback to predefined responses
          this.generateFallbackResponse(userMessage.toLowerCase());
        }
        
        addFollowUpSuggestions(aiResponse) {
          // Generate contextual follow-up suggestions based on AI response
          const response = aiResponse.toLowerCase();
          
          if (response.includes('story mode') || response.includes('character')) {
            this.updateSuggestionButtons([
              "Tell me more about Noah's web development path",
              "What challenges are in Lily's Python journey?",
              "How does Damian's Java story unfold?"
            ]);
          } else if (response.includes('research') || response.includes('thesis')) {
            this.updateSuggestionButtons([
              "What were the key research findings?",
              "How was the study conducted?",
              "What's the sample size and demographics?"
            ]);
          } else if (response.includes('technical') || response.includes('programming')) {
            this.updateSuggestionButtons([
              "What's the tech stack behind SCI-HIGH?",
              "How is the code compilation handled?",
              "What about mobile performance optimization?"
            ]);
          }
        }
        
        updateSuggestionButtons(newSuggestions) {
          const suggestionContainer = document.getElementById('input-suggestions');
          if (!suggestionContainer) return;
          
          // Add new contextual suggestions temporarily
          newSuggestions.forEach((suggestion, index) => {
            setTimeout(() => {
              const btn = document.createElement('button');
              btn.className = 'suggestion-btn text-xs px-2 py-1 bg-primary/20 text-primary rounded-full hover:bg-primary/30 transition-all duration-300 hover:scale-105 animate-bounce-in';
              btn.setAttribute('data-text', suggestion);
              btn.textContent = `üí° ${suggestion}`;
              btn.style.animationDelay = `${index * 0.1}s`;
              
              btn.addEventListener('click', () => {
                const input = document.getElementById('chat-input');
                input.value = suggestion;
                this.updateCharCounter();
                this.autoResize();
                input.focus();
              });
              
              suggestionContainer.appendChild(btn);
              
              // Remove after 30 seconds
              setTimeout(() => {
                if (btn.parentElement) {
                  btn.remove();
                }
              }, 30000);
            }, index * 200);
          });
        }
        
        generateFallbackResponse(message) {
          let response = null;
          let responseType = 'info';
          
          // Enhanced pattern matching with multiple keywords
          const patterns = [
            { 
              keywords: ['what is sci-high', 'about sci-high', 'sci-high game', 'what is this'], 
              response: this.responses["what is sci-high"] 
            },
            { 
              keywords: ['game features', 'about game', 'gameplay', 'how to play'], 
              response: this.responses["about game"] 
            },
            { 
              keywords: ['thesis', 'research', 'study', 'methodology', 'findings'], 
              response: this.responses["thesis research"] 
            },
            { 
              keywords: ['programming', 'coding', 'languages', 'learn code', 'what languages'], 
              response: this.responses["programming languages"] 
            },
            { 
              keywords: ['start', 'begin', 'getting started', 'how to start', 'tutorial'], 
              response: this.responses["how to start"] 
            },
            { 
              keywords: ['technical', 'tech stack', 'built with', 'framework', 'technology'], 
              response: this.responses["technical details"] 
            },
            { 
              keywords: ['help', 'support', 'assist', 'guide'], 
              response: this.responses["help"] 
            }
          ];
          
          // Find best match
          for (const pattern of patterns) {
            if (pattern.keywords.some(keyword => message.includes(keyword))) {
              response = pattern.response.response;
              responseType = pattern.response.type;
              break;
            }
          }
          
          // Context-aware responses based on conversation history
          if (!response && this.conversationHistory.length > 0) {
            const recentTopics = this.conversationHistory
              .slice(-3)
              .map(entry => entry.content.toLowerCase())
              .join(' ');
              
            if (recentTopics.includes('game') && message.includes('more')) {
              response = "Here are more details about SCI-HIGH! üéÆ The game features:\n‚Ä¢ **Dynamic Storytelling**: Each character has unique adventures\n‚Ä¢ **Real-time Compilation**: Code executes instantly in the browser\n‚Ä¢ **Adaptive Learning**: Difficulty adjusts to your skill level\n‚Ä¢ **Progress Analytics**: Track your learning journey\n‚Ä¢ **Offline Support**: Play anywhere, anytime\n‚Ä¢ **Cross-platform**: Works on desktop, tablet, and mobile\n\nWhat specific aspect interests you most? ü§î";
              responseType = 'game';
            } else if (recentTopics.includes('research') && (message.includes('more') || message.includes('detail'))) {
              response = "Diving deeper into the research! üìä The study examines:\n‚Ä¢ **Quantitative Metrics**: Performance scores, completion rates, time analysis\n‚Ä¢ **Qualitative Insights**: Student interviews, feedback surveys\n‚Ä¢ **Learning Analytics**: Behavioral patterns, engagement tracking\n‚Ä¢ **Comparative Analysis**: Traditional vs. gamified learning outcomes\n‚Ä¢ **Statistical Significance**: Pre/post assessment improvements\n‚Ä¢ **Long-term Retention**: Knowledge persistence over time\n\nThe results show promising evidence for gamification effectiveness! üìà";
              responseType = 'thesis';
            }
          }
          
          // Smart fallback responses based on message characteristics
          if (!response) {
            if (message.includes('thank') || message.includes('thanks')) {
              response = "You're absolutely welcome! üòä I'm thrilled to help you explore SCI-HIGH! Whether you're curious about the game mechanics, research findings, or technical implementation, I'm here to guide your learning adventure. Feel free to ask anything else! üöÄ‚ú®";
            } else if (message.includes('hi') || message.includes('hello') || message.includes('hey')) {
              response = "Hello there, future coding champion! üëã‚ú® Welcome to the world of SCI-HIGH! I'm your dedicated AI assistant, ready to help you navigate this exciting educational gaming adventure. What brings you here today? Are you interested in:\n‚Ä¢ üéÆ Learning about the game\n‚Ä¢ üìö Understanding the research\n‚Ä¢ üíª Exploring programming concepts\n‚Ä¢ üöÄ Getting started with your coding journey";
            } else if (message.includes('bye') || message.includes('goodbye')) {
              response = "Farewell, brave adventurer! üëã May your coding journey be filled with epic discoveries and bug-free adventures! Remember, every expert was once a beginner. Keep learning, keep coding, and keep being awesome! See you next time in the SCI-HIGH universe! üöÄ‚ú®";
            } else if (message.length < 3) {
              response = "Hmm, that's quite brief! ü§î Could you elaborate a bit more? I'm here to help with detailed questions about:\n‚Ä¢ üéÆ Game features and mechanics\n‚Ä¢ üìö Research methodology and findings\n‚Ä¢ üíª Programming concepts and tutorials\n‚Ä¢ üõ†Ô∏è Technical implementation details\n\nWhat would you like to explore? üí´";
            } else {
              response = "That's an interesting question! ü§î While I'd love to give you a perfect answer, I'm specifically designed to help with SCI-HIGH-related topics. I can assist you with:\n\nüéÆ **Game Information**:\n‚Ä¢ Gameplay mechanics and features\n‚Ä¢ Character stories and programming paths\n‚Ä¢ Achievement systems and progress tracking\n\nüìö **Research & Thesis**:\n‚Ä¢ Educational methodology and findings\n‚Ä¢ Gamification effectiveness studies\n‚Ä¢ Academic contributions and implications\n\nüíª **Programming & Technical**:\n‚Ä¢ Supported languages and concepts\n‚Ä¢ Technical architecture and implementation\n‚Ä¢ Learning resources and tutorials\n\nTry asking about any of these topics! üöÄ";
            }
          }
          
          // Add contextual follow-up based on response type
          if (responseType === 'game') {
            response += "\n\nüí° **Want to explore more?** Try asking about specific characters, programming challenges, or technical features!";
          } else if (responseType === 'thesis') {
            response += "\n\nüìä **Curious about methodology?** Ask about data collection methods, sample demographics, or statistical analysis!";
          } else if (responseType === 'technical') {
            response += "\n\n‚öôÔ∏è **Deep dive available!** Ask about specific technologies, performance optimizations, or development challenges!";
          }
          
          // Simulate more realistic typing delay based on response length
          const typingDelay = Math.min(Math.max(response.length * 20, 800), 2500);
          
          setTimeout(() => {
            this.hideTypingIndicator();
            this.addToHistory('assistant', response);
            this.addAssistantMessage(response, responseType);
          }, typingDelay);
        }
        
        showTypingIndicator() {
          this.isTyping = true;
          const messagesContainer = document.getElementById('chat-messages');
          const typingDiv = document.createElement('div');
          typingDiv.className = 'typing-indicator mb-3';
          typingDiv.id = 'typing-indicator';
          typingDiv.innerHTML = `
            <div class="bg-purple/20 rounded-lg p-2 max-w-xs md:p-3">
              <div class="flex items-center space-x-1">
                <div class="flex space-x-1">
                  <div class="w-2 h-2 bg-purple rounded-full animate-bounce"></div>
                  <div class="w-2 h-2 bg-purple rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                  <div class="w-2 h-2 bg-purple rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                </div>
                <span class="text-xs text-gray-400 md:text-sm">AI is thinking...</span>
              </div>
            </div>
          `;
          messagesContainer.appendChild(typingDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        hideTypingIndicator() {
          this.isTyping = false;
          this.setButtonLoading(false);
          const typingIndicator = document.getElementById('typing-indicator');
          if (typingIndicator) {
            typingIndicator.remove();
          }
        }
        
        setupAutoResponses() {
          // Add some helpful tips periodically when panel is open
          setInterval(() => {
            if (this.isOpen && Math.random() < 0.1) { // 10% chance every interval
              const tips = [
                "üí° Tip: Try the Story Mode for narrative-based learning!",
                "üéØ Pro tip: Complete challenges in the Computer Lab for hands-on practice!",
                "‚≠ê Did you know? You can track your progress in the Office section!",
                "üöÄ Quick fact: SCI-HIGH supports both mobile and desktop play!"
              ];
              const randomTip = tips[Math.floor(Math.random() * tips.length)];
              setTimeout(() => this.addAssistantMessage(randomTip, 'info'), 2000);
            }
          }, 30000); // Check every 30 seconds
        }
      }
      
      // Initialize the virtual assistant when the page loads
      document.addEventListener('DOMContentLoaded', () => {
        new VirtualAssistant();
        
        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
        
        // Sync mobile menu visibility with desktop menu for user state
        const syncMobileMenu = () => {
          const loginBtn = document.getElementById('login-btn');
          const professorNavLink = document.getElementById('professor-nav-link');
          const userGreeting = document.getElementById('user-greeting');
          const logoutBtn = document.getElementById('logout-btn');
          
          const mobileLoginBtn = document.getElementById('mobile-login-btn');
          const mobileProfessorNavLink = document.getElementById('mobile-professor-nav-link');
          const mobileUserGreeting = document.getElementById('mobile-user-greeting');
          const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
          
          if (loginBtn && mobileLoginBtn) {
            mobileLoginBtn.style.display = loginBtn.classList.contains('hidden') ? 'none' : 'block';
          }
          if (professorNavLink && mobileProfessorNavLink) {
            mobileProfessorNavLink.style.display = professorNavLink.classList.contains('hidden') ? 'none' : 'block';
          }
          if (userGreeting && mobileUserGreeting) {
            mobileUserGreeting.style.display = userGreeting.classList.contains('hidden') ? 'none' : 'block';
            const greetingText = document.getElementById('greeting-text');
            const mobileGreetingText = document.getElementById('mobile-greeting-text');
            if (greetingText && mobileGreetingText) {
              mobileGreetingText.textContent = greetingText.textContent;
            }
          }
          if (logoutBtn && mobileLogoutBtn) {
            mobileLogoutBtn.style.display = logoutBtn.classList.contains('hidden') ? 'none' : 'block';
          }
        };
        
        // Call sync function periodically to keep mobile menu in sync
        setInterval(syncMobileMenu, 1000);
        syncMobileMenu(); // Initial sync
      });
    </script>
  </body>
</html>