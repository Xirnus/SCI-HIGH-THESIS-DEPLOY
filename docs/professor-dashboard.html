<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="public/assets/img/logo/SCI-HIGH_LOGO.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCI-HIGH: Professor Dashboard</title>
    <!-- Last updated: August 8, 2025 - Force GitHub Pages refresh -->
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Modern Notification System -->
    <script src="js/notifications.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script>
      // Fallback functions in case notifications.js hasn't loaded yet
      window.ensureNotifications = function() {
        if (typeof window.modernConfirm === 'undefined') {
          console.warn('Notification system not loaded, using fallback');
          window.modernConfirm = function(message, options = {}) {
            return Promise.resolve(confirm(message));
          };
          window.modernAlert = function(message, options = {}) {
            alert(message);
            return Promise.resolve(true);
          };
          window.showSuccess = function(message, options = {}) {
            alert('‚úÖ ' + message);
            return Promise.resolve(true);
          };
          window.showError = function(message, options = {}) {
            alert('‚ùå ' + message);
            return Promise.resolve(true);
          };
          window.showWarning = function(message, options = {}) {
            alert('‚ö†Ô∏è ' + message);
            return Promise.resolve(true);
          };
          window.showInfo = function(message, options = {}) {
            alert('‚ÑπÔ∏è ' + message);
            return Promise.resolve(true);
          };
        }
      };
      
      // Ensure notifications are available immediately
      window.ensureNotifications();
    </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F4CE14',
              accent: '#379777',
              dark: '#1a1a2e',
              light: '#16213e',
              purple: '#9c27b0',
              cyan: '#00bcd4',
              textColor: '#ffffff',
              cardBg: 'rgba(22, 33, 62, 0.8)',
            },
            fontFamily: {
              gaming: ['Orbitron', 'monospace'],
              body: ['Exo 2', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      .game-bg {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
      }
      
      .neon-border {
        border: 2px solid #F4CE14;
        background: rgba(22, 33, 62, 0.8);
        box-shadow: 0 0 10px rgba(244, 206, 20, 0.3);
      }
    </style>
  </head>
  <body class="font-body game-bg text-textColor min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-dark/90 to-light/90 backdrop-blur-md border-b-2 border-primary/30 py-4">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2 sm:space-x-4">
            <img src="public/assets/img/buko_productions-logo.png" alt="SCI-HIGH Logo" class="w-10 h-10 sm:w-12 sm:h-12" />
            <span class="font-gaming text-lg sm:text-xl font-bold text-primary hidden sm:inline">Professor Dashboard</span>
            <span class="font-gaming text-sm font-bold text-primary sm:hidden">Professor</span>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" type="button" class="text-textColor hover:text-primary focus:outline-none focus:text-primary transition-colors duration-300" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>
          
          <!-- Desktop navigation -->
          <div class="hidden md:flex items-center space-x-4">
            <span class="text-gray-300 text-sm lg:text-base" id="professor-name">Loading...</span>
            <button id="logout-btn" class="px-3 sm:px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-gaming text-sm transition-colors">
              Logout
            </button>
          </div>
        </div>
        
        <!-- Mobile navigation menu -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
          <div class="px-3 pt-3 pb-4 space-y-2 bg-gradient-to-br from-dark/98 to-light/98 backdrop-blur-xl rounded-xl mt-3 border-2 border-primary/40 shadow-xl shadow-primary/20">
            <div class="px-4 py-3 text-gray-300 font-gaming text-sm bg-dark/30 rounded-lg border border-gray-600" id="mobile-professor-name">Loading...</div>
            <button id="mobile-logout-btn" class="block w-full text-left px-4 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-gaming text-sm transition-colors">
              <span class="flex items-center">
                <span class="mr-2">üö™</span> Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8">
      <!-- Dashboard Header -->
      <div class="mb-6 sm:mb-8">
        <h1 class="font-gaming text-2xl sm:text-4xl font-bold text-primary mb-2">Student Management</h1>
        <p class="text-gray-300 text-sm sm:text-base">View and manage your students' progress</p>
      </div>

      <!-- Quick Actions -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <button id="view-analytics-btn" class="neon-border bg-cardBg rounded-lg p-4 hover:scale-105 transition-transform">
          <div class="text-2xl mb-2">ÔøΩ</div>
          <div class="font-gaming text-primary">Analytics</div>
        </button>
        <button id="export-data-btn" class="neon-border bg-cardBg rounded-lg p-4 hover:scale-105 transition-transform">
          <div class="text-2xl mb-2">ÔøΩ</div>
          <div class="font-gaming text-accent">Export Data</div>
        </button>
        <button id="refresh-students-btn" class="neon-border bg-cardBg rounded-lg p-4 hover:scale-105 transition-transform">
          <div class="text-2xl mb-2">üîÑ</div>
          <div class="font-gaming text-cyan">Refresh</div>
        </button>
      </div>

      <!-- Student List -->
      <div class="neon-border bg-cardBg rounded-xl p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="font-gaming text-2xl text-primary">Student List</h2>
          <div class="flex space-x-4">
            <input type="search" id="search-students" placeholder="Search students..." 
                   class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white placeholder-gray-400">
            <select id="filter-strand" class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white">
              <option value="">All Strands/Courses</option>
              <option value="ICT">ICT</option>
              <option value="BSCS">BSCS</option>
              <option value="BSIT">BSIT</option>
              <option value="STEM">STEM</option>
              <option value="ABM">ABM</option>
              <option value="HUMSS">HUMSS</option>
            </select>
            <select id="filter-year" class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white">
              <option value="">All Years</option>
              <option value="1st">1st Year</option>
              <option value="2nd">2nd Year</option>
              <option value="3rd">3rd Year</option>
              <option value="4th">4th Year</option>
              <option value="5th">5th Year</option>
              <option value="Grade 11">Grade 11</option>
              <option value="Grade 12">Grade 12</option>
            </select>
            <select id="sort-by" class="px-4 py-2 bg-dark/50 border border-gray-600 rounded-lg text-white">
              <option value="name">Sort by Name</option>
              <option value="studentId">Sort by Student ID</option>
              <option value="progress">Sort by Progress</option>
              <option value="lastActive">Sort by Last Active</option>
              <option value="points">Sort by Points</option>
            </select>
          </div>
        </div>

        <!-- Student Table -->
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
              <tr class="border-b border-gray-600">
                <th class="py-3 px-4 font-gaming text-primary">Student ID</th>
                <th class="py-3 px-4 font-gaming text-primary">Name</th>
                <th class="py-3 px-4 font-gaming text-primary">Course/Strand</th>
                <th class="py-3 px-4 font-gaming text-primary">Year Level</th>
                <th class="py-3 px-4 font-gaming text-primary">Progress</th>
                <th class="py-3 px-4 font-gaming text-primary">Last Active</th>
                <th class="py-3 px-4 font-gaming text-primary">Actions</th>
              </tr>
            </thead>
            <tbody id="students-table-body">
              <tr>
                <td colspan="7" class="py-8 text-center text-gray-400">
                  Loading students...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Information Panel -->
    <div class="mb-8 neon-border bg-cardBg rounded-xl p-6">
      <div class="text-center">
        <div class="text-4xl mb-4">üìã</div>
        <h3 class="font-gaming text-lg text-accent mb-3">How Student Accounts Work</h3>
        <p class="text-gray-300 text-sm mb-4">
          Students create their own accounts automatically by entering their Student ID. 
          You can view and manage existing students below.
        </p>
        <div class="text-xs text-gray-400 bg-dark/50 rounded-lg p-3 max-w-md mx-auto">
          <p class="mb-2">‚ÑπÔ∏è <strong>How it works:</strong></p>
          <p>‚Ä¢ Students enter their ID on the login page</p>
          <p>‚Ä¢ New accounts are created automatically</p>
          <p>‚Ä¢ Students can continue their progress seamlessly</p>
        </div>
      </div>
    </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      class ProfessorDashboard {
        constructor() {
          this.students = [];
          this.filteredStudents = [];
          this.currentUser = null;
          this.database = null;
          this.isFirebaseInitialized = false;
          this.init();
        }

        async init() {
          // Initialize Firebase first
          await this.initializeFirebase();
          
          // Check if user is authenticated professor or admin
          const savedUser = localStorage.getItem('sci_high_user');
          if (!savedUser) {
            window.location.href = 'index.html';
            return;
          }

          this.currentUser = JSON.parse(savedUser);
          if (!this.currentUser || (this.currentUser.type !== 'professor' && this.currentUser.type !== 'admin')) {
            window.location.href = 'index.html';
            return;
          }

          this.setupUI();
          this.setupEventListeners();
          await this.loadStudents();
        }

        setupUI() {
          document.getElementById('professor-name').textContent = this.currentUser.profile.fullName;
        }

        setupEventListeners() {
          // Logout
          document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('sci_high_user');
            sessionStorage.removeItem('sci_high_authenticated');
            sessionStorage.removeItem('sci_high_user_type');
            window.location.href = 'index.html';
          });

          // Quick action buttons  
          document.getElementById('view-analytics-btn').addEventListener('click', () => {
            this.showInfo('Analytics dashboard coming soon!');
          });

          document.getElementById('export-data-btn').addEventListener('click', () => {
            this.showInfo('Data export feature coming soon!');
          });

          document.getElementById('refresh-students-btn').addEventListener('click', () => {
            this.loadStudents();
            this.showSuccess('Student list refreshed!');
          });

          // Search and filter
          document.getElementById('search-students').addEventListener('input', (e) => {
            this.filterStudents();
          });

          document.getElementById('filter-strand').addEventListener('change', (e) => {
            this.filterStudents();
          });

          document.getElementById('filter-year').addEventListener('change', (e) => {
            this.filterStudents();
          });

          document.getElementById('sort-by').addEventListener('change', (e) => {
            this.filterStudents();
          });
        }

        async initializeFirebase() {
          try {
            const firebaseConfig = {
              apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
              authDomain: "sci-high-website.firebaseapp.com",
              databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app",
              projectId: "sci-high-website",
              storageBucket: "sci-high-website.appspot.com",
              messagingSenderId: "451463202515",
              appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
            };

            if (!firebase.apps.length) {
              firebase.initializeApp(firebaseConfig);
            }

            this.database = firebase.database();
            this.isFirebaseInitialized = true;
            console.log('Firebase initialized successfully');
            
            // Monitor connection status
            this.database.ref('.info/connected').on('value', (snapshot) => {
              if (snapshot.val() === true) {
                console.log('Connected to Firebase');
              } else {
                console.log('Disconnected from Firebase');
                this.showWarning('Connection to Firebase lost. Some features may not work properly.');
              }
            });
          } catch (error) {
            console.error('Firebase initialization error:', error);
            this.isFirebaseInitialized = false;
          }
        }

        async loadStudents() {
          try {
            if (!this.isFirebaseInitialized) {
              console.warn('Firebase not initialized, loading sample data');
              this.loadSampleData();
              return;
            }

            console.log('Loading students from Firebase...');
            const studentsRef = this.database.ref('students');
            const snapshot = await studentsRef.once('value');
            const studentsData = snapshot.val();

            if (!studentsData) {
              console.log('No students found in Firebase');
              this.students = [];
              this.filteredStudents = [];
              this.renderStudentsTable();
              return;
            }

            // Convert Firebase data to our format
            this.students = Object.keys(studentsData).map(studentId => {
              const student = studentsData[studentId];
              
              // Parse strand and year from strandYear if needed
              let strand = student.strand;
              let year = student.year;
              
              if (!strand && !year && student.strandYear) {
                const parseResult = this.parseStrandYear(student.strandYear);
                strand = parseResult.strand;
                year = parseResult.year;
              }

              return {
                id: studentId,
                studentId: student.studentId || studentId,
                fullName: `${student.firstName || ''} ${student.lastName || ''}`.trim() || 'Unknown',
                academicInfo: {
                  level: student.department === 'College Department' ? 'college' : 'shs',
                  strand: strand || 'N/A',
                  year: year || 'N/A',
                  course: student.strandYear || 'N/A', // Legacy field
                  yearLevel: student.strandYear || 'N/A', // Legacy field
                  department: student.department || 'N/A'
                },
                accountStatus: {
                  createdBy: 'system',
                  lastLogin: student.lastLogin || null,
                  isFirstLogin: !student.lastLogin
                },
                gameData: {
                  totalPoints: student.totalPoints || 0,
                  courseProgress: student.courseProgress || {}
                }
              };
            });

            console.log(`Loaded ${this.students.length} students from Firebase`);
            this.filteredStudents = [...this.students];
            this.renderStudentsTable();

          } catch (error) {
            console.error('Error loading students from Firebase:', error);
            this.showError('Failed to load students from database. Loading sample data instead.');
            this.loadSampleData();
          }
        }

        parseStrandYear(strandYear) {
          let strand = '';
          let year = '';
          
          // Extract year
          const yearMatch = strandYear.match(/(\d+)(st|nd|rd|th)/i);
          if (yearMatch) {
            year = yearMatch[1] + (yearMatch[2] || '');
          } else if (strandYear.includes('Grade')) {
            const gradeMatch = strandYear.match(/Grade\s*(\d+)/i);
            if (gradeMatch) {
              year = `Grade ${gradeMatch[1]}`;
            }
          }
          
          // Extract strand
          if (strandYear.includes('BSCS') || strandYear.includes('BS CS') || strandYear.includes('Computer Science')) {
            strand = 'BSCS';
          } else if (strandYear.includes('BSIT') || strandYear.includes('BS IT') || strandYear.includes('Information Technology')) {
            strand = 'BSIT';
          } else if (strandYear.includes('ICT')) {
            strand = 'ICT';
          } else if (strandYear.includes('STEM')) {
            strand = 'STEM';
          } else if (strandYear.includes('ABM')) {
            strand = 'ABM';
          } else if (strandYear.includes('HUMSS')) {
            strand = 'HUMSS';
          }
          
          return { strand, year };
        }

        loadSampleData() {
          // Fallback sample data when Firebase is not available
          this.students = [
            {
              id: 'stud_sample_001',
              studentId: '24-2024-001',
              fullName: 'Juan Dela Cruz',
              academicInfo: {
                level: 'college',
                strand: 'BSCS',
                year: '3rd',
                course: 'BS Computer Science', // Legacy field
                yearLevel: '3rd Year' // Legacy field
              },
              accountStatus: {
                createdBy: 'sample',
                lastLogin: new Date('2024-01-15').toISOString(),
                isFirstLogin: false
              },
              gameData: {
                totalPoints: 850,
                courseProgress: {
                  python: { progress: 75, completed: 8, total: 12 },
                  javascript: { progress: 60, completed: 6, total: 10 }
                }
              }
            },
            {
              id: 'stud_sample_002',
              studentId: '24-2024-002',
              fullName: 'Maria Santos',
              academicInfo: {
                level: 'college',
                strand: 'BSIT',
                year: '2nd',
                course: 'BS Information Technology', // Legacy field
                yearLevel: '2nd Year' // Legacy field
              },
              accountStatus: {
                createdBy: 'sample',
                lastLogin: new Date('2024-01-20').toISOString(),
                isFirstLogin: false
              },
              gameData: {
                totalPoints: 1200,
                courseProgress: {
                  python: { progress: 90, completed: 11, total: 12 },
                  webdesign: { progress: 85, completed: 9, total: 10 }
                }
              }
            }
          ];

          this.filteredStudents = [...this.students];
          this.renderStudentsTable();
        }

        // Methods for student management
        filterStudents() {
          const searchTerm = document.getElementById('search-students').value.toLowerCase();
          const strandFilter = document.getElementById('filter-strand').value;
          const yearFilter = document.getElementById('filter-year').value;
          const sortBy = document.getElementById('sort-by').value;

          this.filteredStudents = this.students.filter(student => {
            const matchesSearch = !searchTerm || 
              student.studentId.toLowerCase().includes(searchTerm) ||
              student.fullName.toLowerCase().includes(searchTerm);
            
            const matchesStrand = !strandFilter || 
              student.academicInfo.strand === strandFilter ||
              (student.academicInfo.course && student.academicInfo.course.includes(strandFilter));

            const matchesYear = !yearFilter || 
              student.academicInfo.year === yearFilter ||
              student.academicInfo.yearLevel === yearFilter ||
              student.academicInfo.yearLevel === `${yearFilter} Year`;

            return matchesSearch && matchesStrand && matchesYear;
          });

          // Sort the filtered results
          this.filteredStudents.sort((a, b) => {
            switch (sortBy) {
              case 'name':
                return a.fullName.localeCompare(b.fullName);
              case 'studentId':
                return a.studentId.localeCompare(b.studentId);
              case 'progress':
                return this.calculateProgress(b) - this.calculateProgress(a); // Descending
              case 'lastActive':
                const aDate = a.accountStatus.lastLogin ? new Date(a.accountStatus.lastLogin) : new Date(0);
                const bDate = b.accountStatus.lastLogin ? new Date(b.accountStatus.lastLogin) : new Date(0);
                return bDate - aDate; // Most recent first
              case 'points':
                const aPoints = a.gameData?.totalPoints || 0;
                const bPoints = b.gameData?.totalPoints || 0;
                return bPoints - aPoints; // Highest first
              default:
                return 0;
            }
          });

          this.renderStudentsTable();
        }

        renderStudentsTable() {
          const tbody = document.getElementById('students-table-body');
          
          if (this.filteredStudents.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="7" class="py-8 text-center text-gray-400">
                  No students found
                </td>
              </tr>
            `;
            return;
          }

          tbody.innerHTML = this.filteredStudents.map(student => `
            <tr class="border-b border-gray-700 hover:bg-dark/20">
              <td class="py-3 px-4 font-mono">${student.studentId}</td>
              <td class="py-3 px-4">${student.fullName}</td>
              <td class="py-3 px-4">
                ${student.academicInfo.strand || 
                  (student.academicInfo.level === 'college' ? 
                    student.academicInfo.course : 
                    student.academicInfo.strand)}
              </td>
              <td class="py-3 px-4">
                ${student.academicInfo.year ? `${student.academicInfo.year} Year` : student.academicInfo.yearLevel}
              </td>
              <td class="py-3 px-4">
                <div class="w-full bg-gray-700 rounded-full h-2">
                  <div class="bg-primary h-2 rounded-full" style="width: ${this.calculateProgress(student)}%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-400 mt-1">
                  <span>${this.calculateProgress(student)}%</span>
                  <span>${student.gameData?.totalPoints || 0} pts</span>
                </div>
              </td>
              <td class="py-3 px-4 text-sm text-gray-400">
                ${student.accountStatus.lastLogin ? 
                  new Date(student.accountStatus.lastLogin).toLocaleDateString() : 
                  'Never'}
              </td>
              <td class="py-3 px-4">
                <div class="flex space-x-2">
                  <button onclick="dashboard.viewStudent('${student.id}')" 
                          class="px-2 py-1 bg-cyan text-white text-xs rounded hover:bg-cyan/80">
                    View
                  </button>
                  <button onclick="dashboard.resetProgress('${student.id}')" 
                          class="px-2 py-1 bg-yellow-600 text-white text-xs rounded hover:bg-yellow-700">
                    Reset
                  </button>
                </div>
              </td>
            </tr>
          `).join('');
        }

        calculateProgress(student) {
          if (!student.gameData || !student.gameData.courseProgress) return 0;
          
          const courses = Object.values(student.gameData.courseProgress);
          const totalProgress = courses.reduce((sum, course) => sum + (course.progress || 0), 0);
          return Math.round(totalProgress / courses.length);
        }

        showSuccess(message) {
          showSuccess(message, { title: 'Success' });
        }

        showError(message) {
          showError(message, { title: 'Error' });
        }

        showWarning(message) {
          showWarning(message, { title: 'Warning' });
        }

        showInfo(message) {
          showInfo(message, { title: 'Information' });
        }

        // Global methods for inline onclick handlers
        viewStudent(studentId) {
          const student = this.students.find(s => s.id === studentId);
          if (student) {
            this.showInfo(`Student Details:\n\nName: ${student.fullName}\nID: ${student.studentId}\nStrand: ${student.academicInfo.strand}\nYear: ${student.academicInfo.year}\nTotal Points: ${student.gameData?.totalPoints || 0}\nProgress: ${this.calculateProgress(student)}%`, {
              title: `üìä ${student.fullName}'s Profile`
            });
          }
        }

        async resetProgress(studentId) {
          const confirmed = await modernConfirm('Reset all progress for this student? This action cannot be undone.', {
            title: 'Reset Student Progress',
            type: 'warning',
            confirmText: 'Yes, Reset',
            cancelText: 'Cancel'
          });
          
          if (confirmed) {
            try {
              console.log('Resetting progress for student:', studentId);
              
              if (this.isFirebaseInitialized) {
                // Update Firebase
                const studentRef = this.database.ref(`students/${studentId}`);
                await studentRef.update({
                  totalPoints: 0,
                  courseProgress: {},
                  lastUpdated: new Date().toISOString()
                });
                console.log('Firebase update completed');
              }
              
              // Update local data
              const student = this.students.find(s => s.id === studentId);
              if (student) {
                student.gameData = {
                  totalPoints: 0,
                  courseProgress: {}
                };
                this.renderStudentsTable();
              }
              
              this.showSuccess('Student progress has been reset successfully.');
            } catch (error) {
              console.error('Error resetting student progress:', error);
              this.showError('Failed to reset student progress: ' + error.message);
            }
          }
        }

        async resetPassword(studentId) {
          const confirmed = await modernConfirm('Reset password for this student?', {
            title: 'Reset Password',
            type: 'warning',
            confirmText: 'Yes, Reset',
            cancelText: 'Cancel'
          });
          
          if (confirmed) {
            try {
              const newPassword = 'Student123!';
              
              // In production, this would update Firebase
              console.log(`Password reset for student ${studentId}: ${newPassword}`);
              
              this.showSuccess(`Password reset! New password: ${newPassword}`);
            } catch (error) {
              this.showError('Failed to reset password: ' + error.message);
            }
          }
        }
      }

      // Initialize dashboard
      const dashboard = new ProfessorDashboard();
      window.dashboard = dashboard; // Make available for inline handlers

      // Mobile menu functionality
      document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
            
            // Update aria-expanded
            mobileMenuBtn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            
            // Update icon
            const svg = mobileMenuBtn.querySelector('svg');
            if (svg) {
              if (isHidden) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
              } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            }
          });
          
          // Close mobile menu when clicking on a link
          const mobileLinks = mobileMenu.querySelectorAll('a, button');
          mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
              mobileMenu.style.display = 'none';
              mobileMenuBtn.setAttribute('aria-expanded', 'false');
              const svg = mobileMenuBtn.querySelector('svg');
              if (svg) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
              }
            });
          });
        }
        
        // Sync mobile menu professor name with desktop
        const syncProfessorName = () => {
          const professorName = document.getElementById('professor-name');
          const mobileProfessorName = document.getElementById('mobile-professor-name');
          
          if (professorName && mobileProfessorName) {
            mobileProfessorName.textContent = professorName.textContent;
          }
        };
        
        // Call sync function periodically
        setInterval(syncProfessorName, 1000);
        syncProfessorName(); // Initial sync
        
        // Mobile logout functionality
        document.getElementById('mobile-logout-btn').addEventListener('click', () => {
          dashboard.logoutUser();
        });
      });
    </script>
  </body>
</html>
